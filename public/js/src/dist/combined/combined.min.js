function injectCSS(){colorTheme=JSON.parse(savedCSS);for(var a="",b=0;b<colorTheme.css.length;b++)colorTheme.css[b].value&&(a+=colorTheme.css[b].classes.join()+" { "+colorTheme.css[b].pre+": "+colorTheme.css[b].value+" !important } ");jcss.innerHTML=a}function startColorThemes(){function a(){e(),D._dark1=Wu.DomUtil.get("colortheme-dark1"),D._dark2=Wu.DomUtil.get("colortheme-dark2"),D._dark3=Wu.DomUtil.get("colortheme-dark3"),D._light1=Wu.DomUtil.get("colortheme-light1"),D._darktheme=Wu.DomUtil.get("darktheme"),D._lighttheme=Wu.DomUtil.get("lighttheme"),D._color_Inner_wrapper=Wu.DomUtil.get("project-color-theme").parentNode,D._color_Outer_wrapper=Wu.DomUtil.get("project-color-theme").parentNode.parentNode,D._advanced=Wu.DomUtil.get("advanced-theme-selector"),D._color_Inner_wrapper.style.left="-310px",D._color_Outer_wrapper.style.height="182px",D._dark1.onclick=function(){Wu.DomUtil.addClass(D._light1,"colortheme-light1-on"),d("one")},D._dark2.onclick=function(){Wu.DomUtil.addClass(D._light1,"colortheme-light1-on"),d("two")},D._dark3.onclick=function(){Wu.DomUtil.addClass(D._light1,"colortheme-light1-on"),d("three")},D._darktheme.onclick=function(){Wu.DomUtil.addClass(this,"selected"),Wu.DomUtil.removeClass(D._lighttheme,"selected"),colorTheme.darktheme=!0,d(colorTheme.cTheme)},D._lighttheme.onclick=function(){Wu.DomUtil.addClass(this,"selected"),Wu.DomUtil.removeClass(D._darktheme,"selected"),colorTheme.darktheme=!1,d(colorTheme.cTheme)},D._advanced.onclick=function(){H.init(),Wu.DomUtil.removeClass(D._light1,"colortheme-light1-on")}}function d(a){if("one"==a)if(colorTheme.cTheme="one",colorTheme.darktheme)preval_0="#0F1A1E",preval_1="#3F4652",preval_2="#97ABB2",preval_3="#424242",preval_4="cyan",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="#333",preval_13="white",preval_15="white",preval_16="#333",preval_17="rgba(255, 255, 255, 0.15)",preval_18="white",colorTheme.cThemeDarkBox=!0,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!0;else{var b={},c={},d="#ADC3CC";F.convert.HEX2RGB(d,b),F.convert.RGB2HSV(b,c);var e=F.convert.HSV2HEX(c.h,3,98);F.convert.HEX2RGB(d,b);var f="rgba("+b.r+","+b.g+","+b.b+",0.5)";preval_0=d,preval_1=e,preval_2="red",preval_3="white",preval_4="#309EB2",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="white",preval_13="black",preval_15="#333",preval_16="white",preval_17=f,preval_18=d,colorTheme.cThemeDarkBox=!1,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!1}if("two"==a)if(colorTheme.cTheme="two",colorTheme.darktheme)preval_0="#0F1A1E",preval_1="#2C3A3F",preval_2="#A6B7BF",preval_3="#424242",preval_4="#FF5300",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#F98752",preval_9="#FCF2ED",preval_10="white",preval_11="white",preval_12="#333",preval_13="white",preval_15="white",preval_16="#333",preval_17="rgba(255, 255, 255, 0.15)",preval_18="white",colorTheme.cThemeDarkBox=!0,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!0;else{var b={},c={},d="#CCBFAD";F.convert.HEX2RGB(d,b),F.convert.RGB2HSV(b,c);var e=F.convert.HSV2HEX(c.h,3,98);F.convert.HEX2RGB(d,b);var f="rgba("+b.r+","+b.g+","+b.b+",0.5)";preval_0=d,preval_1=e,preval_2="red",preval_3="white",preval_4="#2B889E",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="white",preval_13="black",preval_15="#333",preval_16="white",preval_17=f,preval_18=d,colorTheme.cThemeDarkBox=!1,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!1}if("three"==a)if(colorTheme.cTheme="three",colorTheme.darktheme)preval_0="#0F1A1E",preval_1="#333333",preval_2="#A6A6A6",preval_3="#424242",preval_4="#FF00AA",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="#333",preval_13="white",preval_15="white",preval_16="#333",preval_17="rgba(255, 255, 255, 0.15)",preval_18="white",colorTheme.cThemeDarkBox=!0,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!0;else{var b={},c={},d="#BCBCBC";F.convert.HEX2RGB(d,b),F.convert.RGB2HSV(b,c);var e=F.convert.HSV2HEX(c.h,0,98);F.convert.HEX2RGB(d,b);var f="rgba("+b.r+","+b.g+","+b.b+",0.5)";preval_0=d,preval_1=e,preval_2="red",preval_3="white",preval_4="#AE2B95",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="white",preval_13="black",preval_15="#333",preval_16="white",preval_17=f,preval_18=d,colorTheme.cThemeDarkBox=!1,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!1}colorTheme.css[3].value=preval_3,colorTheme.css[4].value=preval_4,colorTheme.css[5].value=preval_5,colorTheme.css[6].value=preval_6,colorTheme.css[7].value=preval_7,colorTheme.css[8].value=preval_8,colorTheme.css[9].value=preval_9,colorTheme.cThemeDarkMenu?j(preval_1):k(preval_1),colorTheme.cThemeDarkBox?(colorTheme.css[14].value="rgba(0,0,0,0.7)",colorTheme.css[31].value="-56px 8px"):(colorTheme.css[14].value="rgba(255, 255, 255, 0.7)",colorTheme.css[31].value=""),colorTheme.cThemeDarkHeader?(colorTheme.css[15].value="rgba(0,0,0,0.8)",colorTheme.css[16].value="white"):(colorTheme.css[15].value="rgba(255,255,255,0.92)",colorTheme.css[16].value="#333"),colorTheme.css[10].value=preval_10,F.update.CSSstring(),jcss.innerHTML=w}function e(){D._hexColor=Wu.DomUtil.get("hexColor"),D._rChannel=Wu.DomUtil.get("rChannel"),D._gChannel=Wu.DomUtil.get("gChannel"),D._bChannel=Wu.DomUtil.get("bChannel"),D._hChannel=Wu.DomUtil.get("hChannel"),D._sChannel=Wu.DomUtil.get("sChannel"),D._vChannel=Wu.DomUtil.get("vChannel"),D._hexColor.onblur=function(){F.update.HEX(D._hexColor.value),F.update.inputFields("HEX")},D._rChannel.onblur=function(){F.update.RGB(o),F.update.inputFields("RGB")},D._gChannel.onblur=function(){F.update.RGB(o),F.update.inputFields("RGB")},D._bChannel.onblur=function(){F.update.RGB(o),F.update.inputFields("RGB")},D._hChannel.onblur=function(){F.update.HSV(p),F.update.inputFields("HSV")},D._sChannel.onblur=function(){F.update.HSV(p),F.update.inputFields("HSV")},D._vChannel.onblur=function(){F.update.HSV(p),F.update.inputFields("HSV")}}function f(){v.complimentary=[],v.complimentary[0]="#complimentary_swatch_0 { background-color: "+A[0][0].HEX+" !important }",v.complimentary[1]="#complimentary_swatch_1 { background-color: "+A[1][0].HEX+" !important }",v.complimentary[2]="#complimentary_swatch_2 { background-color: "+A[2][0].HEX+" !important }",v.complimentary[3]="#complimentary_swatch_3 { background-color: "+A[3][0].HEX+" !important }",v.matching=[],v.matching[0]="#matching_swatch_0 { background-color: "+B[0][0].HEX+" !important }",v.matching[1]="#matching_swatch_1 { background-color: "+B[1][0].HEX+" !important }",v.matching[2]="#matching_swatch_2 { background-color: "+B[2][0].HEX+" !important }",v.matching[3]="#matching_swatch_3 { background-color: "+B[3][0].HEX+" !important }",v.matching[4]="#matching_swatch_4 { background-color: "+B[4][0].HEX+" !important }",v.dark=[],v.dark[0]="#dark_swatch_0 { background-color: "+y[0][0].HEX+" !important }",v.dark[1]="#dark_swatch_1 { background-color: "+y[1][0].HEX+" !important }",v.dark[2]="#dark_swatch_2 { background-color: "+y[2][0].HEX+" !important }",v.dark[3]="#dark_swatch_3 { background-color: "+y[3][0].HEX+" !important }",v.dark[4]="#dark_swatch_4 { background-color: "+y[4][0].HEX+" !important }",v.dark[5]="#dark_swatch_5 { background-color: "+y[5][0].HEX+" !important }",v.light=[],v.light[0]="#light_swatch_0 { background-color: "+x[0][0].HEX+" !important }",v.light[1]="#light_swatch_1 { background-color: "+x[1][0].HEX+" !important }",v.light[2]="#light_swatch_2 { background-color: "+x[2][0].HEX+" !important }",v.light[3]="#light_swatch_3 { background-color: "+x[3][0].HEX+" !important }",v.light[4]="#light_swatch_4 { background-color: "+x[4][0].HEX+" !important }",v.light[5]="#light_swatch_5 { background-color: "+x[5][0].HEX+" !important }",v.bright=[],v.bright[0]="#bright_swatch_0 { background-color: "+z[0][0].HEX+" !important }",v.bright[1]="#bright_swatch_1 { background-color: "+z[1][0].HEX+" !important }",v.bright[2]="#bright_swatch_2 { background-color: "+z[2][0].HEX+" !important }",v.bright[3]="#bright_swatch_3 { background-color: "+z[3][0].HEX+" !important }",v.bright[4]="#bright_swatch_4 { background-color: "+z[4][0].HEX+" !important }",v.bright[5]="#bright_swatch_5 { background-color: "+z[5][0].HEX+" !important }",v.bright[6]="#bright_swatch_6 { background-color: "+z[6][0].HEX+" !important }",v.bright[7]="#bright_swatch_7 { background-color: "+z[7][0].HEX+" !important }",v.bright[8]="#bright_swatch_8 { background-color: "+z[8][0].HEX+" !important }",v.bright[9]="#bright_swatch_9 { background-color: "+z[9][0].HEX+" !important }",v.bright[10]="#bright_swatch_10 { background-color: "+z[10][0].HEX+" !important }";var a="";a+=v.dark.join(" "),a+=v.light.join(" "),a+=v.complimentary.join(" "),a+=v.matching.join(" "),a+=v.bright.join(" "),m.innerHTML=a}function h(a,b){"light"==a&&(colorTheme.cThemeDarkMenu=!1),"dark"==a&&(colorTheme.cThemeDarkMenu=!0),l(),1==u&&("light"==a&&(k(x[b][0].HEX),D._hexColor.value=x[b][0].HEX),"dark"==a&&(j(y[b][0].HEX),D._hexColor.value=y[b][0].HEX)),2==u&&("complimentary"==a&&(colorTheme.css[5].value=A[b][0].HEX,colorTheme.css[6].value=A[b][3].HEX,colorTheme.css[7].value=A[b][4].HEX,D._hexColor.value=A[b][0].HEX),"matching"==a&&(colorTheme.css[5].value=B[b][0].HEX,colorTheme.css[6].value=B[b][2].HEX,colorTheme.css[7].value=B[b][4].HEX,D._hexColor.value=B[b][0].HEX)),3==u&&("complimentary"==a&&(colorTheme.css[8].value=A[b][0].HEX,colorTheme.css[9].value=A[b][4].HEX,D._hexColor.value=A[b][0].HEX),"matching"==a&&(colorTheme.css[8].value=B[b][0].HEX,colorTheme.css[9].value=B[b][4].HEX,D._hexColor.value=B[b][0].HEX)),4==u&&"bright"==a&&(colorTheme.css[4].value=z[b][0].HEX,D._hexColor.value=z[b][0].HEX),F.update.inputFields("HEX"),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.CSSstring(),jcss.innerHTML=w}function j(a){var b=new Object,c=new Object;F.convert.HEX2RGB(a,b),F.convert.RGB2HSV(b,c);var d=c.h,e=F.convert.HSV2HEX(d,50,12),f=F.convert.HSV2HEX(d,30,25),g=F.convert.HSV2HEX(d,15,70);colorTheme.css[0].value=e,colorTheme.css[1].value=f,colorTheme.css[2].value=g,colorTheme.css[11].value="#666",colorTheme.css[12].value="#FFF",colorTheme.css[13].value="#FFFFFF",colorTheme.css[17].value="",colorTheme.css[18].value="white",colorTheme.css[19].value="",colorTheme.css[20].value="",colorTheme.css[22].value="",colorTheme.css[23].value="",colorTheme.css[24].value="",colorTheme.css[25].value="",colorTheme.css[26].value="",colorTheme.css[27].value="",colorTheme.css[28].value="",colorTheme.css[32].value="white",colorTheme.css[33].value="black",colorTheme.css[34].value="rgba(0,0,0,0.4)"}function k(a){var b=new Object,c=new Object;F.convert.HEX2RGB(a,b),F.convert.RGB2HSV(b,c);var d=c.h,e=F.convert.HSV2HEX(d,15,80),f=F.convert.HSV2HEX(d,1,99),g=F.convert.HSV2HEX(d,30,25),b={};F.convert.HEX2RGB(e,b);var h="rgba("+b.r+","+b.g+","+b.b+",0.5)",i="rgba("+b.r+","+b.g+","+b.b+",0.25)",j=d+150;j>360&&(j-=360);var k=F.convert.HSV2HEX(j,20,60);colorTheme.css[0].value=e,colorTheme.css[1].value=f,colorTheme.css[2].value=g,colorTheme.css[11].value="#FFFFFF",colorTheme.css[12].value="#FFFFFF",colorTheme.css[13].value="#666",colorTheme.css[17].value=h,colorTheme.css[18].value=e,colorTheme.css[19].value=h,colorTheme.css[20].value=i,colorTheme.css[22].value="transparent",colorTheme.css[23].value="#666",colorTheme.css[24].value="white",colorTheme.css[25].value="rgba(0, 0, 0, 0.5)",colorTheme.css[26].value="rgba(0, 0, 0, 0.1)",colorTheme.css[27].value="600",colorTheme.css[28].value="200",colorTheme.css[32].value=k,colorTheme.css[33].value="white",colorTheme.css[34].value="rgba(0,0,0,0.6)"}function l(){colorTheme.cThemeDarkMenu?(Wu.DomUtil.addClass(D._tickMenuDark,"active-toggle"),Wu.DomUtil.removeClass(D._tickMenuLight,"active-toggle")):(Wu.DomUtil.addClass(D._tickMenuLight,"active-toggle"),Wu.DomUtil.removeClass(D._tickMenuDark,"active-toggle"))}var m,n,o,p,q=!1,s=!1,t=!1,u=!1,v={},w="",x=[],y=[],z=[],A=[],B=[],C=[],D={},E=[];colorTheme.darktheme=!0,colorTheme.cTheme=!1,colorTheme.cThemeDarkMenu=!0,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkBox=!1,(!colorTheme.css||q)&&(colorTheme.css=[]),m=document.createElement("style"),m.setAttribute("type","text/css"),m.setAttribute("rel","stylesheet"),_CTheader.appendChild(m);var F={HSVobject:function(a,b,c){this.h=a,this.s=b,this.v=c,this.validate=function(){this.h<=0&&(this.h=0),this.s<=0&&(this.s=0),this.v<=0&&(this.v=0),this.h>360&&(this.h=360),this.s>100&&(this.s=100),this.v>100&&(this.v=100)}},RGBobject:function(a,b,c){this.r=a,this.g=b,this.b=c,this.validate=function(){this.r<=0&&(this.r=0),this.g<=0&&(this.g=0),this.b<=0&&(this.b=0),this.r>255&&(this.r=255),this.g>255&&(this.g=255),this.b>255&&(this.b=255)}},convert:{hexify:function(a){var b="0123456789ABCDEF",c=a%16,d=(a-c)/16,e=b.charAt(d)+b.charAt(c);return e},decimalize:function(a){var b="0123456789ABCDEF";return 16*b.indexOf(a.charAt(0).toUpperCase())+b.indexOf(a.charAt(1).toUpperCase())},HEX2RGB:function(a,b){b.r=this.decimalize(a.substring(1,3)),b.g=this.decimalize(a.substring(3,5)),b.b=this.decimalize(a.substring(5,7))},RGB2HEX:function(a){return"#"+this.hexify(a.r)+this.hexify(a.g)+this.hexify(a.b)},RGB2HSV:function(a,c){r=a.r/255,g=a.g/255,b=a.b/255;var d=Math.min(r,g,b),e=Math.max(r,g,b),f=e-d;if(c.v=e,0==f)c.h=0,c.s=0;else{c.s=f/e;var h=((e-r)/6+f/2)/f,i=((e-g)/6+f/2)/f,j=((e-b)/6+f/2)/f;r==e?c.h=j-i:g==e?c.h=1/3+h-j:b==e&&(c.h=2/3+i-h),c.h<0&&(c.h+=1),c.h>1&&(c.h-=1)}c.h*=360,c.s*=100,c.v*=100},HSV2RGB:function(a,b){var c=a.h/360,d=a.s/100,e=a.v/100;0==d?(b.r=255*e,b.g=255*e,b.b=255*e):(var_h=6*c,var_i=Math.floor(var_h),var_1=e*(1-d),var_2=e*(1-d*(var_h-var_i)),var_3=e*(1-d*(1-(var_h-var_i))),0==var_i?(var_r=e,var_g=var_3,var_b=var_1):1==var_i?(var_r=var_2,var_g=e,var_b=var_1):2==var_i?(var_r=var_1,var_g=e,var_b=var_3):3==var_i?(var_r=var_1,var_g=var_2,var_b=e):4==var_i?(var_r=var_3,var_g=var_1,var_b=e):(var_r=e,var_g=var_1,var_b=var_2),b.r=255*var_r,b.g=255*var_g,b.b=255*var_b)},HSV2HEX:function(a,b,c){var d=new F.RGBobject,e=new F.HSVobject(a,b,c);e.validate(),this.HSV2RGB(e,d);var f=this.RGB2HEX(d);return f}},update:{CSSstring:function(){w="";for(var a=0;a<colorTheme.css.length;a++)colorTheme.css[a].value&&(w+=colorTheme.css[a].classes.join()+" { "+colorTheme.css[a].pre+": "+colorTheme.css[a].value+" !important } ");savedCSS=JSON.stringify(colorTheme),Wu.app._activeProject&&Wu.app._activeProject.saveColorTheme()},makeComplimentary:function(a){D._yourswatch.style.backgroundColor=a;var b=a,c=new F.RGBobject(0,0,0),d=new F.HSVobject(0,0,0);F.convert.HEX2RGB(b,c),F.convert.RGB2HSV(c,d),F.sliders.updateAllSliders(c,d),A[0]=[],A[0][0]={},A[0][0].HEX=a,A[0][0].RGB={r:c.r,g:c.g,b:c.b},A[0][0].HSV={h:d.h,s:d.s,v:d.v};for(var e=(360-A[0][0].HSV.h,0);4>e;e++){var f=A[0][0].HSV.h+90*e;f>360&&(f-=360),f=Math.floor(f),d.h=f,d.s=A[0][0].HSV.s,d.v=A[0][0].HSV.v,A[e]=[],A[e][0]={},F.convert.HSV2RGB(d,c);var g=F.convert.RGB2HEX(c);A[e][0].HEX=g,A[e][0].RGB={r:c.r,g:c.g,b:c.b},A[e][0].HSV={h:d.h,s:d.s,v:d.v},this.colorGrade(A,e,d)}},matchColors:function(){o=A[0][0].RGB,p=A[0][0].HSV,F.cMatch.domatch(p),this.colorGrade(B,0,B[0][0].HSV),this.colorGrade(B,1,B[1][0].HSV),this.colorGrade(B,2,B[2][0].HSV),this.colorGrade(B,3,B[3][0].HSV),this.colorGrade(B,4,B[4][0].HSV)},colorGrade:function(a,b,c){for(var d=0;6>d;d++){var e=new F.RGBobject(0,0,0),f=c.v,g=100-f,h=g/6;c.v=Math.floor(f+h*d);var i=c.s,j=i/6;c.s=Math.floor(i-j*d),F.convert.HSV2RGB(c,e);var k=F.convert.RGB2HEX(e);a[b][d]={},a[b][d].HEX=k,a[b][d].RGB={r:e.r,g:e.g,b:e.b},a[b][d].HSV={h:c.h,s:c.s,v:c.v}}},RGB:function(a){var b=new F.HSVobject(0,0,0);F.convert.RGB2HSV(a,b),D._hexColor.value=F.convert.RGB2HEX(a),D._rChannel.value=Math.round(a.r),D._gChannel.value=Math.round(a.g),D._bChannel.value=Math.round(a.b),D._hChannel.value=Math.round(b.h),D._sChannel.value=Math.round(b.s),D._vChannel.value=Math.round(b.v)},HSV:function(a){var b=new F.RGBobject(0,0,0);F.convert.HSV2RGB(a,b),D._hexColor.value=F.convert.RGB2HEX(b),D._rChannel.value=Math.round(b.r),D._gChannel.value=Math.round(b.g),D._bChannel.value=Math.round(b.b),D._hChannel.value=Math.round(a.h),D._sChannel.value=Math.round(a.s),D._vChannel.value=Math.round(a.v)},HEX:function(a){var b=new F.RGBobject(0,0,0),c=new F.HSVobject(0,0,0);F.convert.HEX2RGB(a,b),F.convert.RGB2HSV(b,c),D._rChannel.value=Math.round(b.r),D._gChannel.value=Math.round(b.g),D._bChannel.value=Math.round(b.b),D._hChannel.value=Math.round(c.h),D._sChannel.value=Math.round(c.s),D._vChannel.value=Math.round(c.v)},inputFields:function(a){var b=new Object,c=new Object;if("HEX"==a){var d=D._hexColor.value;F.convert.HEX2RGB(d,b),F.convert.RGB2HSV(b,c),D._rChannel.value=Math.floor(b.r),D._gChannel.value=Math.floor(b.g),D._bChannel.value=Math.floor(b.b),D._hChannel.value=Math.floor(c.h),D._sChannel.value=Math.floor(c.s),D._vChannel.value=Math.floor(c.v)}if("RGB"==a){b.r=D._rChannel.value,b.g=D._gChannel.value,b.b=D._bChannel.value,F.convert.RGB2HSV(b,c);var d=F.convert.RGB2HEX(b);D._hexColor.value=d,D._hChannel.value=Math.floor(c.h),D._sChannel.value=Math.floor(c.s),D._vChannel.value=Math.floor(c.v)}if("HSV"==a){c.r=D._hChannel.value,c.g=D._sChannel.value,c.b=D._vChannel.value,F.convert.HSV2RGB(c,b);var d=F.convert.RGB2HEX(b);D._hexColor.value=d,D._rChannel.value=Math.floor(b.r),D._gChannel.value=Math.floor(b.g),D._bChannel.value=Math.floor(b.b)}F.sliders.updateAllSliders(b,c)},customColors:function(){if("all"==u){var a=D._hexColor.value;this.makeComplimentary(a),this.matchColors(),f(),colorTheme.cThemeDarkMenu?j(a):k(a),colorTheme.css[4].value=B[2][0].HEX,colorTheme.css[5].value=A[0][0].HEX,colorTheme.css[6].value=A[0][3].HEX,colorTheme.css[7].value=A[0][4].HEX,colorTheme.css[8].value=A[2][0].HEX,colorTheme.css[9].value=A[2][4].HEX}if(1==u){var b={h:parseInt(D._hChannel.value),s:parseInt(D._sChannel.value),v:parseInt(D._vChannel.value)};C[1]=[],this.colorGrade(C,1,b),colorTheme.cThemeDarkMenu?j(C[1][0].HEX):k(C[1][0].HEX)}if(2==u){var b={h:parseInt(D._hChannel.value),s:parseInt(D._sChannel.value),v:parseInt(D._vChannel.value)};C[2]=[],this.colorGrade(C,2,b),colorTheme.css[5].value=C[2][0].HEX,colorTheme.css[6].value=C[2][3].HEX,colorTheme.css[7].value=C[2][4].HEX}if(3==u){var b={h:parseInt(D._hChannel.value),s:parseInt(D._sChannel.value),v:parseInt(D._vChannel.value)};C[3]=[],this.colorGrade(C,3,b),colorTheme.css[8].value=C[3][0].HEX,colorTheme.css[9].value=C[3][4].HEX}if(4==u){var b={h:parseInt(D._hChannel.value),s:parseInt(D._sChannel.value),v:parseInt(D._vChannel.value)};C[4]=[],this.colorGrade(C,4,b),colorTheme.css[4].value=C[4][0].HEX}F.update.CSSstring(),jcss.innerHTML=w}},sliders:{updateAllSliders:function(a,b){"range-slider-1"!=s&&this.slideupdater("range-slider-1","hChannel",360,b,a),"range-slider-2"!=s&&this.slideupdater("range-slider-2","sChannel",100,b,a),"range-slider-3"!=s&&this.slideupdater("range-slider-3","vChannel",100,b,a),"range-slider-r"!=s&&this.slideupdater("range-slider-r","rChannel",255,b,a),"range-slider-g"!=s&&this.slideupdater("range-slider-g","gChannel",255,b,a),"range-slider-b"!=s&&this.slideupdater("range-slider-b","bChannel",255,b,a)},rangeSlider:function(a,b,c){var d,e,f=Wu.DomUtil.get(a),g=f.children[0],h=10,i=!1;g.style.width=h+"px",g.style.left=-h+"px",g.style.marginLeft=h/2+"px";var j=this;f.addEventListener("mousedown",function(f){return d=215,e=150,s=a,i=!0,j.updateDragger(f,g,b,i,e,d,h,c,j),!1}),document.addEventListener("mousemove",function(a){j.updateDragger(a,g,b,i,e,d,h,c,j)}),document.addEventListener("mouseup",function(){i=!1,s=!1})},updateDragger:function(a,b,c,d,e,f,g,h){if(d&&a.pageX>=e&&a.pageX<=e+f&&(b.style.left=a.pageX-e-g+"px","function"==typeof h)){var i=Math.round((a.pageX-e)/f*c);h(i)}},slideupdater:function(a,b,c,d,e){if("range-slider-1"==s||"range-slider-2"==s||"range-slider-3"==s){var f=Wu.DomUtil.get("range-slider-r").children[0],g=Math.floor(e.r*(205/255));f.style.left=g+"px";var h=Wu.DomUtil.get("range-slider-g").children[0],i=Math.floor(e.g*(205/255));h.style.left=i+"px";var j=Wu.DomUtil.get("range-slider-b").children[0],k=Math.floor(e.b*(205/255));j.style.left=k+"px"}if("range-slider-r"==s||"range-slider-g"==s||"range-slider-b"==s){var l=Wu.DomUtil.get("range-slider-1").children[0],m=Math.floor(d.h*(205/360));l.style.left=m+"px";var n=Wu.DomUtil.get("range-slider-2").children[0],o=Math.floor(2.05*d.s);n.style.left=o+"px";var p=Wu.DomUtil.get("range-slider-3").children[0],q=Math.floor(2.05*d.v);p.style.left=q+"px"}if(!s){var r,t=Wu.DomUtil.get(a),u=t.children[0];"hChannel"==b&&(r=d.h),"sChannel"==b&&(r=d.s),"vChannel"==b&&(r=d.v),"rChannel"==b&&(r=e.r),"gChannel"==b&&(r=e.g),"bChannel"==b&&(r=e.b),r>=c&&(r=c);var v=205/c;r=Math.floor(r*v),u.style.left=r+"px"}}},cMatch:{domatch:function(a){var b=a,c=new Object,d=new Object,e=new Object;d.s=b.s,d.h=b.h,d.v=b.v>70?b.v-30:b.v+30;var f=new Object;F.convert.HSV2RGB(d,f),c=f,this.outp("0",c),b.h>=0&&b.h<30&&(e.h=d.h=b.h+30,e.s=d.s=b.s,d.v=b.v,e.v=b.v>70?b.v-30:b.v+30),b.h>=30&&b.h<60&&(e.h=d.h=b.h+150,d.s=this.rc(b.s-30,100),d.v=this.rc(b.v-20,100),e.s=this.rc(b.s-50,100),e.v=this.rc(b.v+20,100)),b.h>=60&&b.h<180&&(e.h=d.h=b.h-40,d.s=e.s=b.s,d.v=b.v,e.v=b.v>70?b.v-30:b.v+30),b.h>=180&&b.h<220&&(e.h=b.h-170,d.h=b.h-160,e.s=d.s=b.s,d.v=b.v,e.v=b.v>70?b.v-30:b.v+30),b.h>=220&&b.h<300&&(e.h=d.h=b.h,e.s=d.s=this.rc(b.s-40,100),d.v=b.v,e.v=b.v>70?b.v-30:b.v+30),b.h>=300&&(d.s=e.s=b.s>50?b.s-40:b.s+40,e.h=d.h=(b.h+20)%360,d.v=b.v,e.v=b.v>70?b.v-30:b.v+30);var f=new Object;F.convert.HSV2RGB(d,f),c=f,this.outp("1",c);var f=new Object;F.convert.HSV2RGB(e,f),c=f,this.outp("2",c),d.h=0,d.s=0,d.v=100-b.v;var f=new Object;F.convert.HSV2RGB(d,f),c=f,this.outp("3",c),d.h=0,d.s=0,d.v=b.v;var f=new Object;F.convert.HSV2RGB(d,f),c=f,this.outp("4",c)},outp:function(a,b){B[a]=[],B[a][0]={},B[a][0].HEX="#"+F.convert.hexify(b.r)+F.convert.hexify(b.g)+F.convert.hexify(b.b);var b=new Object,c=new Object;F.convert.HEX2RGB(B[a][0].HEX,b),F.convert.RGB2HSV(b,c),B[a][0].RGB={r:b.r,g:b.g,b:b.b},B[a][0].HSV={h:c.h,s:c.s,v:c.v}},rc:function(a,b){return a>b?b:0>a?0:a}},cPicker:{img2canvas:function(){istat=!0,cnvWidth=120,cnvHeight=70,c=D._myCanvas,ctx=c.getContext("2d"),cPix=D._pixCanvas,ctxPix=cPix.getContext("2d"),ctxPix.mozImageSmoothingEnabled=!1,ctxPix.webkitImageSmoothingEnabled=!1,img=D._canvimg,imgHeight=img.height,imgWidth=img.width,cnvHeight>imgHeight&&cnvWidth>imgWidth&&(ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1),1.56667>imgWidth/imgHeight?cnvWidth=imgWidth/imgHeight*cnvHeight:cnvHeight=cnvWidth/(imgWidth/imgHeight),ctx.clearRect(0,0,c.width,c.height),ctx.drawImage(img,0,0,cnvWidth,cnvHeight);var a=this,b=function(){if(t)if("all"==u)1==confirm("This action will regenerate a color palette for you. By proceding all your changes will be lost!")&&(t=!1,F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"));else{imageData=ctxPix.getImageData(0,0,150,150);var b="#"+a.d2h(imageData.data[45300])+a.d2h(imageData.data[45301])+a.d2h(imageData.data[45302]);D._hexColor.value=b,F.update.HEX(D._hexColor.value),F.update.customColors()}else{imageData=ctxPix.getImageData(0,0,150,150);var b="#"+a.d2h(imageData.data[45300])+a.d2h(imageData.data[45301])+a.d2h(imageData.data[45302]);D._hexColor.value=b,F.update.HEX(D._hexColor.value),F.update.customColors()}},d=function(b){ev=1,istat&&(mousePos=a.getMousePos(c,b),a.drawPix(cPix,ctxPix,img,Math.round(mousePos.x*(imgWidth/cnvWidth)),Math.round(mousePos.y*(imgHeight/cnvHeight))))};c.addEventListener("mousemove",d,!1),c.addEventListener("mousedown",b,!1)},drawPix:function(a,b,c,d,e){b.clearRect(0,0,a.width,a.height),5>d&&(d=5),5>e&&(e=5),d>imgWidth-4&&(d=imgWidth-4),e>imgHeight-4&&(e=imgHeight-4),b.drawImage(c,d-5,e-5,9,9,0,0,a.width,a.height)},getMousePos:function(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}},d2h:function(a){return("0"+a.toString(16)).slice(-2).toUpperCase()}},cFind:function(a){this.callback=a,this.getMostProminentColor=function(a){var b=null;this.callback||(this.callback=function(){return 1});var c=this.getImageData(a);return b=this.getMostProminentRGBImpl(c,6,b,this.callback),b=this.getMostProminentRGBImpl(c,4,b,this.callback),b=this.getMostProminentRGBImpl(c,2,b,this.callback),b=this.getMostProminentRGBImpl(c,0,b,this.callback)},this.getImageData=function(a,b){var c,d,e,f,g,h,i=document.createElement("canvas"),j=i.getContext&&i.getContext("2d"),k=-4;if(!j)return defaultRGB;f=i.height=a.naturalHeight||a.offsetHeight||a.height,e=i.width=a.naturalWidth||a.offsetWidth||a.width,j.drawImage(a,0,0);try{d=j.getImageData(0,0,e,f)}catch(l){return null}h=d.data.length;for(var m=Math.max(1,Math.round(h/5e3)),n={};(k+=4*m)<h;)d.data[k+3]>32&&(g=(d.data[k]>>b)+","+(d.data[k+1]>>b)+","+(d.data[k+2]>>b),n.hasOwnProperty(g)?(c=n[g],c.count++):(c={r:d.data[k],g:d.data[k+1],b:d.data[k+2],count:1},c.weight=this.callback(c.r,c.g,c.b),c.weight<=0&&(c.weight=1e-10),n[g]=c));return n},this.getMostProminentRGBImpl=function(a,b,c){var d,e,f,g,h,j,k={r:0,g:0,b:0,count:0,d:b},l={},m=0;for(e in a)d=a[e],totalWeight=d.weight*d.count,++m,this.doesRgbMatch(c,d.r,d.g,d.b)&&(f=(d.r>>b)+","+(d.g>>b)+","+(d.b>>b),l.hasOwnProperty(f)?l[f]+=totalWeight:l[f]=totalWeight);for(i in l)data=i.split(","),g=data[0],h=data[1],j=data[2],m=l[i],m>k.count&&(k.count=m,data=i.split(","),k.r=g,k.g=h,k.b=j);return k},this.doesRgbMatch=function(a,b,c,d){return null==a?!0:(b>>=a.d,c>>=a.d,d>>=a.d,a.r==b&&a.g==c&&a.b==d)}},makeLightColors:function(a,b){x[a]=[],x[a][0]={},x[a][0].HSV={},x[a][0].HSV.h=b,x[a][0].HSV.s=15,x[a][0].HSV.v=80,x[a][0].HEX=this.convert.HSV2HEX(b,15,80),x[a][0].RGB={},this.convert.HSV2RGB(x[a][0].HSV,x[a][0].RGB),x[a][1]={},x[a][1].HSV={},x[a][1].HSV.h=b,x[a][1].HSV.s=1,x[a][1].HSV.v=99,x[a][1].HEX=this.convert.HSV2HEX(b,1,99),x[a][1].RGB={},this.convert.HSV2RGB(x[a][1].HSV,x[a][1].RGB),x[a][2]={},x[a][2].HSV={},x[a][2].HSV.h=b,x[a][2].HSV.s=30,x[a][2].HSV.v=25,x[a][2].HEX=this.convert.HSV2HEX(b,30,25),x[a][2].RGB={},this.convert.HSV2RGB(x[a][2].HSV,x[a][2].RGB)},makeDarkColors:function(a,b){y[a]=[],y[a][0]={},y[a][0].HSV={},y[a][0].HSV.h=b,y[a][0].HSV.s=50,y[a][0].HSV.v=12,y[a][0].HEX=this.convert.HSV2HEX(b,50,12),y[a][0].RGB={},this.convert.HSV2RGB(y[a][0].HSV,y[a][0].RGB),y[a][1]={},y[a][1].HSV={},y[a][1].HSV.h=b,y[a][1].HSV.s=30,y[a][1].HSV.v=25,y[a][1].HEX=this.convert.HSV2HEX(b,30,25),y[a][1].RGB={},this.convert.HSV2RGB(y[a][1].HSV,y[a][1].RGB),y[a][2]={},y[a][2].HSV={},y[a][2].HSV.h=b,y[a][2].HSV.s=15,y[a][2].HSV.v=70,y[a][2].HEX=this.convert.HSV2HEX(b,15,70),y[a][2].RGB={},this.convert.HSV2RGB(y[a][2].HSV,y[a][2].RGB)}};a();var G={go:function(){(!colorTheme.css||q)&&(this.stackClasses(E),this.makeCSSelements(E),this.makeCSSel())},stackClasses:function(a){a[0]=[".ct0","#content",".item-list.controls-item",".item-list.layer-item",".item-list.layers-mapbox-item"],a[1]=[".ct1","#selectedTab span","#editorPanel > .content","#editor","#datalibrary-download-dialogue:after",".fullpage-users"],a[2]=[".ct2"],a[3]=[".ct3"],a[4]=[".ct4",".active a",".editor-wrapper a"],a[5]=[".ct5"],a[6]=[".ct6"],a[7]=[".ct7"],a[8]=[".ct8","layer-active"],a[9]=[".ct9"],a[10]=[".ct10"],a[11]=[".ct11",".editor-projects-item:hover",".smap-button-gray",".smap-button-white",".item-list.controls-item.active",".item-list.layer-item.active",".active .layers-mapbox-item",".item-list.active",".layer-item.active"],a[12]=[".ct12"],a[13]=[".ct13",".editor-wrapper h3",".editor-wrapper h4",".editor-inner-wrapper h5"],a[14]=[".ct14"],a[15]=[".ct15","#header"],a[16]=[".ct16","#header","#header input"],a[17]=[".ct17",".editor-project-edit-super-wrap"],a[18]=[".ct18",".smap-button-gray",".smap-button-white"],a[19]=[".ct19","tr:nth-child(odd)"],a[20]=[".ct20","tr:nth-child(even)",".ccontainer"],a[21]=[".ct21"],a[22]=[".ct22",".mat_swatches","#darness-selector"],a[23]=[".ct23",".editor-wrapper h3",".editor-wrapper h4",".documents-folder-item:hover",".editor-map-item-wrap input",".form-control input","th",".datalibrary-controls",".input-box",".search"],a[24]=[".ct24",".editor-map-item-wrap input",".form-control input"],a[25]=[".ct25"],a[26]=[".ct26"],a[27]=[".ct27"],a[28]=[".ct28","th","#select-basic-themes","#advanced-color-header",".editor-inner-wrapper h5",".editor-map-item-wrap h4",".client-project-title-wrapper h4",".editor-projects-item h5",".editor-client-title h5","#userlist h4"],a[29]=["hr"],a[30]=["blockquote"],a[31]=[".ct31"],a[32]=[".item-list.controls-item.active",".item-list.layer-item.actve",".active .layers-mapbox-item",".item-list.active",".layer-item.active"],a[33]=[".item-list.controls-item.active",".item-list.layer-item.active",".active .layers-mapbox-item",".item-list.active",".layer-item.active"],a[34]=[".search"]},makeCSSelements:function(){this.makeCSSel(0,"background-color",""),this.makeCSSel(1,"background-color",""),this.makeCSSel(2,"background-color",""),this.makeCSSel(3,"color",""),this.makeCSSel(4,"color",""),this.makeCSSel(5,"background-color",""),this.makeCSSel(6,"background-color",""),this.makeCSSel(7,"background-color",""),this.makeCSSel(8,"background-color",""),this.makeCSSel(9,"background-color",""),this.makeCSSel(10,"color",""),this.makeCSSel(11,"color","white"),this.makeCSSel(12,"color","black"),this.makeCSSel(13,"color","white"),this.makeCSSel(14,"background-color",""),this.makeCSSel(15,"background-color",""),this.makeCSSel(16,"color",""),this.makeCSSel(17,"background-color",""),this.makeCSSel(18,"background-color",""),this.makeCSSel(19,"background-color",""),this.makeCSSel(20,"background-color",""),this.makeCSSel(21,"border-bottom",""),this.makeCSSel(22,"background-color",""),this.makeCSSel(23,"color",""),this.makeCSSel(24,"background-color",""),this.makeCSSel(25,"color",""),this.makeCSSel(26,"background",""),this.makeCSSel(27,"font-weight",""),this.makeCSSel(28,"font-weight",""),this.makeCSSel(29,"border-top",""),this.makeCSSel(30,"border-left",""),this.makeCSSel(31,"background-position",""),this.makeCSSel(32,"background-color",""),this.makeCSSel(33,"color",""),this.makeCSSel(34,"background-color","")},makeCSSel:function(a,b,c){colorTheme.css[a]={},colorTheme.css[a].classes=E[a],colorTheme.css[a].pre=b,colorTheme.css[a].value=c}};G.go();var H={init:function(){var a="342px",b="490px";D._color_Inner_wrapper.style.left="-580px",D._color_Outer_wrapper.style.height=a,D._b2basic=Wu.DomUtil.get("back-to-basic"),D._yourswatch=Wu.DomUtil.get("yourswatch"),D._myCanvas=Wu.DomUtil.get("myCanvas"),D._pixCanvas=Wu.DomUtil.get("pixCanvas"),D._canvimg=Wu.DomUtil.get("canvimg"),D._coloption1=Wu.DomUtil.get("coloption1"),D._coloption2=Wu.DomUtil.get("coloption2"),D._coloption3=Wu.DomUtil.get("coloption3"),D._yourcolLink1=Wu.DomUtil.get("yourcol_link1"),D._regen=Wu.DomUtil.get("regen"),D._normalSwatches=Wu.DomUtil.get("normal-swatches"),D._darkSwatches=Wu.DomUtil.get("dark-swatches"),D._linkSwatches=Wu.DomUtil.get("link-swatches"),D._colorSuggestions=Wu.DomUtil.get("color-suggestions"),D._hsvToggle=Wu.DomUtil.get("hsv-toggle"),D._rgbToggle=Wu.DomUtil.get("rgb-toggle"),D._paletteToggle=Wu.DomUtil.get("palette-toggle"),D._sliderToggle=Wu.DomUtil.get("slider-toggle"),D._imageToggle=Wu.DomUtil.get("image-toggle"),D._tickMenuLight=Wu.DomUtil.get("tick-menu-light"),D._tickMenuDark=Wu.DomUtil.get("tick-menu-dark"),D._tickHeaderLight=Wu.DomUtil.get("tick-header-light"),D._tickHeaderDark=Wu.DomUtil.get("tick-header-dark"),D._tickMboxLight=Wu.DomUtil.get("tick-mbox-light"),D._tickMboxDark=Wu.DomUtil.get("tick-mbox-dark"),D._dark_swatch_0=Wu.DomUtil.get("dark_swatch_0"),D._dark_swatch_1=Wu.DomUtil.get("dark_swatch_1"),D._dark_swatch_2=Wu.DomUtil.get("dark_swatch_2"),D._dark_swatch_3=Wu.DomUtil.get("dark_swatch_3"),D._dark_swatch_4=Wu.DomUtil.get("dark_swatch_4"),D._dark_swatch_5=Wu.DomUtil.get("dark_swatch_5"),D._dark_swatch_0.onclick=function(){h("dark",0)
},D._dark_swatch_1.onclick=function(){h("dark",1)},D._dark_swatch_2.onclick=function(){h("dark",2)},D._dark_swatch_3.onclick=function(){h("dark",3)},D._dark_swatch_4.onclick=function(){h("dark",4)},D._dark_swatch_5.onclick=function(){h("dark",5)},D._light_swatch_0=Wu.DomUtil.get("light_swatch_0"),D._light_swatch_1=Wu.DomUtil.get("light_swatch_1"),D._light_swatch_2=Wu.DomUtil.get("light_swatch_2"),D._light_swatch_3=Wu.DomUtil.get("light_swatch_3"),D._light_swatch_4=Wu.DomUtil.get("light_swatch_4"),D._light_swatch_5=Wu.DomUtil.get("light_swatch_5"),D._light_swatch_0.onclick=function(){h("light",0)},D._light_swatch_1.onclick=function(){h("light",1)},D._light_swatch_2.onclick=function(){h("light",2)},D._light_swatch_3.onclick=function(){h("light",3)},D._light_swatch_4.onclick=function(){h("light",4)},D._light_swatch_5.onclick=function(){h("light",5)},D._complimentary_swatch_0=Wu.DomUtil.get("complimentary_swatch_0"),D._complimentary_swatch_1=Wu.DomUtil.get("complimentary_swatch_1"),D._complimentary_swatch_2=Wu.DomUtil.get("complimentary_swatch_2"),D._complimentary_swatch_3=Wu.DomUtil.get("complimentary_swatch_3"),D._complimentary_swatch_0.onclick=function(){h("complimentary",0)},D._complimentary_swatch_1.onclick=function(){h("complimentary",1)},D._complimentary_swatch_2.onclick=function(){h("complimentary",2)},D._complimentary_swatch_3.onclick=function(){h("complimentary",3)},D._matching_swatch_0=Wu.DomUtil.get("matching_swatch_0"),D._matching_swatch_1=Wu.DomUtil.get("matching_swatch_1"),D._matching_swatch_2=Wu.DomUtil.get("matching_swatch_2"),D._matching_swatch_3=Wu.DomUtil.get("matching_swatch_3"),D._matching_swatch_4=Wu.DomUtil.get("matching_swatch_4"),D._matching_swatch_0.onclick=function(){h("matching",0)},D._matching_swatch_1.onclick=function(){h("matching",1)},D._matching_swatch_2.onclick=function(){h("matching",2)},D._matching_swatch_3.onclick=function(){h("matching",3)},D._matching_swatch_4.onclick=function(){h("matching",4)},D._bright_swatch_0=Wu.DomUtil.get("bright_swatch_0"),D._bright_swatch_1=Wu.DomUtil.get("bright_swatch_1"),D._bright_swatch_2=Wu.DomUtil.get("bright_swatch_2"),D._bright_swatch_3=Wu.DomUtil.get("bright_swatch_3"),D._bright_swatch_4=Wu.DomUtil.get("bright_swatch_4"),D._bright_swatch_5=Wu.DomUtil.get("bright_swatch_5"),D._bright_swatch_6=Wu.DomUtil.get("bright_swatch_6"),D._bright_swatch_7=Wu.DomUtil.get("bright_swatch_7"),D._bright_swatch_8=Wu.DomUtil.get("bright_swatch_8"),D._bright_swatch_9=Wu.DomUtil.get("bright_swatch_9"),D._bright_swatch_10=Wu.DomUtil.get("bright_swatch_10"),D._bright_swatch_0.onclick=function(){h("bright",0)},D._bright_swatch_1.onclick=function(){h("bright",1)},D._bright_swatch_2.onclick=function(){h("bright",2)},D._bright_swatch_3.onclick=function(){h("bright",3)},D._bright_swatch_4.onclick=function(){h("bright",4)},D._bright_swatch_5.onclick=function(){h("bright",5)},D._bright_swatch_6.onclick=function(){h("bright",6)},D._bright_swatch_7.onclick=function(){h("bright",7)},D._bright_swatch_8.onclick=function(){h("bright",8)},D._bright_swatch_9.onclick=function(){h("bright",9)},D._bright_swatch_10.onclick=function(){h("bright",10)},colorTheme.cThemeDarkMenu?(Wu.DomUtil.addClass(D._tickMenuDark,"active-toggle"),Wu.DomUtil.removeClass(D._tickMenuLight,"active-toggle")):(Wu.DomUtil.removeClass(D._tickMenuDark,"active-toggle"),Wu.DomUtil.addClass(D._tickMenuLight,"active-toggle")),colorTheme.cThemeDarkBox?(Wu.DomUtil.addClass(D._tickMboxDark,"active-toggle"),Wu.DomUtil.removeClass(D._tickMboxLight,"active-toggle")):(Wu.DomUtil.removeClass(D._tickMboxDark,"active-toggle"),Wu.DomUtil.addClass(D._tickMboxLight,"active-toggle")),colorTheme.cThemeDarkHeader?(Wu.DomUtil.addClass(D._tickHeaderDark,"active-toggle"),Wu.DomUtil.removeClass(D._tickHeaderLight,"active-toggle")):(Wu.DomUtil.removeClass(D._tickHeaderDark,"active-toggle"),Wu.DomUtil.addClass(D._tickHeaderLight,"active-toggle")),D._yourswatch.style.backgroundColor=n,D._b2basic.onclick=function(){1==u&&D._coloption1.click(),2==u&&D._coloption2.click(),3==u&&D._coloption3.click(),4==u&&D._yourcolLink1.click(),"all"==u&&D._regen.click(),D._color_Inner_wrapper.style.left="-310px",D._color_Outer_wrapper.style.height="182px"},this.initSliders();var c=(Wu.DomUtil.get("project-color-theme").parentNode.getAttribute("uuid"),Wu.DomUtil.get("editor-projects-container"));c=c.getElementsByTagName("div"),F.cPicker.img2canvas(),this.initComplimentaryColors(),this.initMatchingColors(),this.initDarkColors(),this.initLightColors(),this.initBrightColors(),f(),(!colorTheme.css||q)&&d("one"),D._coloption1.onclick=function(){t=!0,1==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u=1,Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._darkSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._normalSwatches,"die"),Wu.DomUtil.removeClass(D._coloption2,"changing"),Wu.DomUtil.removeClass(D._coloption3,"changing"),Wu.DomUtil.removeClass(D._yourcolLink1,"changing"),Wu.DomUtil.removeClass(D._regen,"changing"),D._yourswatch.style.backgroundColor=colorTheme.css[0].value,D._hexColor.value=colorTheme.css[0].value,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),D._paletteToggle.removeAttribute("style"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"))},D._coloption2.onclick=function(){t=!0,2==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u=2,Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.removeClass(D._coloption1,"changing"),Wu.DomUtil.removeClass(D._coloption3,"changing"),Wu.DomUtil.removeClass(D._yourcolLink1,"changing"),Wu.DomUtil.removeClass(D._regen,"changing"),D._yourswatch.style.backgroundColor=colorTheme.css[5].value,D._hexColor.value=colorTheme.css[5].value,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"),D._paletteToggle.removeAttribute("style"))},D._coloption3.onclick=function(){t=!0,3==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u=3,Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.removeClass(D._coloption1,"changing"),Wu.DomUtil.removeClass(D._coloption2,"changing"),Wu.DomUtil.removeClass(D._yourcolLink1,"changing"),Wu.DomUtil.removeClass(D._regen,"changing"),D._yourswatch.style.backgroundColor=colorTheme.css[8].value,D._hexColor.value=colorTheme.css[8].value,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"),D._paletteToggle.removeAttribute("style"))},D._yourcolLink1.onclick=function(){t=!0,4==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u=4,Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.addClass(D._normalSwatches,"die"),Wu.DomUtil.removeClass(D._coloption1,"changing"),Wu.DomUtil.removeClass(D._coloption2,"changing"),Wu.DomUtil.removeClass(D._coloption3,"changing"),Wu.DomUtil.removeClass(D._regen,"changing"),D._yourswatch.style.backgroundColor=colorTheme.css[4].value,D._hexColor.value=colorTheme.css[4].value,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"),D._paletteToggle.removeAttribute("style"))},D._regen.onclick=function(){"all"==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),D._paletteToggle.removeAttribute("style"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u="all",Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.removeClass(D._coloption1,"changing"),Wu.DomUtil.removeClass(D._coloption2,"changing"),Wu.DomUtil.removeClass(D._coloption3,"changing"),Wu.DomUtil.removeClass(D._yourcolLink1,"changing"),D._yourswatch.style.backgroundColor=A[0][0].HEX,D._hexColor.value=A[0][0].HEX,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),D._sliderToggle.click(),D._paletteToggle.setAttribute("style","opacity: 0.2; cursor: normal"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"))},D._hsvToggle.onclick=function(){var a=this.className;"active-toggle"==a?(this.className="",D._rgbToggle.className="active-toggle",Wu.DomUtil.get("rgb-slider-container").className="",Wu.DomUtil.get("hsv-slider-container").className="die"):(this.className="active-toggle",D._rgbToggle.className="",Wu.DomUtil.get("rgb-slider-container").className="die",Wu.DomUtil.get("hsv-slider-container").className="")},D._rgbToggle.onclick=function(){var a=this.className;"active-toggle"==a?(this.className="",D._hsvToggle.className="active-toggle",Wu.DomUtil.get("rgb-slider-container").className="die",Wu.DomUtil.get("hsv-slider-container").className=""):(this.className="active-toggle",D._hsvToggle.className="",Wu.DomUtil.get("rgb-slider-container").className="",Wu.DomUtil.get("hsv-slider-container").className="die")},D._paletteToggle.onclick=function(){"all"!=u&&(Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._sliderToggle,"active-toggle"),Wu.DomUtil.removeClass(D._imageToggle,"active-toggle"),Wu.DomUtil.get("s-watches").style.display="block",Wu.DomUtil.get("sliders").style.display="none",Wu.DomUtil.get("canvascontainer").style.display="none")},D._sliderToggle.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._paletteToggle,"active-toggle"),Wu.DomUtil.removeClass(D._imageToggle,"active-toggle"),Wu.DomUtil.get("sliders").style.display="block",Wu.DomUtil.get("s-watches").style.display="none",Wu.DomUtil.get("canvascontainer").style.display="none"},D._imageToggle.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._paletteToggle,"active-toggle"),Wu.DomUtil.removeClass(D._sliderToggle,"active-toggle"),Wu.DomUtil.get("canvascontainer").style.display="block",Wu.DomUtil.get("sliders").style.display="none",Wu.DomUtil.get("s-watches").style.display="none"},D._tickMenuLight.onclick=function(){colorTheme.cThemeDarkMenu=!1,l();var a=colorTheme.css[0].value;k(a),F.update.CSSstring(),jcss.innerHTML=w},D._tickMenuDark.onclick=function(){colorTheme.cThemeDarkMenu=!0,l();var a=colorTheme.css[0].value;j(a),F.update.CSSstring(),jcss.innerHTML=w},D._tickHeaderLight.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._tickHeaderDark,"active-toggle"),colorTheme.css[15].value="rgba(255,255,255,0.92)",colorTheme.css[16].value="#333",F.update.CSSstring(),jcss.innerHTML=w},D._tickHeaderDark.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._tickHeaderLight,"active-toggle"),colorTheme.css[15].value="rgba(0,0,0,0.8)",colorTheme.css[16].value="white",F.update.CSSstring(),jcss.innerHTML=w},D._tickMboxLight.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._tickMboxDark,"active-toggle"),colorTheme.css[14].value="rgba(255, 255, 255, 0.7)",F.update.CSSstring(),jcss.innerHTML=w},D._tickMboxDark.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._tickMboxLight,"active-toggle"),colorTheme.css[14].value="rgba(0,0,0,0.7)",F.update.CSSstring(),jcss.innerHTML=w},""!=w&&w||d("dark1")},initSliders:function(){F.sliders.rangeSlider("range-slider-1",360,function(a){D._hChannel.value=a;var b=new F.HSVobject(0,0,0);b={h:D._hChannel.value,s:D._sChannel.value,v:D._vChannel.value},F.update.HSV(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-2",100,function(a){D._sChannel.value=a;var b=new F.HSVobject(0,0,0);b={h:D._hChannel.value,s:D._sChannel.value,v:D._vChannel.value},F.update.HSV(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-3",100,function(a){D._vChannel.value=a;var b=new F.HSVobject(0,0,0);b={h:D._hChannel.value,s:D._sChannel.value,v:D._vChannel.value},F.update.HSV(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-r",255,function(a){D._rChannel.value=a;var b=new F.RGBobject(0,0,0);b={r:D._rChannel.value,g:D._gChannel.value,b:D._bChannel.value},F.update.RGB(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-g",255,function(a){D._gChannel.value=a;var b=new F.RGBobject(0,0,0);b={r:D._rChannel.value,g:D._gChannel.value,b:D._bChannel.value},F.update.RGB(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-b",255,function(a){D._bChannel.value=a;var b=new F.RGBobject(0,0,0);b={r:D._rChannel.value,g:D._gChannel.value,b:D._bChannel.value},F.update.RGB(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()})},initComplimentaryColors:function(){var a=colorTheme.css[5].value;F.update.HEX(a),F.update.makeComplimentary(a)},initMatchingColors:function(){var a=colorTheme.css[5].value;p=new Object,o=new Object,F.convert.HEX2RGB(a,o),F.convert.RGB2HSV(o,p),F.cMatch.domatch(p),F.update.colorGrade(B,0,B[0][0].HSV),F.update.colorGrade(B,1,B[1][0].HSV),F.update.colorGrade(B,2,B[2][0].HSV),F.update.colorGrade(B,3,B[3][0].HSV),F.update.colorGrade(B,4,B[4][0].HSV)},initDarkColors:function(){F.makeDarkColors(0,215),F.makeDarkColors(1,196),F.makeDarkColors(2,319),F.makeDarkColors(3,354),F.makeDarkColors(4,22),y[5]=[],y[5][0]={},y[5][0].HSV={},y[5][0].HSV.h=100,y[5][0].HSV.s=0,y[5][0].HSV.v=10,y[5][0].HEX=F.convert.HSV2HEX(100,0,10),y[5][0].RGB={},F.convert.HSV2RGB(y[5][0].HSV,y[5][0].RGB),y[5][1]={},y[5][1].HSV={},y[5][1].HSV.h=100,y[5][1].HSV.s=0,y[5][1].HSV.v=20,y[5][1].HEX=F.convert.HSV2HEX(100,0,20),y[5][1].RGB={},F.convert.HSV2RGB(y[5][1].HSV,y[5][1].RGB),y[5][2]={},y[5][2].HSV={},y[5][2].HSV.h=100,y[5][2].HSV.s=0,y[5][2].HSV.v=70,y[5][2].HEX=F.convert.HSV2HEX(100,0,70),y[5][2].RGB={},F.convert.HSV2RGB(y[5][2].HSV,y[5][2].RGB)},initLightColors:function(){F.makeLightColors(0,215),F.makeLightColors(1,196),F.makeLightColors(2,319),F.makeLightColors(3,76),F.makeLightColors(4,354),x[5]=[],x[5][0]={},x[5][0].HSV={},x[5][0].HSV.h=22,x[5][0].HSV.s=0,x[5][0].HSV.v=70,x[5][0].HEX=F.convert.HSV2HEX(22,0,70),x[5][0].RGB={},F.convert.HSV2RGB(x[5][0].HSV,x[5][0].RGB),x[5][1]={},x[5][1].HSV={},x[5][1].HSV.h=22,x[5][1].HSV.s=0,x[5][1].HSV.v=93,x[5][1].HEX=F.convert.HSV2HEX(22,0,93),x[5][1].RGB={},F.convert.HSV2RGB(x[5][1].HSV,x[5][1].RGB),x[5][2]={},x[5][2].HSV={},x[5][2].HSV.h=22,x[5][2].HSV.s=0,x[5][2].HSV.v=25,x[5][2].HEX=F.convert.HSV2HEX(22,0,25),x[5][2].RGB={},F.convert.HSV2RGB(x[5][2].HSV,x[5][2].RGB)},initBrightColors:function(){z[0]=[],z[0][0]={},z[0][0].HEX="#FF00FF",z[0][0].HSV={},z[0][0].HSV.h=300,z[0][0].HSV.s=100,z[0][0].HSV.v=100,z[0][0].RGB={},z[0][0].RGB.r=255,z[0][0].RGB.g=0,z[0][0].RGB.b=255,z[1]=[],z[1][0]={},z[1][0].HEX="#FF00AA",z[1][0].HSV={},z[1][0].HSV.h=320,z[1][0].HSV.s=100,z[1][0].HSV.v=100,z[1][0].RGB={},z[1][0].RGB.r=255,z[1][0].RGB.g=0,z[1][0].RGB.b=170,z[2]=[],z[2][0]={},z[2][0].HEX="#FF0055",z[2][0].HSV={},z[2][0].HSV.h=340,z[2][0].HSV.s=100,z[2][0].HSV.v=100,z[2][0].RGB={},z[2][0].RGB.r=255,z[2][0].RGB.g=0,z[2][0].RGB.b=85,z[3]=[],z[3][0]={},z[3][0].HEX="#FF0000",z[3][0].HSV={},z[3][0].HSV.h=0,z[3][0].HSV.s=100,z[3][0].HSV.v=100,z[3][0].RGB={},z[3][0].RGB.r=255,z[3][0].RGB.g=0,z[3][0].RGB.b=0,z[4]=[],z[4][0]={},z[4][0].HEX="#FF5400",z[4][0].HSV={},z[4][0].HSV.h=20,z[4][0].HSV.s=100,z[4][0].HSV.v=100,z[4][0].RGB={},z[4][0].RGB.r=255,z[4][0].RGB.g=84,z[4][0].RGB.b=0,z[5]=[],z[5][0]={},z[5][0].HEX="#FF9400",z[5][0].HSV={},z[5][0].HSV.h=35,z[5][0].HSV.s=100,z[5][0].HSV.v=100,z[5][0].RGB={},z[5][0].RGB.r=255,z[5][0].RGB.g=148,z[5][0].RGB.b=0,z[6]=[],z[6][0]={},z[6][0].HEX="#FFD400",z[6][0].HSV={},z[6][0].HSV.h=50,z[6][0].HSV.s=100,z[6][0].HSV.v=100,z[6][0].RGB={},z[6][0].RGB.r=255,z[6][0].RGB.g=212,z[6][0].RGB.b=0,z[7]=[],z[7][0]={},z[7][0].HEX="#FFFF00",z[7][0].HSV={},z[7][0].HSV.h=60,z[7][0].HSV.s=100,z[7][0].HSV.v=100,z[7][0].RGB={},z[7][0].RGB.r=255,z[7][0].RGB.g=255,z[7][0].RGB.b=0,z[8]=[],z[8][0]={},z[8][0].HEX="#00FFD4",z[8][0].HSV={},z[8][0].HSV.h=170,z[8][0].HSV.s=100,z[8][0].HSV.v=100,z[8][0].RGB={},z[8][0].RGB.r=0,z[8][0].RGB.g=255,z[8][0].RGB.b=212,z[9]=[],z[9][0]={},z[9][0].HEX="#00FFFF",z[9][0].HSV={},z[9][0].HSV.h=180,z[9][0].HSV.s=100,z[9][0].HSV.v=100,z[9][0].RGB={},z[9][0].RGB.r=0,z[9][0].RGB.g=255,z[9][0].RGB.b=255,z[10]=[],z[10][0]={},z[10][0].HEX="#54FF00",z[10][0].HSV={},z[10][0].HSV.h=100,z[10][0].HSV.s=100,z[10][0].HSV.v=100,z[10][0].RGB={},z[10][0].RGB.r=85,z[10][0].RGB.g=255,z[10][0].RGB.b=0}}}function swypeTo(a){function b(){Wu.DomUtil.addClass(e,"swipe_out_up"),setTimeout(function(){Wu.DomUtil.removeClass(e,"swipe_out_up"),Wu.DomUtil.removeClass(e,"show")},300),Wu.DomUtil.addClass(a,"show swipe_in_up"),setTimeout(function(){Wu.DomUtil.removeClass(a,"swipe_in_up")},300)}function c(){Wu.DomUtil.addClass(e,"swipe_out"),setTimeout(function(){Wu.DomUtil.removeClass(e,"swipe_out"),Wu.DomUtil.removeClass(e,"show")},300),Wu.DomUtil.addClass(a,"show swipe_in"),setTimeout(function(){Wu.DomUtil.removeClass(a,"swipe_in")},300)}var d=70;Wu.DomUtil.hasClass(a,"clients")&&(menuslider.style.top="0px"),Wu.DomUtil.hasClass(a,"projects")&&(menuslider.style.top=1*d+"px"),Wu.DomUtil.hasClass(a,"map")&&(menuslider.style.top=2*d+"px"),Wu.DomUtil.hasClass(a,"layers")&&(menuslider.style.top=3*d+"px"),Wu.DomUtil.hasClass(a,"documents")&&(menuslider.style.top=4*d+"px"),Wu.DomUtil.hasClass(a,"dataLibrary")&&(menuslider.style.top=5*d+"px"),Wu.DomUtil.hasClass(a,"users")&&(menuslider.style.top=6*d+"px");for(var e,f,g,h=document.getElementsByTagName("content")[0],i=h.getElementsByTagName("div"),j=0;j<i.length;j++)i[j]==a&&(f=j),Wu.DomUtil.hasClass(i[j],"show")&&(g=j,e=i[j]);f>g?c():b()}function transheight(a,b,c){if(c){var d=a.getElementsByTagName("div")[0].offsetHeight+b;a.style.height=d+"px"}else a.style.height="0px"}function jorgo_edit_client(a){var b="editor-client-edit-toggle-"+a,c=document.getElementById(b),d="editor-client-cancel-"+a,e=document.getElementById(d);e.onclick=function(){c.click()};var f="editor-client-edit-wrapper-"+a,g=document.getElementById(f),h=g.className,i=h.split(" ");2==i.length?(i.splice(1,1),c.style.opacity="1"):(i[1]="client-editor-open",c.style.opacity="0");var j=i.join(" ");g.className=j}function polse(){for(var a=document.getElementById("app").getElementsByTagName("div"),b=0;b<a.length;b++)if("q-editor-container"==a[b].className){a[b].style.width="100px";break}document.getElementById("map").style.left="100px",document.getElementById("map").style.width=document.body.offsetWidth-100+"px",document.getElementById("header").style.left="100px"}function unpolse(){for(var a=document.getElementById("app").getElementsByTagName("div"),b=0;b<a.length;b++)if("q-editor-container"==a[b].className){a[b].style.width="400px";break}document.getElementById("map").style.left="400px",document.getElementById("map").style.width=document.body.offsetWidth-400+"px",document.getElementById("header").style.left="400px"}ich.$=function(a){return a},Wu={},Wu.Class=function(){},Wu.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks.length&&this.callInitHooks()},c=b.__super__=this.prototype,d=Wu.Util.create(c);d.constructor=b,b.prototype=d;for(var e in this)this.hasOwnProperty(e)&&"prototype"!==e&&(b[e]=this[e]);return a.statics&&(Wu.extend(b,a.statics),delete a.statics),a.includes&&(Wu.Util.extend.apply(null,[d].concat(a.includes)),delete a.includes),d.options&&(a.options=Wu.Util.extend(Wu.Util.create(d.options),a.options)),Wu.extend(d,a),d._initHooks=[],d.callInitHooks=function(){if(!this._initHooksCalled){c.callInitHooks&&c.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,b=d._initHooks.length;b>a;a++)d._initHooks[a].call(this)}},b},Wu.Class.include=function(a){Wu.extend(this.prototype,a)},Wu.Class.mergeOptions=function(a){Wu.extend(this.prototype.options,a)},Wu.Class.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1),c="function"==typeof a?a:function(){this[a].apply(this,b)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(c)},Wu.Util={extend:function(a){var b,c,d,e,f=Array.prototype.slice.call(arguments,1);for(c=0,d=f.length;d>c;c++){e=f[c];for(b in e)a[b]=e[b]}return a},create:Object.create||function(){function a(){}return function(b){return a.prototype=b,new a}}(),bind:function(a,b){var c=Array.prototype.slice;if(a.bind)return a.bind.apply(a,c.call(arguments,1));var d=c.call(arguments,2);return function(){return a.apply(b,d.length?d.concat(c.call(arguments)):arguments)}},stamp:function(a){return a._leaflet_id=a._leaflet_id||++Wu.Util.lastId,a._leaflet_id},lastId:0,throttle:function(a,b,c){var d,e,f,g;return g=function(){d=!1,e&&(f.apply(c,e),e=!1)},f=function(){d?e=arguments:(a.apply(c,arguments),setTimeout(g,b),d=!0)}},wrapNum:function(a,b,c){var d=b[1],e=b[0],f=d-e;return a===d&&c?a:((a-e)%f+f)%f+e},falseFn:function(){return!1},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},trimAll:function(a){return a.replace(/\s+/g,"")},splitWords:function(a){return Wu.Util.trim(a).split(/\s+/)},setOptions:function(a,b){a.hasOwnProperty("options")||(a.options=a.options?Wu.Util.create(a.options):{});for(var c in b)a.options[c]=b[c];return a.options},getParamString:function(a,b,c){var d=[];for(var e in a)d.push(encodeURIComponent(c?e.toUpperCase():e)+"="+encodeURIComponent(a[e]));return(b&&-1!==b.indexOf("?")?"&":"?")+d.join("&")},template:function(a,b){return a.replace(Wu.Util.templateRe,function(a,c){var d=b[c];if(void 0===d)throw new Error("No value provided for variable "+a);return"function"==typeof d&&(d=d(b)),d})},templateRe:/\{ *([\w_]+) *\}/g,emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",templateIch:function(a,b){var c=Wu.DomUtil.create("div","");return c.innerHTML=ich[a](b),c.children},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},setAddressBar:function(a){window.history.pushState({},"",a)},post:function(a,b){var c=new XMLHttpRequest,d=window.location.origin;d+=a,c.open("POST",d,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&console.log(c.responseText)},c.send(b)},postcb:function(a,b,c,d){var e=new XMLHttpRequest,f=window.location.origin;f+=a,e.open("POST",f,!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&c&&c(d,e.responseText)},e.send(b)},_parse:function(a){try{var b=JSON.parse(a);return b}catch(c){return!1}},_getJSON:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c.responseText)},c.send(null)},_getParentClientID:function(a){var b="";for(c in Wu.app.Clients){var d=Wu.app.Clients[c];d.projects.forEach(function(c){c==a&&(b=d.uuid)})}return b||(b=Wu.app._activeClient.uuid),b},guid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)});return a?a+"-"+b:b},deselectText:function(){var a="getSelection"in window?window.getSelection():"selection"in document?document.selection:null;"removeAllRanges"in a?a.removeAllRanges():"empty"in a&&a.empty()},generateZip:function(a){console.log("# generateZip #"),console.log("string length: ",a.length);var b=LZString.compress(a);return console.log("compressd length: ",b.length),b},zipSave:function(a,b){var c,c=b,d=new LZMA("//85.10.202.87:8080/js/lib/lzma/lzma_worker.js");d.compress(c,1,function(b){console.log("my_lzma finished!"),console.log(b),console.log(typeof b);var c=JSON.stringify(b);console.log("string: ",c);var d=new XMLHttpRequest,e=window.location.origin;e+=a,d.open("POST",e,!0),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&console.log(d.responseText)},d.send(c)},function(a){console.log("lzma progress: ",a)})},zippedSave:function(){},setColorTheme:function(){injectCSS()}},function(){function a(a){return window["webkit"+a]||window["moz"+a]||window["ms"+a]}function b(a){var b=+new Date,d=Math.max(0,16-(b-c));return c=b+d,window.setTimeout(a,d)}var c=0,d=window.requestAnimationFrame||a("RequestAnimationFrame")||b,e=window.cancelAnimationFrame||a("CancelAnimationFrame")||a("CancelRequestAnimationFrame")||function(a){window.clearTimeout(a)};Wu.Util.requestAnimFrame=function(a,c,e,f){return e&&d===b?void a.call(c):d.call(window,Wu.bind(a,c),f)},Wu.Util.cancelAnimFrame=function(a){a&&e.call(window,a)}}(),Wu.extend=Wu.Util.extend,Wu.bind=Wu.Util.bind,Wu.stamp=Wu.Util.stamp,Wu.setOptions=Wu.Util.setOptions,Wu.save=Wu.Util.post,Wu.post=Wu.Util.postcb,Wu.parse=Wu.Util._parse,Wu.zip=Wu.Util.generateZip,Wu.zave=Wu.Util.zipSave,Wu.Evented=Wu.Class.extend({on:function(a,b,c){if("object"==typeof a)for(var d in a)this._on(d,a[d],b);else{a=Wu.Util.splitWords(a);for(var e=0,f=a.length;f>e;e++)this._on(a[e],b,c)}return this},off:function(a,b,c){if(a)if("object"==typeof a)for(var d in a)this._off(d,a[d],b);else{a=Wu.Util.splitWords(a);for(var e=0,f=a.length;f>e;e++)this._off(a[e],b,c)}else delete this._events;return this},_on:function(a,b,c){var d=this._events=this._events||{},e=c&&c!==this&&Wu.stamp(c);if(e){var f=a+"_idx",g=a+"_len",h=d[f]=d[f]||{},i=Wu.stamp(b)+"_"+e;h[i]||(h[i]={fn:b,ctx:c},d[g]=(d[g]||0)+1)}else d[a]=d[a]||[],d[a].push({fn:b})},_off:function(a,b,c){var d=this._events,e=a+"_idx",f=a+"_len";if(d){if(!b)return delete d[a],delete d[e],void delete d[f];var g,h,i,j,k,l=c&&c!==this&&Wu.stamp(c);if(l)k=Wu.stamp(b)+"_"+l,g=d[e],g&&g[k]&&(j=g[k],delete g[k],d[f]--);else if(g=d[a])for(h=0,i=g.length;i>h;h++)if(g[h].fn===b){j=g[h],g.splice(h,1);break}j&&(j.fn=Wu.Util.falseFn)}},fire:function(a,b,c){if(!this.listens(a,c))return this;var d=Wu.Util.extend({},b,{type:a,target:this}),e=this._events;if(e){var f,g,h,i,j=e[a+"_idx"];if(e[a])for(h=e[a].slice(),f=0,g=h.length;g>f;f++)h[f].fn.call(this,d);for(i in j)j[i].fn.call(j[i].ctx,d)}return c&&this._propagateEvent(d),this},listens:function(a,b){var c=this._events;if(c&&(c[a]||c[a+"_len"]))return!0;if(b)for(var d in this._eventParents)if(this._eventParents[d].listens(a,b))return!0;return!1},once:function(a,b,c){if("object"==typeof a){for(var d in a)this.once(d,a[d],b);return this}var e=Wu.bind(function(){this.off(a,b,c).off(a,e,c)},this);return this.on(a,b,c).on(a,e,c)},addEventParent:function(a){return this._eventParents=this._eventParents||{},this._eventParents[Wu.stamp(a)]=a,this},removeEventParent:function(a){return this._eventParents&&delete this._eventParents[Wu.stamp(a)],this},_propagateEvent:function(a){for(var b in this._eventParents)this._eventParents[b].fire(a.type,Wu.extend({layer:a.target},a),!0)}});var proto=Wu.Evented.prototype;proto.addEventListener=proto.on,proto.removeEventListener=proto.clearAllEventListeners=proto.off,proto.addOneTimeEventListener=proto.once,proto.fireEvent=proto.fire,proto.hasEventListeners=proto.listens,Wu.Mixin={Events:proto},Wu.DomUtil={get:function(a){return"string"==typeof a?document.getElementById(a):a},getStyle:function(a,b){var c=a.style[b]||a.currentStyle&&a.currentStyle[b];if((!c||"auto"===c)&&document.defaultView){var d=document.defaultView.getComputedStyle(a,null);c=d?d[b]:null}return"auto"===c?null:c},create:function(a,b,c){var d=document.createElement(a);return d.className=b,c&&c.appendChild(d),d},createId:function(a,b,c){var d=document.createElement(a);return d.id=b,c&&c.appendChild(d),d},remove:function(a){var b=a.parentNode;b&&b.removeChild(a)},toFront:function(a){a.parentNode.appendChild(a)},toBack:function(a){var b=a.parentNode;b.insertBefore(a,b.firstChild)},hasClass:function(a,b){if(void 0!==a.classList)return a.classList.contains(b);var c=Wu.DomUtil.getClass(a);return c.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){if(void 0!==a.classList)for(var c=Wu.Util.splitWords(b),d=0,e=c.length;e>d;d++)a.classList.add(c[d]);else if(!Wu.DomUtil.hasClass(a,b)){var f=Wu.DomUtil.getClass(a);Wu.DomUtil.setClass(a,(f?f+" ":"")+b)}},removeClass:function(a,b){void 0!==a.classList?a.classList.remove(b):Wu.DomUtil.setClass(a,Wu.Util.trim((" "+Wu.DomUtil.getClass(a)+" ").replace(" "+b+" "," ")))},setClass:function(a,b){void 0===a.className.baseVal?a.className=b:a.className.baseVal=b},getClass:function(a){return void 0===a.className.baseVal?a.className:a.className.baseVal},appendTemplate:function(a,b){if("string"==typeof b){var c=Wu.DomUtil.create("div");for(c.innerHTML=b,i=0;i<c.childNodes.length;i++)a.appendChild(c.childNodes[i])}return a},prependTemplate:function(a,b,c){if("string"==typeof b){var d=Wu.DomUtil.create("div");if(d.innerHTML=b,c)var e=a.firstChild;else var e=a.firstChild.nextSibling;for(i=0;i<d.childNodes.length;i++)a.insertBefore(d.childNodes[i],e)}return a}};var eventsKey="_leaflet_events";Wu.DomEvent={on:function(a,b,c,d){if("object"==typeof b)for(var e in b)this._on(a,e,b[e],c);else{b=Wu.Util.splitWords(b);for(var f=0,g=b.length;g>f;f++)this._on(a,b[f],c,d)}return this},off:function(a,b,c,d){if("object"==typeof b)for(var e in b)this._off(a,e,b[e],c);else{b=Wu.Util.splitWords(b);for(var f=0,g=b.length;g>f;f++)this._off(a,b[f],c,d)}return this},_on:function(a,b,c,d){var e=b+Wu.stamp(c)+(d?"_"+Wu.stamp(d):"");if(a[eventsKey]&&a[eventsKey][e])return this;var f=function(b){return c.call(d||a,b||window.event)},g=f;return Wu.Browser.pointer&&0===b.indexOf("touch")?this.addPointerListener(a,b,f,e):(Wu.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener&&this.addDoubleTapListener(a,f,e),"addEventListener"in a?"mousewheel"===b?(a.addEventListener("DOMMouseScroll",f,!1),a.addEventListener(b,f,!1)):"mouseenter"===b||"mouseleave"===b?(f=function(b){return b=b||window.event,Wu.DomEvent._checkMouse(a,b)?g(b):void 0},a.addEventListener("mouseenter"===b?"mouseover":"mouseout",f,!1)):("click"===b&&Wu.Browser.android&&(f=function(a){return Wu.DomEvent._filterClick(a,g)}),a.addEventListener(b,f,!1)):"attachEvent"in a&&a.attachEvent("on"+b,f),a[eventsKey]=a[eventsKey]||{},a[eventsKey][e]=f,this)},_off:function(a,b,c,d){var e=b+Wu.stamp(c)+(d?"_"+Wu.stamp(d):""),f=a[eventsKey]&&a[eventsKey][e];return f?(Wu.Browser.pointer&&0===b.indexOf("touch")?this.removePointerListener(a,b,e):Wu.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,e):"removeEventListener"in a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",f,!1),a.removeEventListener(b,f,!1)):a.removeEventListener("mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,f,!1):"detachEvent"in a&&a.detachEvent("on"+b,f),a[eventsKey][e]=null,this):this
},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,Wu.DomEvent._skipped(a),this},disableScrollPropagation:function(a){return Wu.DomEvent.on(a,"mousewheel MozMousePixelScroll",Wu.DomEvent.stopPropagation)},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},stop:function(a){return Wu.DomEvent.preventDefault(a).stopPropagation(a)},getWheelDelta:function(a){var b=0;return a.wheelDelta&&(b=a.wheelDelta/120),a.detail&&(b=-a.detail/3),b},_skipEvents:{},_fakeStop:function(a){Wu.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var b=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,b},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(d){return!1}return c!==a},_filterClick:function(a,b){var c=a.timeStamp||a.originalEvent.timeStamp,d=Wu.DomEvent._lastClick&&c-Wu.DomEvent._lastClick;return d&&d>100&&500>d||a.target._simulatedClick&&!a._simulated?void Wu.DomEvent.stop(a):(Wu.DomEvent._lastClick=c,b(a))}},Wu.DomEvent.addListener=Wu.DomEvent.on,Wu.DomEvent.removeListener=Wu.DomEvent.off,function(){var a=navigator.userAgent.toLowerCase(),b=document.documentElement,c="ActiveXObject"in window,d=-1!==a.indexOf("webkit"),e=-1!==a.indexOf("phantom"),f=-1!==a.search("android [23]"),g=-1!==a.indexOf("chrome"),h="undefined"!=typeof orientation,i=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,j=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||i,k=c&&"transition"in b.style,l="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!f,m="MozPerspective"in b.style,n="OTransition"in b.style,o="devicePixelRatio"in window&&window.devicePixelRatio>1;if(!o&&"matchMedia"in window){var p=window.matchMedia("(min-resolution:144dpi)");o=p&&p.matches}var q=!window.L_NO_TOUCH&&!e&&(j||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);Wu.Browser={ie:c,ielt9:c&&!document.addEventListener,webkit:d,gecko:-1!==a.indexOf("gecko")&&!d&&!window.opera&&!c,android:-1!==a.indexOf("android"),android23:f,chrome:g,safari:!g&&-1!==a.indexOf("safari"),ie3d:k,webkit3d:l,gecko3d:m,opera3d:n,any3d:!window.L_DISABLE_3D&&(k||l||m||n)&&!e,mobile:h,mobileWebkit:h&&d,mobileWebkit3d:h&&l,mobileOpera:h&&window.opera,touch:!!q,msPointer:!!i,pointer:!!j,retina:!!o}}(),Array.prototype.diff=function(a){return this.filter(function(b){return a.indexOf(b)<0})},String.prototype.camelize=function(){return this.replace(/(?:^|[-_])(\w)/g,function(a,b){return b?b.toUpperCase():""})};var colorTheme={},savedCSS,_CTheader=document.getElementsByTagName("head")[0],jcss;jcss=document.createElement("style"),jcss.setAttribute("type","text/css"),jcss.setAttribute("rel","stylesheet"),_CTheader.appendChild(jcss),L.Control.Description=L.Control.extend({options:{position:"topleft"},onAdd:function(){{var a="leaflet-control-description",b=L.DomUtil.create("div",a);this.options}return b.innerHTML=ich.descriptionControl(),this._uncollapse=Wu.DomUtil.createId("div","uncollapse"),Wu.DomUtil.addClass(this._uncollapse,"leaflet-control open-uncollapse"),this._uncollapse.innerHTML="Open Info Menu",b},addHooks:function(){Wu.DomEvent.on(this._bhattan2,"click",this.closeInfo,this)},closeInfo:function(){this._content.parentNode.parentNode.style.width="34px",this._firstchildofmine=this._content.parentNode.parentNode.getElementsByTagName("div")[0],this._content.parentNode.parentNode.insertBefore(this._uncollapse,this._firstchildofmine),Wu.DomEvent.on(this._uncollapse,"click",this.openInfo,this),Wu.DomUtil.addClass(this._legendsContainer,"legends-push-left"),this._legendsCollapser.style.left=this._legendsCollapser.offsetLeft-Math.floor(143.5)+"px";var a=this;setTimeout(function(){a._uncollapse.className="leaflet-control uncollapser-uncollapsed"},500)},openInfo:function(){this._content.parentNode.parentNode.style.width="320px",this._uncollapse.className="leaflet-control uncollapse-killer",Wu.DomUtil.removeClass(this._legendsContainer,"legends-push-left"),this._legendsCollapser.style.left=this._legendsCollapser.offsetLeft+Math.floor(143.5)+"px";var a=this;setTimeout(function(){a._content.parentNode.parentNode.removeChild(a._uncollapse),a._uncollapse.className="leaflet-control open-uncollapse"},500)},update:function(a){this.initContainer(),this.project=a||Wu.app._activeProject,this._content=Wu.DomUtil.get("description-control-inner-content")},initContainer:function(){this._bhattan2=Wu.DomUtil.get("bhattan2"),this._legendsContainer=Wu.DomUtil.get("legends-control-inner-content"),this._legendsCollapser=Wu.DomUtil.get("legends-collapser"),this.addHooks()}}),L.control.description=function(a){return new L.Control.Description(a)},Wu.HeaderPane=Wu.Class.extend({initialize:function(){return this.options={},this.options.editMode=!1,this._initContainer(),this},_initContainer:function(){this._container=Wu.app._headerPane=Wu.DomUtil.createId("div","header",Wu.app._mapContainer),this._logoWrap=Wu.DomUtil.create("div","header-logo",this._container),this._logo=Wu.DomUtil.create("img","header-logo-img",this._logoWrap),this._title=Wu.DomUtil.create("div","header-title editable",this._container),this._subtitle=Wu.DomUtil.create("div","header-subtitle editable",this._container),this._resizer=Wu.DomUtil.createId("div","headerResizer",this._container),this._title.setAttribute("readonly","readonly"),this._subtitle.setAttribute("readonly","readonly"),this.addHooks()},addHooks:function(){this.addEditHooks()},addEditHooks:function(){this.enableResize(),Wu.DomEvent.on(this._title,"dblclick",function(a){this._enableEdit(a,"title")},this),Wu.DomEvent.on(this._subtitle,"dblclick",function(a){this._enableEdit(a,"subtitle")},this)},disableResize:function(){Wu.DomEvent.off(this._resizer,"mousedown",this.resize,this),Wu.DomEvent.off(this._resizer,"mouseup",this._resized,this),Wu.DomUtil.addClass(this._resizer,"headerResizerDisabled")},enableResize:function(){Wu.DomEvent.on(this._resizer,"mousedown",this.resize,this),Wu.DomEvent.on(this._resizer,"mouseup",this._resized,this),Wu.DomUtil.removeClass(this._resizer,"headerResizerDisabled")},_enableEdit:function(a,b){var c=a.target,d=a.target.innerHTML;if(b){if("title"==b)var e=ich.injectHeaderTitleInput({value:d});if("subtitle"==b)var e=ich.injectHeaderSubtitleInput({value:d});c.innerHTML=e;var f=c.firstChild;f.focus(),f.selectionStart=f.selectionEnd,Wu.DomEvent.on(f,"blur",this._editBlur,this),Wu.DomEvent.on(f,"keydown",this._editKey,this)}},_editBlur:function(a){var b=a.target.value,c=a.target.parentNode;c.innerHTML=b,this.save()},_editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},_setLeft:function(a){this._container.style.left=a+"px"},_update:function(a){this._project=a;var b=a.header;this._container.style.display="block",this._logo.src=b.logo,this._title.innerHTML=b.title,this._subtitle.innerHTML=b.subtitle,this._headerHeight=parseInt(b.height),this._container.style.height=this._headerHeight+"px",this._container.style.maxHeight=this._headerHeight+"px"},reset:function(){this._container.style.display="none"},_resetView:function(){},resize:function(){var a=this;window.onmouseup=function(){a._resized(),window.onmouseup=null},window.onmousemove=function(b){a._resize(b.y)}},_resize:function(a){this._headerHeight=a,this._container.style.height=this._headerHeight+"px",this._container.style.maxHeight=this._headerHeight+"px";var b=Wu.app._map._controlContainer;b.style.paddingTop=this._headerHeight+"px"},_resized:function(){this._resizer.style.backgroundColor="",window.onmousemove=null,this.save(),Wu.app._map.invalidateSize()},save:function(){this._project.header.height=this._headerHeight,this._project.header.title=this._title.innerHTML,this._project.header.subtitle=this._subtitle.innerHTML,this._project.header.logo=this._logo.src,this._save()},_save:function(){this._project._update("header")},setProject:function(a){this._update(a)}}),L.Control.Inspect=L.Control.extend({options:{position:"bottomright"},onAdd:function(){{var a="leaflet-control-inspect ct14",b=L.DomUtil.create("div",a);this.options}return b.innerHTML=ich.inspectControl(),b},update:function(a){console.log("inspect update!")}}),L.control.inspect=function(a){return new L.Control.Inspect(a)},window.onload=function(){for(var a=document.getElementsByTagName("content")[0],b=a.getElementsByTagName("div"),c=0;c<b.length;c++)Wu.DomUtil.hasClass(b[c],"clients")&&(_clients=b[c]),Wu.DomUtil.hasClass(b[c],"projects")&&(_projects=b[c]),Wu.DomUtil.hasClass(b[c],"map")&&(_map=b[c]),Wu.DomUtil.hasClass(b[c],"layers")&&(_layers=b[c]),Wu.DomUtil.hasClass(b[c],"documents")&&(_documents=b[c]),Wu.DomUtil.hasClass(b[c],"dataLibrary")&&(_dataLibrary=b[c]),Wu.DomUtil.hasClass(b[c],"users")&&(_users=b[c]);var d=document.createElement("div");d.id="menuslider",document.getElementsByTagName("menu")[0].appendChild(d)};var _clients,_projects,_map,_layers,_documents,_dataLibrary,_users,edit_projects_sort_by_right=document.getElementById("editor-projects-sort-by-right");edit_projects_sort_by_right.onclick=function(){for(var a=document.getElementById("editor-projects-container"),b=a.getElementsByTagName("div"),c=0;c<b.length;c++)("editor-projects-item"==b[c].className||"editor-projects-item active"==b[c].className)&&(b[c].className="editor-projects-item swipe_left");setTimeout(function(){for(var a=0;a<b.length;a++)"editor-projects-item swipe_left"==b[a].className&&(b[a].className="editor-projects-item"),"project-edit-button box"==b[a].className&&(b[a].className="project-edit-button list");var c=document.getElementById("editor-projects-container");c.className="list_view"},150)};var edit_projects_sort_by_left=document.getElementById("editor-projects-sort-by-left");edit_projects_sort_by_left.onclick=function(){for(var a=document.getElementById("editor-projects-container"),b=a.getElementsByTagName("div"),c=0;c<b.length;c++)("editor-projects-item"==b[c].className||"editor-projects-item active"==b[c].className)&&(b[c].className="editor-projects-item swipe_left");setTimeout(function(){for(var a=0;a<b.length;a++)"editor-projects-item swipe_left"==b[a].className&&(b[a].className="editor-projects-item"),"project-edit-button list"==b[a].className&&(b[a].className="project-edit-button box");var c=document.getElementById("editor-projects-container");c.className=""},150)};var coordinate_state=!1,editor_map_initpos_coordinates=document.getElementById("editor-map-initpos-coordinates"),editor_map_initpos_more=document.getElementById("editor-map-initpos-more");editor_map_initpos_more.onclick=function(){coordinate_state?(coordinate_state=!1,transheight(editor_map_initpos_coordinates,0,!1),this.className=""):(coordinate_state=!0,transheight(editor_map_initpos_coordinates,15,!0),this.className="rotate180")};var bounds_state=!1,editor_map_bounds_coordinates=document.getElementById("editor-map-bounds-coordinates"),editor_map_bounds_more=document.getElementById("editor-map-bounds-more");editor_map_bounds_more.onclick=function(){bounds_state?(bounds_state=!1,transheight(editor_map_bounds_coordinates,0,!1),this.className=""):(bounds_state=!0,transheight(editor_map_bounds_coordinates,15,!0),this.className="rotate180")},L.Control.Layermenu=L.Control.extend({options:{position:"bottomright"},onAdd:function(){{var a="leaflet-control-layermenu",b=L.DomUtil.create("div",a);this.options}return b.innerHTML=ich.layerMenuFrame(),this._cunt=b,this.initContainer(),b},initContainer:function(){this._layerMenuHeader=Wu.DomUtil.createId("div","layer-menu-header"),Wu.DomUtil.addClass(this._layerMenuHeader,"menucollapser ct15 ct16"),this._layerMenuHeader.innerHTML="layers",this._bhattan1=Wu.DomUtil.createId("div","bhattan1"),Wu.DomUtil.addClass(this._bhattan1,"dropdown-button rotate270 ct31"),this._layerMenuHeader.appendChild(this._bhattan1),this._cunt.insertBefore(this._layerMenuHeader,this._cunt.getElementsByTagName("div")[0]),this._openLayers=Wu.DomUtil.createId("div","open-layers"),this._openLayers.innerHTML="Open Layer Menu",Wu.DomUtil.addClass(this._openLayers,"leaflet-control open-open-layers"),this._legendsContainer=Wu.DomUtil.get("legends-control-inner-content"),this._legendsCollapser=Wu.DomUtil.get("legends-collapser"),Wu.DomEvent.on(this._bhattan1,"click",this.closeLayers,this),Wu.DomEvent.on(this._openLayers,"click",this.openLayers,this)},closeLayers:function(){this._container.parentNode.style.width="0px",this._container.parentNode.appendChild(this._openLayers),Wu.DomUtil.addClass(this._legendsContainer,"legends-push-right"),this._legendsCollapser.style.left=this._legendsCollapser.offsetLeft+Math.floor(118.5)+"px",Wu.app.MapPane._container.children[1].children[1].style.right="6px";var a=this;setTimeout(function(){a._openLayers.className="leaflet-control layer-opener-opened"},500)},openLayers:function(){this._container.parentNode.style.width="220px",this._openLayers.className="leaflet-control layer-opener-opened close-layer-opener",Wu.DomUtil.removeClass(this._legendsContainer,"legends-push-right"),this._legendsCollapser.style.left=this._legendsCollapser.offsetLeft-Math.floor(118.5)+"px",Wu.app.MapPane._container.children[1].children[1].style.right="232px";var a=this;setTimeout(function(){a._container.parentNode.removeChild(a._openLayers),a._openLayers.className="leaflet-control open-open-layers"},500)},enableLayer:function(a){a.layer.add(),a.on=!0,Wu.DomUtil.addClass(a.el,"layer-active ct8")},disableLayer:function(a){a.layer.remove(),a.on=!1,Wu.DomUtil.removeClass(a.el,"layer-active"),Wu.DomUtil.removeClass(a.el,"ct8")},toggleLayer:function(a){console.log("toggleLayuer!",a);var b=a.target.getAttribute("fuuid"),c=this.layers[b];c.on?this.disableLayer(c):this.enableLayer(c)},remove:function(a){var b=this.layers[a],c=b.el;c.parentNode.removeChild(c),delete this.layers[a]},add:function(a){var b=this.layers[a.uuid]={};if(b.file=a,b.layer)return this.enableLayer(b.layer);b.layer=new Wu.GeojsonLayer(a);var c=Wu.DomUtil.create("div","layer-menu-item-wrap ct5");c.innerHTML=ich.layerMenuItem(a),b.el=c,this._content.appendChild(c),Wu.DomEvent.on(c,"mousedown",this.toggleLayer,this)},addFromFile:function(a){var b=this.layers[a.uuid]={};if(b.file=a,b.layer)return void this.enableLayer(b.layer);b.layer=new Wu.GeojsonLayer(a);var c=Wu.DomUtil.create("div","layer-menu-item-wrap ct5");c.innerHTML=ich.layerMenuItem(a),b.el=c,this._content.appendChild(c),Wu.DomEvent.on(c,"mousedown",this.toggleLayer,this)},addMenuFolder:function(a){var b=this.layers[a.fuuid]={};b.file=!1,b.layer=!1;var c=Wu.DomUtil.create("div","layer-menu-item-wrap menufolder ct5",this._content);Wu.DomUtil.addClass(c,"level-"+a.pos);var d=Wu.DomUtil.create("div","layer-menufolder-up",c);d.setAttribute("fuuid",a.fuuid),d.innerHTML=">",Wu.DomEvent.on(d,"click",this.upFolder,this);var e=Wu.DomUtil.create("div","layer-menufolder-down",c);e.setAttribute("fuuid",a.fuuid),e.innerHTML="<",Wu.DomEvent.on(e,"click",this.downFolder,this);var f=Wu.DomUtil.create("div","layer-menufolder-delete",c);f.setAttribute("fuuid",a.fuuid),f.innerHTML="X",Wu.DomEvent.on(f,"click",this.deleteMenuFolder,this);var g=Wu.DomUtil.create("div","layer-menu-item",c);g.setAttribute("fuuid",a.fuuid),g.id=a.fuuid,g.innerHTML=a.title,b.el=c},upFolder:function(a){console.log("UP menu folder");var b=a.target.getAttribute("fuuid");console.log("fuuid: ",b);var c=this.layers[b].el,d=_.findIndex(this.project.layermenu,{fuuid:b}),e=parseInt(this.project.layermenu[d].pos),f=e+1;this.project.layermenu[d].pos=f,Wu.DomUtil.addClass(c,"level-"+f),Wu.DomUtil.removeClass(c,"level-"+e),this.project._update("layermenu")},downFolder:function(a){console.log("DOWN menu folder");var b=a.target.getAttribute("fuuid");console.log("fuuid: ",b);var c=this.layers[b].el,d=_.findIndex(this.project.layermenu,{fuuid:b}),e=parseInt(this.project.layermenu[d].pos),f=e-1;this.project.layermenu[d].pos=f,Wu.DomUtil.addClass(c,"level-"+f),Wu.DomUtil.removeClass(c,"level-"+e),this.project._update("layermenu")},deleteMenuFolder:function(a){console.log("delete menu folder");var b=a.target.getAttribute("fuuid");console.log("fuuid: ",b),this.remove(b);var c=_.findIndex(this.project.layermenu,{fuuid:b});this.project.layermenu.splice(c,1),this.project._update("layermenu")},addFromMapbox:function(a){var b=this.layers[a.id]={};b.file=a,b.layer=new Wu.MapboxLayer(a);var c=Wu.DomUtil.create("div","layer-menu-item-wrap ct5"),d={uuid:a.id,name:a.name};c.innerHTML=ich.layerMenuItem(d),b.el=c,this._content.appendChild(c),Wu.DomEvent.on(c,"mousedown",this.toggleLayer,this)},save:function(){var a=this;this.saveTimer=setTimeout(function(){a.project._update("layermenu")},1e3)},update:function(a){return this.project=a||Wu.app._activeProject,this._content=Wu.DomUtil.get("layer-menu-inner-content"),this.layers={},this.project.layermenu?void this.fill():void console.log("no menu here!")},fill:function(){this.project.layermenu.forEach(function(a){if("datalibrary"==a.layerType||void 0===a.layerType){var b=_.find(this.project.files,{uuid:a.fuuid});this.addFromFile(b)}if("mapbox"==a.layerType){var c=_.find(this.project.mapboxLayers,{id:a.fuuid});0>c&&console.error("no mb??",a,this.project.mapboxLayers),this.addFromMapbox(c)}"menufolder"==a.layerType&&(console.log("adding menufolder"),this.addMenuFolder(a))},this)}}),L.control.layermenu=function(a){return new L.Control.Layermenu(a)},Wu.Layer=Wu.Class.extend({type:"Wu.Layer",initialize:function(a){this._source=a,this.create(),window.layers=window.layers||[],window.layers.push(this)},_create:function(){this.uuid="layer-"+Wu.Util.guid(),this.title="Layer new title!",this.description="Layer desc!",this.source={},"geojson"==this._source.type},create:function(){"geojson"==this.source.type&&(this._layer=L.geoJson()),this.hasLoaded=!1},load:function(){},loaded:function(a){console.log("loaded:"),console.log(a),this._layer.addData([a]),this._layer.onEachFeature(this._attachPopup(feature,layer))},_attachPopup:function(a){if(a.properties){var b="";for(key in a.properties)b+=key+": "+a.properties[key]+"<br>";this._layer.bindPopup(b)}},_leafletAddGeoJSON:function(a){console.log("adding leaflet geolayer"),console.log(a),layer=L.geoJson(a,{onEachFeature:function(a,b){if(a.properties){var c="";for(key in a.properties)c+=key+": "+a.properties[key]+"<br>";b.bindPopup(c)}}}),layer.addTo(app._map)}}),Wu.GeojsonLayer=Wu.Layer.extend({type:"Wu.GeojsonLayer",create:function(){var a=this;"layer"==this._source.type&&(this._layer=L.geoJson([],{onEachFeature:function(b,c){a.basicTooltip(b,c)}})),this.hasLoaded=!1},basicTooltip:function(a,b){if(a.properties){var c="";for(key in a.properties)c+=key+": "+a.properties[key]+"<br>";b.bindPopup(c)}},add:function(a){var a=a||Wu.app._map,b=this._layer,c=Wu.app.MapPane._drawControlLayer;this.hasLoaded||this.load(),c?c.addLayer(b):b.addTo(a)},remove:function(a){var a=a||Wu.app._map,b=this._layer,c=Wu.app.MapPane._drawControlLayer;c?c.removeLayer(b):a.removeLayer(b)},load:function(){var a=this;if(!this.hasLoaded){var b={uuid:this._source.uuid},c=JSON.stringify(b),d="/api/geojson",e=new XMLHttpRequest,f=window.location.origin;f+=d,e.addEventListener("progress",function(a){console.log("progress: ",a)},!1),e.open("POST",f,!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&a._loaded(a,e.responseText)},e.send(c)}},progress:function(a){var b=Wu.app.SidePane.DataLibrary.progress,c=a.loaded/a.total*100;b.style.opacity=1,b.style.width=c+"%"},_loaded:function(a,b){console.log("_got json: length: ",b.length),a.geojson=JSON.parse(b),a._layer.addData(a.geojson),this.hasLoaded=!0}}),Wu.RasterLayer=Wu.Layer.extend({}),Wu.MapboxLayer=Wu.Layer.extend({create:function(){this._layer=L.mapbox.tileLayer(this._source.id)},add:function(a){var a=a||Wu.app._map;this._layer.addTo(a)},remove:function(a){var a=a||Wu.app._map;a.removeLayer(this._layer)}}),Wu.CartodbLayer=Wu.Layer.extend({}),L.Control.Legends=L.Control.extend({options:{position:"bottomleft"},onAdd:function(){{var a="leaflet-control-legends",b=L.DomUtil.create("div",a);this.options}return b.innerHTML=ich.legendsControl(),this._legendsOpener=Wu.DomUtil.createId("div","legends-opener"),this._legendsOpener.innerHTML="Open Legends",Wu.DomUtil.addClass(this._legendsOpener,"opacitizer"),b},addHooks:function(){Wu.DomEvent.on(this._legendsCollapser,"click",this.closeLegends,this)},closeLegends:function(){this._legendsInner.style.width=this._legendsInner.offsetWidth+"px";var a=this._legendsInner.getElementsByTagName("div")[0];this._legendsInner.insertBefore(this._legendsOpener,a),Wu.DomEvent.on(this._legendsOpener,"click",this.openLegends,this);var b=this._legendsInner.offsetHeight;this._legendsCollapser.setAttribute("sh",b),this._legendsInner.style.width="150px",this._legendsInner.style.height="24px",this._legendsCollapser.style.display="none",this._legendsCollapser.style.opacity="0",Wu.app.MapPane._container.children[1].children[1].style.bottom="6px"},openLegends:function(){console.log("open legendary"),this._legendsOpener.className="",this._legendsOpener.style.opacity="0";var a=this._legendsContainer.offsetWidth-287-235,b=Wu.DomUtil.hasClass(this._legendsContainer,"legends-push-left"),c=Wu.DomUtil.hasClass(this._legendsContainer,"legends-push-right");b&&(a+=287),c&&(a+=235),this._legendsInner.style.width=a+"px",this._legendsInner.style.height=this._legendsCollapser.getAttribute("sh")+"px",this._legendsCollapser.style.display="block",Wu.app.MapPane._container.children[1].children[1].style.bottom="133px";var d=this;setTimeout(function(){d._legendsInner.removeAttribute("style"),d._legendsOpener.removeAttribute("style"),d._legendsInner.removeChild(d._legendsOpener),Wu.DomUtil.addClass(d._legendsCollapser,"opacitizer"),d.adjustLegArrow(),d._legendsCollapser.style.opacity="1"},500)},update:function(a){console.log("legends update!"),this.initContainer(),this.project=a||Wu.app._activeProject,this._content=Wu.DomUtil.get("legends-control-inner-content")},initContainer:function(){console.log("init container"),this._legendsCollapser=Wu.DomUtil.get("legends-collapser"),this._legendsInner=Wu.DomUtil.get("legends-inner"),this._legendsContainer=Wu.DomUtil.get("legends-control-inner-content"),this.addHooks(),this.adjustLegArrow()},adjustLegArrow:function(){var a=document.getElementById("legends-inner").offsetWidth,b=Wu.DomUtil.hasClass(this._legendsContainer,"legends-push-left"),c=Wu.DomUtil.hasClass(this._legendsContainer,"legends-push-right");b?a-=287:a+=287,a+=c?237:237,this._legendsCollapser.style.left=a/2+"px"}}),L.control.legends=function(a){return new L.Control.Legends(a)},Wu.MapPane=Wu.Class.extend({initialize:function(){return this._initContainer(),this._initPanes(),this},_initContainer:function(){this._container=Wu.app._mapPane=Wu.DomUtil.createId("div","map",Wu.app._mapContainer),Wu.DomEvent.on(window,"resize",this._updateWidth,this)},_initPanes:function(){},_updateWidth:function(){this._map&&(this._map._container.style.width=parseInt(window.innerWidth)-parseInt(this._map._container.offsetLeft)+"px",this._map.invalidateSize())},setProject:function(a){this.project=a,this._reset(),this._update(a)},setBaseLayer:function(a){Wu.Util.isObject(this._baselayer)&&(console.log("removing baselayer!"),this._map.removeLayer(this._baseLayer)),this._baseLayer&&this._map.removeLayer(this._baseLayer),this._baseLayer=this._getBaseLayer(a),this._baseLayer.addTo(this._map)},_setLeft:function(a){this._map._container.style.left=a+"px",this._map._container.style.width=parseInt(window.innerWidth)-a+"px"},_update:function(a){this.setBaseLayer(a);var b=a.map.initPos.lat,c=a.map.initPos.lng,d=a.map.initPos.zoom;this._map.setView([b,c],d);var e=Wu.app._map._controlContainer;e.style.paddingTop=a.header.height+"px",this._map.invalidateSize()},_getBaseLayer:function(a){var b=a.map.baseLayer.url;if("mapbox"==a.map.baseLayer.provider)var c=L.mapbox.tileLayer(b);if("systemapic"==a.map.baseLayer.provider||"datalibrary"==a.map.baseLayer.provider)var d=a.map.baseLayer.type,b=a.map.baseLayer.url,e=Wu.app.options.tileserver+d+"/"+b+"/{z}/{x}/{y}.png",f=a.map.baseLayer.tms||!1,c=L.tileLayer(e,{tms:f});return c},reset:function(){this._reset()},_reset:function(){this._map&&this._map.remove(),this._map=Wu.app._map=L.map("map").setView([0,0],5),this._updateWidth(),delete this._drawControl,delete this._drawControlLayer,delete this._scale,delete this.vectorStyle,delete this.layerMenu,delete this.legendsControl,delete this.descriptionControl,delete this.inspectControl,delete this.mousepositionControl,this.disableZoom()},addLayer:function(a){var b=L.mapbox.tileLayer(a);b.addTo(this._map)},_addLayer:function(a){a.addto(this._map)},disableZoom:function(){this._map.touchZoom.disable(),this._map.doubleClickZoom.disable(),this._map.scrollWheelZoom.disable(),this._map.boxZoom.disable(),this._map.keyboard.disable(),document.getElementsByClassName("leaflet-control-zoom")[0].style.visibility="hidden"},enableZoom:function(){console.log("enabling zoom!"),this._map.touchZoom.enable(),this._map.doubleClickZoom.enable(),this._map.scrollWheelZoom.enable(),this._map.boxZoom.enable(),this._map.keyboard.enable(),document.getElementsByClassName("leaflet-control-zoom")[0].style.visibility="visible"},enableLegends:function(){this.legendsControl||(this.legendsControl=L.control.legends({position:"bottomleft"}),this.legendsControl.addTo(this._map),this.legendsControl.update())},disableLegends:function(){this.legendsControl&&(this._map.removeControl(this.legendsControl),delete this.legendsControl)},enableMouseposition:function(){this.mousepositionControl||(this.mousepositionControl=L.control.mouseposition({position:"topright"}),this.mousepositionControl.addTo(this._map))},disableMouseposition:function(){this.mousepositionControl&&(this._map.removeControl(this.mousepositionControl),delete this.mousepositionControl)},enableGeolocation:function(){},disableGeolocation:function(){},enableMeasure:function(){this._scale||(this._scale=L.control.scale({position:"topright"}),this._scale.addTo(this._map))},disableMeasure:function(){this._scale&&(this._map.removeControl(this._scale),delete this._scale)},enableDescription:function(){this.descriptionControl||(this.descriptionControl=L.control.description({position:"topleft"}),this.descriptionControl.addTo(this._map),this.descriptionControl.update())},disableDescription:function(){this.descriptionControl&&(this._map.removeControl(this.descriptionControl),delete this.descriptionControl)},enableInspect:function(){this.inspectControl||(this.inspectControl=L.control.inspect({position:"bottomright"}),this.inspectControl.addTo(this._map),this.inspectControl.update())},disableInspect:function(){this.inspectControl&&(this._map.removeControl(this.inspectControl),delete this.inspectControl)},enableLayermenu:function(){this.layerMenu||(this.layerMenu=L.control.layermenu({position:"bottomright"}),this.layerMenu.addTo(this._map),this.layerMenu.update())},disableLayermenu:function(){this.layerMenu&&(this._map.removeControl(this.layerMenu),delete this.layerMenu)},enableVectorstyle:function(){this.vectorStyle||(this.vectorStyle=L.control.styleEditor({position:"topleft"}),this._map.addControl(this.vectorStyle))},disableVectorstyle:function(){this.vectorStyle&&(this._map.removeControl(this.vectorStyle),delete this.vectorStyle)},enableDraw:function(){this._drawControl||this.addDrawControl()},disableDraw:function(){this._drawControl&&"undefined"!==this._drawControl&&this.removeDrawControl()},removeDrawControl:function(){this._drawControl&&"undefined"!==this._drawControl&&(this._map.removeControl(this._drawControl),this._map.removeLayer(this._drawControlLayer),this._drawControl=!1)},addDrawControl:function(){var a=this;geojsony={type:"Feature",properties:{OK:"asdasd",asdsad:"asd"},geometry:{type:"Polygon",coordinates:[[[43.9453125,36.73888412439431],[43.9453125,53.4357192066942],[77.6953125,53.4357192066942],[77.6953125,36.73888412439431],[33.9453125,36.73888412439431]]]}},console.log("ALSDALDLASD<AS"),this._drawControlLayer=window.drawControl=L.geoJson().addTo(this._map),options={position:"topleft",edit:{featureGroup:this._drawControlLayer},draw:{circle:{shapeOptions:{fill:!1,color:"#FFF",fillOpacity:.3,fillColor:"#FFF"}},rectangle:{shapeOptions:{fill:!0,color:"#FFF",fillOpacity:.3,fillColor:"#FFF"}},polygon:{shapeOptions:{fill:!0,color:"#FFF",fillOpacity:.3,fillColor:"#FFF"}},polyline:{shapeOptions:{fill:!1,color:"#FFF"}}}},this._drawControl=new L.Control.Draw(options),this._map.addControl(this._drawControl),L.DomUtil.addClass(this._drawControl._container,"elizaveta"),Wu.DomEvent.on(this._drawControl,"mousemove",L.DomEvent.stop,this),Wu.DomEvent.on(this._drawControl,"mouseover",this._map.closePopup,this),this._map.on("draw:created",function(b){b.layer.layerType=b.layerType,a._drawControlLayer.addLayer(b.layer)}),this._map.on("draw:note:created",function(b){a._drawControlLayer.addLayer(b.noteLayer),a._drawControlLayer.addLayer(b.rectangleLayer),L.Draw._editshortcut.enable(),b.noteLayer._el.focus(),a._map.LeafletDrawEditEnabled=!0})}}),L.Control.MousePosition=L.Control.extend({options:{position:"topright",separator:" : ",emptyString:"Lat/Lng",lngFirst:!1,numDigits:5,lngFormatter:void 0,latFormatter:void 0,prefix:""},onAdd:function(a){return this._container=L.DomUtil.create("div","leaflet-control-mouseposition"),this._container.innerHTML=this.options.emptyString,L.DomEvent.disableClickPropagation(this._container),a.on("mousemove",this._onMouseMove,this),this._container},onRemove:function(a){a.off("mousemove",this._onMouseMove)},_onMouseMove:function(a){var b=this.options.lngFormatter?this.options.lngFormatter(a.latlng.lng):L.Util.formatNum(a.latlng.lng,this.options.numDigits),c=this.options.latFormatter?this.options.latFormatter(a.latlng.lat):L.Util.formatNum(a.latlng.lat,this.options.numDigits),d=this.options.lngFirst?b+this.options.separator+c:c+this.options.separator+b,e=this.options.prefix+" "+d;this._container.innerHTML=e}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.mouseposition=function(a){return new L.Control.MousePosition(a)},Wu.Util.notebook=function(a,b){console.log("notebook"),console.log($);var b,c=document,d=window,e=function(){var a=function(a){return a&&"none"!=a?a.match(/(-?[0-9\.]+)/g):[1,0,0,1,0,0]},b=function(a){return a.css("-webkit-transform")||a.css("transform")||a.css("-moz-transform")||a.css("-o-transform")||a.css("-ms-transform")},c=function(c){var d=b(c);return a(d)},d=function(a,b){a.css("-webkit-transform",b),a.css("-moz-transform",b),a.css("-o-transform",b),a.css("-ms-transform",b),a.css("transform",b)},e=function(a){return"matrix("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},f=function(a){var b=c(a);return{x:parseInt(b[4]),y:parseInt(b[5])}},g=function(a,b){var f=c(a);f[0]=f[3]=b;var g=e(f);d(a,g)},h=function(a,b,f){var g=c(a);g[4]=b,g[5]=f;var h=e(g);d(a,h)},i=function(a,b){var f=c(a),g=b*(Math.PI/180),h=-1*g;f[1]=g,f[2]=h;var i=e(f);d(a,i)};return{scale:g,translate:h,rotate:i,getTranslate:f}}(),f="MacIntel"==d.navigator.platform,g=0,h=0,i={command:!1,shift:!1,isSelecting:!1},j={66:"bold",73:"italic",85:"underline",112:"h1",113:"h2",122:"undo"},k={keyboard:{isCommand:function(a,b,c){f&&a.metaKey||!f&&a.ctrlKey?b():c()},isShift:function(a,b,c){a.shiftKey?b():c()},isModifier:function(a,b){var c=a.which,d=j[c];d&&b.call(this,d)},isEnter:function(a,b){13===a.which&&b()},isArrow:function(a,b){(a.which>=37||a.which<=40)&&b()}},html:{addTag:function(a,b,d,e){var f=$(c.createElement(b));return f.attr("contenteditable",Boolean(e)),f.append(" "),a.append(f),d&&(i.focusedElement=a.children().last(),k.cursor.set(a,0,i.focusedElement)),f}},cursor:{set:function(a,b,e){var f;if(c.createRange){f=c.createRange();var g=d.getSelection(),h=a.children().last(),i=h.html().length-1,j=e?e[0]:h[0],k="undefined"!=typeof b?b:i;f.setStart(j,k),f.collapse(!0),g.removeAllRanges(),g.addRange(f)
}else f=c.body.createTextRange(),f.moveToElementText(e),f.collapse(!1),f.select()}},selection:{save:function(){if(d.getSelection){var a=d.getSelection();if(a.rangeCount>0)return a.getRangeAt(0)}else if(c.selection&&c.selection.createRange)return c.selection.createRange();return null},restore:function(a){if(a)if(d.getSelection){var b=d.getSelection();b.removeAllRanges(),b.addRange(a)}else c.selection&&a.select&&a.select()},getText:function(){var a="";return d.getSelection?a=d.getSelection().toString():c.getSelection?a=c.getSelection().toString():c.selection&&(a=c.selection.createRange().text),a},clear:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},getContainer:function(a){return d.getSelection&&a&&a.commonAncestorContainer?a.commonAncestorContainer:c.selection&&a&&a.parentElement?a.parentElement():null},getSelection:function(){return d.getSelection?d.getSelection():c.selection&&c.selection.createRange?c.selection:null}},validation:{isUrl:function(a){return/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(a)}}},l={updatePos:function(a,b){var c=d.getSelection(),f=c.getRangeAt(0),g=f.getBoundingClientRect(),h=b.width(),i=b.height(),j=(a.offset().left,{x:g.left+g.width/2-h/2,y:g.top-i-8+$(document).scrollTop()});e.translate(b,j.x,j.y)},updateState:function(a,b){b.find("button").removeClass("active");var c=d.getSelection(),e=[];l.checkForFormatting(c.focusNode,e);for(var f={b:"bold",i:"italic",u:"underline",h1:"h1",h2:"h2",a:"anchor",ul:"ul",ol:"ol"},g=0;g<e.length;g++){var h=e[g];b.find("button."+f[h]).addClass("active")}},checkForFormatting:function(a,b){var c=["b","i","u","h1","h2","ol","ul","li","a"];("#text"===a.nodeName||-1!=c.indexOf(a.nodeName.toLowerCase()))&&("#text"!=a.nodeName&&b.push(a.nodeName.toLowerCase()),l.checkForFormatting(a.parentNode,b))},buildMenu:function(a,c){var d=k.html.addTag(c,"ul",!1,!1);for(var e in b.modifiers){var f=k.html.addTag(d,"li",!1,!1),g=k.html.addTag(f,"button",!1,!1);g.attr("editor-command",b.modifiers[e]),g.addClass(b.modifiers[e])}c.find("button").click(function(b){b.preventDefault();var c=$(this).attr("editor-command");o.commands[c].call(a,b)});var h=k.html.addTag(c,"div",!1,!1);h.addClass("link-area");var i=k.html.addTag(h,"input",!1,!1);i.attr({type:"text"});var j=k.html.addTag(h,"button",!1,!1);j.click(function(a){a.preventDefault();$(this).closest(".editor");$(this).closest(".link-area").hide(),$(this).closest(".bubble").find("ul").show()})},show:function(){var a=$(this).parent().find(".bubble");a.length||(a=k.html.addTag($(this).parent(),"div",!1,!1),a.addClass("jquery-notebook bubble")),a.empty(),l.buildMenu(this,a),a.show(),l.updateState(this,a),a.hasClass("active")?a.removeClass("jump"):a.addClass("jump"),l.updatePos($(this),a),a.addClass("active")},update:function(){var a=$(this).parent().find(".bubble");l.updateState(this,a)},clear:function(){var a=$(this).parent().find(".bubble");a.hasClass("active")&&(a.removeClass("active"),l.hideLinkInput.call(this),l.showButtons.call(this),setTimeout(function(){a.hasClass("active")||a.hide()},500))},hideButtons:function(){$(this).parent().find(".bubble").find("ul").hide()},showButtons:function(){$(this).parent().find(".bubble").find("ul").show()},showLinkInput:function(a){l.hideButtons.call(this);var b=this,c=$(this).parent().find(".bubble").find("input[type=text]"),d=c.closest(".jquery-notebook").find("button.anchor").hasClass("active");c.unbind("keydown"),c.keydown(function(c){var e=$(this);k.keyboard.isEnter(c,function(){c.preventDefault();var f=e.val();k.validation.isUrl(f)?(c.url=f,o.commands.createLink(c,a),l.clear.call(b)):""===f&&d&&(o.commands.removeLink(c,a),l.clear.call(b))})}),c.bind("paste",function(){var a=$(this);setTimeout(function(){var b=a.val();/http:\/\/https?:\/\//.test(b)&&(b=b.substring(7),a.val(b))},1)});var e="http://";if(d){var f=$(k.selection.getContainer(a)).closest("a");e=f.prop("href")||e}$(this).parent().find(".link-area").show(),c.val(e).focus()},hideLinkInput:function(){$(this).parent().find(".bubble").find(".link-area").hide()}},m={bindEvents:function(a){a.keydown(n.keydown),a.keyup(n.keyup),a.focus(n.focus),a.bind("paste",o.paste),a.mousedown(n.mouseClick),a.mouseup(n.mouseUp),a.mousemove(n.mouseMove),a.blur(n.blur),$("body").mouseup(function(b){b.target==b.currentTarget&&i.isSelecting&&n.mouseUp.call(a,b)})},setPlaceholder:function(a){if(/^\s*$/.test($(this).text())){$(this).empty();var b=k.html.addTag($(this),"p").addClass("placeholder");b.append($(this).attr("editor-placeholder")),k.html.addTag($(this),"p","undefined"!=typeof a.focus?a.focus:!1,!0)}else $(this).find(".placeholder").remove()},removePlaceholder:function(){$(this).find(".placeholder").remove()},preserveElementFocus:function(){var a=d.getSelection()?d.getSelection().anchorNode:c.activeElement;if(a){var b=a.parentNode,e=b!==i.focusedElement,f=this.children,g=0;b===this&&(b=a);for(var h=0;h<f.length;h++)if(b===f[h]){g=h;break}e&&(i.focusedElement=b,i.focusedElementIndex=g)}},setContentArea:function(a){var b=$("body").find(".jquery-editor").length+1;a.attr("data-jquery-notebook-id",b);var c=$("body");contentArea=$("<textarea></textarea>"),contentArea.css({position:"absolute",left:-1e3}),contentArea.attr("id","jquery-notebook-content-"+b),c.append(contentArea)},prepare:function(a,c){if(b=c,m.setContentArea(a),a.attr("editor-mode",b.mode),a.attr("editor-placeholder",b.placeholder),a.attr("contenteditable",!0),a.css("position","relative"),a.addClass("jquery-notebook editor"),m.setPlaceholder.call(a,{}),m.preserveElementFocus.call(a),b.autoFocus===!0){var d=a.find("p:not(.placeholder)");k.cursor.set(a,0,d)}}},n={keydown:function(a){var b=this;i.command&&65===a.which&&setTimeout(function(){l.show.call(b)},50),k.keyboard.isCommand(a,function(){i.command=!0},function(){i.command=!1}),k.keyboard.isShift(a,function(){i.shift=!0},function(){i.shift=!1}),k.keyboard.isModifier.call(this,a,function(b){i.command&&o.commands[b].call(this,a)}),i.shift?k.keyboard.isArrow.call(this,a,function(){setTimeout(function(){var a=k.selection.getText();""!==a?l.show.call(b):l.clear.call(b)},100)}):k.keyboard.isArrow.call(this,a,function(){l.clear.call(b)}),13===a.which&&o.enterKey.call(this,a),27===a.which&&l.clear.call(this),86===a.which&&i.command&&o.paste.call(this,a),90===a.which&&i.command&&o.commands.undo.call(this,a)},keyup:function(a){k.keyboard.isCommand(a,function(){i.command=!1},function(){i.command=!0}),m.preserveElementFocus.call(this),m.removePlaceholder.call(this),/^\s*$/.test($(this).text())&&($(this).empty(),k.html.addTag($(this),"p",!0,!0)),o.change.call(this)},focus:function(){i.command=!1,i.shift=!1},mouseClick:function(){if(i.isSelecting=!0,$(this).parent().find(".bubble:visible").length){var a=$(this).parent().find(".bubble:visible"),b=a.offset().left,c=a.offset().top,d=a.width(),e=a.height();if(g>b&&b+d>g&&h>c&&c+e>h)return}},mouseUp:function(a){var b=this;i.isSelecting=!1,setTimeout(function(){var c=k.selection.save();c&&(c.collapsed?l.clear.call(b):(l.show.call(b),a.preventDefault()))},50)},mouseMove:function(a){g=a.pageX,h=a.pageY},blur:function(){m.setPlaceholder.call(this,{focus:!1})}},o={commands:{bold:function(a){a.preventDefault(),c.execCommand("bold",!1),l.update.call(this),o.change.call(this)},italic:function(a){a.preventDefault(),c.execCommand("italic",!1),l.update.call(this),o.change.call(this)},underline:function(a){a.preventDefault(),c.execCommand("underline",!1),l.update.call(this),o.change.call(this)},anchor:function(a){a.preventDefault();var b=k.selection.save();l.showLinkInput.call(this,b),o.change.call(this)},createLink:function(a,b){k.selection.restore(b),c.execCommand("createLink",!1,a.url),l.update.call(this),o.change.call(this)},removeLink:function(a,b){var c=$(k.selection.getContainer(b)).closest("a");c.contents().first().unwrap(),o.change.call(this)},h1:function(a){a.preventDefault(),$(window.getSelection().anchorNode.parentNode).is("h1")?c.execCommand("formatBlock",!1,"<p>"):c.execCommand("formatBlock",!1,"<h1>"),l.update.call(this),o.change.call(this)},h2:function(a){a.preventDefault(),$(window.getSelection().anchorNode.parentNode).is("h2")?c.execCommand("formatBlock",!1,"<p>"):c.execCommand("formatBlock",!1,"<h2>"),l.update.call(this),o.change.call(this)},ul:function(a){a.preventDefault(),c.execCommand("insertUnorderedList",!1),l.update.call(this),o.change.call(this)},ol:function(a){a.preventDefault(),c.execCommand("insertOrderedList",!1),l.update.call(this),o.change.call(this)},undo:function(a){a.preventDefault(),c.execCommand("undo",!1);var b=d.getSelection(),e=b.getRangeAt(0),f=e.getBoundingClientRect();$(document).scrollTop($(document).scrollTop()+f.top),o.change.call(this)}},enterKey:function(a){if("inline"===$(this).attr("editor-mode"))return a.preventDefault(),void a.stopPropagation();var b=k.selection.getSelection(),c=$(b.focusNode.parentElement),d=c.next();if(!d.length&&"LI"!=c.prop("tagName")){var e=c.prop("tagName");if("OL"===e||"UL"===e){var f=c.children().last();f.length&&""===f.text()&&f.remove()}k.html.addTag($(this),"p",!0,!0),a.preventDefault(),a.stopPropagation()}o.change.call(this)},paste:function(){var a=($(this),"jqeditor-temparea"),b=k.selection.save(),d=$("#"+a);if(d.length<1){var e=$("body");d=$("<textarea></textarea>"),d.css({position:"absolute",left:-1e3}),d.attr("id",a),e.append(d)}d.focus(),setTimeout(function(){for(var a="",e=d.val().split("\n"),f=0;f<e.length;f++)a+=["<p>",e[f],"</p>"].join("");d.val(""),k.selection.restore(b),c.execCommand("delete"),c.execCommand("insertHTML",!1,a),o.change.call(this)},500)},change:function(){var a=$("#jquery-notebook-content-"+$(this).attr("data-jquery-notebook-id"));a.val($(this).html());var b=a.val(),c=new CustomEvent("contentChange",{detail:{content:b}});this.dispatchEvent(c)}},p={autoFocus:!1,placeholder:"Your text here...",mode:"multiline",modifiers:["bold","italic","underline","h1","h2","ol","ul","anchor"]};return m.prepare(a,p),m.bindEvents(a),a}(),Wu.Client=Wu.Class.extend({initialize:function(a){Wu.extend(this,a),this.options={},this.options.editMode=!1,!Wu.Util.isObject(Wu.app._activeClient)},setActive:function(){this._setUrl(),Wu.Util.isObject(Wu.app._activeClient)&&Wu.app._activeClient.uuid==this.uuid||(Wu.app._activeClient=this,console.log("setting active client"),Wu.app.SidePane.Projects.enable(),Wu.app.SidePane.Projects.refresh())},_setUrl:function(){var a="/"+this.slug+"/";Wu.Util.setAddressBar(a)},update:function(a){var b={};b[a]=this[a],b.uuid=this.uuid;var c=JSON.stringify(b);this._save(c)},_save:function(a){Wu.save("/api/client/update",a)},saveNew:function(){var a={name:this.name,description:this.description,keywords:this.keywords},b=JSON.stringify(a),c=Wu.app.SidePane.Clients;Wu.Util.postcb("/api/client/new",b,c._created,this)},_delete:function(){var a=this,b={cid:a.uuid};b=JSON.stringify(b),Wu.Util.postcb("/api/client/delete",b,a._deleted,a)},_deleted:function(a){delete Wu.app.Clients[a.uuid];var b=Wu.DomUtil.get("editor-clients-container-"+a.uuid);Wu.DomUtil.remove(b),Wu.Util.setAddressBar("/")}}),Wu.Project=Wu.Class.extend({initialize:function(a){Wu.extend(this,a),this.options={editMode:!1},this._attach(),this.layerify(),this.lastSaved={}},layerify:function(){if(this.layers&&(this.layers.forEach(function(a,b){this.layers[b]._layer=new Wu.GeojsonLayer(a)},this),"geojson"==this.type)){var a=new Wu.GeojsonLayer(this);this.layers.push(a)}},setActive:function(){Wu.app._activeProject=this,Wu.Util.isObject(Wu.app.MapPane)&&Wu.app.MapPane.setProject(this),Wu.Util.isObject(Wu.app.HeaderPane)&&Wu.app.HeaderPane.setProject(this),Wu.Util.isObject(Wu.app.LayermenuPane)&&Wu.app.LayermenuPane.setProject(this),Wu.Util.isObject(Wu.app.SidePane)&&Wu.app.SidePane.setProject(this),this._setUrl(),this.setColorTheme()},_setUrl:function(){var a="/";a+=this._parentClient.slug,a+="/",a+=this.slug,Wu.Util.setAddressBar(a)},_attach:function(){var a=Wu.Util._getParentClientID(this.uuid);this._parentClient=Wu.app.Clients[a]},_update:function(a){var b={};b[a]=this[a],b.uuid=this.uuid;var c=JSON.stringify(b);this._save(c)},_save:function(a){console.log("saving..."),Wu.save("/api/project/update",a)},_saveNew:function(){var a={name:this.name,description:this.description,keywords:this.keywords},b=JSON.stringify(a),c=Wu.app.SidePane.Projects;Wu.Util.postcb("/api/project/new",b,c._created,this)},unload:function(){Wu.app.MapPane.reset(),Wu.app.HeaderPane.reset()},addLayer:function(a){if("geojson"==a.type){var b=new Wu.GeojsonLayer(a);this.layers.push(b)}if("raster"==a.type){var b=new Wu.RasterLayer(a);this.layers.push(b)}Wu.app.SidePane.Layers.update(this)},_delete:function(){var a=this,b={pid:a.uuid,projectUuid:a.uuid,clientUuid:a._parentClient.uuid};b=JSON.stringify(b),console.log("deleting project!"),console.log(b),Wu.Util.postcb("/api/project/delete",b,a._deleted,a)},_deleted:function(a){delete Wu.app.Projects[a.uuid]},saveColorTheme:function(){this.colorTheme=savedCSS,this._update("colorTheme"),console.log("saved color theme,",this.colorTheme.length)},setColorTheme:function(){this.colorTheme&&(savedCSS=this.colorTheme,Wu.Util.setColorTheme())}}),Wu.SidePane=Wu.Class.extend({initialize:function(a){return this.options=a||Wu.app.options,this.initContainer(),this.initContent(),this.render(),this},initContainer:function(){var a="q-editor-container ct1";this._container=Wu.DomUtil.create("div",a,Wu.app._appPane),this.open=!0,Wu.app._paneToggle=Wu.DomUtil.createId("div","menucloser",this._container),Wu.DomUtil.addClass(Wu.app._paneToggle,"pane-open"),Wu.DomEvent.on(Wu.app._paneToggle,"click",this.togglePane,this)},initContent:function(){var a="q-editor-menu ct0";Wu.app._editorMenuPane=Wu.DomUtil.create("menu",a,this._container);var a="q-editor-content ct1";Wu.app._editorContentPane=Wu.DomUtil.create("content",a,this._container),Wu.app._menuSlider=Wu.DomUtil.createId("div","menuslider",this._container),Wu.DomUtil.addClass(Wu.app._menuSlider,"ct1")},render:function(){Wu.Util.isObject(this.options.editor)||(this.options.editor={render:this.options.editor||!0}),0!=this.options.editor.clients&&(this.Clients=new Wu.SidePane.Clients),this.Projects=new Wu.SidePane.Projects(this),0!=this.options.editor.map&&(this.Map=new Wu.SidePane.Map),0!=this.options.editor.sources&&(this.Layers=new Wu.SidePane.Layers),0!=this.options.editor.documentsPane&&(this.Documents=new Wu.SidePane.Documents),0!=this.options.editor.downloadsPane&&(this.DataLibrary=new Wu.SidePane.DataLibrary),0!=this.options.editor.users&&(this.Users=new Wu.SidePane.Users)},setProject:function(a){this.Map.updateContent(a),this.Layers.updateContent(a),this.Documents.updateContent(a),this.DataLibrary.updateContent(a)},refresh:function(a){var b=["Clients","Projects","Map","Layers","Documents","Users","DataLibrary"];a.forEach(function(a){Wu.app.SidePane[a]||(Wu.app.SidePane[a]=new Wu.SidePane[a]),Wu.app.SidePane[a].enable()},this);var c=b.diff(a);c.forEach(function(a){Wu.app.SidePane[a].disable()},this)},togglePane:function(){if(Wu.app._activeProject){if(this.open)return this.closePane();this.openPane(),Wu.app._map.invalidateSize()}},closePane:function(){this.open&&(this.open=!1,this._container.style.width="100px",Wu.app.MapPane._setLeft(100),Wu.app.HeaderPane._setLeft(100),Wu.DomUtil.removeClass(Wu.app._paneToggle,"pane-open"))},openPane:function(){this.open||(this.open=!0,this._container.style.width="400px",Wu.app.MapPane._setLeft(400),Wu.app.HeaderPane._setLeft(400),Wu.DomUtil.addClass(Wu.app._paneToggle,"pane-open"))},setSubheaders:function(){var a=Wu.app._activeClient,b=Wu.app._activeProject;a&&(Wu.DomUtil.get("h4-projects-client-name").innerHTML=a.name,Wu.DomUtil.get("h4-map-configuration-client-name").innerHTML=a.name,Wu.DomUtil.get("h4-layers-client-name").innerHTML=a.name,b&&(Wu.DomUtil.get("h4-map-configuration-project-name").innerHTML=b.name,Wu.DomUtil.get("h4-layers-project-name").innerHTML=b.name))}}),Wu.SidePane.Item=Wu.Class.extend({type:"item",initialize:function(){Wu.setOptions(this,Wu.app.options),this.render()},render:function(){this.initContainer(),this.initContent(),this.addHooks(),this.disable()},addHooks:function(){Wu.DomEvent.on(this._menu,"click",this._activate,this),Wu.DomEvent.on(this._menu,"mouseenter",this._mouseenter,this),Wu.DomEvent.on(this._menu,"mouseleave",this._mouseleave,this)},_mouseenter:function(){Wu.DomUtil.addClass(this._menu,"red")},_mouseleave:function(){Wu.DomUtil.removeClass(this._menu,"red")},_activate:function(){var a=Wu.app._activeMenu||!1;Wu.app._activeMenu=this,Wu.app._active=this._content,this.checkSwipe(a),a&&Wu.DomUtil.removeClass(a._menu,"active"),Wu.DomUtil.addClass(this._menu,"active"),a&&a.deactivate()},checkSwipe:function(a){return a?this.swiper(a):(Wu.app._active&&Wu.DomUtil.removeClass(Wu.app._active,"show"),Wu.app._active=this._content,void Wu.DomUtil.addClass(Wu.app._active,"show"))},swiper:function(a){var b=a._content,c=Wu.app._active;if(b!=c){var d=70,e=Wu.DomUtil.get("menuslider"),f=this._menu.classList;_.contains(f,"clients")&&(e.style.top="0px",Wu.app.SidePane._container.style.width="400px"),_.contains(f,"projects")&&(e.style.top=1*d+"px",Wu.app.SidePane._container.style.width="400px"),_.contains(f,"map")&&(e.style.top=2*d+"px",Wu.app.SidePane._container.style.width="400px"),_.contains(f,"layers")&&(e.style.top=3*d+"px",Wu.app.SidePane._container.style.width="400px"),_.contains(f,"documents")&&(e.style.top=4*d+"px",Wu.app.SidePane._container.style.width="100%"),_.contains(f,"dataLibrary")&&(e.style.top=5*d+"px",Wu.app.SidePane._container.style.width="100%"),_.contains(f,"users")&&(e.style.top=6*d+"px",Wu.app.SidePane._container.style.width="100%");for(var g,h,i,j,k=document.getElementsByTagName("menu")[0],l=k.getElementsByTagName("div"),m=0;m<l.length;m++)l[m]==a._menu&&(g=m),l[m]==this._menu&&(h=m);g>h?(i="swipe_out",j="swipe_in"):(i="swipe_out_up",j="swipe_in_up"),Wu.app._active&&(Wu.DomUtil.addClass(b,i),setTimeout(function(){Wu.DomUtil.removeClass(b,"show"),Wu.DomUtil.removeClass(b,i)},300)),Wu.DomUtil.addClass(c,"show"),Wu.DomUtil.addClass(c,j),setTimeout(function(){Wu.DomUtil.removeClass(c,j)},300)}},deactivate:function(){console.log("blank deactiavte")},initContainer:function(){var a="q-editor-menu-item "+this.type;this._menu=Wu.DomUtil.create("div",a,Wu.app._editorMenuPane),this._title=Wu.DomUtil.create("a",this.type,this._menu),this._title.innerHTML=Wu.Util.capitalize(this.title||this.type);var a="q-editor-content-item "+this.type;this._content=Wu.DomUtil.create("div",a,Wu.app._editorContentPane),this._container=Wu.DomUtil.create("div","editor-wrapper ct13",this._content)},initContent:function(){},updateContent:function(){},_addHook:function(a,b,c,d){Wu.DomEvent.on(a,b,c,d)},disable:function(){Wu.DomEvent.off(this._menu,"click",this._activate,this),Wu.DomUtil.addClass(this._title,"disabled")},enable:function(){Wu.DomEvent.on(this._menu,"click",this._activate,this),Wu.DomUtil.removeClass(this._title,"disabled")},remove:function(){delete this._menu,delete this._content,delete this}}),Wu.SidePane.Clients=Wu.SidePane.Item.extend({type:"clients",initialize:function(){Wu.SidePane.Item.prototype.initialize.call(this),Wu.app._active=this._content,this._activate()},initContent:function(){this._container.innerHTML=ich.editorClients();var a=(this._clientsContainer=Wu.DomUtil.get("editor-clients"),Wu.DomUtil.create("div","smap-button-white new-client ct11 ct16 ct18",this._clientsContainer));a.innerHTML="Create New Client",this._addHook(a,"click",this._createNew,this),this.options.json.clients.forEach(function(a){this._create(a)},this)},_create:function(a){var b={clientName:a.name,clientLogo:a.header.logo,clientID:a.uuid};Wu.DomUtil.prependTemplate(this._clientsContainer,ich.editorClientsItem(b));var c=Wu.DomUtil.get("editor-clients-container-"+a.uuid);this._addHook(c,"click",this.select,Wu.app.Clients[a.uuid]),this._addHook(c,"click",this._select,c);var d=Wu.DomUtil.get("editor-client-edit-toggle-"+a.uuid);this._addHook(d,"click",this.toggleEdit,Wu.app.Clients[a.uuid]);var e=Wu.DomUtil.get("editor-client-delete-"+a.uuid);this._addHook(e,"click",this.remove,Wu.app.Clients[a.uuid])},remove:function(){var a=this;window.confirm("Are you sure you want to DELETE the client "+a.name+"?")&&a._delete()},_createNew:function(){var a={clientName:"New client"};Wu.DomUtil.prependTemplate(this._clientsContainer,ich.editorClientsNew(a));var b=Wu.DomUtil.get("editor-client-confirm-button");this._addHook(b,"click",this._confirm,this);var b=Wu.DomUtil.get("editor-client-cancel-button");this._addHook(b,"click",this._cancel,this);var c=Wu.DomUtil.get("editor-client-name-new");this._addHook(c,"keyup",this._checkSlug,this)},_checkSlug:function(){clearTimeout(this._timer);var a=this;this._timer=setTimeout(function(){var b=Wu.DomUtil.get("editor-client-name-new"),c=Wu.Util.trimAll(b.value).toLowerCase(),d=JSON.stringify({slug:c}),e="/api/client/unique";Wu.Util.postcb(e,d,a._checkedSlug,a)},500)},_checkedSlug:function(a,b){var c=JSON.parse(b);return c.unique?a._enableConfirm():c.error?void console.log(c):void a._disableConfirm()},_disableConfirm:function(){var a=Wu.DomUtil.get("editor-client-confirm-button");a.style.backgroundColor="red",console.log("Client name is not unique.")},_enableConfirm:function(){var a=Wu.DomUtil.get("editor-client-confirm-button");a.style.backgroundColor="",console.log("Client name OK.")},_cancel:function(){var a=Wu.DomUtil.get("editor-clients-container-new").parentNode;Wu.DomUtil.remove(a)},_confirm:function(){var a=Wu.DomUtil.get("editor-client-name-new").value,b=Wu.DomUtil.get("editor-client-description-new").value,c=Wu.DomUtil.get("editor-client-keywords-new").value,d={name:a,description:b,keywords:c},e=new Wu.Client(d);e.saveNew()},_created:function(a,b){var c=Wu.app.SidePane.Clients,d=JSON.parse(b);Wu.extend(a,d),Wu.app.Clients[a.uuid]=a;var e=Wu.DomUtil.get("editor-clients-container-new");Wu.DomUtil.remove(e),c._create(a),a.setActive()},toggleEdit:function(a){a&&Wu.DomEvent.stop(a);var b=this,c=Wu.DomUtil.get("editor-client-edit-wrapper-"+b.uuid);b.options.editMode?(c.style.display="none",b.options.editMode=!1):(c.style.display="block",b.options.editMode=!0)},_addHook:function(a,b,c,d){Wu.DomEvent.on(a,b,c,d)},select:function(){var a=this;a.setActive(),Wu.app._activeProject&&Wu.app._activeProject.unload(),Wu.app.SidePane.Clients.refreshSidePane(),Wu.app.SidePane.Projects._activate(),Wu.app.SidePane.setSubheaders()},refreshSidePane:function(){var a=["Clients","Projects"];a.push("Users"),Wu.app.SidePane.refresh(a),Wu.app.SidePane.Users.update()},_select:function(){var a=Wu.app.SidePane.Clients;a._previousSelect&&Wu.DomUtil.removeClass(a._previousSelect,"active-client"),Wu.DomUtil.addClass(this,"active-client"),a._previousSelect=this},selectProject:function(){var a=this;a.setActive()},disable:function(){}}),Wu.SidePane.Projects=Wu.SidePane.Item.extend({type:"projects",initContent:function(){this._container.innerHTML=ich.editorProjectsContainer(),this._sortleft=Wu.DomUtil.get("editor-projects-sort-by-left"),this._sortright=Wu.DomUtil.get("editor-projects-sort-by-right"),this._sortIsList=!1;var a=Wu.DomUtil.get("new-project-button");Wu.DomEvent.on(a,"click",this._createNew,this),this._projectsContainer=Wu.DomUtil.get("editor-projects-container"),this._projects={},this._editMode=!1,this._addHooks(),this._doSortRight()},_addHooks:function(){Wu.DomEvent.on(this._sortleft,"click",this._doSortLeft,this),Wu.DomEvent.on(this._sortright,"click",this._doSortRight,this)},_doSortRight:function(){if(!this._sortIsList){for(p in this._projects){var a=this._projects[p];Wu.DomUtil.addClass(a,"swipe_left")}var b=this;setTimeout(function(){for(p in b._projects){var a=b._projects[p];Wu.DomUtil.removeClass(a,"swipe_left"),Wu.DomUtil.addClass(a,"list"),Wu.DomUtil.removeClass(a,"box")}Wu.DomUtil.addClass(b._projectsContainer,"list_view")},150),this._sortIsList=!0}},_doSortLeft:function(){if(this._sortIsList){for(p in this._projects){var a=this._projects[p];Wu.DomUtil.addClass(a,"swipe_left")}var b=this;setTimeout(function(){for(p in b._projects){var a=b._projects[p];Wu.DomUtil.removeClass(a,"swipe_left"),Wu.DomUtil.removeClass(a,"list"),Wu.DomUtil.addClass(a,"box")}Wu.DomUtil.removeClass(b._projectsContainer,"list_view")},150),this._sortIsList=!1}},refresh:function(){var a=Wu.app._activeClient;this._projectsContainer.innerHTML="",this._projects={};for(item in Wu.app.Projects)a.projects.indexOf(item)>-1&&this._create(Wu.app.Projects[item])},select:function(){var a=this;a.setActive();var b=Wu.app.SidePane.Projects._projects;for(p in b)Wu.DomUtil.removeClass(b[p],"active");Wu.DomUtil.addClass(b[a.uuid],"active");var c=["Clients","Projects","Documents","Layers","DataLibrary"],d=Wu.app.User.options.access.write.projects;d.indexOf(a.uuid)>-1&&c.push("Map");var e=Wu.app.options.json.user.access.create;e.users&&c.push("Users"),Wu.app.SidePane.refresh(c),Wu.app.SidePane.setSubheaders()},sortProjects:function(a,b){console.log("sort!"),console.log(this),console.log(a),console.log(b)},_createNew:function(){var a={projectName:"New project"};Wu.DomUtil.prependTemplate(this._projectsContainer,ich.editorProjectsNew(a),!0);var b=Wu.DomUtil.get("editor-project-confirm-button");this._addHook(b,"click",this._confirm,this);var b=Wu.DomUtil.get("editor-project-cancel-button");this._addHook(b,"click",this._cancel,this)},_cancel:function(){var a=Wu.DomUtil.get("editor-projects-container-new");Wu.DomUtil.remove(a)},_confirm:function(){var a=Wu.DomUtil.get("editor-project-name-new").value,b=Wu.DomUtil.get("editor-project-description-new").value,c=Wu.DomUtil.get("editor-project-keywords-new").value,d={name:a,description:b,keywords:c},e=new Wu.Project(d);e._saveNew()},_create:function(a){var b={projectName:a.name||"",projectLogo:a.header.logo||"",uuid:a.uuid},c=Wu.DomUtil.create("div","editor-projects-item ct0");c.setAttribute("uuid",a.uuid),c.innerHTML=ich.editorProjectsItem(b),this._projects[a.uuid]=c,this._projectsContainer.appendChild(c);var d=Wu.DomUtil.get("project-edit-button-"+a.uuid);Wu.DomEvent.on(d,"mousedown",this.toggleEdit,this),Wu.DomEvent.on(d,"click",Wu.DomEvent.stop,this),Wu.DomEvent.on(c,"click",this.select,Wu.app.Projects[a.uuid])},toggleEdit:function(a){a&&Wu.DomEvent.stop(a);var b=a.target.getAttribute("uuid"),c=(Wu.DomUtil.get("editor-project-edit-wrapper-"+b),Wu.app.Projects[b]);if(this._editorPane&&Wu.DomUtil.remove(this._editorPane),this._editMode=!this._editMode,this._editMode){c._editorPane=this._editorPane=Wu.DomUtil.create("div","editor-project-edit-super-wrap ct11 ct17");var d=ich.editorProjectEditWrapper({uuid:b,name:c.name,description:c.description,keywords:c.keywords});c._editorPane.innerHTML=d;for(var e=this._projects[b].parentNode.childNodes,f=0;f<e.length;f++)if(e[f].getAttribute("uuid")==b)var g=f,h=g%2;if(h){var i=g,j=e[i];j.parentNode.insertBefore(c._editorPane,j.nextSibling),Wu.DomUtil.addClass(c._editorPane,"right")}else{var i=parseInt(g)+1;i>e.length-1&&(i=e.length-1);var j=e[i];j.parentNode.insertBefore(c._editorPane,j.nextSibling),Wu.DomUtil.addClass(c._editorPane,"left")}this._editName=Wu.DomUtil.get("editor-project-name-"+b),this._editDescription=Wu.DomUtil.get("editor-project-description-"+b),this._editKeywords=Wu.DomUtil.get("editor-project-keywords-"+b),this._deleteButton=Wu.DomUtil.get("editor-project-delete-"+b),Wu.DomEvent.on(this._editName,"keydown blur",function(){this.autosave(c,"name")},this),Wu.DomEvent.on(this._editDescription,"keydown blur",function(){this.autosave(c,"description")},this),Wu.DomEvent.on(this._editKeywords,"keydown blur",function(){this.autosave(c,"keywords")},this),Wu.DomEvent.on(this._deleteButton,"mousedown",function(){this._delete(c)},this)}},_delete:function(a){if(confirm('Are you sure you want to delete project "'+a.name+'"?')){a._delete();var b=this._projects[a.uuid];Wu.DomUtil.remove(b),this._editorPane&&Wu.DomUtil.remove(this._editorPane)}},autosave:function(a,b){var c=this;clearTimeout(this._saving),this._saving=setTimeout(function(){c.saveText(a,b)},500)},saveText:function(a,b){a[b]=Wu.DomUtil.get("editor-project-"+b+"-"+a.uuid).value,a._update(b)},_created:function(a,b){var c=Wu.app.SidePane.Projects,d=JSON.parse(b);Wu.extend(a,d),Wu.app.Projects[a.uuid]=a;var e=Wu.DomUtil.get("editor-projects-container-new");Wu.DomUtil.remove(e),c._create(a),a.setActive(),Wu.app.User.options.access.write.projects.push(a.uuid),Wu.app.User.options.access.read.projects.push(a.uuid),Wu.app.User.options.access.manage.projects.push(a.uuid),Wu.app._activeClient.projects.push(a.uuid),Wu.app._activeClient.update("projects")}}),Wu.SidePane.Map=Wu.SidePane.Item.extend({type:"map",initContent:function(){this.app=Wu.app,this._container.innerHTML=ich.editorMapBaseLayer(),this._panes={},this._panes.baselayerWrap=Wu.DomUtil.get("editor-map-baselayer-wrap"),this._panes.boundsMore=Wu.DomUtil.get("editor-map-bounds-more"),this._panes.boundsOuter=Wu.DomUtil.get("editor-map-bounds-coordinates"),this._panes.boundsInner=Wu.DomUtil.get("map-bounds-inner"),this._boundsToggled=!1,this._panes.bounds=Wu.DomUtil.get("editor-map-bounds"),this._panes.boundsNELatValue=Wu.DomUtil.get("editor-map-bounds-NE-lat-value"),this._panes.boundsNELngValue=Wu.DomUtil.get("editor-map-bounds-NE-lng-value"),this._panes.boundsSWLatValue=Wu.DomUtil.get("editor-map-bounds-SW-lat-value"),this._panes.boundsSWLngValue=Wu.DomUtil.get("editor-map-bounds-SW-lng-value"),this._panes.initPosMore=Wu.DomUtil.get("editor-map-initpos-more"),this._panes.initPosOuter=Wu.DomUtil.get("editor-map-initpos-coordinates"),this._panes.initPosInner=Wu.DomUtil.get("map-initpos-inner"),this._initPosToggled=!1,this._panes.initPos=Wu.DomUtil.get("editor-map-initpos-button"),this._panes.initPosLatValue=Wu.DomUtil.get("editor-map-initpos-lat-value"),this._panes.initPosLngValue=Wu.DomUtil.get("editor-map-initpos-lng-value"),this._panes.initPosZoomValue=Wu.DomUtil.get("editor-map-initpos-zoom-value"),this._panes.controlsWrap=Wu.DomUtil.get("editor-map-controls-wrap").parentNode.parentNode,this._panes.controlZoom=Wu.DomUtil.get("map-controls-zoom").parentNode.parentNode,this._panes.controlDraw=Wu.DomUtil.get("map-controls-draw").parentNode.parentNode,this._panes.controlInspect=Wu.DomUtil.get("map-controls-inspect").parentNode.parentNode,this._panes.controlDescription=Wu.DomUtil.get("map-controls-description").parentNode.parentNode,this._panes.controlLayermenu=Wu.DomUtil.get("map-controls-layermenu").parentNode.parentNode,this._panes.controlLegends=Wu.DomUtil.get("map-controls-legends").parentNode.parentNode,this._panes.controlMeasure=Wu.DomUtil.get("map-controls-measure").parentNode.parentNode,this._panes.controlGeolocation=Wu.DomUtil.get("map-controls-geolocation").parentNode.parentNode,this._panes.controlVectorstyle=Wu.DomUtil.get("map-controls-vectorstyle").parentNode.parentNode,this._panes.controlMouseposition=Wu.DomUtil.get("map-controls-mouseposition").parentNode.parentNode},_activate:function(){Wu.SidePane.Item.prototype._activate.call(this),this._update()},addHooks:function(){Wu.SidePane.Item.prototype.addHooks.call(this),Wu.DomEvent.on(this._panes.bounds,"click",this._setBounds,this),Wu.DomEvent.on(this._panes.initPos,"click",this._setInitPos,this),Wu.DomEvent.on(this._panes.initPosMore,"mousedown",this._toggleInitPosDropdown,this),Wu.DomEvent.on(this._panes.boundsMore,"mousedown",this._toggleBoundsDropdown,this),Wu.DomEvent.on(this._panes.initPos,"mousedown",this._buttonMouseDown,this),Wu.DomEvent.on(this._panes.initPos,"mouseup",this._buttonMouseUp,this),Wu.DomEvent.on(this._panes.initPos,"mouseleave",this._buttonMouseUp,this),Wu.DomEvent.on(this._panes.bounds,"mousedown",this._buttonMouseDown,this),Wu.DomEvent.on(this._panes.bounds,"mouseup",this._buttonMouseUp,this),Wu.DomEvent.on(this._panes.bounds,"mouseleave",this._buttonMouseUp,this),Wu.DomEvent.on(this._panes.controlZoom,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlDraw,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlInspect,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlDescription,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlLayermenu,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlLegends,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlMeasure,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlGeolocation,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlVectorstyle,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlMouseposition,"mousedown click",this.toggleControl,this)
},_toggleInitPosDropdown:function(){if(this._initPosToggled)this._initPosToggled=!1,this._panes.initPosOuter.style.height="0px",Wu.DomUtil.removeClass(this._panes.initPosMore,"rotate180");else{this._initPosToggled=!0;var a=this._panes.initPosInner.offsetHeight+15;this._panes.initPosOuter.style.height=a+"px",Wu.DomUtil.addClass(this._panes.initPosMore,"rotate180")}},_toggleBoundsDropdown:function(){if(this._boundsToggled)this._boundsToggled=!1,this._panes.boundsOuter.style.height="0px",Wu.DomUtil.removeClass(this._panes.boundsMore,"rotate180");else{this._boundsToggled=!0;var a=this._panes.boundsInner.offsetHeight+15;this._panes.boundsOuter.style.height=a+"px",Wu.DomUtil.addClass(this._panes.boundsMore,"rotate180")}},toggleControl:function(a){if("click"==a.type)return Wu.DomEvent.stop(a);var b=a.target.getAttribute("which"),c=Wu.DomUtil.get("map-controls-"+b),d=!c.checked,e="enable"+b.camelize(),f="disable"+b.camelize();d?(Wu.app.MapPane[e](),this.enableControl(b)):(Wu.app.MapPane[f](),this.disableControl(b)),this.project.controls[b]=d,this.project._update("controls")},disableControl:function(a){{var b=Wu.DomUtil.get("map-controls-"+a),c=Wu.DomUtil.get("map-controls-title-"+a).parentNode;Wu.app._map}Wu.DomUtil.removeClass(c,"active"),b.checked=!1},enableControl:function(a){{var b=Wu.DomUtil.get("map-controls-"+a),c=Wu.DomUtil.get("map-controls-title-"+a).parentNode;this.app._map}Wu.DomUtil.addClass(c,"active"),b.checked=!0},_buttonMouseDown:function(a){Wu.DomUtil.addClass(a.target,"btn-info")},_buttonMouseUp:function(a){Wu.DomUtil.removeClass(a.target,"btn-info")},_setUrl:function(a){var b=Wu.app._activeProject;if(!b)return void console.log("_activeProejct == undefined");var c=a.target.value;b.map.baseLayer.url=c,b._update("map")},_setProvider:function(a){console.log("set provider"),console.log(a);var b=Wu.app._activeProject;if(!b)return void console.log("_activeProejct == undefined");var c=a.target.value;b.map.baseLayer.provider=c,b._update("map")},_setTileType:function(a){console.log("set tiletype"),console.log(a);var b=Wu.app._activeProject;if(!b)return void console.log("_activeProejct == undefined");if(a.target.checked)var c="vector";else{var c="raster";b.map.baseLayer.tms=!0}b.map.baseLayer.type=c,b._update("map")},_setBounds:function(){var a=Wu.app._activeProject;if(!a)return void console.log("_activeProejct == undefined");{var b=Wu.app._map.getBounds();Wu.app._map.getZoom()}a.map.bounds={northEast:{lat:b._northEast.lat,lng:b._northEast.lng},southWest:{lat:b._southWest.lat,lng:b._southWest.lng}},a._update("map"),this.updateContent()},_setInitPos:function(){var a=Wu.app._activeProject;if(!a)return void console.log("_activeProejct == undefined");var b=Wu.app._map.getCenter(),c=Wu.app._map.getZoom();a.map.initPos={lat:b.lat,lng:b.lng,zoom:c},a._update("map"),this.updateContent()},updateContent:function(){this._update()},_resetView:function(){},_updateBaselayer:function(){var a=this.insertSelect(this._panes.baselayerWrap),b=a.tit,c=a.w,d=this.project.map.baseLayer.url;this.project.mapboxLayers.forEach(function(a){var e=Wu.DomUtil.create("div","item-list select-elem ct0",c);e.innerHTML=a.name,e.setAttribute("uuid",a.id),e.setAttribute("type","mapbox"),Wu.DomEvent.on(e,"mousedown",function(a){b.innerHTML=a.target.innerHTML,b.setAttribute("active",!1),Wu.DomUtil.removeClass(c,"select-baselayer-open"),this.setBaseLayer("mapbox",a.target.getAttribute("uuid"))},this),d==a.id&&(b.innerHTML=a.name)},this)},_update:function(){this.project=Wu.app._activeProject;var a=this.project.map.bounds;Wu.Util.isObject(this.project.controls)||(this.project.controls={}),this._updateBaselayer(),this._panes.boundsNELatValue.value=a.northEast.lat,this._panes.boundsNELngValue.value=a.northEast.lng,this._panes.boundsSWLatValue.value=a.southWest.lat,this._panes.boundsSWLngValue.value=a.southWest.lng,this._panes.initPosLatValue.value=this.project.map.initPos.lat,this._panes.initPosLngValue.value=this.project.map.initPos.lng,this._panes.initPosZoomValue.value=this.project.map.initPos.zoom,this._updateControls()},_updateControls:function(){for(c in this.project.controls){var a=this.project.controls[c],b="enable"+c.camelize(),d="disable"+c.camelize();a?(Wu.app.MapPane[b](),this.enableControl(c)):(Wu.app.MapPane[d](),this.disableControl(c))}},setBaseLayer:function(a,b){this.project.map.baseLayer.url=b,this.project.map.baseLayer.provider=a,this.project._update(),Wu.app.MapPane.setBaseLayer(this.project),this.project._update("map")},insertSelect:function(a){a.innerHTML="<h4>Base Layer </h4>";var b=Wu.DomUtil.createId("div","select-baselayer-wrap",a);Wu.DomUtil.addClass(b,"select-wrap");var c=Wu.DomUtil.create("div","smap-button-white select-title",b);c.innerHTML="Select layer";var d=Wu.DomUtil.create("div","select-elems",b),e=Wu.DomUtil.create("div","select-baselayer dropdown-button",b);Wu.DomEvent.on(e,"mousedown",function(){var a=c.getAttribute("active");if("true"==a)c.setAttribute("active",!1),d.style.height="0px",Wu.DomUtil.removeClass(e,"rotate180");else{c.setAttribute("active",!0);var b=33*this.project.mapboxLayers.length;d.style.height=b+"px",Wu.DomUtil.addClass(e,"rotate180")}},this);var f={};return f.tit=c,f.w=d,f}}),Wu.SidePane.Documents=Wu.SidePane.Item.extend({type:"documents",title:"Documents",initContent:function(){this._content=Wu.DomUtil.create("div","fullpage-documents ct1",Wu.app._appPane),this._container=Wu.DomUtil.create("div","editor-wrapper ct11",this._content),this._container.innerHTML=ich.documentsContainer(),this._leftpane=Wu.DomUtil.get("documents-container-leftpane"),this._folderpane=Wu.DomUtil.get("documents-folder-list"),this._rightpane=Wu.DomUtil.get("documents-container-rightpane"),this._textarea=Wu.DomUtil.get("documents-container-textarea"),this._newfolder=Wu.DomUtil.get("documents-new-folder")},initFolders:function(){this.folders={};var a=this.project.folders;a.forEach(function(a){this.folders[a.uuid]=a},this)},addHooks:function(){Wu.DomEvent.on(this._newfolder,"mousedown",this.newFolder,this),grande.bind([this._textarea]),this.expandGrande()},expandGrande:function(){var a=document.getElementsByClassName("g-body")[0],b=a.children[0].children[0].children[0].children[0],c=a.children[0],d=Wu.DomUtil.create("button","file url"),e=Wu.DomUtil.create("div","grande-project-files-wrap"),f=Wu.DomUtil.create("div","grande-project-files-btn"),g=Wu.DomUtil.create("select","grande-project-files");e.appendChild(g),e.appendChild(f),d.innerHTML="F",b.appendChild(d),b.appendChild(e),this._grandeFiles=b,this._grandeFilesBtn=d,this._grandeFilesSelect=g,this._grandeInsertBtn=f,this._grandeFilesWrap=e,this._grandeWrap=c,Wu.DomEvent.on(d,"mousedown",this.attachFile,this)},attachFile:function(){this.textSelection=window.getSelection(),range=this.textSelection.getRangeAt(0),this.textSelectionText=range.cloneContents().firstChild.data,this._grandeFilesWrap.style.display="block";var a=this._grandeFilesSelect;a.innerHTML="",this.project.files.forEach(function(b){a.options[a.options.length]=new Option(b.name,b.uuid)},this),Wu.DomEvent.on(this._grandeInsertBtn,"mousedown",this.selectedFile,this)},replaceSelection:function(a,b){var c;if(this.textSelection.getRangeAt){c=this.textSelection.getRangeAt(0),c.deleteContents();var d=document.createElement("a");d.innerHTML=b,d.href=a,c.insertNode(d)}},selectedFile:function(){{var a=this._grandeFilesSelect,b=a.options[a.selectedIndex].value;a.options[a.selectedIndex].text}this._grandeFilesWrap.style.display="none",Wu.DomUtil.removeClass(this._grandeWrap,"active"),Wu.DomUtil.addClass(this._grandeWrap,"hide");var c="/api/file/download?file="+b;this.replaceSelection(c,this.textSelectionText),this.saveText()},_activate:function(a){if(Wu.SidePane.Item.prototype._activate.call(this),this.adjustTop(),Wu.app.HeaderPane.disableResize(),this.project.folders.length>0){var a={target:{uuid:this.project.folders[0].uuid},preventDefault:Wu.Util.falseFn};this.selectFolder(a)}this.enableShift()},enableShift:function(){Wu.DomEvent.on(window,"keydown",this.shiftMode,this),Wu.DomEvent.on(window,"keyup",this.unshiftMode,this)},disableShift:function(){Wu.DomEvent.off(window,"keydown",this.shiftMode,this),Wu.DomEvent.off(window,"keyup",this.unshiftMode,this)},shiftMode:function(a){var c=a||window.event;if(16==c.which)for(b in this._deleteButtons){var d=this._deleteButtons[b];d.style.visibility="visible"}},unshiftMode:function(a){var c=a||window.event;if(16==c.which)for(b in this._deleteButtons){var d=this._deleteButtons[b];d.style.visibility="hidden"}},deactivate:function(){Wu.app.HeaderPane.enableResize(),this.disableShift()},adjustTop:function(){return},update:function(){this.project=Wu.app._activeProject,this.reset(),this.createFolders(),this.adjustTop()},updateContent:function(){this._textarea.innerHTML="",this.update()},newFolder:function(){var a={title:"Title",uuid:Wu.Util.guid("folder"),content:"Text content"};this.project.folders.push(a),this.update()},createFolders:function(){var a=this.project.folders;this._deleteButtons={},a.forEach(function(a){var b=Wu.DomUtil.create("div","documents-folder-delete",this._folderpane);b.innerHTML="x",Wu.DomEvent.on(b,"click",function(){this.deleteFolder(a.uuid)},this),this._deleteButtons[a.uuid]=b;var c=a;c.el=Wu.DomUtil.create("input","documents-folder-item ct23 ct28",this._folderpane),c.el.value=c.title,c.el.setAttribute("readonly","readonly"),c.el.uuid=c.uuid,Wu.DomEvent.on(c.el,"mousedown",this.selectFolder,this),Wu.DomEvent.on(c.el,"dblclick",this.renameFolder,this),this.folders[c.uuid]=c},this)},deleteFolder:function(a){confirm("Are you sure you want to delete folder "+this.folders[a].title+"?")&&(console.log("delete folder: ",a),delete this.folders[a],this._save())},renameFolder:function(a){this.disableShift();{var b=a.target.uuid;this.folders[b]}a.target.removeAttribute("readonly"),a.target.focus(),a.target.selectionStart=a.target.selectionEnd,Wu.DomEvent.on(a.target,"blur",this.titleBlur,this),Wu.DomEvent.on(a.target,"keydown",this.titleKey,this)},titleKey:function(){(13==event.which||13==event.keyCode)&&this.titleBlur()},titleBlur:function(){for(f in this.folders){var a=this.folders[f];a.el.setAttribute("readonly","readonly"),this.folders[a.uuid].title=a.el.value}this._save(),this.enableShift()},selectFolder:function(a){a.preventDefault();var b=a.target.uuid,c=this.folders[b];this._textarea.innerHTML="",this._textarea.innerHTML=c.content,this._textarea.fuuid=b,this._textarea.blur(),this.underline(b),Wu.DomEvent.on(this._textarea,"keydown mousedown",this.autosave,this)},underline:function(a){for(f in this.folders){var b=this.folders[f].el,c=this.folders[f].uuid;a==c?Wu.DomUtil.addClass(b,"underline"):Wu.DomUtil.removeClass(b,"underline")}},autosave:function(){var a=this;clearTimeout(this._saving),this._saving=setTimeout(function(){a.saveText()},500)},saveText:function(){var a=this.folders[this._textarea.fuuid].content,b=this._textarea.innerHTML;a!=b&&(this.folders[this._textarea.fuuid].content=b,this._save())},_save:function(){var a=this.folders;this.project.folders=[];for(f in a){var b=Wu.extend({},a[f]);delete b.el,this.project.folders.push(b)}this.project._update("folders"),this.update()},reset:function(){this._folderpane.innerHTML="",this.folders={}}}),Wu.SidePane.Users=Wu.SidePane.Item.extend({type:"users",title:"Users",initContent:function(){this._content=Wu.DomUtil.create("div","fullpage-users",Wu.app._appPane),this._container=Wu.DomUtil.create("div","editor-wrapper",this._content),this._container.innerHTML=ich.usersPane(),this._tableContainer=Wu.DomUtil.get("users-table-container"),this._tableContainer.innerHTML=ich.usersTableFrame(),this._table=Wu.DomUtil.get("users-insertrows"),this._addUser=Wu.DomUtil.get("users-add-user"),this._mainTitle=Wu.DomUtil.get("user-management-client"),this._deleteUser=Wu.DomUtil.get("users-delete-user"),this._checkall=Wu.DomUtil.get("users-checkbox-all"),this._checkallLabel=Wu.DomUtil.get("label-users-checkbox-all"),this.initList()},addHooks:function(){Wu.DomEvent.on(this._addUser,"mousedown",this.addUser,this),Wu.DomEvent.on(this._deleteUser,"mousedown",this.deleteUser,this),Wu.DomEvent.on(this._checkallLabel,"mousedown",this.checkAll,this)},deactivate:function(){console.log("deactive sidepane users")},addUser:function(){console.log("addUser");var a={firstName:"First name",lastName:"Last name",company:"Company",position:"Position",phone:"Phone",local:{email:"Email"},projects:[],uuid:"new-user-pseudo-"+Wu.Util.guid(),access:{read:[],write:[]}};this.addTableItem(a);var b=Wu.DomUtil.get("actions-"+a.uuid),c=Wu.DomUtil.create("div","users-actions-save users-button",b);c.setAttribute("uuid",a.uuid),c.innerHTML="Create",Wu.DomEvent.on(c,"click",this.createNewUser,this)},deleteUser:function(){console.log("deleteUser");var a=this.getSelected();console.log("checked: ",a);var b=Wu.app.User.options.uuid,c=!1;return a.forEach(function(a){a.uuid==b&&(c=!0)}),c?void console.error("Can't delete yourself."):void(confirm("Are you sure you want to delete?")&&console.log("todo: delete user"))},createNewUser:function(a){var b=a.target.getAttribute("uuid"),c={firstName:Wu.DomUtil.get("firstName-"+b).value,lastName:Wu.DomUtil.get("lastName-"+b).value,company:Wu.DomUtil.get("company-"+b).innerHTML,position:Wu.DomUtil.get("position-"+b).innerHTML,phone:Wu.DomUtil.get("phone-"+b).innerHTML,local:{email:Wu.DomUtil.get("email-"+b).innerHTML},projects:[],client:this.client.uuid,createdBy:Wu.app.User.options.uuid};console.log("user to create: ",c);var d=JSON.stringify(c);Wu.post("/api/user/new",d,this.createdNewUser,this)},createdNewUser:function(a,b){console.log("createdNewUser: ",b)},checkAll:function(){console.log("checkAll")},getSelected:function(){var a=[];return this.client.users.forEach(function(b){var c=Wu.DomUtil.get("users-checkbox-"+b.uuid);if(c)var d=c.checked;d&&a.push(b)},this),a},initList:function(){var a=Wu.DomUtil.createId("tr","dummy-table-entry");a.innerHTML=ich.usersTablerow({type:"dummy-table-entry"}),this._table.appendChild(a);var b={valueNames:["name","company","position","phone","email","projects"]};this.list=new List("userslist",b),this.list.clear()},updateContent:function(){this.update()},update:function(){this.client=Wu.app._activeClient,this._mainTitle.innerHTML=this.client.name.camelize(),this.reset(),this.refreshTable()},refreshTable:function(){console.log("refreshTable"),this.getUsersData()},getUsersData:function(){var a=JSON.stringify({clientUuid:this.client.uuid});Wu.post("/api/client/users",a,this.gotUsers,this)},gotUsers:function(a,b){b&&(a.client.users=JSON.parse(b),console.log("gotUsers: ",a.client.users),a._updateUserProjects(),a._refreshTable())},_updateUserProjects:function(){this.client.users.forEach(function(a){a.projectObjects={},a.projectObjects.read={},a.access.read.projects.forEach(function(b){this.client.projects.indexOf(b)>-1&&(a.projectObjects.read[b]=Wu.app.Projects[b])},this),a.projectObjects.write={},a.access.write.projects.forEach(function(b){this.client.projects.indexOf(b)>-1&&(a.projectObjects.write[b]=Wu.app.Projects[b])},this)},this)},_refreshTable:function(){this.client.users&&(this.client.users.forEach(function(a){this.addTableItem(a)},this),this.list.sort("name",{order:"asc"}))},reset:function(){this.list.clear()},addTableItem:function(a){var b=Wu.extend({},a);b.name=ich.usersTablerowName({firstName:b.firstName||"First name",lastName:b.lastName||"Last name",lastNameUuid:"lastName-"+b.uuid,firstNameUuid:"firstName-"+b.uuid}),b.email=b.local.email,b=this._fillProjects(b);for(var c=this.list.add(b),d=c[0].elm.children,e=0;e<d.length;e++){var f=d[e];0==e&&(f.children[0].children[0].id="users-checkbox-"+b.uuid,f.children[0].children[1].setAttribute("for","users-checkbox-"+b.uuid)),""==!f.id&&(f.id=f.id+b.uuid,f.setAttribute("uuid",b.uuid))}this.setEditHooks(b.uuid)},_fillProjects:function(a){var b=(this.client.projects,a.projectObjects),c={},d="";if(!b)return a;if("read"in b)for(p in b.read){var e=b.read[p];c={name:e.name,description:e.description,uuid:e.uuid},d+=ich.usersTableProjectItem(c)}return a.projects=d,a},_editProjects:function(a){this.insertProjectsSelect(a)},insertProjectsSelect:function(a){var b=a.target.parentElement,c=b.getAttribute("uuid");if(!c)var b=a.target,c=b.getAttribute("uuid");var d={x:b.offsetLeft,y:b.offsetTop},e={},f=this.client.projects;f.forEach(function(a){e[a]=Wu.app.Projects[a]},this);var g;this.client.users.forEach(function(a){a.uuid==c&&(g=a.projectObjects)}),this._projectsDropWrap=Wu.DomUtil.create("div","users-projects-dropwrap"),this._projectsDropWrap.userUuid=c;for(p in e){var h=e[p],i=Wu.DomUtil.create("div","users-projects-itemwrap"),j="",k="";h.uuid in g.read&&(j="checked"),h.uuid in g.write&&(k="checked"),i.innerHTML=ich.usersProjectsCheckbox({uuid:h.uuid,checkedRead:j,checkedWrite:k});var l=Wu.DomUtil.create("div","users-projects-namediv",i);l.innerHTML=h.name,this._projectsDropWrap.appendChild(i)}var m=Wu.DomUtil.create("div","users-projects-top-title");m.innerHTML="R &nbsp;W",this._projectsDropWrap.insertBefore(m,this._projectsDropWrap.firstChild);var n=Wu.DomUtil.create("div","projects-select-cancel",this._projectsDropWrap),o=Wu.DomUtil.create("div","projects-select-confirm",this._projectsDropWrap);n.innerHTML="Cancel",o.innerHTML="Confirm",Wu.app._appPane.appendChild(this._projectsDropWrap),this._projectsDropWrap.style.left=d.x+"px",this._projectsDropWrap.style.top=d.y+200+"px",Wu.DomEvent.on(o,"click",this._popupConfirm,this),Wu.DomEvent.on(n,"click",this._popupCancel,this),Wu.DomEvent.on(document,"keydown",this.checkEscape,this)},checkEscape:function(a){27==a.keyCode&&this._popupCancel()},_popupConfirm:function(){var a=[],b=[],c=this._projectsDropWrap.userUuid;this.client.projects.forEach(function(c){var d=Wu.DomUtil.get("users-projects-checkbox-read-"+c).checked;d&&a.push(c);var d=Wu.DomUtil.get("users-projects-checkbox-write-"+c).checked;d&&b.push(c)});var d={uuid:this._projectsDropWrap.userUuid,projects:{read:a,write:b,client:this.client.uuid}},e=JSON.stringify(d);Wu.save("/api/user/update",e),this.client.users.forEach(function(d,e){d.uuid==c&&(this.client.users[e].access.read.projects=a,this.client.users[e].access.write.projects=b)},this);var f=this;setTimeout(function(){f._updateUserProjects(),f.list.clear(),f.refreshTable()},200),this.removeProjectsPopup()},removeProjectsPopup:function(){this._projectsDropWrap.parentNode.removeChild(this._projectsDropWrap),Wu.DomEvent.off(document,"keydown",this.checkEscape,this)},_popupCancel:function(){this.removeProjectsPopup()},setEditHooks:function(a,b){var b=b||"on",c=Wu.DomUtil.get("lastName-"+a),d=Wu.DomUtil.get("firstName-"+a),e=Wu.DomUtil.get("company-"+a),f=Wu.DomUtil.get("position-"+a),g=Wu.DomUtil.get("phone-"+a),h=Wu.DomUtil.get("email-"+a),i=Wu.DomUtil.get("projects-"+a);Wu.DomEvent[b](c,"mousedown mouseup click",this.stop,this)[b](c,"dblclick",this.rename,this)[b](d,"mousedown mouseup click",this.stop,this)[b](d,"dblclick",this.rename,this)[b](e,"mousedown mouseup click",this.stop,this)[b](e,"dblclick",this._rename,this)[b](f,"mousedown mouseup click",this.stop,this)[b](f,"dblclick",this._rename,this)[b](g,"mousedown mouseup click",this.stop,this)[b](g,"dblclick",this._rename,this)[b](h,"mousedown mouseup click",this.stop,this)[b](h,"dblclick",this._rename,this)[b](i,"dblclick",this._editProjects,this)},stop:function(a){console.log("stop!"),a.preventDefault(),a.stopPropagation()},rename:function(a){a.target.removeAttribute("readonly"),a.target.focus(),a.target.selectionStart=a.target.selectionEnd,a.target.fieldKey=a.target.id.split("-")[0],Wu.DomEvent.on(a.target,"blur",this.editBlur,this),Wu.DomEvent.on(a.target,"keydown",this.editKey,this)},editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},editBlur:function(a){var b=a.target.fieldKey;a.target.setAttribute("readonly","readonly");var c=a.target.id.replace(b+"-",""),d=a.target.value||a.target.innerHTML;this._save(b,d,c)},_rename:function(a){var b=a.target,c=a.target.innerHTML,d=a.target.getAttribute("key"),e=a.target.getAttribute("uuid"),f=ich.injectInput({value:c,key:d,uuid:e});b.innerHTML=f;var g=b.firstChild;g.focus(),g.selectionStart=g.selectionEnd,Wu.DomEvent.on(g,"blur",this._editBlur,this),Wu.DomEvent.on(g,"keydown",this._editKey,this)},_editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},_editBlur:function(a){var b=a.target.value,c=a.target.getAttribute("key"),d=a.target.getAttribute("uuid"),e=a.target.parentNode;e.innerHTML=b,this.list.update(),this._save(c,b,d)},_save:function(a,b,c){this.client.users.forEach(function(d){if(d.uuid==c){d[a]=b;var e={};e[a]=b,e.uuid=d.uuid;var f=JSON.stringify(e);Wu.save("/api/user/update",f)}},this)}}),Wu.SidePane.DataLibrary=Wu.SidePane.Item.extend({type:"dataLibrary",title:"Data Library",initContent:function(){this._content=Wu.DomUtil.create("div","data-library ct1",Wu.app._appPane),this._container=Wu.DomUtil.create("div","editor-wrapper ct1",this._content),this.progress=Wu.DomUtil.create("div","progress-bar",this._content),this._container.innerHTML=ich.datalibraryContainer(),this._tableContainer=Wu.DomUtil.get("datalibrary-table-container"),this.fulldrop=Wu.DomUtil.create("div","fullscreen-drop",this._content),this.filecount=0,this._tableContainer.innerHTML=ich.datalibraryTableframe(),this._table=Wu.DomUtil.get("datalibrary-insertrows"),this._errors=Wu.DomUtil.get("datalibrary-errors"),this._uploader=Wu.DomUtil.get("upload-container"),this._deleter=Wu.DomUtil.get("datalibrary-delete-file"),this._downloader=Wu.DomUtil.get("datalibrary-download-files"),this._downloadList=Wu.DomUtil.get("datalibrary-download-dialogue"),this._checkall=Wu.DomUtil.get("checkbox-all"),this._checkallLabel=Wu.DomUtil.get("label-checkbox-all"),this.initList(),this.initDZ(),this.initDownloadTable()},addHooks:function(){Wu.DomEvent.on(this._deleter,"mousedown",this.deleteConfirm,this),Wu.DomEvent.on(this._downloader,"mousedown",this.downloadConfirm,this),Wu.DomEvent.on(this._checkallLabel,"mousedown",this.checkAll,this)},deactivate:function(){console.log("deactive sidepane datalib"),this.dz.disable(),this.disableFullscreenDZ()},initDownloadTable:function(){var a=ich.datalibraryTableDownload();this._downloadList.innerHTML=a,this._downloadOK=Wu.DomUtil.get("download-ok-button"),this._downloadCancel=Wu.DomUtil.get("download-cancel-button"),Wu.DomEvent.on(this._downloadOK,"mousedown",this.downloadFiles,this),Wu.DomEvent.on(this._downloadCancel,"mousedown",this.downloadCancel,this)},checkAll:function(){if(this._checkall.checked){var a=this.list.visibleItems;a.forEach(function(a){var b=a.elm.children[0].childNodes[1].children[0];b.checked&&(b.checked=!1)},this)}else{var a=this.list.visibleItems;a.forEach(function(a){var b=a.elm.children[0].childNodes[1].children[0];b.checked||(b.checked=!0)},this)}},downloadFiles:function(){var a=[];this._downloadFileList.forEach(function(b){a.push(b.uuid)},this);var b={files:this._downloadFileList,puuid:this.project.uuid,pslug:this.project.slug},b=JSON.stringify(b);Wu.post("/api/file/download",b,this.receivedDownload,this)},receivedDownload:function(a,b){var c="/api/file/download?file="+b+"&type=zip";a._downloadList.innerHTML=ich.datalibraryDownloadReady({url:c});var d=Wu.DomUtil.get("download-ready-button");Wu.DomEvent.on(d,"click",a.downloadDone,a)},downloadCancel:function(){console.log("downloadCancel!"),this._downloadFileList=[],this._downloadList.style.display="none"},downloadDone:function(){this.downloadCancel(),this.initDownloadTable()},downloadConfirm:function(){var a=this.getSelected();if(this._downloadFileList=a,0!=a.length){var b="";a.forEach(function(a){var c=Wu.extend({},a);c.format=c.format.join(", "),b+=ich.datalibraryDownloadRow(c)},this);var c=Wu.DomUtil.get("datalibrary-download-insertrows");c.innerHTML=b,this._downloadList.style.display="block"}},getSelected:function(){var a=[];return this.project.files.forEach(function(b){var c=Wu.DomUtil.get("checkbox-"+b.uuid);if(c)var d=c.checked;d&&a.push(b)},this),a},deleteConfirm:function(){var a=this.getSelected();0!=a.length&&confirm("Are you sure you want to delete these "+a.length+" files?")&&this.deleteFiles(a)},deleteFiles:function(a){console.log("deleting ",a);var b=[];a.forEach(function(a,c){this.list.remove("uuid",a.uuid);var c;for(c=this.project.files.length-1;c>=0;c-=1)this.project.files[c].uuid==a.uuid&&this.project.files.splice(c,1);var c;for(c=this.project.layermenu.length-1;c>=0;c-=1)this.project.layermenu[c].fuuid==a.uuid&&this.project.layermenu.splice(c,1);b.push(a._id)},this),this.project._update("layermenu");var c={_fids:b,puuid:this.project.uuid},d=JSON.stringify(c);Wu.save("/api/file/delete",d)},initList:function(){var a=Wu.DomUtil.createId("tr","dummy-table-entry");a.innerHTML=ich.datalibraryTablerow({type:"dummy-table-entry"}),this._table.appendChild(a);var b={valueNames:["name","file","category","keywords","date","status","type"]};this.list=new List("filelist",b),this.list.clear()},initDZ:function(){this.dz=new Dropzone(this._uploader,{url:"/api/upload",createImageThumbnails:!1,autoDiscover:!1}),this.enableFullscreenDZ()},enableFullscreenDZ:function(){Wu.DomEvent.on(document,"dragenter",this.dropping,this),Wu.DomEvent.on(document,"dragleave",this.undropping,this),Wu.DomEvent.on(document,"dragover",this.dragover,this),Wu.DomEvent.on(document,"drop",this.dropped,this)},disableFullscreenDZ:function(){Wu.DomEvent.off(document,"dragenter",this.dropping,this),Wu.DomEvent.off(document,"dragleave",this.undropping,this),Wu.DomEvent.off(document,"dragover",this.dragover,this),Wu.DomEvent.off(document,"drop",this.dropped,this)},refreshDZ:function(){var a=this;this.dz.removeAllListeners(),this.dz.options.params.project=this.project.uuid,this.dz.on("drop",function(){console.log("drop")}),this.dz.on("dragenter",function(){console.log("dragenter")}),this.dz.on("addedfile",function(){a.filecount+=1,a.progress.style.opacity=1,a._fulldrop||(a.fullOn(),a.fullUpOn())}),this.dz.on("complete",function(b){console.log("complete"),a.filecount-=1,a.dz.removeFile(b)}),this.dz.on("uploadprogress",function(b,c){a.progress.style.width=c+"%"}),this.dz.on("success",function(b,c){var d=Wu.parse(c);d&&a.uploaded(d)}),this.dz.on("complete",function(b){console.log("complete!",b),console.log("filecount: ",a.filecount),a.filecount||(a.progress.style.opacity=0,a.progress.style.width="0%",a.fullUpOff(),a.fulldropOff(),a._fulldrop=!1)})},fullUpOn:function(){Wu.DomUtil.addClass(this.fulldrop,"fullscreen-dropped")},fullUpOff:function(){Wu.DomUtil.removeClass(this.fulldrop,"fullscreen-dropped")},fulldropOn:function(a){this.fullOn(),this._fulldrop=a.target.className},fulldropOff:function(){this.fullOff()},fullOn:function(){this.fulldrop.style.opacity=.9,this.fulldrop.style.zIndex=1e3},fullOff:function(){var a=this;this.fulldrop.style.opacity=0,setTimeout(function(){a.fulldrop.style.zIndex=-10},200)},dropping:function(a){a.preventDefault(),this.fulldropOn(a)},undropping:function(a){a.preventDefault();var b=a.target.className;b==this._fulldrop&&this.fulldropOff(a)},dropped:function(a){a.preventDefault(),this.fullUpOn(),this.dz.drop(a)},dragover:function(a){a.preventDefault()},handleError:function(a){console.log("handling error");var b="";a.forEach(function(a){b+=a.error,b+="<br>"}),this._errors.innerHTML=b,this._errors.style.display="block"},uploaded:function(a){console.log("uploaded:"),console.log("file: ",a),a.errors.length>0&&this.handleError(a.errors),a.files&&a.files.forEach(function(a){this.addFile(a),this.project.files.push(a)},this)},addFile:function(a){var b=Wu.extend({},a);b.name=ich.datalibraryTablerowName({name:b.name||"Title",description:b.description||"Description",nameUuid:"name-"+b.uuid,descUuid:"description-"+b.uuid}),b.files=b.files.join(", "),b.keywords=b.keywords.join(", "),b.createdDate=new Date(b.createdDate).toDateString();var c=this.list.add(b);c[0].elm.id=b.uuid;var d=c[0].elm.children[0].children[0].children;d[0].id="checkbox-"+b.uuid,d[1].setAttribute("for","checkbox-"+b.uuid),this.addEditHooks(b.uuid)},addEditHooks:function(a){var b=Wu.DomUtil.get("name-"+a),c=Wu.DomUtil.get("description-"+a);Wu.DomEvent.on(b,"mousedown mouseup click",this.stop,this),Wu.DomEvent.on(b,"dblclick",this.rename,this),Wu.DomEvent.on(c,"mousedown mouseup click",this.stop,this),Wu.DomEvent.on(c,"dblclick",this.rename,this)},stop:function(a){console.log("stop!"),a.preventDefault(),a.stopPropagation()},rename:function(a){a.target.removeAttribute("readonly"),a.target.focus(),a.target.selectionStart=a.target.selectionEnd,a.target.fieldKey=a.target.id.split("-")[0],Wu.DomEvent.on(a.target,"blur",this.editBlur,this),Wu.DomEvent.on(a.target,"keydown",this.editKey,this)},editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},editBlur:function(a){var b=a.target.fieldKey;a.target.setAttribute("readonly","readonly");var c=a.target.id.replace(b+"-",""),d=a.target.value||a.target.innerHTML;this.project.files.forEach(function(a){a.uuid==c&&(a[b]=d)},this),this.list.update(),this._save(c,b)},_save:function(a,b){this.project.files.forEach(function(c){if(c.uuid==a){var d={};d[b]=c[b],d.uuid=c.uuid;var e=JSON.stringify(d);Wu.save("/api/file/update",e)}})},updateContent:function(){this.update()},update:function(){this.project=Wu.app._activeProject,this.reset(),this.refreshDZ(),this.refreshTable()},refreshTable:function(){this.project.files&&(this.project.files.forEach(function(a){this.addFile(a)},this),this.list.sort("name",{order:"asc"}))},reset:function(){this.list.clear(),this.fullOff(),this.fulldropOff()}}),Wu.SidePane.Layers=Wu.SidePane.Item.extend({type:"layers",initContent:function(){this._container.innerHTML=ich.layersWrapper(),this._layersWrapper=Wu.DomUtil.get("layers-wrapper"),this._libaryWrapper=Wu.DomUtil.get("layers-library-browser"),this._layerList=Wu.DomUtil.get("layers-library-list"),this._browserLibrary=Wu.DomUtil.get("layers-library-browser-datalayers"),this._browserMapbox=Wu.DomUtil.get("layers-library-browser-mapbox"),this._libraryPane=Wu.DomUtil.get("layers-library"),this._mapboxPane=Wu.DomUtil.get("layers-mapbox"),this._mapboxImportOk=Wu.DomUtil.get("import-mapbox-layers-ok"),this._mapboxImportInput=Wu.DomUtil.get("import-mapbox-layers"),this._mapboxList=Wu.DomUtil.get("layers-mapbox-list-wrap"),this._mapboxConnectDropp=Wu.DomUtil.get("editor-layers-connect-mapbox"),this._datalibUploadDropp=Wu.DomUtil.get("editor-layers-upload"),this._middleItem=Wu.DomUtil.create("div","smap-button-white middle-item ct12 ct18"),this._middleItem.innerHTML="Menu Folder",this._layersWrapper.appendChild(this._middleItem)},addHooks:function(){Wu.DomEvent.on(this._browserMapbox,"mousedown",this.selectBrowserMapbox,this),Wu.DomEvent.on(this._browserLibrary,"mousedown",this.selectBrowserLibrary,this),Wu.DomEvent.on(this._mapboxImportOk,"mousedown",this.importMapboxAccount,this),Wu.DomEvent.on(this._mapboxImportInput,"keydown",this.mapboxInputKeydown,this),Wu.DomEvent.on(this._middleItem,"mousedown",this.addMenuFolder,this)},addMenuFolder:function(){console.log("adding menu folder!");var a={fuuid:"layermenuFolder-"+Wu.Util.guid(),title:"New folder",layerType:"menufolder",pos:2};Wu.app.MapPane.layerMenu.addMenuFolder(a),this.project.layermenu.push(a),this.project._update("layermenu")},toggleDropdown:function(a){var b=a.target.nextElementSibling;Wu.DomUtil.hasClass(b,"hide")?(Wu.DomUtil.removeClass(b,"hide"),Wu.DomUtil.addClass(a.target,"rotate180")):(Wu.DomUtil.addClass(b,"hide"),Wu.DomUtil.removeClass(a.target,"rotate180"))},mapboxInputKeydown:function(a){(13==event.which||13==event.keyCode)&&(a.target.blur(),this.getMapboxAccount())},selectBrowserMapbox:function(){this._mapboxPane.style.display="block",this._libraryPane.style.display="none"},selectBrowserLibrary:function(){this._mapboxPane.style.display="none",this._libraryPane.style.display="block"},update:function(a){var a=this.project||a;this.updateContent(a)},updateContent:function(a){this._reset(),this.project=a,this._update()},_update:function(){this.initLayers(),this.initMapboxLayers(),this.markActiveLayers()},_reset:function(){this._layerList.innerHTML="",this._mapboxList.innerHTML="",this.mapboxFiles={},this.mapboxUsers={},this.mapboxLayers={},this.selectBrowserLibrary()
},markActiveLayers:function(){this.project.layermenu.forEach(function(a){if("datalibrary"==a.layerType){var b="layerItem-"+a.fuuid,c=Wu.DomUtil.get(b).parentNode;Wu.DomUtil.addClass(c,"active")}else if("mapbox"==a.layerType){var b="layerMapboxItem-"+a.fuuid,c=Wu.DomUtil.get(b).parentNode;Wu.DomUtil.addClass(c,"active")}},this)},initMapboxLayers:function(){this.parseMapboxLayers(),this.updateMapboxDOM()},initLayers:function(){var a=[];this.project.files.forEach(function(b){"layer"==b.type&&(a.push(b),this.addLayer(b))},this),this.initDraggable()},resetDraggable:function(){var a=Wu.DomUtil.get("layer-menu-inner-content");a&&(Wu.DomEvent.off(a,"dragover",this.drag.over,this),Wu.DomEvent.off(a,"dragleave",this.drag.leave,this),Wu.DomEvent.off(a,"drop",this.drag.drop,this))},drag:{start:function(a){var b=a.target;console.log("drag start: ",a),a.dataTransfer.setData("uuid",b.id)},drop:function(a){a.stopPropagation&&a.stopPropagation();var b=document.getElementById(a.dataTransfer.getData("uuid")),c=b.getAttribute("fuuid"),d=b.getAttribute("type");return this.addLayerToMenu(c,d),Wu.DomUtil.removeClass(Wu.DomUtil.get("layer-menu-inner-content"),"over"),!1},over:function(a){return a.preventDefault&&a.preventDefault(),Wu.DomUtil.addClass(Wu.DomUtil.get("layer-menu-inner-content"),"over"),!1},leave:function(){Wu.DomUtil.removeClass(Wu.DomUtil.get("layer-menu-inner-content"),"over")}},initDraggable:function(){this.resetDraggable();for(var a=document.getElementsByClassName("layer-item"),b=0;b<a.length;b++){var c=a[b];c.setAttribute("draggable","true"),c.id=Wu.Util.guid(),Wu.DomEvent.on(c,"dragstart",this.drag.start,this)}var d=Wu.DomUtil.get("layer-menu-inner-content");d&&(Wu.DomEvent.on(d,"dragover",this.drag.over,this),Wu.DomEvent.on(d,"dragleave",this.drag.leave,this),Wu.DomEvent.on(d,"drop",this.drag.drop,this))},removeLayerFromMenu:function(a,b){console.log("__________removeLayerFromMenu_____________",a,b),console.log("this.project.layermenu",this.project.layermenu);var c=_.findIndex(this.project.layermenu,{fuuid:a});if(0>!c)var c=_.findIndex(this.project.layermenu,{id:a});this.project.layermenu.splice(c,1),Wu.app.MapPane.layerMenu.remove(a),this.project._update("layermenu"),console.log("____end______removeLayerFromMenu______end_______")},addLayerToMenu:function(a,b){if("datalibrary"==b){var c=this.getFileFromUuid(a);console.log("dl file: ",c),Wu.app.MapPane.layerMenu.addFromFile(c);var d="layerItem-"+a,e=Wu.DomUtil.get(d).parentNode;Wu.DomUtil.addClass(e,"active");var f={fuuid:c.uuid,title:c.name,pos:1,layerType:"datalibrary"};return this.project.layermenu.push(f),console.log("====mb=> pushing to layermenu",f),console.log("this.project.layermenu",this.project.layermenu),void this.project._update("layermenu")}if("mapbox"==b){console.log("this.mapboxLayers: ",this.mapboxLayers);var g=[];for(l in this.mapboxLayers){var h=this.mapboxLayers[l];h.forEach(function(b){b.id==a&&(g=b)})}if(!g)return void console.log("that layer is not here????");Wu.app.MapPane.layerMenu.addFromMapbox(g);var d="layerMapboxItem-"+a,e=Wu.DomUtil.get(d).parentNode;Wu.DomUtil.addClass(e,"active");var f={fuuid:g.id,title:g.name,pos:1,layerType:"mapbox"};return this.project.layermenu.push(f),console.log("====mb=> pushing to layermenu",f),void this.project._update("layermenu")}},getFileFromUuid:function(a){var b={};return this.project.files.forEach(function(c){a==c.uuid&&(b=c)},this),b},addLayer:function(a){var b=Wu.DomUtil.create("div","item-list layer-item");b.setAttribute("draggable",!0),b.setAttribute("fuuid",a.uuid),b.setAttribute("type","datalibrary"),b.innerHTML=ich.layersItem(a),this._layerList.appendChild(b),Wu.DomEvent.on(b,"click",this.toggleLayer,this)},_activate:function(){Wu.SidePane.Item.prototype._activate.call(this),this.update()},importMapboxAccount:function(){var a=this._mapboxImportInput.value;this.getMapboxAccount(a),this._mapboxImportInput.value=""},getMapboxAccount:function(a){var b={username:a,projectId:this.project.uuid};Wu.post("/api/util/getmapboxaccount",JSON.stringify(b),this.gotMapboxAccount,this)},parseMapboxLayers:function(a,b){var a=a||this.project.mapboxLayers;this.mapboxLayers=this.mapboxLayers||{},a.forEach(function(a){this.mapboxLayers[a.username]=this.mapboxLayers[a.username]||[],this.mapboxLayers[a.username].push(a),b&&this.project.mapboxLayers.push(a)},this),this.removeMapboxDuplicates()},removeMapboxDuplicates:function(){this.project.mapboxLayers=_.uniq(this.project.mapboxLayers);for(a in this.mapboxLayers)this.mapboxLayers[a]=_.uniq(this.mapboxLayers[a])},gotMapboxAccount:function(a,b){var c=JSON.parse(b);return c?(a.parseMapboxLayers(c,!0),a.updateMapboxDOM(),void a.project._update("mapboxLayers")):void console.log("seems empty")},updateMapboxDOM:function(){console.log("updateMapboxDOM; this.mapboxLayers: ",this.mapboxLayers),this._mapboxList.innerHTML="";for(account in this.mapboxLayers){var a=Wu.DomUtil.create("div","mapbox-list-item");a.innerHTML=ich.mapboxListWrapper({name:account}),this._mapboxList.appendChild(a);var b=Wu.DomUtil.get("layers-mapbox-list-"+account),c=this.mapboxLayers[account];c.forEach(function(a){var c=Wu.DomUtil.create("div","layer-item");c.setAttribute("draggable",!0),c.setAttribute("fuuid",a.id),c.setAttribute("type","mapbox"),c.innerHTML=ich.layersMapboxItem(a),b.appendChild(c),Wu.DomEvent.on(c,"click",this.toggleLayer,this)},this)}this.initDraggable()},toggleLayer:function(a){var b=a.target,c=b.getAttribute("fuuid"),d=b.getAttribute("type");if(!c&&!d)var b=a.target.parentNode,c=b.getAttribute("fuuid"),d=b.getAttribute("type");var e=_.find(this.project.layermenu,{fuuid:c});void 0!=e?(this.removeLayerFromMenu(c),Wu.DomUtil.removeClass(b,"active")):this.addLayerToMenu(c,d)},save:function(){}}),Wu.SidePane=Wu.Class.extend({initialize:function(a){return this.options=a||Wu.app.options,this.initContainer(),this.initContent(),this.render(),this},initContainer:function(){var a="q-editor-container";this._container=Wu.DomUtil.create("div",a,Wu.app._appPane)},initContent:function(){var a="q-editor-menu";Wu.app._editorMenuPane=Wu.DomUtil.create("menu",a,this._container);var a="q-editor-content";Wu.app._editorContentPane=Wu.DomUtil.create("content",a,this._container)},render:function(){Wu.Util.isObject(this.options.editor)||(this.options.editor={render:this.options.editor||!0}),0!=this.options.editor.clients&&(this.Clients=new Wu.SidePane.Clients),this.Projects=new Wu.SidePane.Projects(this),0!=this.options.editor.map&&(this.Map=new Wu.SidePane.Map),0!=this.options.editor.sources&&(this.Layers=new Wu.SidePane.Layers),0!=this.options.editor.documentsPane&&(this.Documents=new Wu.SidePane.Documents),0!=this.options.editor.downloadsPane&&(this.DataLibrary=new Wu.SidePane.DataLibrary),0!=this.options.editor.users&&(this.Users=new Wu.SidePane.Users)},setProject:function(a){console.log("set project _______ SidePane"),this.Map.updateContent(a),this.Layers.updateContent(a),this.Documents.updateContent(a),this.Users.updateContent(a),this.DataLibrary.updateContent(a)},refresh:function(a){var b=["Clients","Projects","Map","Layers","Documents","Users","DataLibrary"];a.forEach(function(a){Wu.app.SidePane[a]||(Wu.app.SidePane[a]=new Wu.SidePane[a]),Wu.app.SidePane[a].enable()},this);var c=b.diff(a);c.forEach(function(a){Wu.app.SidePane[a].disable()},this)}}),Wu.SidePane.Item=Wu.Class.extend({type:"item",initialize:function(){Wu.setOptions(this,Wu.app.options),this.render()},render:function(){this.initContainer(),this.initContent(),this.addHooks(),this.disable()},addHooks:function(){Wu.DomEvent.on(this._menu,"click",this._activate,this),Wu.DomEvent.on(this._menu,"mouseenter",this._mouseenter,this),Wu.DomEvent.on(this._menu,"mouseleave",this._mouseleave,this)},_mouseenter:function(){Wu.DomUtil.addClass(this._menu,"red")},_mouseleave:function(){Wu.DomUtil.removeClass(this._menu,"red")},_activate:function(){var a=Wu.app._activeMenu||!1;Wu.app._activeMenu=this,Wu.app._active=this._content,this.swiper(),a&&Wu.DomUtil.removeClass(a._menu,"active"),Wu.DomUtil.addClass(this._menu,"active"),a&&a.deactivate()},swiper:function(){for(var a,b,c,d,e,f=document.getElementsByTagName("menu")[0],g=f.getElementsByTagName("div"),h=0;h<g.length;h++)g[h]==Wu.app._activeMenu._menu&&(a=h),g[h]==Wu.app._active._menu&&(b=h);b>c?(d="swipe_out",e="swipe_in"):(d="swipe_out_up",e="swipe_in_up"),Wu.app._active&&(Wu.DomUtil.addClass(Wu.app._active,d),setTimeout(function(){Wu.DomUtil.removeClass(Wu.app._active,d)},300)),Wu.DomUtil.addClass(Wu.app._active,"show"),Wu.DomUtil.addClass(Wu.app._active,e),setTimeout(function(){Wu.DomUtil.removeClass(Wu.app._active,e)},300)},deactivate:function(){console.log("blank deactiavte")},initContainer:function(){var a="q-editor-menu-item "+this.type;this._menu=Wu.DomUtil.create("div",a,Wu.app._editorMenuPane),this._title=Wu.DomUtil.create("a",this.type,this._menu),this._title.innerHTML=Wu.Util.capitalize(this.title||this.type);var a="q-editor-content-item "+this.type;this._content=Wu.DomUtil.create("div",a,Wu.app._editorContentPane),this._container=Wu.DomUtil.create("div","editor-wrapper",this._content)},initContent:function(){},updateContent:function(){},_addHook:function(a,b,c,d){Wu.DomEvent.on(a,b,c,d)},disable:function(){Wu.DomEvent.off(this._menu,"click",this._activate,this),Wu.DomUtil.addClass(this._title,"disabled")},enable:function(){Wu.DomEvent.on(this._menu,"click",this._activate,this),Wu.DomUtil.removeClass(this._title,"disabled")},remove:function(){delete this._menu,delete this._content,delete this}}),Wu.SidePane.Clients=Wu.SidePane.Item.extend({type:"clients",initialize:function(){Wu.SidePane.Item.prototype.initialize.call(this),Wu.app._active=this._content,this._activate()},initContent:function(){this._container.innerHTML=ich.editorClients();var a=(this._clientsContainer=Wu.DomUtil.get("editor-clients"),Wu.DomUtil.create("div","new-client",this._clientsContainer));a.innerHTML="Create New Client",this._addHook(a,"click",this._createNew,this),this.options.json.clients.forEach(function(a){this._create(a)},this)},_create:function(a){var b={clientName:a.name,clientLogo:a.header.logo,clientID:a.uuid};Wu.DomUtil.prependTemplate(this._clientsContainer,ich.editorClientsItem(b));var c=Wu.DomUtil.get("editor-clients-container-"+a.uuid);this._addHook(c,"click",this.select,Wu.app.Clients[a.uuid]),this._addHook(c,"click",this._select,c);var d=Wu.DomUtil.get("editor-client-edit-toggle-"+a.uuid);this._addHook(d,"click",this.toggleEdit,Wu.app.Clients[a.uuid]);var e=Wu.DomUtil.get("editor-client-delete-"+a.uuid);this._addHook(e,"click",this.remove,Wu.app.Clients[a.uuid])},remove:function(){var a=this;window.confirm("Are you sure you want to DELETE the client "+a.name+"?")&&a._delete()},_createNew:function(){var a={clientName:"New client"};Wu.DomUtil.prependTemplate(this._clientsContainer,ich.editorClientsNew(a));var b=Wu.DomUtil.get("editor-client-confirm-button");this._addHook(b,"click",this._confirm,this);var b=Wu.DomUtil.get("editor-client-cancel-button");this._addHook(b,"click",this._cancel,this);var c=Wu.DomUtil.get("editor-client-name-new");this._addHook(c,"keyup",this._checkSlug,this)},_checkSlug:function(){clearTimeout(this._timer);var a=this;this._timer=setTimeout(function(){var b=Wu.DomUtil.get("editor-client-name-new"),c=Wu.Util.trimAll(b.value).toLowerCase(),d=JSON.stringify({slug:c}),e="/api/client/unique";Wu.Util.postcb(e,d,a._checkedSlug,a)},500)},_checkedSlug:function(a,b){var c=JSON.parse(b);return c.unique?void a._enableConfirm():c.error?void console.log(c):void a._disableConfirm()},_disableConfirm:function(){var a=Wu.DomUtil.get("editor-client-confirm-button");a.style.backgroundColor="red",console.log("Client name is not unique.")},_enableConfirm:function(){var a=Wu.DomUtil.get("editor-client-confirm-button");a.style.backgroundColor="",console.log("Client name OK.")},_cancel:function(){var a=Wu.DomUtil.get("editor-clients-container-new");Wu.DomUtil.remove(a)},_confirm:function(){var a=Wu.DomUtil.get("editor-client-name-new").value,b=Wu.DomUtil.get("editor-client-description-new").value,c=Wu.DomUtil.get("editor-client-keywords-new").value,d={name:a,description:b,keywords:c},e=new Wu.Client(d);e.saveNew()},_created:function(a,b){var c=Wu.app.SidePane.Clients,d=JSON.parse(b);Wu.extend(a,d),Wu.app.Clients[a.uuid]=a;var e=Wu.DomUtil.get("editor-clients-container-new");Wu.DomUtil.remove(e),c._create(a),a.setActive()},toggleEdit:function(a){a&&Wu.DomEvent.stop(a);var b=this,c=Wu.DomUtil.get("editor-client-edit-wrapper-"+b.uuid);b.options.editMode?(c.style.display="none",b.options.editMode=!1):(c.style.display="block",b.options.editMode=!0)},_addHook:function(a,b,c,d){Wu.DomEvent.on(a,b,c,d)},select:function(){var a=this;a.setActive(),Wu.app._activeProject&&Wu.app._activeProject.unload();var b=["Clients","Projects"],c=Wu.app.options.json.user.privileges.create;c.users&&b.push("Users"),Wu.app.SidePane.refresh(b),Wu.app.SidePane.Projects._activate()},_select:function(){var a=Wu.app.SidePane.Clients;a._previousSelect&&Wu.DomUtil.removeClass(a._previousSelect,"active-client"),Wu.DomUtil.addClass(this,"active-client"),a._previousSelect=this},selectProject:function(){var a=this;a.setActive()},disable:function(){}}),Wu.SidePane.Projects=Wu.SidePane.Item.extend({type:"projects",initContent:function(){this._container.innerHTML=ich.editorProjectsContainer();var a=Wu.DomUtil.get("editor-projects-sort-by-left"),b=Wu.DomUtil.get("editor-projects-sort-by-right");Wu.DomEvent.on(a,"click",this.sortProjects,this),Wu.DomEvent.on(b,"click",this.sortProjects,this);var c=Wu.DomUtil.get("new-project-button");Wu.DomEvent.on(c,"click",this._createNew,this),this._projectsContainer=Wu.DomUtil.get("editor-projects-container"),this._projects={},this._editMode=!1},refresh:function(){var a=Wu.app._activeClient;this._projectsContainer.innerHTML="",this._projects={};for(item in Wu.app.Projects)a.projects.indexOf(item)>-1&&this._create(Wu.app.Projects[item])},select:function(){var a=this;a.setActive();var b=Wu.app.SidePane.Projects._projects;for(p in b){var c=b[p];Wu.DomUtil.removeClass(c,"active")}var c=b[a.uuid];Wu.DomUtil.addClass(c,"active");var d=["Clients","Projects","Documents","Layers","DataLibrary"];a.access.write.indexOf(Wu.app.options.json.user.uuid)>-1&&d.push("Map");var e=Wu.app.options.json.user.privileges.create;e.users&&d.push("Users"),Wu.app.SidePane.refresh(d)},sortProjects:function(a,b){console.log("sort!"),console.log(this),console.log(a),console.log(b)},_createNew:function(){console.log("creating neeeee!");var a={projectName:"New project"};Wu.DomUtil.prependTemplate(this._projectsContainer,ich.editorProjectsNew(a),!0);var b=Wu.DomUtil.get("editor-project-confirm-button");this._addHook(b,"click",this._confirm,this);var b=Wu.DomUtil.get("editor-project-cancel-button");this._addHook(b,"click",this._cancel,this)},_cancel:function(){var a=Wu.DomUtil.get("editor-projects-container-new");Wu.DomUtil.remove(a)},_confirm:function(){var a=Wu.DomUtil.get("editor-project-name-new").value,b=Wu.DomUtil.get("editor-project-description-new").value,c=Wu.DomUtil.get("editor-project-keywords-new").value,d={name:a,description:b,keywords:c},e=new Wu.Project(d);e._saveNew()},_create:function(a){var b={projectName:a.name||"",projectLogo:a.header.logo||"",uuid:a.uuid},c=Wu.DomUtil.create("div","editor-projects-item");c.setAttribute("uuid",a.uuid),c.innerHTML=ich.editorProjectsItem(b),this._projects[a.uuid]=c,this._projectsContainer.appendChild(c);var d=Wu.DomUtil.get("project-edit-button-"+a.uuid);Wu.DomEvent.on(d,"mousedown",this.toggleEdit,this),Wu.DomEvent.on(d,"click",Wu.DomEvent.stop,this),Wu.DomEvent.on(c,"click",this.select,Wu.app.Projects[a.uuid])},toggleEdit:function(a){a&&Wu.DomEvent.stop(a);var b=a.target.getAttribute("uuid"),c=(Wu.DomUtil.get("editor-project-edit-wrapper-"+b),Wu.app.Projects[b]);if(this._editorPane&&Wu.DomUtil.remove(this._editorPane),this._editMode=!this._editMode,this._editMode){c._editorPane=this._editorPane=Wu.DomUtil.create("div","editor-project-edit-super-wrap");var d=ich.editorProjectEditWrapper({uuid:b,name:c.name,description:c.description,keywords:c.keywords});c._editorPane.innerHTML=d;for(var e=this._projects[b].parentNode.childNodes,f=0;f<e.length;f++)if(e[f].getAttribute("uuid")==b)var g=f,h=g%2;if(h){var i=g,j=e[i];j.parentNode.insertBefore(c._editorPane,j.nextSibling),Wu.DomUtil.addClass(c._editorPane,"right")}else{var i=parseInt(g)+1;i>e.length-1&&(i=e.length-1);var j=e[i];j.parentNode.insertBefore(c._editorPane,j.nextSibling),Wu.DomUtil.addClass(c._editorPane,"left")}this._editName=Wu.DomUtil.get("editor-project-name-"+b),this._editDescription=Wu.DomUtil.get("editor-project-description-"+b),this._editKeywords=Wu.DomUtil.get("editor-project-keywords-"+b),this._deleteButton=Wu.DomUtil.get("editor-project-delete-"+b),Wu.DomEvent.on(this._editName,"keydown blur",function(){this.autosave(c,"name")},this),Wu.DomEvent.on(this._editDescription,"keydown blur",function(){this.autosave(c,"description")},this),Wu.DomEvent.on(this._editKeywords,"keydown blur",function(){this.autosave(c,"keywords")},this),Wu.DomEvent.on(this._deleteButton,"mousedown",function(){this._delete(c)},this)}},_delete:function(a){if(confirm('Are you sure you want to delete project "'+a.name+'"?')){a._delete();var b=this._projects[a.uuid];Wu.DomUtil.remove(b),this._editorPane&&Wu.DomUtil.remove(this._editorPane)}},autosave:function(a,b){var c=this;clearTimeout(this._saving),this._saving=setTimeout(function(){c.saveText(a,b)},500)},saveText:function(a,b){a[b]=Wu.DomUtil.get("editor-project-"+b+"-"+a.uuid).value,a._update(b)},_created:function(a,b){var c=Wu.app.SidePane.Projects,d=JSON.parse(b);Wu.extend(a,d),Wu.app.Projects[a.uuid]=a;var e=Wu.DomUtil.get("editor-projects-container-new");Wu.DomUtil.remove(e),c._create(a),a.setActive(),Wu.app._activeClient.projects.push(a.uuid),Wu.app._activeClient.update("projects"),console.log("updated parent client::::",Wu.app._activeClient)}}),Wu.SidePane.Map=Wu.SidePane.Item.extend({type:"map",initContent:function(){this.app=Wu.app,this._container.innerHTML=ich.editorMapBaseLayer(),this._panes={},this._panes.baselayerWrap=Wu.DomUtil.get("editor-map-baselayer-wrap"),this._panes.bounds=Wu.DomUtil.get("editor-map-bounds"),this._panes.boundsNELatValue=Wu.DomUtil.get("editor-map-bounds-NE-lat-value"),this._panes.boundsNELngValue=Wu.DomUtil.get("editor-map-bounds-NE-lng-value"),this._panes.boundsSWLatValue=Wu.DomUtil.get("editor-map-bounds-SW-lat-value"),this._panes.boundsSWLngValue=Wu.DomUtil.get("editor-map-bounds-SW-lng-value"),this._panes.initPos=Wu.DomUtil.get("editor-map-initpos-button"),this._panes.initPosLatValue=Wu.DomUtil.get("editor-map-initpos-lat-value"),this._panes.initPosLngValue=Wu.DomUtil.get("editor-map-initpos-lng-value"),this._panes.initPosZoomValue=Wu.DomUtil.get("editor-map-initpos-zoom-value"),this._panes.controlsWrap=Wu.DomUtil.get("editor-map-controls-wrap").parentNode.parentNode,this._panes.controlZoom=Wu.DomUtil.get("map-controls-zoom").parentNode.parentNode,this._panes.controlDraw=Wu.DomUtil.get("map-controls-draw").parentNode.parentNode,this._panes.controlInspect=Wu.DomUtil.get("map-controls-inspect").parentNode.parentNode,this._panes.controlDescription=Wu.DomUtil.get("map-controls-description").parentNode.parentNode,this._panes.controlLayermenu=Wu.DomUtil.get("map-controls-layermenu").parentNode.parentNode,this._panes.controlLegends=Wu.DomUtil.get("map-controls-legends").parentNode.parentNode,this._panes.controlMeasure=Wu.DomUtil.get("map-controls-measure").parentNode.parentNode,this._panes.controlGeolocation=Wu.DomUtil.get("map-controls-geolocation").parentNode.parentNode,this._panes.controlVectorstyle=Wu.DomUtil.get("map-controls-vectorstyle").parentNode.parentNode,this._panes.controlMouseposition=Wu.DomUtil.get("map-controls-mouseposition").parentNode.parentNode},_activate:function(){Wu.SidePane.Item.prototype._activate.call(this),this._update()},addHooks:function(){Wu.SidePane.Item.prototype.addHooks.call(this),Wu.DomEvent.on(this._panes.bounds,"click",this._setBounds,this),Wu.DomEvent.on(this._panes.initPos,"click",this._setInitPos,this),Wu.DomEvent.on(this._panes.initPos,"mousedown",this._buttonMouseDown,this),Wu.DomEvent.on(this._panes.initPos,"mouseup",this._buttonMouseUp,this),Wu.DomEvent.on(this._panes.initPos,"mouseleave",this._buttonMouseUp,this),Wu.DomEvent.on(this._panes.bounds,"mousedown",this._buttonMouseDown,this),Wu.DomEvent.on(this._panes.bounds,"mouseup",this._buttonMouseUp,this),Wu.DomEvent.on(this._panes.bounds,"mouseleave",this._buttonMouseUp,this),Wu.DomEvent.on(this._panes.controlZoom,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlDraw,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlInspect,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlDescription,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlLayermenu,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlLegends,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlMeasure,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlGeolocation,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlVectorstyle,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this._panes.controlMouseposition,"mousedown click",this.toggleControl,this)},toggleControl:function(a){if("click"==a.type)return void Wu.DomEvent.stop(a);var b=a.target.getAttribute("which"),c=Wu.DomUtil.get("map-controls-"+b),d=!c.checked,e="enable"+b.camelize(),f="disable"+b.camelize();d?(console.log("enable: ",e),Wu.app.MapPane[e](),this.enableControl(b)):(Wu.app.MapPane[f](),this.disableControl(b)),this.project.controls[b]=d,this.project._update("controls")},disableControl:function(a){{var b=Wu.DomUtil.get("map-controls-"+a),c=Wu.DomUtil.get("map-controls-title-"+a).parentNode;Wu.app._map}Wu.DomUtil.removeClass(c,"active"),b.checked=!1},enableControl:function(a){{var b=Wu.DomUtil.get("map-controls-"+a),c=Wu.DomUtil.get("map-controls-title-"+a).parentNode;this.app._map}Wu.DomUtil.addClass(c,"active"),b.checked=!0},_buttonMouseDown:function(a){Wu.DomUtil.addClass(a.target,"btn-info")},_buttonMouseUp:function(a){Wu.DomUtil.removeClass(a.target,"btn-info")},_setUrl:function(a){var b=Wu.app._activeProject;if(!b)return void console.log("_activeProejct == undefined");var c=a.target.value;console.log("url: ",c),b.map.baseLayer.url=c,b._update("map")},_setProvider:function(a){console.log("set provider"),console.log(a);var b=Wu.app._activeProject;if(!b)return void console.log("_activeProejct == undefined");var c=a.target.value;b.map.baseLayer.provider=c,b._update("map")},_setTileType:function(a){console.log("set tiletype"),console.log(a);var b=Wu.app._activeProject;if(!b)return void console.log("_activeProejct == undefined");if(a.target.checked)var c="vector";else{var c="raster";b.map.baseLayer.tms=!0}console.log("YTPE NOW::",c),b.map.baseLayer.type=c,b._update("map")},_setBounds:function(){var a=Wu.app._activeProject;if(!a)return void console.log("_activeProejct == undefined");{var b=Wu.app._map.getBounds();Wu.app._map.getZoom()}a.map.bounds={northEast:{lat:b._northEast.lat,lng:b._northEast.lng},southWest:{lat:b._southWest.lat,lng:b._southWest.lng}},a._update("map"),this.updateContent()},_setInitPos:function(){var a=Wu.app._activeProject;if(!a)return void console.log("_activeProejct == undefined");var b=Wu.app._map.getCenter(),c=Wu.app._map.getZoom();a.map.initPos={lat:b.lat,lng:b.lng,zoom:c},a._update("map"),this.updateContent()},updateContent:function(){this._update()},_resetView:function(){},_updateBaselayer:function(){var a=this.insertSelect(this._panes.baselayerWrap),b=a.tit,c=a.w,d=this.project.map.baseLayer.url;this.project.mapboxLayers.forEach(function(a){var e=Wu.DomUtil.create("div","select-elem",c);e.innerHTML=a.name,e.setAttribute("uuid",a.id),e.setAttribute("type","mapbox"),Wu.DomEvent.on(e,"mousedown",function(a){b.innerHTML=a.target.innerHTML,b.setAttribute("active",!1),c.style.display="none",this.setBaseLayer("mapbox",a.target.getAttribute("uuid"))},this),console.log("cur: "+d+" | fid: "+a.id),d==a.id&&(b.innerHTML=a.name)},this)},_update:function(){this.project=Wu.app._activeProject;var a=this.project.map.bounds;Wu.Util.isObject(this.project.controls)||(this.project.controls={}),this._updateBaselayer(),this._panes.boundsNELatValue.value=a.northEast.lat,this._panes.boundsNELngValue.value=a.northEast.lng,this._panes.boundsSWLatValue.value=a.southWest.lat,this._panes.boundsSWLngValue.value=a.southWest.lng,this._panes.initPosLatValue.value=this.project.map.initPos.lat,this._panes.initPosLngValue.value=this.project.map.initPos.lng,this._panes.initPosZoomValue.value=this.project.map.initPos.zoom,this._updateControls()},_updateControls:function(){for(c in this.project.controls){var a=this.project.controls[c],b="enable"+c.camelize(),d="disable"+c.camelize();a?(Wu.app.MapPane[b](),this.enableControl(c)):(Wu.app.MapPane[d](),this.disableControl(c))}},setBaseLayer:function(a,b){console.log("setting baselayer: ",a,b),this.project.map.baseLayer.url=b,this.project.map.baseLayer.provider=a,this.project._update(),Wu.app.MapPane.setBaseLayer(this.project),this.project._update("map")},insertSelect:function(a){a.innerHTML="<h4>Base Layer </h4>";var b=Wu.DomUtil.createId("div","select-baselayer-wrap",a);Wu.DomUtil.addClass(b,"select-wrap");var c=Wu.DomUtil.create("div","select-title",b);c.innerHTML="Select layer";var d=Wu.DomUtil.create("div","select-elems",b),e=Wu.DomUtil.create("div","select-baselayer dropdown-button",b);Wu.DomEvent.on(e,"mousedown",function(){var a=c.getAttribute("active");"true"==a?(c.setAttribute("active",!1),d.style.display="none"):(c.setAttribute("active",!0),d.style.display="block")},this);var f={};return f.tit=c,f.w=d,f}}),Wu.SidePane.Documents=Wu.SidePane.Item.extend({type:"documents",title:"Documents",initContent:function(){this._content=Wu.DomUtil.create("div","fullpage-documents",Wu.app._appPane),this._container=Wu.DomUtil.create("div","editor-wrapper",this._content),this._container.innerHTML=ich.documentsContainer(),this._leftpane=Wu.DomUtil.get("documents-container-leftpane"),this._folderpane=Wu.DomUtil.get("documents-folder-list"),this._rightpane=Wu.DomUtil.get("documents-container-rightpane"),this._textarea=Wu.DomUtil.get("documents-container-textarea"),this._newfolder=Wu.DomUtil.get("documents-new-folder")},initFolders:function(){this.folders={};var a=this.project.folders;a.forEach(function(a){this.folders[a.uuid]=a},this)},addHooks:function(){Wu.DomEvent.on(this._newfolder,"mousedown",this.newFolder,this),grande.bind([this._textarea]),this.expandGrande()},expandGrande:function(){var a=document.getElementsByClassName("g-body")[0],b=a.children[0].children[0].children[0].children[0],c=a.children[0],d=Wu.DomUtil.create("button","file url"),e=Wu.DomUtil.create("div","grande-project-files-wrap"),f=Wu.DomUtil.create("div","grande-project-files-btn"),g=Wu.DomUtil.create("select","grande-project-files");e.appendChild(g),e.appendChild(f),d.innerHTML="F",b.appendChild(d),b.appendChild(e),this._grandeFiles=b,this._grandeFilesBtn=d,this._grandeFilesSelect=g,this._grandeInsertBtn=f,this._grandeFilesWrap=e,this._grandeWrap=c,Wu.DomEvent.on(d,"mousedown",this.attachFile,this)},attachFile:function(){console.log("text selll:::::"),console.log(window.getSelection()),this.textSelection=window.getSelection(),range=this.textSelection.getRangeAt(0),this.textSelectionText=range.cloneContents().firstChild.data,console.log("actual text:: ",this.textSelectionText),this._grandeFilesWrap.style.display="block";var a=this._grandeFilesSelect;a.innerHTML="",this.project.files.forEach(function(b){a.options[a.options.length]=new Option(b.name,b.uuid)},this),Wu.DomEvent.on(this._grandeInsertBtn,"mousedown",this.selectedFile,this)},replaceSelection:function(a,b){var c;if(this.textSelection.getRangeAt){c=this.textSelection.getRangeAt(0),c.deleteContents();var d=document.createElement("a");d.innerHTML=b,d.href=a,c.insertNode(d)}},selectedFile:function(){var a=this._grandeFilesSelect,b=a.options[a.selectedIndex].value,c=a.options[a.selectedIndex].text;console.log("remember?"),console.log("fuuid: ",b),console.log("name: ",c),console.log(window.getSelection()),this._grandeFilesWrap.style.display="none",Wu.DomUtil.removeClass(this._grandeWrap,"active"),Wu.DomUtil.addClass(this._grandeWrap,"hide");var d="/api/file/download?file="+b;this.replaceSelection(d,this.textSelectionText),this.saveText()},_activate:function(a){if(Wu.SidePane.Item.prototype._activate.call(this),this.adjustTop(),this.adjustWidth(),Wu.app.HeaderPane.disableResize(),this.project.folders.length>0){var a={target:{uuid:this.project.folders[0].uuid},preventDefault:Wu.Util.falseFn};this.selectFolder(a)}},deactivate:function(){Wu.app.HeaderPane.enableResize()},adjustTop:function(){return},adjustWidth:function(){},update:function(){this.project=Wu.app._activeProject,this.reset(),this.createFolders(),this.adjustTop(),this.adjustWidth()},updateContent:function(){this._textarea.innerHTML="",this.update()},newFolder:function(){var a={title:"Title",uuid:Wu.Util.guid("folder"),content:"Text content"};this.project.folders.push(a),this.update()},createFolders:function(){var a=this.project.folders;a.forEach(function(a){var b=a;b.el=Wu.DomUtil.create("input","documents-folder-item",this._folderpane),b.el.value=b.title,b.el.setAttribute("readonly","readonly"),b.el.uuid=b.uuid,Wu.DomEvent.on(b.el,"mousedown",this.selectFolder,this),Wu.DomEvent.on(b.el,"dblclick",this.renameFolder,this),this.folders[b.uuid]=b},this)},renameFolder:function(a){{var b=a.target.uuid;this.folders[b]}a.target.removeAttribute("readonly"),a.target.focus(),Wu.DomEvent.on(a.target,"blur",this.titleBlur,this),Wu.DomEvent.on(a.target,"keydown",this.titleKey,this)},titleKey:function(){(13==event.which||13==event.keyCode)&&this.titleBlur()},titleBlur:function(){for(f in this.folders){var a=this.folders[f];a.el.setAttribute("readonly","readonly"),this.folders[a.uuid].title=a.el.value}this._save()},selectFolder:function(a){a.preventDefault();var b=a.target.uuid,c=this.folders[b];this._textarea.innerHTML="",this._textarea.innerHTML=c.content,this._textarea.fuuid=b,this.adjustWidth(),this._textarea.blur(),this.underline(b),Wu.DomEvent.on(this._textarea,"keydown mousedown",this.autosave,this)},underline:function(a){for(f in this.folders){var b=this.folders[f].el,c=this.folders[f].uuid;a==c?Wu.DomUtil.addClass(b,"underline"):Wu.DomUtil.removeClass(b,"underline")}},autosave:function(){var a=this;clearTimeout(this._saving),this._saving=setTimeout(function(){a.saveText()},500)},saveText:function(){var a=this.folders[this._textarea.fuuid].content,b=this._textarea.innerHTML;a!=b&&(this.folders[this._textarea.fuuid].content=b,this._save())},_save:function(){var a=this.folders;this.project.folders=[];for(f in a){var b=Wu.extend({},a[f]);delete b.el,this.project.folders.push(b)}this.project._update("folders"),this.update()},reset:function(){this._folderpane.innerHTML="",this.folders={}}}),Wu.SidePane.DataLibrary=Wu.SidePane.Item.extend({type:"dataLibrary",title:"Data Library",initContent:function(){this._content=Wu.DomUtil.create("div","data-library",Wu.app._appPane),this._container=Wu.DomUtil.create("div","editor-wrapper",this._content),this.progress=Wu.DomUtil.create("div","progress-bar",this._content),this._container.innerHTML=ich.datalibraryContainer(),this._tableContainer=Wu.DomUtil.get("datalibrary-table-container"),this.fulldrop=Wu.DomUtil.create("div","fullscreen-drop",this._content),this.filecount=0,this._tableContainer.innerHTML=ich.datalibraryTableframe(),this._table=Wu.DomUtil.get("datalibrary-insertrows"),this._errors=Wu.DomUtil.get("datalibrary-errors"),this._uploader=Wu.DomUtil.get("upload-container"),this._deleter=Wu.DomUtil.get("datalibrary-delete-file"),this._downloader=Wu.DomUtil.get("datalibrary-download-files"),this._downloadList=Wu.DomUtil.get("datalibrary-download-dialogue"),this._checkall=Wu.DomUtil.get("checkbox-all"),this._checkallLabel=Wu.DomUtil.get("label-checkbox-all"),this.initList(),this.initDZ(),this.initDownloadTable()
},addHooks:function(){Wu.DomEvent.on(this._deleter,"mousedown",this.deleteConfirm,this),Wu.DomEvent.on(this._downloader,"mousedown",this.downloadConfirm,this),Wu.DomEvent.on(this._checkallLabel,"mousedown",this.checkAll,this)},deactivate:function(){console.log("deactive datalib"),console.log(this.dz),this.dz.disable(),this.disableFullscreenDZ()},initDownloadTable:function(){var a=ich.datalibraryTableDownload();this._downloadList.innerHTML=a,this._downloadOK=Wu.DomUtil.get("download-ok-button"),this._downloadCancel=Wu.DomUtil.get("download-cancel-button"),Wu.DomEvent.on(this._downloadOK,"mousedown",this.downloadFiles,this),Wu.DomEvent.on(this._downloadCancel,"mousedown",this.downloadCancel,this)},checkAll:function(){if(this._checkall.checked){var a=this.list.visibleItems;a.forEach(function(a){var b=a.elm.children[0].childNodes[1].children[0];b.checked&&(b.checked=!1)},this)}else{var a=this.list.visibleItems;a.forEach(function(a){var b=a.elm.children[0].childNodes[1].children[0];b.checked||(b.checked=!0)},this)}},downloadFiles:function(){var a=[];this._downloadFileList.forEach(function(b){a.push(b.uuid)},this);var b={files:this._downloadFileList,puuid:this.project.uuid,pslug:this.project.slug},b=JSON.stringify(b);Wu.post("/api/file/download",b,this.receivedDownload,this)},receivedDownload:function(a,b){var c="/api/file/download?file="+b+"&type=zip";a._downloadList.innerHTML=ich.datalibraryDownloadReady({url:c});var d=Wu.DomUtil.get("download-ready-button");Wu.DomEvent.on(d,"click",a.downloadDone,a)},downloadCancel:function(){console.log("downloadCancel!"),this._downloadFileList=[],this._downloadList.style.display="none"},downloadDone:function(){this.downloadCancel(),this.initDownloadTable()},downloadConfirm:function(){var a=this.getSelected();if(this._downloadFileList=a,0!=a.length){var b="";a.forEach(function(a){var c=Wu.extend({},a);c.format=c.format.join(", "),b+=ich.datalibraryDownloadRow(c)},this);var c=Wu.DomUtil.get("datalibrary-download-insertrows");c.innerHTML=b,this._downloadList.style.display="block"}},getSelected:function(){var a=[];return this.project.files.forEach(function(b){var c=Wu.DomUtil.get("checkbox-"+b.uuid);if(c)var d=c.checked;d&&a.push(b)},this),a},deleteConfirm:function(){var a=this.getSelected();0!=a.length&&confirm("Are you sure you want to delete these "+a.length+" files?")&&this.deleteFiles(a)},deleteFiles:function(a){console.log("deleting ",a);var b=[];a.forEach(function(a,c){this.list.remove("uuid",a.uuid);var c;for(c=this.project.files.length-1;c>=0;c-=1)this.project.files[c].uuid==a.uuid&&this.project.files.splice(c,1);var c;for(c=this.project.layermenu.length-1;c>=0;c-=1)this.project.layermenu[c].fuuid==a.uuid&&this.project.layermenu.splice(c,1);b.push(a._id)},this),this.project._update("layermenu");var c={_fids:b,puuid:this.project.uuid},d=JSON.stringify(c);Wu.save("/api/file/delete",d)},initList:function(){var a=Wu.DomUtil.createId("tr","dummy-table-entry");a.innerHTML=ich.datalibraryTablerow({type:"dummy-table-entry"}),this._table.appendChild(a);var b={valueNames:["name","file","category","keywords","date","status","type"]};this.list=new List("filelist",b),this.list.clear()},initDZ:function(){this.dz=new Dropzone(this._uploader,{url:"/api/upload",createImageThumbnails:!1,autoDiscover:!1}),this.enableFullscreenDZ()},enableFullscreenDZ:function(){Wu.DomEvent.on(document,"dragenter",this.dropping,this),Wu.DomEvent.on(document,"dragleave",this.undropping,this),Wu.DomEvent.on(document,"dragover",this.dragover,this),Wu.DomEvent.on(document,"drop",this.dropped,this)},disableFullscreenDZ:function(){Wu.DomEvent.off(document,"dragenter",this.dropping,this),Wu.DomEvent.off(document,"dragleave",this.undropping,this),Wu.DomEvent.off(document,"dragover",this.dragover,this),Wu.DomEvent.off(document,"drop",this.dropped,this)},refreshDZ:function(){var a=this;this.dz.removeAllListeners(),this.dz.options.params.project=this.project.uuid,this.dz.on("drop",function(){console.log("drop")}),this.dz.on("dragenter",function(){console.log("dragenter")}),this.dz.on("addedfile",function(){a.filecount+=1,a.progress.style.opacity=1,a._fulldrop||(a.fullOn(),a.fullUpOn())}),this.dz.on("complete",function(b){console.log("complete"),a.filecount-=1,a.dz.removeFile(b)}),this.dz.on("uploadprogress",function(b,c){a.progress.style.width=c+"%"}),this.dz.on("success",function(b,c){var d=Wu.parse(c);d&&a.uploaded(d)}),this.dz.on("complete",function(b){console.log("complete!",b),console.log("filecount: ",a.filecount),a.filecount||(a.progress.style.opacity=0,a.progress.style.width="0%",a.fullUpOff(),a.fulldropOff(),a._fulldrop=!1)})},fullUpOn:function(){Wu.DomUtil.addClass(this.fulldrop,"fullscreen-dropped")},fullUpOff:function(){Wu.DomUtil.removeClass(this.fulldrop,"fullscreen-dropped")},fulldropOn:function(a){this.fullOn(),this._fulldrop=a.target.className},fulldropOff:function(){this.fullOff()},fullOn:function(){this.fulldrop.style.opacity=.9,this.fulldrop.style.zIndex=1e3},fullOff:function(){var a=this;this.fulldrop.style.opacity=0,setTimeout(function(){a.fulldrop.style.zIndex=-10},200)},dropping:function(a){a.preventDefault(),this.fulldropOn(a)},undropping:function(a){a.preventDefault();var b=a.target.className;b==this._fulldrop&&this.fulldropOff(a)},dropped:function(a){a.preventDefault(),this.fullUpOn(),this.dz.drop(a)},dragover:function(a){a.preventDefault()},handleError:function(a){console.log("handling error");var b="";a.forEach(function(a){b+=a.error,b+="<br>"}),this._errors.innerHTML=b,this._errors.style.display="block"},uploaded:function(a){console.log("uploaded:"),console.log("file: ",a),a.errors.length>0&&this.handleError(a.errors),a.files&&a.files.forEach(function(a){this.addFile(a),this.project.files.push(a)},this)},addFile:function(a){var b=Wu.extend({},a);b.name=ich.datalibraryTablerowName({name:b.name||"Title",description:b.description||"Description",nameUuid:"name-"+b.uuid,descUuid:"description-"+b.uuid}),b.files=b.files.join(", "),b.keywords=b.keywords.join(", "),b.createdDate=new Date(b.createdDate).toDateString();var c=this.list.add(b);c[0].elm.id=b.uuid;var d=c[0].elm.children[0].children[0].children;d[0].id="checkbox-"+b.uuid,d[1].setAttribute("for","checkbox-"+b.uuid),this.addEditHooks(b.uuid)},addEditHooks:function(a){var b=Wu.DomUtil.get("name-"+a),c=Wu.DomUtil.get("description-"+a);Wu.DomEvent.on(b,"mousedown mouseup click",this.stop,this),Wu.DomEvent.on(b,"dblclick",this.rename,this),Wu.DomEvent.on(c,"mousedown mouseup click",this.stop,this),Wu.DomEvent.on(c,"dblclick",this.rename,this)},stop:function(a){console.log("stop!"),a.preventDefault(),a.stopPropagation()},rename:function(a){a.target.removeAttribute("readonly"),a.target.focus(),a.target.fieldKey=a.target.id.split("-")[0],Wu.DomEvent.on(a.target,"blur",this.editBlur,this),Wu.DomEvent.on(a.target,"keydown",this.editKey,this)},editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},editBlur:function(a){var b=a.target.fieldKey;a.target.setAttribute("readonly","readonly");var c=a.target.id.replace(b+"-",""),d=a.target.value||a.target.innerHTML;this.project.files.forEach(function(a){a.uuid==c&&(a[b]=d)},this),this.list.update(),this._save(c,b)},_save:function(a,b){this.project.files.forEach(function(c){if(c.uuid==a){var d={};d[b]=c[b],d.uuid=c.uuid;var e=JSON.stringify(d);Wu.save("/api/file/update",e)}})},updateContent:function(){this.update()},update:function(){this.project=Wu.app._activeProject,this.reset(),this.refreshDZ(),this.refreshTable()},refreshTable:function(){this.project.files&&(this.project.files.forEach(function(a){this.addFile(a)},this),this.list.sort("name",{order:"asc"}))},reset:function(){this.list.clear(),this.fullOff(),this.fulldropOff()}}),Wu.SidePane.Users=Wu.SidePane.Item.extend({type:"users",title:"Users"}),Wu.SidePane.Layers=Wu.SidePane.Item.extend({type:"layers",initContent:function(){this._container.innerHTML=ich.layersWrapper(),this._layersWrapper=Wu.DomUtil.get("layers-wrapper"),this._libaryWrapper=Wu.DomUtil.get("layers-library-browser"),this._layerList=Wu.DomUtil.get("layers-library-list"),this._browserLibrary=Wu.DomUtil.get("layers-library-browser-datalayers"),this._browserMapbox=Wu.DomUtil.get("layers-library-browser-mapbox"),this._libraryPane=Wu.DomUtil.get("layers-library"),this._mapboxPane=Wu.DomUtil.get("layers-mapbox"),this._mapboxImportOk=Wu.DomUtil.get("import-mapbox-layers-ok"),this._mapboxImportInput=Wu.DomUtil.get("import-mapbox-layers"),this._mapboxList=Wu.DomUtil.get("layers-mapbox-list-wrap"),this._mapboxConnectDrop=Wu.DomUtil.get("editor-layers-connect-mapbox-more"),this._mapboxConnectDropp=Wu.DomUtil.get("editor-layers-connect-mapbox"),this._datalibUploadDrop=Wu.DomUtil.get("editor-layers-upload-more"),this._datalibUploadDropp=Wu.DomUtil.get("editor-layers-upload"),this._middleItem=Wu.DomUtil.create("div","middle-item"),this._middleItem.innerHTML="Menu Folder",this._layersWrapper.insertBefore(this._middleItem,this._libraryPane)},addHooks:function(){Wu.DomEvent.on(this._browserMapbox,"mousedown",this.selectBrowserMapbox,this),Wu.DomEvent.on(this._browserLibrary,"mousedown",this.selectBrowserLibrary,this),Wu.DomEvent.on(this._mapboxImportOk,"mousedown",this.importMapboxAccount,this),Wu.DomEvent.on(this._mapboxImportInput,"keydown",this.mapboxInputKeydown,this),Wu.DomEvent.on(this._mapboxConnectDrop,"mousedown",this.toggleDropdown,this),Wu.DomEvent.on(this._datalibUploadDrop,"mousedown",this.toggleDropdown,this),Wu.DomEvent.on(this._middleItem,"mousedown",this.addMenuFolder,this)},addMenuFolder:function(){console.log("adding menu folder!");var a={fuuid:"layermenuFolder-"+Wu.Util.guid(),title:"New folder",layerType:"menufolder",pos:2};Wu.app.MapPane.layerMenu.addMenuFolder(a),this.project.layermenu.push(a),console.log("====mb=> pushing to layermenu",a),console.log("this.project.layermenu",this.project.layermenu),this.project._update("layermenu")},toggleDropdown:function(a){var b=a.target.nextElementSibling;Wu.DomUtil.hasClass(b,"hide")?(Wu.DomUtil.removeClass(b,"hide"),Wu.DomUtil.addClass(a.target,"rotate180")):(Wu.DomUtil.addClass(b,"hide"),Wu.DomUtil.removeClass(a.target,"rotate180"))},mapboxInputKeydown:function(a){(13==event.which||13==event.keyCode)&&(a.target.blur(),this.getMapboxAccount())},selectBrowserMapbox:function(){this._mapboxPane.style.display="block",this._libraryPane.style.display="none"},selectBrowserLibrary:function(){this._mapboxPane.style.display="none",this._libraryPane.style.display="block"},update:function(a){var a=this.project||a;this.updateContent(a)},updateContent:function(a){this._reset(),this.project=a,this._update()},_update:function(){this.initLayers(),this.initMapboxLayers(),this.markActiveLayers()},_reset:function(){this._layerList.innerHTML="",this._mapboxList.innerHTML="",this.mapboxFiles={},this.mapboxUsers={},this.selectBrowserLibrary()},markActiveLayers:function(){this.project.layermenu.forEach(function(a){if("datalibrary"==a.layerType){var b="layerItem-"+a.fuuid,c=Wu.DomUtil.get(b).parentNode;Wu.DomUtil.addClass(c,"active-layer")}else if("mapbox"==a.layerType){var b="layerMapboxItem-"+a.fuuid,c=Wu.DomUtil.get(b).parentNode;Wu.DomUtil.addClass(c,"active-layer")}},this)},initMapboxLayers:function(){this.parseMapboxLayers(),this.updateMapboxDOM()},initLayers:function(){var a=[];this.project.files.forEach(function(b){"layer"==b.type&&(a.push(b),this.addLayer(b))},this),this.initDraggable()},resetDraggable:function(){var a=Wu.DomUtil.get("layer-menu-inner-content");a&&(Wu.DomEvent.off(a,"dragover",this.drag.over,this),Wu.DomEvent.off(a,"dragleave",this.drag.leave,this),Wu.DomEvent.off(a,"drop",this.drag.drop,this))},drag:{start:function(a){var b=a.target;console.log("drag start: ",a),a.dataTransfer.setData("uuid",b.id)},drop:function(a){a.stopPropagation&&a.stopPropagation();var b=document.getElementById(a.dataTransfer.getData("uuid")),c=b.getAttribute("fuuid"),d=b.getAttribute("type");return this.addLayerToMenu(c,d),Wu.DomUtil.removeClass(Wu.DomUtil.get("layer-menu-inner-content"),"over"),!1},over:function(a){return a.preventDefault&&a.preventDefault(),Wu.DomUtil.addClass(Wu.DomUtil.get("layer-menu-inner-content"),"over"),!1},leave:function(){Wu.DomUtil.removeClass(Wu.DomUtil.get("layer-menu-inner-content"),"over")}},initDraggable:function(){this.resetDraggable();for(var a=document.getElementsByClassName("layer-item"),b=0;b<a.length;b++){var c=a[b];c.setAttribute("draggable","true"),c.id=Wu.Util.guid(),Wu.DomEvent.on(c,"dragstart",this.drag.start,this)}var d=Wu.DomUtil.get("layer-menu-inner-content");d&&(Wu.DomEvent.on(d,"dragover",this.drag.over,this),Wu.DomEvent.on(d,"dragleave",this.drag.leave,this),Wu.DomEvent.on(d,"drop",this.drag.drop,this))},removeLayerFromMenu:function(a,b){console.log("__________removeLayerFromMenu_____________",a,b),console.log("this.project.layermenu",this.project.layermenu);var c=_.findIndex(this.project.layermenu,{fuuid:a});if(0>!c)var c=_.findIndex(this.project.layermenu,{id:a});this.project.layermenu.splice(c,1),Wu.app.MapPane.layerMenu.remove(a),this.project._update("layermenu"),console.log("____end______removeLayerFromMenu______end_______")},addLayerToMenu:function(a,b){if("datalibrary"==b){var c=this.getFileFromUuid(a);console.log("dl file: ",c),Wu.app.MapPane.layerMenu.addFromFile(c);var d="layerItem-"+a,e=Wu.DomUtil.get(d).parentNode;Wu.DomUtil.addClass(e,"active-layer");var f={fuuid:c.uuid,title:c.name,pos:1,layerType:"datalibrary"};return this.project.layermenu.push(f),console.log("====mb=> pushing to layermenu",f),console.log("this.project.layermenu",this.project.layermenu),void this.project._update("layermenu")}if("mapbox"==b){console.log("this.mapboxLayers: ",this.mapboxLayers);var g=[];for(l in this.mapboxLayers){var h=this.mapboxLayers[l];h.forEach(function(b){b.id==a&&(g=b)})}if(!g)return void console.log("that layer is not here????");Wu.app.MapPane.layerMenu.addFromMapbox(g);var d="layerMapboxItem-"+a,e=Wu.DomUtil.get(d).parentNode;Wu.DomUtil.addClass(e,"active-layer");var f={fuuid:g.id,title:g.name,pos:1,layerType:"mapbox"};return this.project.layermenu.push(f),console.log("====mb=> pushing to layermenu",f),void this.project._update("layermenu")}},getFileFromUuid:function(a){var b={};return this.project.files.forEach(function(c){a==c.uuid&&(b=c)},this),b},addLayer:function(a){var b=Wu.DomUtil.create("div","layer-item");b.setAttribute("draggable",!0),b.setAttribute("fuuid",a.uuid),b.setAttribute("type","datalibrary"),b.innerHTML=ich.layersItem(a),this._layerList.appendChild(b),Wu.DomEvent.on(b,"click",this.toggleLayer,this)},_activate:function(){Wu.SidePane.Item.prototype._activate.call(this),this.update()},importMapboxAccount:function(){var a=this._mapboxImportInput.value;this.getMapboxAccount(a),this._mapboxImportInput.value=""},getMapboxAccount:function(a){var b={username:a,projectId:this.project.uuid};Wu.post("/api/util/getmapboxaccount",JSON.stringify(b),this.gotMapboxAccount,this)},parseMapboxLayers:function(a,b){var a=a||this.project.mapboxLayers;this.mapboxLayers=this.mapboxLayers||{},a.forEach(function(a){this.mapboxLayers[a.username]=this.mapboxLayers[a.username]||[],this.mapboxLayers[a.username].push(a),b&&this.project.mapboxLayers.push(a)},this),this.removeMapboxDuplicates()},removeMapboxDuplicates:function(){this.project.mapboxLayers=_.uniq(this.project.mapboxLayers);for(a in this.mapboxLayers)this.mapboxLayers[a]=_.uniq(this.mapboxLayers[a])},gotMapboxAccount:function(a,b){var c=JSON.parse(b);return c?(a.parseMapboxLayers(c,!0),a.updateMapboxDOM(),void a.project._update("mapboxLayers")):void console.log("seems empty")},updateMapboxDOM:function(){console.log("updateMapboxDOM; this.mapboxLayers: ",this.mapboxLayers),this._mapboxList.innerHTML="";for(account in this.mapboxLayers){var a=Wu.DomUtil.create("div","mapbox-list-item");a.innerHTML=ich.mapboxListWrapper({name:account}),this._mapboxList.appendChild(a);var b=Wu.DomUtil.get("layers-mapbox-list-"+account),c=this.mapboxLayers[account];c.forEach(function(a){var c=Wu.DomUtil.create("div","layer-item");c.setAttribute("draggable",!0),c.setAttribute("fuuid",a.id),c.setAttribute("type","mapbox"),c.innerHTML=ich.layersMapboxItem(a),b.appendChild(c),Wu.DomEvent.on(c,"click",this.toggleLayer,this)},this)}this.initDraggable()},toggleLayer:function(a){var b=a.target,c=b.getAttribute("fuuid"),d=b.getAttribute("type");if(!c&&!d)var b=a.target.parentNode,c=b.getAttribute("fuuid"),d=b.getAttribute("type");var e=_.find(this.project.layermenu,{fuuid:c});e?(this.removeLayerFromMenu(c),Wu.DomUtil.removeClass(b,"active-layer")):this.addLayerToMenu(c,d)},save:function(){}});