function injectCSS(){colorTheme=JSON.parse(savedCSS);for(var a="",b=0;b<colorTheme.css.length;b++)colorTheme.css[b].value&&(a+=colorTheme.css[b].classes.join()+" { "+colorTheme.css[b].pre+": "+colorTheme.css[b].value+" !important } ");jcss.innerHTML=a}function startColorThemes(){function a(){e(),D._dark1=Wu.DomUtil.get("colortheme-dark1"),D._dark2=Wu.DomUtil.get("colortheme-dark2"),D._dark3=Wu.DomUtil.get("colortheme-dark3"),D._light1=Wu.DomUtil.get("colortheme-light1"),D._darktheme=Wu.DomUtil.get("darktheme"),D._lighttheme=Wu.DomUtil.get("lighttheme"),D._color_Inner_wrapper=Wu.DomUtil.get("project-color-theme").parentNode,D._color_Outer_wrapper=Wu.DomUtil.get("project-color-theme").parentNode.parentNode,D._advanced=Wu.DomUtil.get("advanced-theme-selector"),D._color_Inner_wrapper.style.left="-310px",D._color_Outer_wrapper.style.height="182px",D._dark1.onclick=function(){Wu.DomUtil.addClass(D._light1,"colortheme-light1-on"),d("one")},D._dark2.onclick=function(){Wu.DomUtil.addClass(D._light1,"colortheme-light1-on"),d("two")},D._dark3.onclick=function(){Wu.DomUtil.addClass(D._light1,"colortheme-light1-on"),d("three")},D._darktheme.onclick=function(){Wu.DomUtil.addClass(this,"selected"),Wu.DomUtil.removeClass(D._lighttheme,"selected"),colorTheme.darktheme=!0,d(colorTheme.cTheme)},D._lighttheme.onclick=function(){Wu.DomUtil.addClass(this,"selected"),Wu.DomUtil.removeClass(D._darktheme,"selected"),colorTheme.darktheme=!1,d(colorTheme.cTheme)},D._advanced.onclick=function(){H.init(),Wu.DomUtil.removeClass(D._light1,"colortheme-light1-on")}}function d(a){if("one"==a)if(colorTheme.cTheme="one",colorTheme.darktheme)preval_0="#0F1A1E",preval_1="#3F4652",preval_2="#97ABB2",preval_3="#424242",preval_4="cyan",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="#333",preval_13="white",preval_15="white",preval_16="#333",preval_17="rgba(255, 255, 255, 0.15)",preval_18="white",colorTheme.cThemeDarkBox=!0,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!0;else{var b={},c={},d="#ADC3CC";F.convert.HEX2RGB(d,b),F.convert.RGB2HSV(b,c);var e=F.convert.HSV2HEX(c.h,3,98);F.convert.HEX2RGB(d,b);var f="rgba("+b.r+","+b.g+","+b.b+",0.5)";preval_0=d,preval_1=e,preval_2="red",preval_3="white",preval_4="#309EB2",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="white",preval_13="black",preval_15="#333",preval_16="white",preval_17=f,preval_18=d,colorTheme.cThemeDarkBox=!1,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!1}if("two"==a)if(colorTheme.cTheme="two",colorTheme.darktheme)preval_0="#0F1A1E",preval_1="#2C3A3F",preval_2="#A6B7BF",preval_3="#424242",preval_4="#FF5300",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#F98752",preval_9="#FCF2ED",preval_10="white",preval_11="white",preval_12="#333",preval_13="white",preval_15="white",preval_16="#333",preval_17="rgba(255, 255, 255, 0.15)",preval_18="white",colorTheme.cThemeDarkBox=!0,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!0;else{var b={},c={},d="#CCBFAD";F.convert.HEX2RGB(d,b),F.convert.RGB2HSV(b,c);var e=F.convert.HSV2HEX(c.h,3,98);F.convert.HEX2RGB(d,b);var f="rgba("+b.r+","+b.g+","+b.b+",0.5)";preval_0=d,preval_1=e,preval_2="red",preval_3="white",preval_4="#2B889E",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="white",preval_13="black",preval_15="#333",preval_16="white",preval_17=f,preval_18=d,colorTheme.cThemeDarkBox=!1,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!1}if("three"==a)if(colorTheme.cTheme="three",colorTheme.darktheme)preval_0="#0F1A1E",preval_1="#333333",preval_2="#A6A6A6",preval_3="#424242",preval_4="#FF00AA",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="#333",preval_13="white",preval_15="white",preval_16="#333",preval_17="rgba(255, 255, 255, 0.15)",preval_18="white",colorTheme.cThemeDarkBox=!0,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!0;else{var b={},c={},d="#BCBCBC";F.convert.HEX2RGB(d,b),F.convert.RGB2HSV(b,c);var e=F.convert.HSV2HEX(c.h,0,98);F.convert.HEX2RGB(d,b);var f="rgba("+b.r+","+b.g+","+b.b+",0.5)";preval_0=d,preval_1=e,preval_2="red",preval_3="white",preval_4="#AE2B95",preval_5="#63A3A0",preval_6="#CCE2E1",preval_7="#EDF4F4",preval_8="#B80077",preval_9="#F7E1EF",preval_10="white",preval_11="white",preval_12="white",preval_13="black",preval_15="#333",preval_16="white",preval_17=f,preval_18=d,colorTheme.cThemeDarkBox=!1,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkMenu=!1}colorTheme.css[3].value=preval_3,colorTheme.css[4].value=preval_4,colorTheme.css[5].value=preval_5,colorTheme.css[6].value=preval_6,colorTheme.css[7].value=preval_7,colorTheme.css[8].value=preval_8,colorTheme.css[9].value=preval_9,colorTheme.cThemeDarkMenu?j(preval_1):k(preval_1),colorTheme.cThemeDarkBox?(colorTheme.css[14].value="rgba(0,0,0,0.7)",colorTheme.css[31].value="-56px 8px"):(colorTheme.css[14].value="rgba(255, 255, 255, 0.7)",colorTheme.css[31].value=""),colorTheme.cThemeDarkHeader?(colorTheme.css[15].value="rgba(0,0,0,0.8)",colorTheme.css[16].value="white"):(colorTheme.css[15].value="rgba(255,255,255,0.92)",colorTheme.css[16].value="#333"),colorTheme.css[10].value=preval_10,F.update.CSSstring(),jcss.innerHTML=w}function e(){D._hexColor=Wu.DomUtil.get("hexColor"),D._rChannel=Wu.DomUtil.get("rChannel"),D._gChannel=Wu.DomUtil.get("gChannel"),D._bChannel=Wu.DomUtil.get("bChannel"),D._hChannel=Wu.DomUtil.get("hChannel"),D._sChannel=Wu.DomUtil.get("sChannel"),D._vChannel=Wu.DomUtil.get("vChannel"),D._hexColor.onblur=function(){F.update.HEX(D._hexColor.value),F.update.inputFields("HEX")},D._rChannel.onblur=function(){F.update.RGB(o),F.update.inputFields("RGB")},D._gChannel.onblur=function(){F.update.RGB(o),F.update.inputFields("RGB")},D._bChannel.onblur=function(){F.update.RGB(o),F.update.inputFields("RGB")},D._hChannel.onblur=function(){F.update.HSV(p),F.update.inputFields("HSV")},D._sChannel.onblur=function(){F.update.HSV(p),F.update.inputFields("HSV")},D._vChannel.onblur=function(){F.update.HSV(p),F.update.inputFields("HSV")}}function f(){v.complimentary=[],v.complimentary[0]="#complimentary_swatch_0 { background-color: "+A[0][0].HEX+" !important }",v.complimentary[1]="#complimentary_swatch_1 { background-color: "+A[1][0].HEX+" !important }",v.complimentary[2]="#complimentary_swatch_2 { background-color: "+A[2][0].HEX+" !important }",v.complimentary[3]="#complimentary_swatch_3 { background-color: "+A[3][0].HEX+" !important }",v.matching=[],v.matching[0]="#matching_swatch_0 { background-color: "+B[0][0].HEX+" !important }",v.matching[1]="#matching_swatch_1 { background-color: "+B[1][0].HEX+" !important }",v.matching[2]="#matching_swatch_2 { background-color: "+B[2][0].HEX+" !important }",v.matching[3]="#matching_swatch_3 { background-color: "+B[3][0].HEX+" !important }",v.matching[4]="#matching_swatch_4 { background-color: "+B[4][0].HEX+" !important }",v.dark=[],v.dark[0]="#dark_swatch_0 { background-color: "+y[0][0].HEX+" !important }",v.dark[1]="#dark_swatch_1 { background-color: "+y[1][0].HEX+" !important }",v.dark[2]="#dark_swatch_2 { background-color: "+y[2][0].HEX+" !important }",v.dark[3]="#dark_swatch_3 { background-color: "+y[3][0].HEX+" !important }",v.dark[4]="#dark_swatch_4 { background-color: "+y[4][0].HEX+" !important }",v.dark[5]="#dark_swatch_5 { background-color: "+y[5][0].HEX+" !important }",v.light=[],v.light[0]="#light_swatch_0 { background-color: "+x[0][0].HEX+" !important }",v.light[1]="#light_swatch_1 { background-color: "+x[1][0].HEX+" !important }",v.light[2]="#light_swatch_2 { background-color: "+x[2][0].HEX+" !important }",v.light[3]="#light_swatch_3 { background-color: "+x[3][0].HEX+" !important }",v.light[4]="#light_swatch_4 { background-color: "+x[4][0].HEX+" !important }",v.light[5]="#light_swatch_5 { background-color: "+x[5][0].HEX+" !important }",v.bright=[],v.bright[0]="#bright_swatch_0 { background-color: "+z[0][0].HEX+" !important }",v.bright[1]="#bright_swatch_1 { background-color: "+z[1][0].HEX+" !important }",v.bright[2]="#bright_swatch_2 { background-color: "+z[2][0].HEX+" !important }",v.bright[3]="#bright_swatch_3 { background-color: "+z[3][0].HEX+" !important }",v.bright[4]="#bright_swatch_4 { background-color: "+z[4][0].HEX+" !important }",v.bright[5]="#bright_swatch_5 { background-color: "+z[5][0].HEX+" !important }",v.bright[6]="#bright_swatch_6 { background-color: "+z[6][0].HEX+" !important }",v.bright[7]="#bright_swatch_7 { background-color: "+z[7][0].HEX+" !important }",v.bright[8]="#bright_swatch_8 { background-color: "+z[8][0].HEX+" !important }",v.bright[9]="#bright_swatch_9 { background-color: "+z[9][0].HEX+" !important }",v.bright[10]="#bright_swatch_10 { background-color: "+z[10][0].HEX+" !important }";var a="";a+=v.dark.join(" "),a+=v.light.join(" "),a+=v.complimentary.join(" "),a+=v.matching.join(" "),a+=v.bright.join(" "),m.innerHTML=a}function h(a,b){"light"==a&&(colorTheme.cThemeDarkMenu=!1),"dark"==a&&(colorTheme.cThemeDarkMenu=!0),l(),1==u&&("light"==a&&(k(x[b][0].HEX),D._hexColor.value=x[b][0].HEX),"dark"==a&&(j(y[b][0].HEX),D._hexColor.value=y[b][0].HEX)),2==u&&("complimentary"==a&&(colorTheme.css[5].value=A[b][0].HEX,colorTheme.css[6].value=A[b][3].HEX,colorTheme.css[7].value=A[b][4].HEX,D._hexColor.value=A[b][0].HEX),"matching"==a&&(colorTheme.css[5].value=B[b][0].HEX,colorTheme.css[6].value=B[b][2].HEX,colorTheme.css[7].value=B[b][4].HEX,D._hexColor.value=B[b][0].HEX)),3==u&&("complimentary"==a&&(colorTheme.css[8].value=A[b][0].HEX,colorTheme.css[9].value=A[b][4].HEX,D._hexColor.value=A[b][0].HEX),"matching"==a&&(colorTheme.css[8].value=B[b][0].HEX,colorTheme.css[9].value=B[b][4].HEX,D._hexColor.value=B[b][0].HEX)),4==u&&"bright"==a&&(colorTheme.css[4].value=z[b][0].HEX,D._hexColor.value=z[b][0].HEX),F.update.inputFields("HEX"),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.CSSstring(),jcss.innerHTML=w}function j(a){var b=new Object,c=new Object;F.convert.HEX2RGB(a,b),F.convert.RGB2HSV(b,c);var d=c.h,e=F.convert.HSV2HEX(d,50,12),f=F.convert.HSV2HEX(d,30,25),g=F.convert.HSV2HEX(d,15,70);colorTheme.css[0].value=e,colorTheme.css[1].value=f,colorTheme.css[2].value=g,colorTheme.css[11].value="#666",colorTheme.css[12].value="#FFF",colorTheme.css[13].value="#FFFFFF",colorTheme.css[17].value="",colorTheme.css[18].value="white",colorTheme.css[19].value="",colorTheme.css[20].value="",colorTheme.css[22].value="",colorTheme.css[23].value="",colorTheme.css[24].value="",colorTheme.css[25].value="",colorTheme.css[26].value="",colorTheme.css[27].value="",colorTheme.css[28].value="",colorTheme.css[32].value="white",colorTheme.css[33].value="black",colorTheme.css[34].value="rgba(0,0,0,0.4)"}function k(a){var b=new Object,c=new Object;F.convert.HEX2RGB(a,b),F.convert.RGB2HSV(b,c);var d=c.h,e=F.convert.HSV2HEX(d,15,80),f=F.convert.HSV2HEX(d,1,99),g=F.convert.HSV2HEX(d,30,25),b={};F.convert.HEX2RGB(e,b);var h="rgba("+b.r+","+b.g+","+b.b+",0.5)",i="rgba("+b.r+","+b.g+","+b.b+",0.25)",j=d+150;j>360&&(j-=360);var k=F.convert.HSV2HEX(j,20,60);colorTheme.css[0].value=e,colorTheme.css[1].value=f,colorTheme.css[2].value=g,colorTheme.css[11].value="#FFFFFF",colorTheme.css[12].value="#FFFFFF",colorTheme.css[13].value="#666",colorTheme.css[17].value=h,colorTheme.css[18].value=e,colorTheme.css[19].value=h,colorTheme.css[20].value=i,colorTheme.css[22].value="transparent",colorTheme.css[23].value="#666",colorTheme.css[24].value="white",colorTheme.css[25].value="rgba(0, 0, 0, 0.5)",colorTheme.css[26].value="rgba(0, 0, 0, 0.1)",colorTheme.css[27].value="600",colorTheme.css[28].value="200",colorTheme.css[32].value=k,colorTheme.css[33].value="white",colorTheme.css[34].value="rgba(0,0,0,0.6)"}function l(){colorTheme.cThemeDarkMenu?(Wu.DomUtil.addClass(D._tickMenuDark,"active-toggle"),Wu.DomUtil.removeClass(D._tickMenuLight,"active-toggle")):(Wu.DomUtil.addClass(D._tickMenuLight,"active-toggle"),Wu.DomUtil.removeClass(D._tickMenuDark,"active-toggle"))}var m,n,o,p,q=!0,s=!1,t=!1,u=!1,v={},w="",x=[],y=[],z=[],A=[],B=[],C=[],D={},E=[];colorTheme.darktheme=!0,colorTheme.cTheme=!1,colorTheme.cThemeDarkMenu=!0,colorTheme.cThemeDarkHeader=!1,colorTheme.cThemeDarkBox=!1,(!colorTheme.css||q)&&(colorTheme.css=[]),m=document.createElement("style"),m.setAttribute("type","text/css"),m.setAttribute("rel","stylesheet"),_CTheader.appendChild(m);var F={HSVobject:function(a,b,c){this.h=a,this.s=b,this.v=c,this.validate=function(){this.h<=0&&(this.h=0),this.s<=0&&(this.s=0),this.v<=0&&(this.v=0),this.h>360&&(this.h=360),this.s>100&&(this.s=100),this.v>100&&(this.v=100)}},RGBobject:function(a,b,c){this.r=a,this.g=b,this.b=c,this.validate=function(){this.r<=0&&(this.r=0),this.g<=0&&(this.g=0),this.b<=0&&(this.b=0),this.r>255&&(this.r=255),this.g>255&&(this.g=255),this.b>255&&(this.b=255)}},convert:{hexify:function(a){var b="0123456789ABCDEF",c=a%16,d=(a-c)/16,e=b.charAt(d)+b.charAt(c);return e},decimalize:function(a){var b="0123456789ABCDEF";return 16*b.indexOf(a.charAt(0).toUpperCase())+b.indexOf(a.charAt(1).toUpperCase())},HEX2RGB:function(a,b){b.r=this.decimalize(a.substring(1,3)),b.g=this.decimalize(a.substring(3,5)),b.b=this.decimalize(a.substring(5,7))},RGB2HEX:function(a){return"#"+this.hexify(a.r)+this.hexify(a.g)+this.hexify(a.b)},RGB2HSV:function(a,c){r=a.r/255,g=a.g/255,b=a.b/255;var d=Math.min(r,g,b),e=Math.max(r,g,b),f=e-d;if(c.v=e,0==f)c.h=0,c.s=0;else{c.s=f/e;var h=((e-r)/6+f/2)/f,i=((e-g)/6+f/2)/f,j=((e-b)/6+f/2)/f;r==e?c.h=j-i:g==e?c.h=1/3+h-j:b==e&&(c.h=2/3+i-h),c.h<0&&(c.h+=1),c.h>1&&(c.h-=1)}c.h*=360,c.s*=100,c.v*=100},HSV2RGB:function(a,b){var c=a.h/360,d=a.s/100,e=a.v/100;0==d?(b.r=255*e,b.g=255*e,b.b=255*e):(var_h=6*c,var_i=Math.floor(var_h),var_1=e*(1-d),var_2=e*(1-d*(var_h-var_i)),var_3=e*(1-d*(1-(var_h-var_i))),0==var_i?(var_r=e,var_g=var_3,var_b=var_1):1==var_i?(var_r=var_2,var_g=e,var_b=var_1):2==var_i?(var_r=var_1,var_g=e,var_b=var_3):3==var_i?(var_r=var_1,var_g=var_2,var_b=e):4==var_i?(var_r=var_3,var_g=var_1,var_b=e):(var_r=e,var_g=var_1,var_b=var_2),b.r=255*var_r,b.g=255*var_g,b.b=255*var_b)},HSV2HEX:function(a,b,c){var d=new F.RGBobject,e=new F.HSVobject(a,b,c);e.validate(),this.HSV2RGB(e,d);var f=this.RGB2HEX(d);return f}},update:{CSSstring:function(){w="";for(var a=0;a<colorTheme.css.length;a++)colorTheme.css[a].value&&(w+=colorTheme.css[a].classes.join()+" { "+colorTheme.css[a].pre+": "+colorTheme.css[a].value+" !important } ");savedCSS=JSON.stringify(colorTheme),Wu.app._activeProject&&Wu.app._activeProject.saveColorTheme()},makeComplimentary:function(a){D._yourswatch.style.backgroundColor=a;var b=a,c=new F.RGBobject(0,0,0),d=new F.HSVobject(0,0,0);F.convert.HEX2RGB(b,c),F.convert.RGB2HSV(c,d),F.sliders.updateAllSliders(c,d),A[0]=[],A[0][0]={},A[0][0].HEX=a,A[0][0].RGB={r:c.r,g:c.g,b:c.b},A[0][0].HSV={h:d.h,s:d.s,v:d.v};for(var e=(360-A[0][0].HSV.h,0);4>e;e++){var f=A[0][0].HSV.h+90*e;f>360&&(f-=360),f=Math.floor(f),d.h=f,d.s=A[0][0].HSV.s,d.v=A[0][0].HSV.v,A[e]=[],A[e][0]={},F.convert.HSV2RGB(d,c);var g=F.convert.RGB2HEX(c);A[e][0].HEX=g,A[e][0].RGB={r:c.r,g:c.g,b:c.b},A[e][0].HSV={h:d.h,s:d.s,v:d.v},this.colorGrade(A,e,d)}},matchColors:function(){o=A[0][0].RGB,p=A[0][0].HSV,F.cMatch.domatch(p),this.colorGrade(B,0,B[0][0].HSV),this.colorGrade(B,1,B[1][0].HSV),this.colorGrade(B,2,B[2][0].HSV),this.colorGrade(B,3,B[3][0].HSV),this.colorGrade(B,4,B[4][0].HSV)},colorGrade:function(a,b,c){for(var d=0;6>d;d++){var e=new F.RGBobject(0,0,0),f=c.v,g=100-f,h=g/6;c.v=Math.floor(f+h*d);var i=c.s,j=i/6;c.s=Math.floor(i-j*d),F.convert.HSV2RGB(c,e);var k=F.convert.RGB2HEX(e);a[b][d]={},a[b][d].HEX=k,a[b][d].RGB={r:e.r,g:e.g,b:e.b},a[b][d].HSV={h:c.h,s:c.s,v:c.v}}},RGB:function(a){var b=new F.HSVobject(0,0,0);F.convert.RGB2HSV(a,b),D._hexColor.value=F.convert.RGB2HEX(a),D._rChannel.value=Math.round(a.r),D._gChannel.value=Math.round(a.g),D._bChannel.value=Math.round(a.b),D._hChannel.value=Math.round(b.h),D._sChannel.value=Math.round(b.s),D._vChannel.value=Math.round(b.v)},HSV:function(a){var b=new F.RGBobject(0,0,0);F.convert.HSV2RGB(a,b),D._hexColor.value=F.convert.RGB2HEX(b),D._rChannel.value=Math.round(b.r),D._gChannel.value=Math.round(b.g),D._bChannel.value=Math.round(b.b),D._hChannel.value=Math.round(a.h),D._sChannel.value=Math.round(a.s),D._vChannel.value=Math.round(a.v)},HEX:function(a){var b=new F.RGBobject(0,0,0),c=new F.HSVobject(0,0,0);F.convert.HEX2RGB(a,b),F.convert.RGB2HSV(b,c),D._rChannel.value=Math.round(b.r),D._gChannel.value=Math.round(b.g),D._bChannel.value=Math.round(b.b),D._hChannel.value=Math.round(c.h),D._sChannel.value=Math.round(c.s),D._vChannel.value=Math.round(c.v)},inputFields:function(a){var b=new Object,c=new Object;if("HEX"==a){var d=D._hexColor.value;F.convert.HEX2RGB(d,b),F.convert.RGB2HSV(b,c),D._rChannel.value=Math.floor(b.r),D._gChannel.value=Math.floor(b.g),D._bChannel.value=Math.floor(b.b),D._hChannel.value=Math.floor(c.h),D._sChannel.value=Math.floor(c.s),D._vChannel.value=Math.floor(c.v)}if("RGB"==a){b.r=D._rChannel.value,b.g=D._gChannel.value,b.b=D._bChannel.value,F.convert.RGB2HSV(b,c);var d=F.convert.RGB2HEX(b);D._hexColor.value=d,D._hChannel.value=Math.floor(c.h),D._sChannel.value=Math.floor(c.s),D._vChannel.value=Math.floor(c.v)}if("HSV"==a){c.r=D._hChannel.value,c.g=D._sChannel.value,c.b=D._vChannel.value,F.convert.HSV2RGB(c,b);var d=F.convert.RGB2HEX(b);D._hexColor.value=d,D._rChannel.value=Math.floor(b.r),D._gChannel.value=Math.floor(b.g),D._bChannel.value=Math.floor(b.b)}F.sliders.updateAllSliders(b,c)},customColors:function(){if("all"==u){var a=D._hexColor.value;this.makeComplimentary(a),this.matchColors(),f(),colorTheme.cThemeDarkMenu?j(a):k(a),colorTheme.css[4].value=B[2][0].HEX,colorTheme.css[5].value=A[0][0].HEX,colorTheme.css[6].value=A[0][3].HEX,colorTheme.css[7].value=A[0][4].HEX,colorTheme.css[8].value=A[2][0].HEX,colorTheme.css[9].value=A[2][4].HEX}if(1==u){var b={h:parseInt(D._hChannel.value),s:parseInt(D._sChannel.value),v:parseInt(D._vChannel.value)};C[1]=[],this.colorGrade(C,1,b),colorTheme.cThemeDarkMenu?j(C[1][0].HEX):k(C[1][0].HEX)}if(2==u){var b={h:parseInt(D._hChannel.value),s:parseInt(D._sChannel.value),v:parseInt(D._vChannel.value)};C[2]=[],this.colorGrade(C,2,b),colorTheme.css[5].value=C[2][0].HEX,colorTheme.css[6].value=C[2][3].HEX,colorTheme.css[7].value=C[2][4].HEX}if(3==u){var b={h:parseInt(D._hChannel.value),s:parseInt(D._sChannel.value),v:parseInt(D._vChannel.value)};C[3]=[],this.colorGrade(C,3,b),colorTheme.css[8].value=C[3][0].HEX,colorTheme.css[9].value=C[3][4].HEX}if(4==u){var b={h:parseInt(D._hChannel.value),s:parseInt(D._sChannel.value),v:parseInt(D._vChannel.value)};C[4]=[],this.colorGrade(C,4,b),colorTheme.css[4].value=C[4][0].HEX}F.update.CSSstring(),jcss.innerHTML=w}},sliders:{updateAllSliders:function(a,b){"range-slider-1"!=s&&this.slideupdater("range-slider-1","hChannel",360,b,a),"range-slider-2"!=s&&this.slideupdater("range-slider-2","sChannel",100,b,a),"range-slider-3"!=s&&this.slideupdater("range-slider-3","vChannel",100,b,a),"range-slider-r"!=s&&this.slideupdater("range-slider-r","rChannel",255,b,a),"range-slider-g"!=s&&this.slideupdater("range-slider-g","gChannel",255,b,a),"range-slider-b"!=s&&this.slideupdater("range-slider-b","bChannel",255,b,a)},rangeSlider:function(a,b,c){var d,e,f=Wu.DomUtil.get(a),g=f.children[0],h=10,i=!1;g.style.width=h+"px",g.style.left=-h+"px",g.style.marginLeft=h/2+"px";var j=this;f.addEventListener("mousedown",function(f){return d=215,e=150,s=a,i=!0,j.updateDragger(f,g,b,i,e,d,h,c,j),!1}),document.addEventListener("mousemove",function(a){j.updateDragger(a,g,b,i,e,d,h,c,j)}),document.addEventListener("mouseup",function(){i=!1,s=!1})},updateDragger:function(a,b,c,d,e,f,g,h){if(d&&a.pageX>=e&&a.pageX<=e+f&&(b.style.left=a.pageX-e-g+"px","function"==typeof h)){var i=Math.round((a.pageX-e)/f*c);h(i)}},slideupdater:function(a,b,c,d,e){if("range-slider-1"==s||"range-slider-2"==s||"range-slider-3"==s){var f=Wu.DomUtil.get("range-slider-r").children[0],g=Math.floor(e.r*(205/255));f.style.left=g+"px";var h=Wu.DomUtil.get("range-slider-g").children[0],i=Math.floor(e.g*(205/255));h.style.left=i+"px";var j=Wu.DomUtil.get("range-slider-b").children[0],k=Math.floor(e.b*(205/255));j.style.left=k+"px"}if("range-slider-r"==s||"range-slider-g"==s||"range-slider-b"==s){var l=Wu.DomUtil.get("range-slider-1").children[0],m=Math.floor(d.h*(205/360));l.style.left=m+"px";var n=Wu.DomUtil.get("range-slider-2").children[0],o=Math.floor(2.05*d.s);n.style.left=o+"px";var p=Wu.DomUtil.get("range-slider-3").children[0],q=Math.floor(2.05*d.v);p.style.left=q+"px"}if(!s){var r,t=Wu.DomUtil.get(a),u=t.children[0];"hChannel"==b&&(r=d.h),"sChannel"==b&&(r=d.s),"vChannel"==b&&(r=d.v),"rChannel"==b&&(r=e.r),"gChannel"==b&&(r=e.g),"bChannel"==b&&(r=e.b),r>=c&&(r=c);var v=205/c;r=Math.floor(r*v),u.style.left=r+"px"}}},cMatch:{domatch:function(a){var b=a,c=new Object,d=new Object,e=new Object;d.s=b.s,d.h=b.h,d.v=b.v>70?b.v-30:b.v+30;var f=new Object;F.convert.HSV2RGB(d,f),c=f,this.outp("0",c),b.h>=0&&b.h<30&&(e.h=d.h=b.h+30,e.s=d.s=b.s,d.v=b.v,e.v=b.v>70?b.v-30:b.v+30),b.h>=30&&b.h<60&&(e.h=d.h=b.h+150,d.s=this.rc(b.s-30,100),d.v=this.rc(b.v-20,100),e.s=this.rc(b.s-50,100),e.v=this.rc(b.v+20,100)),b.h>=60&&b.h<180&&(e.h=d.h=b.h-40,d.s=e.s=b.s,d.v=b.v,e.v=b.v>70?b.v-30:b.v+30),b.h>=180&&b.h<220&&(e.h=b.h-170,d.h=b.h-160,e.s=d.s=b.s,d.v=b.v,e.v=b.v>70?b.v-30:b.v+30),b.h>=220&&b.h<300&&(e.h=d.h=b.h,e.s=d.s=this.rc(b.s-40,100),d.v=b.v,e.v=b.v>70?b.v-30:b.v+30),b.h>=300&&(d.s=e.s=b.s>50?b.s-40:b.s+40,e.h=d.h=(b.h+20)%360,d.v=b.v,e.v=b.v>70?b.v-30:b.v+30);var f=new Object;F.convert.HSV2RGB(d,f),c=f,this.outp("1",c);var f=new Object;F.convert.HSV2RGB(e,f),c=f,this.outp("2",c),d.h=0,d.s=0,d.v=100-b.v;var f=new Object;F.convert.HSV2RGB(d,f),c=f,this.outp("3",c),d.h=0,d.s=0,d.v=b.v;var f=new Object;F.convert.HSV2RGB(d,f),c=f,this.outp("4",c)},outp:function(a,b){B[a]=[],B[a][0]={},B[a][0].HEX="#"+F.convert.hexify(b.r)+F.convert.hexify(b.g)+F.convert.hexify(b.b);var b=new Object,c=new Object;F.convert.HEX2RGB(B[a][0].HEX,b),F.convert.RGB2HSV(b,c),B[a][0].RGB={r:b.r,g:b.g,b:b.b},B[a][0].HSV={h:c.h,s:c.s,v:c.v}},rc:function(a,b){return a>b?b:0>a?0:a}},cPicker:{img2canvas:function(){istat=!0,cnvWidth=120,cnvHeight=70,c=D._myCanvas,ctx=c.getContext("2d"),cPix=D._pixCanvas,ctxPix=cPix.getContext("2d"),ctxPix.mozImageSmoothingEnabled=!1,ctxPix.webkitImageSmoothingEnabled=!1,img=D._canvimg,imgHeight=img.height,imgWidth=img.width,cnvHeight>imgHeight&&cnvWidth>imgWidth&&(ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1),1.56667>imgWidth/imgHeight?cnvWidth=imgWidth/imgHeight*cnvHeight:cnvHeight=cnvWidth/(imgWidth/imgHeight),ctx.clearRect(0,0,c.width,c.height),ctx.drawImage(img,0,0,cnvWidth,cnvHeight);var a=this,b=function(){if(t)if("all"==u)1==confirm("This action will regenerate a color palette for you. By proceding all your changes will be lost!")&&(t=!1,F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"));else{imageData=ctxPix.getImageData(0,0,150,150);var b="#"+a.d2h(imageData.data[45300])+a.d2h(imageData.data[45301])+a.d2h(imageData.data[45302]);D._hexColor.value=b,F.update.HEX(D._hexColor.value),F.update.customColors()}else{imageData=ctxPix.getImageData(0,0,150,150);var b="#"+a.d2h(imageData.data[45300])+a.d2h(imageData.data[45301])+a.d2h(imageData.data[45302]);D._hexColor.value=b,F.update.HEX(D._hexColor.value),F.update.customColors()}},d=function(b){ev=1,istat&&(mousePos=a.getMousePos(c,b),a.drawPix(cPix,ctxPix,img,Math.round(mousePos.x*(imgWidth/cnvWidth)),Math.round(mousePos.y*(imgHeight/cnvHeight))))};c.addEventListener("mousemove",d,!1),c.addEventListener("mousedown",b,!1)},drawPix:function(a,b,c,d,e){b.clearRect(0,0,a.width,a.height),5>d&&(d=5),5>e&&(e=5),d>imgWidth-4&&(d=imgWidth-4),e>imgHeight-4&&(e=imgHeight-4),b.drawImage(c,d-5,e-5,9,9,0,0,a.width,a.height)},getMousePos:function(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}},d2h:function(a){return("0"+a.toString(16)).slice(-2).toUpperCase()}},cFind:function(a){this.callback=a,this.getMostProminentColor=function(a){var b=null;this.callback||(this.callback=function(){return 1});var c=this.getImageData(a);return b=this.getMostProminentRGBImpl(c,6,b,this.callback),b=this.getMostProminentRGBImpl(c,4,b,this.callback),b=this.getMostProminentRGBImpl(c,2,b,this.callback),b=this.getMostProminentRGBImpl(c,0,b,this.callback)},this.getImageData=function(a,b){var c,d,e,f,g,h,i=document.createElement("canvas"),j=i.getContext&&i.getContext("2d"),k=-4;if(!j)return defaultRGB;f=i.height=a.naturalHeight||a.offsetHeight||a.height,e=i.width=a.naturalWidth||a.offsetWidth||a.width,j.drawImage(a,0,0);try{d=j.getImageData(0,0,e,f)}catch(l){return null}h=d.data.length;for(var m=Math.max(1,Math.round(h/5e3)),n={};(k+=4*m)<h;)d.data[k+3]>32&&(g=(d.data[k]>>b)+","+(d.data[k+1]>>b)+","+(d.data[k+2]>>b),n.hasOwnProperty(g)?(c=n[g],c.count++):(c={r:d.data[k],g:d.data[k+1],b:d.data[k+2],count:1},c.weight=this.callback(c.r,c.g,c.b),c.weight<=0&&(c.weight=1e-10),n[g]=c));return n},this.getMostProminentRGBImpl=function(a,b,c){var d,e,f,g,h,j,k={r:0,g:0,b:0,count:0,d:b},l={},m=0;for(e in a)d=a[e],totalWeight=d.weight*d.count,++m,this.doesRgbMatch(c,d.r,d.g,d.b)&&(f=(d.r>>b)+","+(d.g>>b)+","+(d.b>>b),l.hasOwnProperty(f)?l[f]+=totalWeight:l[f]=totalWeight);for(i in l)data=i.split(","),g=data[0],h=data[1],j=data[2],m=l[i],m>k.count&&(k.count=m,data=i.split(","),k.r=g,k.g=h,k.b=j);return k},this.doesRgbMatch=function(a,b,c,d){return null==a?!0:(b>>=a.d,c>>=a.d,d>>=a.d,a.r==b&&a.g==c&&a.b==d)}},makeLightColors:function(a,b){x[a]=[],x[a][0]={},x[a][0].HSV={},x[a][0].HSV.h=b,x[a][0].HSV.s=15,x[a][0].HSV.v=80,x[a][0].HEX=this.convert.HSV2HEX(b,15,80),x[a][0].RGB={},this.convert.HSV2RGB(x[a][0].HSV,x[a][0].RGB),x[a][1]={},x[a][1].HSV={},x[a][1].HSV.h=b,x[a][1].HSV.s=1,x[a][1].HSV.v=99,x[a][1].HEX=this.convert.HSV2HEX(b,1,99),x[a][1].RGB={},this.convert.HSV2RGB(x[a][1].HSV,x[a][1].RGB),x[a][2]={},x[a][2].HSV={},x[a][2].HSV.h=b,x[a][2].HSV.s=30,x[a][2].HSV.v=25,x[a][2].HEX=this.convert.HSV2HEX(b,30,25),x[a][2].RGB={},this.convert.HSV2RGB(x[a][2].HSV,x[a][2].RGB)},makeDarkColors:function(a,b){y[a]=[],y[a][0]={},y[a][0].HSV={},y[a][0].HSV.h=b,y[a][0].HSV.s=50,y[a][0].HSV.v=12,y[a][0].HEX=this.convert.HSV2HEX(b,50,12),y[a][0].RGB={},this.convert.HSV2RGB(y[a][0].HSV,y[a][0].RGB),y[a][1]={},y[a][1].HSV={},y[a][1].HSV.h=b,y[a][1].HSV.s=30,y[a][1].HSV.v=25,y[a][1].HEX=this.convert.HSV2HEX(b,30,25),y[a][1].RGB={},this.convert.HSV2RGB(y[a][1].HSV,y[a][1].RGB),y[a][2]={},y[a][2].HSV={},y[a][2].HSV.h=b,y[a][2].HSV.s=15,y[a][2].HSV.v=70,y[a][2].HEX=this.convert.HSV2HEX(b,15,70),y[a][2].RGB={},this.convert.HSV2RGB(y[a][2].HSV,y[a][2].RGB)}};a();var G={go:function(){(!colorTheme.css||q)&&(this.stackClasses(E),this.makeCSSelements(E),this.makeCSSel())},stackClasses:function(a){a[0]=[".ct0","#content",".item-list.controls-item",".item-list.layer-item",".item-list.layers-mapbox-item"],a[1]=[".ct1","#selectedTab span","#editorPanel > .content","#editor","#datalibrary-download-dialogue:after",".fullpage-users"],a[2]=[".ct2"],a[3]=[".ct3"],a[4]=[".ct4",".active a",".editor-wrapper a"],a[5]=[".ct5",".level-0"],a[6]=[".ct6",".level-1"],a[7]=[".ct7",".level-2"],a[8]=[".ct8","layer-active"],a[9]=[".ct9"],a[10]=[".ct10"],a[11]=[".ct11",".editor-projects-item:hover",".smap-button-gray",".smap-button-white",".item-list.controls-item.active",".item-list.layer-item.active",".active .layers-mapbox-item",".item-list.active",".layer-item.active"],a[12]=[".ct12"],a[13]=[".ct13",".editor-wrapper h3",".editor-wrapper h4",".editor-inner-wrapper h5"],a[14]=[".ct14"],a[15]=[".ct15","#header"],a[16]=[".ct16","#header","#header input"],a[17]=[".ct17",".editor-project-edit-super-wrap"],a[18]=[".ct18",".smap-button-gray",".smap-button-white"],a[19]=[".ct19","tr:nth-child(odd)"],a[20]=[".ct20","tr:nth-child(even)",".ccontainer"],a[21]=[".ct21"],a[22]=[".ct22",".mat_swatches","#darness-selector"],a[23]=[".ct23",".editor-wrapper h3",".editor-wrapper h4",".documents-folder-item:hover",".editor-map-item-wrap input",".form-control input","th",".datalibrary-controls",".input-box",".search"],a[24]=[".ct24",".editor-map-item-wrap input",".form-control input"],a[25]=[".ct25"],a[26]=[".ct26"],a[27]=[".ct27"],a[28]=[".ct28","th","#select-basic-themes","#advanced-color-header",".editor-inner-wrapper h5",".editor-map-item-wrap h4",".client-project-title-wrapper h4",".editor-projects-item h5",".editor-client-title h5","#userlist h4"],a[29]=["hr"],a[30]=["blockquote"],a[31]=[".ct31"],a[32]=[".item-list.controls-item.active",".item-list.layer-item.actve",".active .layers-mapbox-item",".item-list.active",".layer-item.active"],a[33]=[".item-list.controls-item.active",".item-list.layer-item.active",".active .layers-mapbox-item",".item-list.active",".layer-item.active"],a[34]=[".search"]},makeCSSelements:function(){this.makeCSSel(0,"background-color",""),this.makeCSSel(1,"background-color",""),this.makeCSSel(2,"background-color",""),this.makeCSSel(3,"color",""),this.makeCSSel(4,"color",""),this.makeCSSel(5,"background-color",""),this.makeCSSel(6,"background-color",""),this.makeCSSel(7,"background-color",""),this.makeCSSel(8,"background-color",""),this.makeCSSel(9,"background-color",""),this.makeCSSel(10,"color",""),this.makeCSSel(11,"color","white"),this.makeCSSel(12,"color","black"),this.makeCSSel(13,"color","white"),this.makeCSSel(14,"background-color",""),this.makeCSSel(15,"background-color",""),this.makeCSSel(16,"color",""),this.makeCSSel(17,"background-color",""),this.makeCSSel(18,"background-color",""),this.makeCSSel(19,"background-color",""),this.makeCSSel(20,"background-color",""),this.makeCSSel(21,"border-bottom",""),this.makeCSSel(22,"background-color",""),this.makeCSSel(23,"color",""),this.makeCSSel(24,"background-color",""),this.makeCSSel(25,"color",""),this.makeCSSel(26,"background",""),this.makeCSSel(27,"font-weight",""),this.makeCSSel(28,"font-weight",""),this.makeCSSel(29,"border-top",""),this.makeCSSel(30,"border-left",""),this.makeCSSel(31,"background-position",""),this.makeCSSel(32,"background-color",""),this.makeCSSel(33,"color",""),this.makeCSSel(34,"background-color","")},makeCSSel:function(a,b,c){colorTheme.css[a]={},colorTheme.css[a].classes=E[a],colorTheme.css[a].pre=b,colorTheme.css[a].value=c}};G.go();var H={init:function(){var a="342px",b="490px";D._color_Inner_wrapper.style.left="-580px",D._color_Outer_wrapper.style.height=a,D._b2basic=Wu.DomUtil.get("back-to-basic"),D._yourswatch=Wu.DomUtil.get("yourswatch"),D._myCanvas=Wu.DomUtil.get("myCanvas"),D._pixCanvas=Wu.DomUtil.get("pixCanvas"),D._canvimg=Wu.DomUtil.get("canvimg"),D._coloption1=Wu.DomUtil.get("coloption1"),D._coloption2=Wu.DomUtil.get("coloption2"),D._coloption3=Wu.DomUtil.get("coloption3"),D._yourcolLink1=Wu.DomUtil.get("yourcol_link1"),D._regen=Wu.DomUtil.get("regen"),D._normalSwatches=Wu.DomUtil.get("normal-swatches"),D._darkSwatches=Wu.DomUtil.get("dark-swatches"),D._linkSwatches=Wu.DomUtil.get("link-swatches"),D._colorSuggestions=Wu.DomUtil.get("color-suggestions"),D._hsvToggle=Wu.DomUtil.get("hsv-toggle"),D._rgbToggle=Wu.DomUtil.get("rgb-toggle"),D._paletteToggle=Wu.DomUtil.get("palette-toggle"),D._sliderToggle=Wu.DomUtil.get("slider-toggle"),D._imageToggle=Wu.DomUtil.get("image-toggle"),D._tickMenuLight=Wu.DomUtil.get("tick-menu-light"),D._tickMenuDark=Wu.DomUtil.get("tick-menu-dark"),D._tickHeaderLight=Wu.DomUtil.get("tick-header-light"),D._tickHeaderDark=Wu.DomUtil.get("tick-header-dark"),D._tickMboxLight=Wu.DomUtil.get("tick-mbox-light"),D._tickMboxDark=Wu.DomUtil.get("tick-mbox-dark"),D._dark_swatch_0=Wu.DomUtil.get("dark_swatch_0"),D._dark_swatch_1=Wu.DomUtil.get("dark_swatch_1"),D._dark_swatch_2=Wu.DomUtil.get("dark_swatch_2"),D._dark_swatch_3=Wu.DomUtil.get("dark_swatch_3"),D._dark_swatch_4=Wu.DomUtil.get("dark_swatch_4"),D._dark_swatch_5=Wu.DomUtil.get("dark_swatch_5"),D._dark_swatch_0.onclick=function(){h("dark",0)
},D._dark_swatch_1.onclick=function(){h("dark",1)},D._dark_swatch_2.onclick=function(){h("dark",2)},D._dark_swatch_3.onclick=function(){h("dark",3)},D._dark_swatch_4.onclick=function(){h("dark",4)},D._dark_swatch_5.onclick=function(){h("dark",5)},D._light_swatch_0=Wu.DomUtil.get("light_swatch_0"),D._light_swatch_1=Wu.DomUtil.get("light_swatch_1"),D._light_swatch_2=Wu.DomUtil.get("light_swatch_2"),D._light_swatch_3=Wu.DomUtil.get("light_swatch_3"),D._light_swatch_4=Wu.DomUtil.get("light_swatch_4"),D._light_swatch_5=Wu.DomUtil.get("light_swatch_5"),D._light_swatch_0.onclick=function(){h("light",0)},D._light_swatch_1.onclick=function(){h("light",1)},D._light_swatch_2.onclick=function(){h("light",2)},D._light_swatch_3.onclick=function(){h("light",3)},D._light_swatch_4.onclick=function(){h("light",4)},D._light_swatch_5.onclick=function(){h("light",5)},D._complimentary_swatch_0=Wu.DomUtil.get("complimentary_swatch_0"),D._complimentary_swatch_1=Wu.DomUtil.get("complimentary_swatch_1"),D._complimentary_swatch_2=Wu.DomUtil.get("complimentary_swatch_2"),D._complimentary_swatch_3=Wu.DomUtil.get("complimentary_swatch_3"),D._complimentary_swatch_0.onclick=function(){h("complimentary",0)},D._complimentary_swatch_1.onclick=function(){h("complimentary",1)},D._complimentary_swatch_2.onclick=function(){h("complimentary",2)},D._complimentary_swatch_3.onclick=function(){h("complimentary",3)},D._matching_swatch_0=Wu.DomUtil.get("matching_swatch_0"),D._matching_swatch_1=Wu.DomUtil.get("matching_swatch_1"),D._matching_swatch_2=Wu.DomUtil.get("matching_swatch_2"),D._matching_swatch_3=Wu.DomUtil.get("matching_swatch_3"),D._matching_swatch_4=Wu.DomUtil.get("matching_swatch_4"),D._matching_swatch_0.onclick=function(){h("matching",0)},D._matching_swatch_1.onclick=function(){h("matching",1)},D._matching_swatch_2.onclick=function(){h("matching",2)},D._matching_swatch_3.onclick=function(){h("matching",3)},D._matching_swatch_4.onclick=function(){h("matching",4)},D._bright_swatch_0=Wu.DomUtil.get("bright_swatch_0"),D._bright_swatch_1=Wu.DomUtil.get("bright_swatch_1"),D._bright_swatch_2=Wu.DomUtil.get("bright_swatch_2"),D._bright_swatch_3=Wu.DomUtil.get("bright_swatch_3"),D._bright_swatch_4=Wu.DomUtil.get("bright_swatch_4"),D._bright_swatch_5=Wu.DomUtil.get("bright_swatch_5"),D._bright_swatch_6=Wu.DomUtil.get("bright_swatch_6"),D._bright_swatch_7=Wu.DomUtil.get("bright_swatch_7"),D._bright_swatch_8=Wu.DomUtil.get("bright_swatch_8"),D._bright_swatch_9=Wu.DomUtil.get("bright_swatch_9"),D._bright_swatch_10=Wu.DomUtil.get("bright_swatch_10"),D._bright_swatch_0.onclick=function(){h("bright",0)},D._bright_swatch_1.onclick=function(){h("bright",1)},D._bright_swatch_2.onclick=function(){h("bright",2)},D._bright_swatch_3.onclick=function(){h("bright",3)},D._bright_swatch_4.onclick=function(){h("bright",4)},D._bright_swatch_5.onclick=function(){h("bright",5)},D._bright_swatch_6.onclick=function(){h("bright",6)},D._bright_swatch_7.onclick=function(){h("bright",7)},D._bright_swatch_8.onclick=function(){h("bright",8)},D._bright_swatch_9.onclick=function(){h("bright",9)},D._bright_swatch_10.onclick=function(){h("bright",10)},colorTheme.cThemeDarkMenu?(Wu.DomUtil.addClass(D._tickMenuDark,"active-toggle"),Wu.DomUtil.removeClass(D._tickMenuLight,"active-toggle")):(Wu.DomUtil.removeClass(D._tickMenuDark,"active-toggle"),Wu.DomUtil.addClass(D._tickMenuLight,"active-toggle")),colorTheme.cThemeDarkBox?(Wu.DomUtil.addClass(D._tickMboxDark,"active-toggle"),Wu.DomUtil.removeClass(D._tickMboxLight,"active-toggle")):(Wu.DomUtil.removeClass(D._tickMboxDark,"active-toggle"),Wu.DomUtil.addClass(D._tickMboxLight,"active-toggle")),colorTheme.cThemeDarkHeader?(Wu.DomUtil.addClass(D._tickHeaderDark,"active-toggle"),Wu.DomUtil.removeClass(D._tickHeaderLight,"active-toggle")):(Wu.DomUtil.removeClass(D._tickHeaderDark,"active-toggle"),Wu.DomUtil.addClass(D._tickHeaderLight,"active-toggle")),D._yourswatch.style.backgroundColor=n,D._b2basic.onclick=function(){1==u&&D._coloption1.click(),2==u&&D._coloption2.click(),3==u&&D._coloption3.click(),4==u&&D._yourcolLink1.click(),"all"==u&&D._regen.click(),D._color_Inner_wrapper.style.left="-310px",D._color_Outer_wrapper.style.height="182px"},this.initSliders();var c=(Wu.DomUtil.get("project-color-theme").parentNode.getAttribute("uuid"),Wu.DomUtil.get("editor-projects-container"));c=c.getElementsByTagName("div"),F.cPicker.img2canvas(),this.initComplimentaryColors(),this.initMatchingColors(),this.initDarkColors(),this.initLightColors(),this.initBrightColors(),f(),(!colorTheme.css||q)&&d("one"),D._coloption1.onclick=function(){t=!0,1==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u=1,Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._darkSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._normalSwatches,"die"),Wu.DomUtil.removeClass(D._coloption2,"changing"),Wu.DomUtil.removeClass(D._coloption3,"changing"),Wu.DomUtil.removeClass(D._yourcolLink1,"changing"),Wu.DomUtil.removeClass(D._regen,"changing"),D._yourswatch.style.backgroundColor=colorTheme.css[0].value,D._hexColor.value=colorTheme.css[0].value,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),D._paletteToggle.removeAttribute("style"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"))},D._coloption2.onclick=function(){t=!0,2==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u=2,Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.removeClass(D._coloption1,"changing"),Wu.DomUtil.removeClass(D._coloption3,"changing"),Wu.DomUtil.removeClass(D._yourcolLink1,"changing"),Wu.DomUtil.removeClass(D._regen,"changing"),D._yourswatch.style.backgroundColor=colorTheme.css[5].value,D._hexColor.value=colorTheme.css[5].value,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"),D._paletteToggle.removeAttribute("style"))},D._coloption3.onclick=function(){t=!0,3==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u=3,Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.removeClass(D._coloption1,"changing"),Wu.DomUtil.removeClass(D._coloption2,"changing"),Wu.DomUtil.removeClass(D._yourcolLink1,"changing"),Wu.DomUtil.removeClass(D._regen,"changing"),D._yourswatch.style.backgroundColor=colorTheme.css[8].value,D._hexColor.value=colorTheme.css[8].value,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"),D._paletteToggle.removeAttribute("style"))},D._yourcolLink1.onclick=function(){t=!0,4==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u=4,Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.addClass(D._normalSwatches,"die"),Wu.DomUtil.removeClass(D._coloption1,"changing"),Wu.DomUtil.removeClass(D._coloption2,"changing"),Wu.DomUtil.removeClass(D._coloption3,"changing"),Wu.DomUtil.removeClass(D._regen,"changing"),D._yourswatch.style.backgroundColor=colorTheme.css[4].value,D._hexColor.value=colorTheme.css[4].value,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"),D._paletteToggle.removeAttribute("style"))},D._regen.onclick=function(){"all"==u?(D._color_Outer_wrapper.style.height=a,u=!1,Wu.DomUtil.removeClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),D._paletteToggle.removeAttribute("style"),Wu.DomUtil.addClass(D._colorSuggestions,"collapsed-color-suggestions")):(D._color_Outer_wrapper.style.height=b,u="all",Wu.DomUtil.addClass(this,"changing"),Wu.DomUtil.removeClass(D._normalSwatches,"die"),Wu.DomUtil.addClass(D._linkSwatches,"die"),Wu.DomUtil.addClass(D._darkSwatches,"die"),Wu.DomUtil.removeClass(D._coloption1,"changing"),Wu.DomUtil.removeClass(D._coloption2,"changing"),Wu.DomUtil.removeClass(D._coloption3,"changing"),Wu.DomUtil.removeClass(D._yourcolLink1,"changing"),D._yourswatch.style.backgroundColor=A[0][0].HEX,D._hexColor.value=A[0][0].HEX,Wu.DomUtil.removeClass(D._colorSuggestions,"collapsed-color-suggestions"),D._sliderToggle.click(),D._paletteToggle.setAttribute("style","opacity: 0.2; cursor: normal"),F.update.HEX(D._hexColor.value),F.update.inputFields("HEX"))},D._hsvToggle.onclick=function(){var a=this.className;"active-toggle"==a?(this.className="",D._rgbToggle.className="active-toggle",Wu.DomUtil.get("rgb-slider-container").className="",Wu.DomUtil.get("hsv-slider-container").className="die"):(this.className="active-toggle",D._rgbToggle.className="",Wu.DomUtil.get("rgb-slider-container").className="die",Wu.DomUtil.get("hsv-slider-container").className="")},D._rgbToggle.onclick=function(){var a=this.className;"active-toggle"==a?(this.className="",D._hsvToggle.className="active-toggle",Wu.DomUtil.get("rgb-slider-container").className="die",Wu.DomUtil.get("hsv-slider-container").className=""):(this.className="active-toggle",D._hsvToggle.className="",Wu.DomUtil.get("rgb-slider-container").className="",Wu.DomUtil.get("hsv-slider-container").className="die")},D._paletteToggle.onclick=function(){"all"!=u&&(Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._sliderToggle,"active-toggle"),Wu.DomUtil.removeClass(D._imageToggle,"active-toggle"),Wu.DomUtil.get("s-watches").style.display="block",Wu.DomUtil.get("sliders").style.display="none",Wu.DomUtil.get("canvascontainer").style.display="none")},D._sliderToggle.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._paletteToggle,"active-toggle"),Wu.DomUtil.removeClass(D._imageToggle,"active-toggle"),Wu.DomUtil.get("sliders").style.display="block",Wu.DomUtil.get("s-watches").style.display="none",Wu.DomUtil.get("canvascontainer").style.display="none"},D._imageToggle.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._paletteToggle,"active-toggle"),Wu.DomUtil.removeClass(D._sliderToggle,"active-toggle"),Wu.DomUtil.get("canvascontainer").style.display="block",Wu.DomUtil.get("sliders").style.display="none",Wu.DomUtil.get("s-watches").style.display="none"},D._tickMenuLight.onclick=function(){colorTheme.cThemeDarkMenu=!1,l();var a=colorTheme.css[0].value;k(a),F.update.CSSstring(),jcss.innerHTML=w},D._tickMenuDark.onclick=function(){colorTheme.cThemeDarkMenu=!0,l();var a=colorTheme.css[0].value;j(a),F.update.CSSstring(),jcss.innerHTML=w},D._tickHeaderLight.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._tickHeaderDark,"active-toggle"),colorTheme.css[15].value="rgba(255,255,255,0.92)",colorTheme.css[16].value="#333",F.update.CSSstring(),jcss.innerHTML=w},D._tickHeaderDark.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._tickHeaderLight,"active-toggle"),colorTheme.css[15].value="rgba(0,0,0,0.8)",colorTheme.css[16].value="white",F.update.CSSstring(),jcss.innerHTML=w},D._tickMboxLight.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._tickMboxDark,"active-toggle"),colorTheme.css[14].value="rgba(255, 255, 255, 0.7)",F.update.CSSstring(),jcss.innerHTML=w},D._tickMboxDark.onclick=function(){Wu.DomUtil.addClass(this,"active-toggle"),Wu.DomUtil.removeClass(D._tickMboxLight,"active-toggle"),colorTheme.css[14].value="rgba(0,0,0,0.7)",F.update.CSSstring(),jcss.innerHTML=w},""!=w&&w||d("dark1")},initSliders:function(){F.sliders.rangeSlider("range-slider-1",360,function(a){D._hChannel.value=a;var b=new F.HSVobject(0,0,0);b={h:D._hChannel.value,s:D._sChannel.value,v:D._vChannel.value},F.update.HSV(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-2",100,function(a){D._sChannel.value=a;var b=new F.HSVobject(0,0,0);b={h:D._hChannel.value,s:D._sChannel.value,v:D._vChannel.value},F.update.HSV(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-3",100,function(a){D._vChannel.value=a;var b=new F.HSVobject(0,0,0);b={h:D._hChannel.value,s:D._sChannel.value,v:D._vChannel.value},F.update.HSV(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-r",255,function(a){D._rChannel.value=a;var b=new F.RGBobject(0,0,0);b={r:D._rChannel.value,g:D._gChannel.value,b:D._bChannel.value},F.update.RGB(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-g",255,function(a){D._gChannel.value=a;var b=new F.RGBobject(0,0,0);b={r:D._rChannel.value,g:D._gChannel.value,b:D._bChannel.value},F.update.RGB(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()}),F.sliders.rangeSlider("range-slider-b",255,function(a){D._bChannel.value=a;var b=new F.RGBobject(0,0,0);b={r:D._rChannel.value,g:D._gChannel.value,b:D._bChannel.value},F.update.RGB(b),D._yourswatch.style.backgroundColor=D._hexColor.value,F.update.customColors()})},initComplimentaryColors:function(){var a=colorTheme.css[5].value;F.update.HEX(a),F.update.makeComplimentary(a)},initMatchingColors:function(){var a=colorTheme.css[5].value;p=new Object,o=new Object,F.convert.HEX2RGB(a,o),F.convert.RGB2HSV(o,p),F.cMatch.domatch(p),F.update.colorGrade(B,0,B[0][0].HSV),F.update.colorGrade(B,1,B[1][0].HSV),F.update.colorGrade(B,2,B[2][0].HSV),F.update.colorGrade(B,3,B[3][0].HSV),F.update.colorGrade(B,4,B[4][0].HSV)},initDarkColors:function(){F.makeDarkColors(0,215),F.makeDarkColors(1,196),F.makeDarkColors(2,319),F.makeDarkColors(3,354),F.makeDarkColors(4,22),y[5]=[],y[5][0]={},y[5][0].HSV={},y[5][0].HSV.h=100,y[5][0].HSV.s=0,y[5][0].HSV.v=10,y[5][0].HEX=F.convert.HSV2HEX(100,0,10),y[5][0].RGB={},F.convert.HSV2RGB(y[5][0].HSV,y[5][0].RGB),y[5][1]={},y[5][1].HSV={},y[5][1].HSV.h=100,y[5][1].HSV.s=0,y[5][1].HSV.v=20,y[5][1].HEX=F.convert.HSV2HEX(100,0,20),y[5][1].RGB={},F.convert.HSV2RGB(y[5][1].HSV,y[5][1].RGB),y[5][2]={},y[5][2].HSV={},y[5][2].HSV.h=100,y[5][2].HSV.s=0,y[5][2].HSV.v=70,y[5][2].HEX=F.convert.HSV2HEX(100,0,70),y[5][2].RGB={},F.convert.HSV2RGB(y[5][2].HSV,y[5][2].RGB)},initLightColors:function(){F.makeLightColors(0,215),F.makeLightColors(1,196),F.makeLightColors(2,319),F.makeLightColors(3,76),F.makeLightColors(4,354),x[5]=[],x[5][0]={},x[5][0].HSV={},x[5][0].HSV.h=22,x[5][0].HSV.s=0,x[5][0].HSV.v=70,x[5][0].HEX=F.convert.HSV2HEX(22,0,70),x[5][0].RGB={},F.convert.HSV2RGB(x[5][0].HSV,x[5][0].RGB),x[5][1]={},x[5][1].HSV={},x[5][1].HSV.h=22,x[5][1].HSV.s=0,x[5][1].HSV.v=93,x[5][1].HEX=F.convert.HSV2HEX(22,0,93),x[5][1].RGB={},F.convert.HSV2RGB(x[5][1].HSV,x[5][1].RGB),x[5][2]={},x[5][2].HSV={},x[5][2].HSV.h=22,x[5][2].HSV.s=0,x[5][2].HSV.v=25,x[5][2].HEX=F.convert.HSV2HEX(22,0,25),x[5][2].RGB={},F.convert.HSV2RGB(x[5][2].HSV,x[5][2].RGB)},initBrightColors:function(){z[0]=[],z[0][0]={},z[0][0].HEX="#FF00FF",z[0][0].HSV={},z[0][0].HSV.h=300,z[0][0].HSV.s=100,z[0][0].HSV.v=100,z[0][0].RGB={},z[0][0].RGB.r=255,z[0][0].RGB.g=0,z[0][0].RGB.b=255,z[1]=[],z[1][0]={},z[1][0].HEX="#FF00AA",z[1][0].HSV={},z[1][0].HSV.h=320,z[1][0].HSV.s=100,z[1][0].HSV.v=100,z[1][0].RGB={},z[1][0].RGB.r=255,z[1][0].RGB.g=0,z[1][0].RGB.b=170,z[2]=[],z[2][0]={},z[2][0].HEX="#FF0055",z[2][0].HSV={},z[2][0].HSV.h=340,z[2][0].HSV.s=100,z[2][0].HSV.v=100,z[2][0].RGB={},z[2][0].RGB.r=255,z[2][0].RGB.g=0,z[2][0].RGB.b=85,z[3]=[],z[3][0]={},z[3][0].HEX="#FF0000",z[3][0].HSV={},z[3][0].HSV.h=0,z[3][0].HSV.s=100,z[3][0].HSV.v=100,z[3][0].RGB={},z[3][0].RGB.r=255,z[3][0].RGB.g=0,z[3][0].RGB.b=0,z[4]=[],z[4][0]={},z[4][0].HEX="#FF5400",z[4][0].HSV={},z[4][0].HSV.h=20,z[4][0].HSV.s=100,z[4][0].HSV.v=100,z[4][0].RGB={},z[4][0].RGB.r=255,z[4][0].RGB.g=84,z[4][0].RGB.b=0,z[5]=[],z[5][0]={},z[5][0].HEX="#FF9400",z[5][0].HSV={},z[5][0].HSV.h=35,z[5][0].HSV.s=100,z[5][0].HSV.v=100,z[5][0].RGB={},z[5][0].RGB.r=255,z[5][0].RGB.g=148,z[5][0].RGB.b=0,z[6]=[],z[6][0]={},z[6][0].HEX="#FFD400",z[6][0].HSV={},z[6][0].HSV.h=50,z[6][0].HSV.s=100,z[6][0].HSV.v=100,z[6][0].RGB={},z[6][0].RGB.r=255,z[6][0].RGB.g=212,z[6][0].RGB.b=0,z[7]=[],z[7][0]={},z[7][0].HEX="#FFFF00",z[7][0].HSV={},z[7][0].HSV.h=60,z[7][0].HSV.s=100,z[7][0].HSV.v=100,z[7][0].RGB={},z[7][0].RGB.r=255,z[7][0].RGB.g=255,z[7][0].RGB.b=0,z[8]=[],z[8][0]={},z[8][0].HEX="#00FFD4",z[8][0].HSV={},z[8][0].HSV.h=170,z[8][0].HSV.s=100,z[8][0].HSV.v=100,z[8][0].RGB={},z[8][0].RGB.r=0,z[8][0].RGB.g=255,z[8][0].RGB.b=212,z[9]=[],z[9][0]={},z[9][0].HEX="#00FFFF",z[9][0].HSV={},z[9][0].HSV.h=180,z[9][0].HSV.s=100,z[9][0].HSV.v=100,z[9][0].RGB={},z[9][0].RGB.r=0,z[9][0].RGB.g=255,z[9][0].RGB.b=255,z[10]=[],z[10][0]={},z[10][0].HEX="#54FF00",z[10][0].HSV={},z[10][0].HSV.h=100,z[10][0].HSV.s=100,z[10][0].HSV.v=100,z[10][0].RGB={},z[10][0].RGB.r=85,z[10][0].RGB.g=255,z[10][0].RGB.b=0}}}function layer_menu_j(){for(var a=0,b=Wu.DomUtil.get("layer-menu-inner-content"),c=b.getElementsByTagName("div"),d=0;d<c.length;d++)for(var e=c[d].classList,f=0;f<e.length;f++)0==e[f].indexOf("level-")&&(menuList[a]={},menuList[a].level=e[f],menuList[a].el=c[d],menuList[a].el.no=parseInt(a)+1,menuList[a].open=!1,a++);for(var d=0;d<menuList.length;d++)menuList[d].folder=Wu.DomUtil.hasClass(menuList[d].el,"menufolder")?!0:!1;for(var g=!1,d=0;d<menuList.length;d++){if(menuList[d].folder){if(g=menuList[d],menuList[d].subLayers=[],menuList[d].subFolders=[],menuList[d].attached=!1,"level-0"!=menuList[d].level)for(var h=0;h<menuList.length;h++)if(menuList[h].folder){var i=parseInt(menuList[d].level.charAt(menuList[d].level.length-1)),j="level-"+(i-1);menuList[h].level==j&&(menuList[d].attached=h+1)}menuList[d].attached-1>=0&&menuList[menuList[d].attached-1].subFolders.push(menuList[d])}else g.subLayers.push(menuList[d]);menuList[d].el.onclick=function(){menuFolderSelected(menuList[this.no-1])}}}function menuFolderSelected(a){a.subLayers&&a.subLayers.length>=1&&(a.open=a.open?!1:!0,layerCollapser(a,a.open)),a.subFolders&&a.subFolders.length>=1&&(a.open=a.open?!1:!0,collapse_folders(a,a.open))}function collapse_folders(a,b){for(var c=a.subFolders,d=0;d<c.length;d++)b?(c[d].open=!1,Wu.DomUtil.addClass(c[d].el,"layer-closed"),layerCollapser(c[d],!0),c[d].subFolders.length>=1&&(c[d].open=b,collapse_folders(c[d],b))):(c[d].open=!0,Wu.DomUtil.removeClass(c[d].el,"layer-closed"))}function layerCollapser(a,b){for(var c=a.subLayers,d=0;d<c.length;d++){var e=c[d].el;b?(c[d].open=!0,Wu.DomUtil.addClass(e,"layer-closed")):(c[d].open=!1,Wu.DomUtil.removeClass(e,"layer-closed"))}}ich.$=function(a){return a},Wu={},Wu.Class=function(){},Wu.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks.length&&this.callInitHooks()},c=b.__super__=this.prototype,d=Wu.Util.create(c);d.constructor=b,b.prototype=d;for(var e in this)this.hasOwnProperty(e)&&"prototype"!==e&&(b[e]=this[e]);return a.statics&&(Wu.extend(b,a.statics),delete a.statics),a.includes&&(Wu.Util.extend.apply(null,[d].concat(a.includes)),delete a.includes),d.options&&(a.options=Wu.Util.extend(Wu.Util.create(d.options),a.options)),Wu.extend(d,a),d._initHooks=[],d.callInitHooks=function(){if(!this._initHooksCalled){c.callInitHooks&&c.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,b=d._initHooks.length;b>a;a++)d._initHooks[a].call(this)}},b},Wu.Class.include=function(a){Wu.extend(this.prototype,a)},Wu.Class.mergeOptions=function(a){Wu.extend(this.prototype.options,a)},Wu.Class.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1),c="function"==typeof a?a:function(){this[a].apply(this,b)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(c)},Wu.Util={extend:function(a){var b,c,d,e,f=Array.prototype.slice.call(arguments,1);for(c=0,d=f.length;d>c;c++){e=f[c];for(b in e)a[b]=e[b]}return a},create:Object.create||function(){function a(){}return function(b){return a.prototype=b,new a}}(),bind:function(a,b){var c=Array.prototype.slice;if(a.bind)return a.bind.apply(a,c.call(arguments,1));var d=c.call(arguments,2);return function(){return a.apply(b,d.length?d.concat(c.call(arguments)):arguments)}},stamp:function(a){return a._leaflet_id=a._leaflet_id||++Wu.Util.lastId,a._leaflet_id},lastId:0,throttle:function(a,b,c){var d,e,f,g;return g=function(){d=!1,e&&(f.apply(c,e),e=!1)},f=function(){d?e=arguments:(a.apply(c,arguments),setTimeout(g,b),d=!0)}},wrapNum:function(a,b,c){var d=b[1],e=b[0],f=d-e;return a===d&&c?a:((a-e)%f+f)%f+e},falseFn:function(){return!1},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},trimAll:function(a){return a.replace(/\s+/g,"")},splitWords:function(a){return Wu.Util.trim(a).split(/\s+/)},setOptions:function(a,b){a.hasOwnProperty("options")||(a.options=a.options?Wu.Util.create(a.options):{});for(var c in b)a.options[c]=b[c];return a.options},getParamString:function(a,b,c){var d=[];for(var e in a)d.push(encodeURIComponent(c?e.toUpperCase():e)+"="+encodeURIComponent(a[e]));return(b&&-1!==b.indexOf("?")?"&":"?")+d.join("&")},template:function(a,b){return a.replace(Wu.Util.templateRe,function(a,c){var d=b[c];if(void 0===d)throw new Error("No value provided for variable "+a);return"function"==typeof d&&(d=d(b)),d})},templateRe:/\{ *([\w_]+) *\}/g,emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",templateIch:function(a,b,c){var d=Wu.DomUtil.create("div","");if(d.innerHTML=ich[a](b),c){for(var e=d,f=0;f<e.children.length;f++)c.appendChild(e.children[f]);return c.children[0]}return d.children},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},setAddressBar:function(a){window.history.pushState({},"",a)},post:function(a,b){var c=new XMLHttpRequest,d=window.location.origin;d+=a,c.open("POST",d,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){4==c.readyState&&200==c.status},c.send(b)},postcb:function(a,b,c,d){var e=new XMLHttpRequest,f=window.location.origin;f+=a,e.open("POST",f,!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&c&&c(d,e.responseText)},e.send(b)},send:function(a,b,c){var d=new XMLHttpRequest,e=window.location.origin;e+=a,d.open("POST",e,!0),d.setRequestHeader("Content-type","application/json"),d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c&&c(null,d.responseText):c&&c(d.status))},d.send(b)},_parse:function(a){try{var b=JSON.parse(a);return b}catch(c){return!1}},_getJSON:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c.responseText)},c.send(null)},_getParentClientID:function(a){var b="";for(c in Wu.app.Clients){var d=Wu.app.Clients[c];d.projects.forEach(function(c){c==a&&(b=d.uuid)})}return b||(b=Wu.app._activeClient.uuid),b},guid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)});return a?a+"-"+b:b},createRandom:function(a){return Math.random().toString(36).slice(-1*a).toUpperCase()},deselectText:function(){var a="getSelection"in window?window.getSelection():"selection"in document?document.selection:null;"removeAllRanges"in a?a.removeAllRanges():"empty"in a&&a.empty()},generateZip:function(a){var b=LZString.compress(a);return b},zipSave:function(a,b){var c,c=b,d=new LZMA("//85.10.202.87:8080/js/lib/lzma/lzma_worker.js");d.compress(c,1,function(b){var c=JSON.stringify(b),d=new XMLHttpRequest,e=window.location.origin;e+=a,d.open("POST",e,!0),d.onreadystatechange=function(){4==d.readyState&&200==d.status},d.send(c)},function(){})},zippedSave:function(){},setColorTheme:function(){injectCSS()},can:{create:{project:function(){var a=app.User.store;return a.role.superadmin?!0:a.role.admin?!0:!1},client:function(){var a=app.User.store;return a.role.superadmin?!0:a.role.admin?!0:!1},superadmin:function(){var a=app.User.store;return a.role.superadmin?!0:!1},admin:function(){var a=app.User.store;return a.role.superadmin?!0:a.role.admin?!0:!1},manager:function(){var a=app.User.store;return a.role.superadmin?!0:a.role.admin?!0:!1},editor:function(){var a=app.User.store;return a.role.superadmin?!0:a.role.admin?!0:!1},reader:function(){var a=app.User.store;return a.role.superadmin?!0:a.role.admin?!0:a.role.manager.projects.indexOf(uuid)>=0?!0:!1}},read:{project:function(a){var b=app.User.store;return b.role.superadmin?!0:b.role.admin?!0:b.role.manager.projects.indexOf(a)>=0?!0:b.role.editor.projects.indexOf(a)>=0?!0:b.role.reader.projects.indexOf(a)>=0?!0:!1},client:function(a){var b=app.User.store;return b.role.superadmin?!0:b.role.admin?!0:b.role.manager.clients.indexOf(a)>=0?!0:b.role.editor.clients.indexOf(a)>=0?!0:b.role.reader.clients.indexOf(a)>=0?!0:!1}},update:{project:function(a){var b=app.User.store;return b.role.superadmin?!0:b.role.admin?!0:b.role.editor.projects.indexOf(a)>=0?!0:!1},client:function(a){var b=app.User.store;return b.role.superadmin?!0:b.role.admin?!0:b.role.editor.clients.indexOf(a)>=0?!0:!1},user:function(a){var b=app.User.store;return b.role.superadmin?!0:b.role.admin?!0:b.role.manager.indexOf(a)>=0?!0:!1}},remove:{project:function(){var a=app.User.store;return a.role.superadmin?!0:a.role.admin?!0:!1},client:function(){var a=app.User.store;return a.role.superadmin?!0:a.role.admin?!0:!1}}},prettyDate:function(a,b){function c(a,b){var c=.1;return a>=b&&b*(1+c)>=a?b:a}if(a){var d,e={ago:"Ago",from:"",now:"Just Now",minute:"Minute",minutes:"Minutes",hour:"Hour",hours:"Hours",day:"Day",days:"Days",week:"Week",weeks:"Weeks",month:"Month",months:"Months",year:"Year",years:"Years"},f=[[60,e.now],[3600,e.minute,e.minutes,60],[86400,e.hour,e.hours,3600],[604800,e.day,e.days,86400],[2628e3,e.week,e.weeks,604800],[31536e3,e.month,e.months,2628e3],[1/0,e.year,e.years,31536e3]],g="string"==typeof a,a=g?new Date((""+a).replace(/-/g,"/").replace(/T|(?:\.\d+)?Z/g," ")):a,b=b||new Date,h=(b-a+6e4*(b.getTimezoneOffset()-(g?0:a.getTimezoneOffset())))/1e3;0>h?(h=Math.abs(h),d=e.from?" "+e.from:""):d=e.ago?" "+e.ago:"";for(var i=0,j=f[0];f[i];j=f[++i])if(h<j[0]){if(0===i)return j[1];var k=Math.ceil(c(h,j[3])/j[3]);return k+" "+(1!=k?j[2]:j[1])+(i>0?d:"")}}},stripAccents:function(a){var b={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Æ:"AE",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ý:"Y",ß:"s",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",æ:"ae",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ù:"u",ú:"u",û:"u",ü:"u",ý:"y",ÿ:"y",Ā:"A",ā:"a",Ă:"A",ă:"a",Ą:"A",ą:"a",Ć:"C",ć:"c",Ĉ:"C",ĉ:"c",Ċ:"C",ċ:"c",Č:"C",č:"c",Ď:"D",ď:"d",Đ:"D",đ:"d",Ē:"E",ē:"e",Ĕ:"E",ĕ:"e",Ė:"E",ė:"e",Ę:"E",ę:"e",Ě:"E",ě:"e",Ĝ:"G",ĝ:"g",Ğ:"G",ğ:"g",Ġ:"G",ġ:"g",Ģ:"G",ģ:"g",Ĥ:"H",ĥ:"h",Ħ:"H",ħ:"h",Ĩ:"I",ĩ:"i",Ī:"I",ī:"i",Ĭ:"I",ĭ:"i",Į:"I",į:"i",İ:"I",ı:"i",Ĳ:"IJ",ĳ:"ij",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",Ĺ:"L",ĺ:"l",Ļ:"L",ļ:"l",Ľ:"L",ľ:"l",Ŀ:"L",ŀ:"l",Ł:"l",ł:"l",Ń:"N",ń:"n",Ņ:"N",ņ:"n",Ň:"N",ň:"n",ŉ:"n",Ō:"O",ō:"o",Ŏ:"O",ŏ:"o",Ő:"O",ő:"o",Œ:"OE",œ:"oe",Ŕ:"R",ŕ:"r",Ŗ:"R",ŗ:"r",Ř:"R",ř:"r",Ś:"S",ś:"s",Ŝ:"S",ŝ:"s",Ş:"S",ş:"s",Š:"S",š:"s",Ţ:"T",ţ:"t",Ť:"T",ť:"t",Ŧ:"T",ŧ:"t",Ũ:"U",ũ:"u",Ū:"U",ū:"u",Ŭ:"U",ŭ:"u",Ů:"U",ů:"u",Ű:"U",ű:"u",Ų:"U",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",ź:"z",Ż:"Z",ż:"z",Ž:"Z",ž:"z",ſ:"s",ƒ:"f",Ơ:"O",ơ:"o",Ư:"U",ư:"u",Ǎ:"A",ǎ:"a",Ǐ:"I",ǐ:"i",Ǒ:"O",ǒ:"o",Ǔ:"U",ǔ:"u",Ǖ:"U",ǖ:"u",Ǘ:"U",ǘ:"u",Ǚ:"U",ǚ:"u",Ǜ:"U",ǜ:"u",Ǻ:"A",ǻ:"a",Ǽ:"AE",ǽ:"ae",Ǿ:"O",ǿ:"o"},c=/\W/g,d=function(a){return b[a]||a};return a.replace(c,d)},bytesToSize:function(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"0 Byte";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]},parseUrl:function(){var a=window.location.search.substr(1),b={};return a.split("&").forEach(function(a){var c=a.split("=");""!=c[0]&&(b[c[0]]=decodeURIComponent(c[1]))}),_.size(b)?b:!1},getWindowSize:function(){var a={width:window.innerWidth,height:window.innerHeight};return a}},function(){function a(a){return window["webkit"+a]||window["moz"+a]||window["ms"+a]}function b(a){var b=+new Date,d=Math.max(0,16-(b-c));return c=b+d,window.setTimeout(a,d)}var c=0,d=window.requestAnimationFrame||a("RequestAnimationFrame")||b,e=window.cancelAnimationFrame||a("CancelAnimationFrame")||a("CancelRequestAnimationFrame")||function(a){window.clearTimeout(a)};Wu.Util.requestAnimFrame=function(a,c,e,f){return e&&d===b?void a.call(c):d.call(window,Wu.bind(a,c),f)},Wu.Util.cancelAnimFrame=function(a){a&&e.call(window,a)}}(),Wu.extend=Wu.Util.extend,Wu.bind=Wu.Util.bind,Wu.stamp=Wu.Util.stamp,Wu.setOptions=Wu.Util.setOptions,Wu.save=Wu.Util.post,Wu.post=Wu.Util.postcb,Wu.send=Wu.Util.send,Wu.parse=Wu.Util._parse,Wu.zip=Wu.Util.generateZip,Wu.zave=Wu.Util.zipSave,Wu.can=Wu.Util.can,ichDiv=Wu.Util.templateIch,Wu.Evented=Wu.Class.extend({on:function(a,b,c){if("object"==typeof a)for(var d in a)this._on(d,a[d],b);else{a=Wu.Util.splitWords(a);for(var e=0,f=a.length;f>e;e++)this._on(a[e],b,c)}return this},off:function(a,b,c){if(a)if("object"==typeof a)for(var d in a)this._off(d,a[d],b);else{a=Wu.Util.splitWords(a);for(var e=0,f=a.length;f>e;e++)this._off(a[e],b,c)}else delete this._events;return this},_on:function(a,b,c){var d=this._events=this._events||{},e=c&&c!==this&&Wu.stamp(c);if(e){var f=a+"_idx",g=a+"_len",h=d[f]=d[f]||{},i=Wu.stamp(b)+"_"+e;h[i]||(h[i]={fn:b,ctx:c},d[g]=(d[g]||0)+1)}else d[a]=d[a]||[],d[a].push({fn:b})},_off:function(a,b,c){var d=this._events,e=a+"_idx",f=a+"_len";if(d){if(!b)return delete d[a],delete d[e],void delete d[f];var g,h,i,j,k,l=c&&c!==this&&Wu.stamp(c);if(l)k=Wu.stamp(b)+"_"+l,g=d[e],g&&g[k]&&(j=g[k],delete g[k],d[f]--);else if(g=d[a])for(h=0,i=g.length;i>h;h++)if(g[h].fn===b){j=g[h],g.splice(h,1);break}j&&(j.fn=Wu.Util.falseFn)}},fire:function(a,b,c){if(!this.listens(a,c))return this;var d=Wu.Util.extend({},b,{type:a,target:this}),e=this._events;if(e){var f,g,h,i,j=e[a+"_idx"];if(e[a])for(h=e[a].slice(),f=0,g=h.length;g>f;f++)h[f].fn.call(this,d);for(i in j)j[i].fn.call(j[i].ctx,d)}return c&&this._propagateEvent(d),this},listens:function(a,b){var c=this._events;if(c&&(c[a]||c[a+"_len"]))return!0;if(b)for(var d in this._eventParents)if(this._eventParents[d].listens(a,b))return!0;return!1},once:function(a,b,c){if("object"==typeof a){for(var d in a)this.once(d,a[d],b);return this}var e=Wu.bind(function(){this.off(a,b,c).off(a,e,c)},this);return this.on(a,b,c).on(a,e,c)},addEventParent:function(a){return this._eventParents=this._eventParents||{},this._eventParents[Wu.stamp(a)]=a,this
},removeEventParent:function(a){return this._eventParents&&delete this._eventParents[Wu.stamp(a)],this},_propagateEvent:function(a){for(var b in this._eventParents)this._eventParents[b].fire(a.type,Wu.extend({layer:a.target},a),!0)}});var proto=Wu.Evented.prototype;proto.addEventListener=proto.on,proto.removeEventListener=proto.clearAllEventListeners=proto.off,proto.addOneTimeEventListener=proto.once,proto.fireEvent=proto.fire,proto.hasEventListeners=proto.listens,Wu.Mixin={Events:proto},Wu.DomUtil={get:function(a){return"string"==typeof a?document.getElementById(a):a},getStyle:function(a,b){var c=a.style[b]||a.currentStyle&&a.currentStyle[b];if((!c||"auto"===c)&&document.defaultView){var d=document.defaultView.getComputedStyle(a,null);c=d?d[b]:null}return"auto"===c?null:c},create:function(a,b,c,d){var e=document.createElement(a);return e.className=b,c&&c.appendChild(e),d&&("input"==a?e.setAttribute("placeholder",d):"image"==a?e.src=d:e.innerHTML=d),e},createId:function(a,b,c){var d=document.createElement(a);return d.id=b,c&&c.appendChild(d),d},remove:function(a){var b=a.parentNode;b&&b.removeChild(a)},toFront:function(a){a.parentNode.appendChild(a)},toBack:function(a){var b=a.parentNode;b.insertBefore(a,b.firstChild)},hasClass:function(a,b){if(void 0!==a.classList)return a.classList.contains(b);var c=Wu.DomUtil.getClass(a);return c.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){if(void 0!==a.classList)for(var c=Wu.Util.splitWords(b),d=0,e=c.length;e>d;d++)a.classList.add(c[d]);else if(!Wu.DomUtil.hasClass(a,b)){var f=Wu.DomUtil.getClass(a);Wu.DomUtil.setClass(a,(f?f+" ":"")+b)}},removeClass:function(a,b){void 0!==a.classList?a.classList.remove(b):Wu.DomUtil.setClass(a,Wu.Util.trim((" "+Wu.DomUtil.getClass(a)+" ").replace(" "+b+" "," ")))},classed:function(a,b,c){c?this.addClass(a,b):this.removeClass(a,b)},setClass:function(a,b){void 0===a.className.baseVal?a.className=b:a.className.baseVal=b},getClass:function(a){return void 0===a.className.baseVal?a.className:a.className.baseVal},appendTemplate:function(a,b){if("string"==typeof b){var c=Wu.DomUtil.create("div");for(c.innerHTML=b,i=0;i<c.childNodes.length;i++)a.appendChild(c.childNodes[i])}return a},prependTemplate:function(a,b,c){if("string"==typeof b){var d=Wu.DomUtil.create("div");if(d.innerHTML=b,c)var e=a.firstChild;else var e=a.firstChild.nextSibling;for(i=0;i<d.childNodes.length;i++)a.insertBefore(d.childNodes[i],e)}return a}};var eventsKey="_leaflet_events";Wu.DomEvent={on:function(a,b,c,d){if("object"==typeof b)for(var e in b)this._on(a,e,b[e],c);else{b=Wu.Util.splitWords(b);for(var f=0,g=b.length;g>f;f++)this._on(a,b[f],c,d)}return this},off:function(a,b,c,d){if("object"==typeof b)for(var e in b)this._off(a,e,b[e],c);else{b=Wu.Util.splitWords(b);for(var f=0,g=b.length;g>f;f++)this._off(a,b[f],c,d)}return this},_on:function(a,b,c,d){var e=b+Wu.stamp(c)+(d?"_"+Wu.stamp(d):"");if(a[eventsKey]&&a[eventsKey][e])return this;var f=function(b){return c.call(d||a,b||window.event)},g=f;return Wu.Browser.pointer&&0===b.indexOf("touch")?this.addPointerListener(a,b,f,e):(Wu.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener&&this.addDoubleTapListener(a,f,e),"addEventListener"in a?"mousewheel"===b?(a.addEventListener("DOMMouseScroll",f,!1),a.addEventListener(b,f,!1)):"mouseenter"===b||"mouseleave"===b?(f=function(b){return b=b||window.event,Wu.DomEvent._checkMouse(a,b)?g(b):void 0},a.addEventListener("mouseenter"===b?"mouseover":"mouseout",f,!1)):("click"===b&&Wu.Browser.android&&(f=function(a){return Wu.DomEvent._filterClick(a,g)}),a.addEventListener(b,f,!1)):"attachEvent"in a&&a.attachEvent("on"+b,f),a[eventsKey]=a[eventsKey]||{},a[eventsKey][e]=f,this)},_off:function(a,b,c,d){var e=b+Wu.stamp(c)+(d?"_"+Wu.stamp(d):""),f=a[eventsKey]&&a[eventsKey][e];return f?(Wu.Browser.pointer&&0===b.indexOf("touch")?this.removePointerListener(a,b,e):Wu.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,e):"removeEventListener"in a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",f,!1),a.removeEventListener(b,f,!1)):a.removeEventListener("mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,f,!1):"detachEvent"in a&&a.detachEvent("on"+b,f),a[eventsKey][e]=null,this):this},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,Wu.DomEvent._skipped(a),this},disableScrollPropagation:function(a){return Wu.DomEvent.on(a,"mousewheel MozMousePixelScroll",Wu.DomEvent.stopPropagation)},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},stop:function(a){return Wu.DomEvent.preventDefault(a).stopPropagation(a)},getWheelDelta:function(a){var b=0;return a.wheelDelta&&(b=a.wheelDelta/120),a.detail&&(b=-a.detail/3),b},_skipEvents:{},_fakeStop:function(a){Wu.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var b=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,b},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(d){return!1}return c!==a},_filterClick:function(a,b){var c=a.timeStamp||a.originalEvent.timeStamp,d=Wu.DomEvent._lastClick&&c-Wu.DomEvent._lastClick;return d&&d>100&&500>d||a.target._simulatedClick&&!a._simulated?void Wu.DomEvent.stop(a):(Wu.DomEvent._lastClick=c,b(a))}},Wu.DomEvent.addListener=Wu.DomEvent.on,Wu.DomEvent.removeListener=Wu.DomEvent.off,function(){var a=navigator.userAgent.toLowerCase(),b=document.documentElement,c="ActiveXObject"in window,d=-1!==a.indexOf("webkit"),e=-1!==a.indexOf("phantom"),f=-1!==a.search("android [23]"),g=-1!==a.indexOf("chrome"),h="undefined"!=typeof orientation,i=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,j=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||i,k=c&&"transition"in b.style,l="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!f,m="MozPerspective"in b.style,n="OTransition"in b.style,o="devicePixelRatio"in window&&window.devicePixelRatio>1;if(!o&&"matchMedia"in window){var p=window.matchMedia("(min-resolution:144dpi)");o=p&&p.matches}var q=!window.L_NO_TOUCH&&!e&&(j||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);Wu.Browser={ie:c,ielt9:c&&!document.addEventListener,webkit:d,gecko:-1!==a.indexOf("gecko")&&!d&&!window.opera&&!c,android:-1!==a.indexOf("android"),android23:f,chrome:g,safari:!g&&-1!==a.indexOf("safari"),ie3d:k,webkit3d:l,gecko3d:m,opera3d:n,any3d:!window.L_DISABLE_3D&&(k||l||m||n)&&!e,mobile:h,mobileWebkit:h&&d,mobileWebkit3d:h&&l,mobileOpera:h&&window.opera,touch:!!q,msPointer:!!i,pointer:!!j,retina:!!o}}(),Array.prototype.diff=function(a){return this.filter(function(b){return a.indexOf(b)<0})},Array.prototype.move=function(a,b){this.splice(b,0,this.splice(a,1)[0])},Array.prototype.moveUp=function(a,b){var c=this.indexOf(a),d=c-(b||1);if(-1===c)throw new Error("Element not found in array");0>d&&(d=0),this.splice(c,1),this.splice(d,0,a)},Array.prototype.moveDown=function(a,b){var c=this.indexOf(a),d=c+(b||1);if(-1===c)throw new Error("Element not found in array");d>=this.length&&(d=this.length),this.splice(c,1),this.splice(d,0,a)},String.prototype.camelize=function(){return this.replace(/(?:^|[-_])(\w)/g,function(a,b){return b?b.toUpperCase():""})},JSON.parseAsync=function(a,b){var c,d;return window.Worker?(c=new Worker("json.worker.js"),c.addEventListener("message",function(a){d=a.data,b(d)},!1),void c.postMessage(a)):(d=JSON.parse(a),void b(d))},L.Map.include({reframe:function(){return this._loaded?(this._sizeChanged=!0,void this.fire("moveend")):this}}),L.Control.Draw.include({onAdd:function(a){var b,c=L.DomUtil.create("div","leaflet-draw"),d=!1,e="leaflet-draw-toolbar-top",f=L.DomUtil.create("div","leaflet-draw-section-button",c),g=L.DomUtil.create("div","leaflet-draw-section-wrapper",c);this._wrapper=g,L.DomEvent.on(f,"mousedown",function(a){L.DomEvent.stop(a),L.DomUtil.hasClass(g,"draw-expander")?(L.DomUtil.removeClass(g,"draw-expander"),L.DomUtil.removeClass(f,"open-drawer")):(L.DomUtil.addClass(g,"draw-expander"),L.DomUtil.addClass(f,"open-drawer"))},this),L.DomEvent.on(f,"dblclick",L.DomEvent.stop,this);for(var h in this._toolbars)this._toolbars.hasOwnProperty(h)&&(b=this._toolbars[h].addToolbar(a),b&&(d||(L.DomUtil.hasClass(b,e)||L.DomUtil.addClass(b.childNodes[0],e),d=!0),g.appendChild(b)));return c}}),L.Control.StyleEditor.include({addTo:function(a){this._map=a;{var b=this._container=this.onAdd(a),c=this.getPosition();a._controlCorners[c]}L.DomUtil.addClass(b,"leaflet-control");var d=this.options.container;return d.appendChild(b),this},removeFrom:function(a){var b=this.getPosition(),c=(a._controlCorners[b],this.options.container);return c.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(a),this}}),L.Popup.include({_initLayout:function(){var a,b="leaflet-popup",c=b+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),d=this._container=L.DomUtil.create("div",c);this.options.closeButton&&(a=this._closeButton=L.DomUtil.create("a",b+"-close-button",d),a.href="#close",a.innerHTML="&#215;",L.DomEvent.disableClickPropagation(a),L.DomEvent.on(a,"click",this._onCloseButtonClick,this));var e=this._wrapper=L.DomUtil.create("div",b+"-content-wrapper",d);L.DomEvent.disableClickPropagation(e),this._contentNode=L.DomUtil.create("div",b+"-content",e),L.DomEvent.disableScrollPropagation(this._contentNode),L.DomEvent.on(e,"contextmenu",L.DomEvent.stopPropagation),this._tipContainer=L.DomUtil.create("div",b+"-tip-container",d),this._tip=L.DomUtil.create("div",b+"-tip",this._tipContainer)},_updateLayout:function(){var a=this._contentNode,b=a.style,c=a.parentNode;b.width="",b.whiteSpace="nowrap";var d=a.offsetWidth;d=Math.min(d,this.options.maxWidth),d=Math.max(d,this.options.minWidth),b.width=d+46+"px",b.whiteSpace="",b.height="";var e=a.offsetHeight,f=this.options.maxHeight,g="leaflet-popup-scrolled";f&&e>f?(b.height=f+"px",L.DomUtil.addClass(a,g)):L.DomUtil.removeClass(a,g),this._containerWidth=this._container.offsetWidth,c.style.width=d+46+"px"}}),Wu.SidePane=Wu.Class.extend({_:"sidepane",initialize:function(a){return this.options=a||app.options,this.initContainer(),this.initContent(),this.render(),this},initContainer:function(){var a="q-editor-container ct1";this._container=Wu.DomUtil.create("div",a,Wu.app._appPane),this.paneOpen=!1,this.whichPaneOpen="projects"},initContent:function(){var a="q-editor-menu ct0";Wu.app._editorMenuPane=Wu.DomUtil.create("menu",a,this._container);var a="q-editor-content ct1";app._editorContentPane=Wu.DomUtil.create("content",a,this._container),app._menuSlider=Wu.DomUtil.createId("div","menuslider",Wu.app._editorMenuPane),app._menuSliderArrow=Wu.DomUtil.createId("div","menuslider-arrow",Wu.app._menuSlider),Wu.DomUtil.addClass(Wu.app._menuSlider,"ct1")},render:function(){var a=this.options.panes;a.clients&&(this.Clients=new Wu.SidePane.Clients),a.mapOptions&&(this.Map=new Wu.SidePane.Map),a.documents&&(this.Documents=new Wu.SidePane.Documents),a.dataLibrary&&(this.DataLibrary=new Wu.SidePane.DataLibrary),a.mediaLibrary&&(this.MediaLibrary=new Wu.SidePane.MediaLibrary),a.users&&(this.Users=new Wu.SidePane.Users),a.share&&(this.Share=new Wu.SidePane.Share)},calculateHeight:function(){var a=app.HeaderPane,b=a.getHeight();b||(b=80),this._minHeight=0},setHeight:function(a){this._container.style.height=a+"px"},collapse:function(){this.calculateHeight(),this.setHeight(this._minHeight),this.closePane(),this._deactivate()},_deactivate:function(){this.Clients&&this.Clients._deactivate(),this.Map&&this.Map._deactivate(),this.Documents&&this.Documents._deactivate(),this.DataLibrary&&this.DataLibrary._deactivate(),this.MediaLibrary&&this.MediaLibrary._deactivate(),this.Users&&this.Users._deactivate(),this.Share&&this.Share._deactivate()},expand:function(){this._container.style.height="100%",this.openPane()},_getPaneArray:function(a){var b=[],c=this.options.panes,d=a.getSettings();return c.clients&&b.push("Clients"),c.mapOptions&&b.push("Map"),c.documents&&d.documentsPane&&b.push("Documents"),c.dataLibrary&&d.dataLibrary&&b.push("DataLibrary"),c.mediaLibrary&&d.mediaLibrary&&b.push("MediaLibrary"),c.users&&b.push("Users"),c.share&&b.push("Share"),b},setProject:function(a){this.Home&&this.Home.updateContent(a),this.Map&&this.Map.updateContent(a),this.Documents&&this.Documents.updateContent(a),this.DataLibrary&&this.DataLibrary.updateContent(a)},refreshProject:function(a){var b=a.editMode,c=this._getPaneArray(a);b||_.pull(c,"Map"),app.Account.isManager()||_.pull(c,"Users"),this.refresh(c)},refreshClient:function(){var a=["Clients"];app.Account.isManager()&&a.push("Users"),this.refresh(a)},refresh:function(a){this.panes=[];var b=["Clients","Map","Documents","DataLibrary","MediaLibrary","Users","Share"];b.forEach(function(a){Wu.app.SidePane[a]||(Wu.app.SidePane[a]=new Wu.SidePane[a]),Wu.app.SidePane[a].enable(),this.panes.push(a)},this);var c=b.diff(a);c.forEach(function(a){var b=Wu.app.SidePane[a];b&&Wu.app.SidePane[a].disable(),_.pull(this.panes,a)},this)},removePane:function(a){var b=Wu.extend([],this.panes);_.pull(b,a),this.refresh(b)},addPane:function(a){var b=Wu.extend([],this.panes);b.push(a),b=_.unique(b),this.refresh(b)},closePane:function(){this.paneOpen&&(this.paneOpen=!1,this._container.style.width="100px",this._refreshLeaflet(),Wu.DomUtil.removeClass(app.SidePane.Documents._content,"show"),Wu.DomUtil.removeClass(app.SidePane.DataLibrary._content,"show"),Wu.DomUtil.removeClass(app.SidePane.Users._content,"show"))},_closePane:function(){},openPane:function(){this.paneOpen||(this.paneOpen=!0,this._container.style.width="350px",Wu.DomUtil.addClass(app._active,"show"),this._refreshLeaflet())},_refreshLeaflet:function(){setTimeout(function(){var a=Wu.app._map;a&&a.reframe()},300)}}),Wu.SidePane.Item=Wu.Class.extend({_wu:"sidepane.item",type:"item",initialize:function(){Wu.setOptions(this,Wu.app.options),this.render()},render:function(){this.initContainer(),this.initContent(),this.addHooks(),this.disable()},initContainer:function(){var a="q-editor-menu-item "+this.type;this._menu=Wu.DomUtil.create("div",a,Wu.app._editorMenuPane),this._title=Wu.DomUtil.create("a",this.type,this._menu),this._title.innerHTML=Wu.Util.capitalize(this.title||this.type);var a="q-editor-content-item "+this.type;this._content=Wu.DomUtil.create("div",a,Wu.app._editorContentPane),this._scrollWrapper=Wu.DomUtil.create("div","editor-scroll-wrapper",this._content),this._container=Wu.DomUtil.create("div","editor-wrapper ct13",this._scrollWrapper)},initContent:function(){},addHooks:function(){Wu.DomEvent.on(this._menu,"mousedown",this._clickActivate,this),Wu.DomEvent.on(this._menu,"mouseenter",this._mouseenter,this),Wu.DomEvent.on(this._menu,"mouseleave",this._mouseleave,this)},_mouseenter:function(){Wu.DomUtil.addClass(this._menu,"red")},_mouseleave:function(){Wu.DomUtil.removeClass(this._menu,"red")},_reclick:function(){{var a=Wu.DomUtil.get("map");Wu.DomUtil.get("menuslider-arrow")}if(Wu.app.SidePane.paneOpen)Wu.DomUtil.removeClass(Wu.app._active,"show"),Wu.app.SidePane.closePane(),Wu.DomUtil.removeClass(a,"map-blur");else{Wu.DomUtil.addClass(Wu.app._active,"show"),Wu.app.SidePane.openPane();var b=Wu.app._active.classList;(_.contains(b,"fullpage-documents")||_.contains(b,"data-library")||_.contains(b,"fullpage-users"))&&Wu.DomUtil.addClass(a,"map-blur")}},_clickActivate:function(){Wu.app._activeMenu!=this&&(Wu.app.SidePane.paneOpen||Wu.app.SidePane.openPane(),this.activate())},activate:function(){var a=Wu.app._activeMenu||!1;Wu.app._activeMenu=this,Wu.app._active=this._content,app._activeMenuItem=this.type,this.checkSwipe(a),a&&Wu.DomUtil.removeClass(a._menu,"active"),Wu.DomUtil.addClass(this._menu,"active"),a&&a._deactivate(),this._activate(),this.update()},_activate:function(){},_deactivate:function(){},checkSwipe:function(a){return a?this.swiper(a):(Wu.app._active&&Wu.DomUtil.removeClass(Wu.app._active,"show"),Wu.app._active=this._content,void Wu.DomUtil.addClass(Wu.app._active,"show"))},swiper:function(a){var b=a._content,c=Wu.app._active;if(b!=c){var d=70,e=Wu.DomUtil.get("menuslider"),f=this._menu.classList,g=Wu.app.SidePane.paneOpen,h="100px";g&&(h="400px");var i=Wu.DomUtil.get("map"),j=Wu.DomUtil.get("menuslider-arrow");if(j.style.width="9px",_.contains(f,"clients")&&(e.style.top="0px",Wu.app.SidePane._container.style.width=h,Wu.DomUtil.removeClass(i,"map-blur")),_.contains(f,"map")){var k=app.SidePane.panes.indexOf("Map");e.style.top=d*k+"px",Wu.app.SidePane._container.style.width=h,Wu.DomUtil.removeClass(i,"map-blur")}if(_.contains(f,"documents")){var k=app.SidePane.panes.indexOf("Documents");e.style.top=d*k+"px",Wu.app.SidePane._container.style.width="100%",Wu.DomUtil.addClass(i,"map-blur")}if(_.contains(f,"dataLibrary")){var k=app.SidePane.panes.indexOf("DataLibrary");e.style.top=d*k+"px",Wu.app.SidePane._container.style.width="100%",Wu.DomUtil.addClass(i,"map-blur")}if(_.contains(f,"mediaLibrary")){var k=app.SidePane.panes.indexOf("MediaLibrary");e.style.top=d*k+"px",Wu.app.SidePane._container.style.width="100%",Wu.DomUtil.addClass(i,"map-blur")}if(_.contains(f,"users")){var k=app.SidePane.panes.indexOf("Users");e.style.top=d*k+"px",Wu.app.SidePane._container.style.width="100%",Wu.DomUtil.addClass(i,"map-blur")}if(_.contains(f,"share")){var k=app.SidePane.panes.indexOf("Share");e.style.top=d*k+"px",Wu.app.SidePane._container.style.width="100%",Wu.DomUtil.removeClass(i,"map-blur")}for(var l,m,n=document.getElementsByTagName("menu")[0],o=n.getElementsByTagName("div"),p=0;p<o.length;p++)o[p]==a._menu&&(l=p),o[p]==this._menu&&(m=p);Wu.app._active&&Wu.DomUtil.removeClass(b,"show"),Wu.DomUtil.addClass(c,"show")}},updateContent:function(){},_addHook:function(a,b,c,d){Wu.DomEvent.on(a,b,c,d)},disable:function(){Wu.DomEvent.off(this._menu,"mousedown",this._clickActivate,this),Wu.DomUtil.addClass(this._menu,"disabled")},enable:function(){Wu.DomEvent.on(this._menu,"mousedown",this._clickActivate,this),Wu.DomUtil.removeClass(this._menu,"disabled")},remove:function(){delete this._menu,delete this._content,delete this},setContentHeight:function(){this.calculateHeight(),this._content.style.maxHeight=this.maxHeight+"px",this._scrollWrapper.style.maxHeight=parseInt(this.maxHeight-20)+"px"},calculateHeight:function(){var a=window.innerHeight,b=app.MapPane.legendsControl,c=-107;c+=b?parseInt(a)-parseInt(b._legendsHeight):parseInt(a)-6,this.maxHeight=c}}),Wu.SidePane.Clients=Wu.SidePane.Item.extend({_:"sidepane.clients",type:"clients",title:"Projects",initialize:function(){Wu.SidePane.Item.prototype.initialize.call(this),this.activate()},initContent:function(){this._clientsContainer=Wu.DomUtil.create("div","editor-clients",this._container),this.options.json.clients.forEach(function(a){var b=new Wu.SidePane.Client(a);b.addTo(this._clientsContainer)},this),app.Account.canCreateClient()&&this._insertNewClientButton()},_insertNewClientButton:function(){var a="smap-button-white new-client ct11 ct16 ct18",b=Wu.DomUtil.create("div",a,this._clientsContainer,"+");b.id="new-client-button",this._addHook(b,"click",this.newClient,this)},addHooks:function(){Wu.SidePane.Item.prototype.addHooks.call(this)},_activate:function(){},_deactivate:function(){},_create:function(a){var b=new Wu.SidePane.Client(a);b.addTo(this._clientsContainer)},openClient:function(){this._container.style.height=""},closeClient:function(){},remove:function(){var a=this,b="Are you sure you want to DELETE the client "+a.name+"?",c="Are you REALLY sure you want to DELETE the client "+a.name+"? This CANNOT be undone!";confirm(b)&&confirm(c)&&a._delete()},_createNew:function(){this.newClient()},newClient:function(){var a={clientName:"New client"};Wu.DomUtil.appendTemplate(this._clientsContainer,ich.editorClientsNew(a));var b=Wu.DomUtil.get("editor-client-confirm-button");this._addHook(b,"click",this._confirm,this);var b=Wu.DomUtil.get("editor-client-cancel-button");this._addHook(b,"click",this._cancel,this);var c=Wu.DomUtil.get("editor-client-name-new");this._addHook(c,"keyup",this._checkSlug,this)},_checkSlug:function(){clearTimeout(this._timer);var a=this;this._timer=setTimeout(function(){var b=Wu.DomUtil.get("editor-client-name-new"),c=Wu.Util.trimAll(b.value).toLowerCase(),d=JSON.stringify({slug:c}),e="/api/client/unique";Wu.Util.postcb(e,d,a._checkedSlug,a)},500)},_checkedSlug:function(a,b){var c=JSON.parse(b);return c.unique?a._enableConfirm():void(c.error||a._disableConfirm())},_disableConfirm:function(){var a=Wu.DomUtil.get("editor-client-confirm-button");a.style.backgroundColor="red"},_enableConfirm:function(){var a=Wu.DomUtil.get("editor-client-confirm-button");a.style.backgroundColor=""},_cancel:function(){var a=Wu.DomUtil.get("editor-clients-container-new").parentNode;Wu.DomUtil.remove(a)},_confirm:function(){var a=Wu.DomUtil.get("editor-client-name-new").value,b=Wu.DomUtil.get("editor-client-description-new").value,c=Wu.DomUtil.get("editor-client-keywords-new").value,d={name:a,description:b,keywords:c},e=new Wu.Client(d);e.saveNew()},_created:function(a,b){var c=Wu.app.SidePane.Clients,d=JSON.parse(b);Wu.extend(a,d),Wu.app.Clients[a.uuid]=a;var e=Wu.DomUtil.get("editor-clients-container-new").parentNode;Wu.DomUtil.remove(e),c._create(a),a.setActive()},toggleEdit:function(a){a&&Wu.DomEvent.stop(a);var b=this,c=Wu.DomUtil.get("editor-client-edit-wrapper-"+b.uuid),d=Wu.DomUtil.get("editor-clients-container-"+b.uuid);b.options.editMode?(Wu.DomUtil.removeClass(d,"client-editor-open"),Wu.DomUtil.removeClass(c,"client-editor-open"),b.options.editMode=!1):(Wu.DomUtil.addClass(d,"client-editor-open"),Wu.DomUtil.addClass(c,"client-editor-open"),b.options.editMode=!0)},_addHook:function(a,b,c,d){Wu.DomEvent.on(a,b,c,d)},select:function(a){Wu.app._activeClient!=a&&(a.setActive(),Wu.app.activeProject&&Wu.app.activeProject.unload(),Wu.app.SidePane.Clients.refreshSidePane(),Wu.app.SidePane.setSubheaders())},refreshSidePane:function(){Wu.app.SidePane.refreshClient(),Wu.app.SidePane.Users.update()},_select:function(){var a=Wu.app.SidePane.Clients;a._previousSelect&&Wu.DomUtil.removeClass(a._previousSelect,"active-client"),Wu.DomUtil.addClass(this,"active-client"),a._previousSelect=this},selectProject:function(){var a=this;a.setActive()},disable:function(){},update:function(){}}),Wu.SidePane.Project=Wu.Class.extend({initialize:function(a,b){return Wu.setOptions(this,b),this.project=a,this.project.setEditMode(),this.project.setSidepane(this),this._parent=this.options.parent,this.initLayout(),this.update(),this},initLayout:function(){this._container=Wu.DomUtil.create("div","project-item"),this.name=Wu.DomUtil.create("div","project-title",this._container),this.name.type="name",this.description=Wu.DomUtil.create("div","project-description",this._container),this.description.type="description",this.logo=Wu.DomUtil.create("div","project-logo",this._container),this.logo.type="logo",this.users=Wu.DomUtil.create("div","project-users-wrap",this._container),this.usersInnerWrapper=Wu.DomUtil.create("div","project-users-inner-wrapper",this.users),this.projectStatsHeader=Wu.DomUtil.create("div","project-stats",this.usersInnerWrapper),this.projectStatsHeader.innerHTML="Project status:",this.createdBy=Wu.DomUtil.create("div","project-createdby",this.usersInnerWrapper),this.createdDate=Wu.DomUtil.create("div","project-createddate",this.usersInnerWrapper),this.lastUpdated=Wu.DomUtil.create("div","project-lastupdated",this.usersInnerWrapper),this.usersInner=Wu.DomUtil.create("div","project-users",this.usersInnerWrapper),(app.Account.canDeleteProject(this.project.store.uuid)||this.options.editMode)&&(this.kill=Wu.DomUtil.create("div","project-delete",this.usersInnerWrapper,"Delete project")),this.addHooks()},expandUsers:function(){},collapseUsers:function(){},update:function(a){this.project=a||this.project,this.name.innerHTML=this.project.store.name,this.description.innerHTML=this.project.store.description,this.logo.style.backgroundImage="url('"+this.project.store.logo+"')",this.createdBy.innerHTML='<div class="project-info-left">Created by:</div><div class="project-info-right">'+this.project.store.createdByName+"</div>",this.lastUpdated.innerHTML='<div class="project-info-left">Last updated:</div><div class="project-info-right">'+Wu.Util.prettyDate(this.project.store.lastUpdated)+"</div>",this.createdDate.innerHTML='<div class="project-info-left">Created time:</div><div class="project-info-right">'+Wu.Util.prettyDate(this.project.store.created)+"</div>",this.usersInner.innerHTML='<div class="project-users-header">Project users:</div>'+this.project.getUsersHTML()},addHooks:function(){Wu.DomEvent.on(this._container,"mouseenter",this.open,this),Wu.DomEvent.on(this._container,"mouseleave",this.close,this),Wu.DomEvent.on(this._container,"click",this.select,this),Wu.DomEvent.on(this._container,"mousedown",Wu.DomEvent.stopPropagation,this),this.project.editMode&&this.addEditHooks()},removeHooks:function(){Wu.DomEvent.off(this._container,"mouseenter",this.open,this),Wu.DomEvent.off(this._container,"mouseleave",this.close,this),Wu.DomEvent.off(this._container,"click",this.select,this),Wu.DomEvent.off(this._container,"mousedown",Wu.DomEvent.stopPropagation,this),this.project.editMode&&this.removeEditHooks()},addEditHooks:function(){this.project.editMode&&(Wu.DomEvent.on(this.name,"dblclick",this.edit,this),Wu.DomEvent.on(this.description,"dblclick",this.editDescription,this),this.addLogoDZ(),app.Account.canDeleteProject(this.project.getUuid())&&Wu.DomEvent.on(this.kill,"click",this.deleteProject,this))},removeEditHooks:function(){Wu.DomEvent.off(this.name,"dblclick",this.edit,this),Wu.DomEvent.off(this.description,"dblclick",this.editDescription,this),this.removeLogoDZ(),app.Account.canDeleteProject(this.project.getUuid())&&Wu.DomEvent.off(this.kill,"click",this.deleteProject,this)},addLogoDZ:function(){this.logodz=new Dropzone(this.logo,{url:"/api/project/uploadlogo",createImageThumbnails:!1,autoDiscover:!1}),this.logodz.options.params.project=this.project.getUuid();var a=this;this.logodz.on("success",function(b,c){a.editedLogo(c)}),Wu.DomUtil.addClass(this.logo,"editable")},removeLogoDZ:function(){this.logodz&&this.logodz.disable(),delete this.logodz,Wu.DomUtil.removeClass(this.logo,"editable")},editedLogo:function(a){var b="/images/"+a;this.project.setLogo(b),this.logo.style.backgroundImage="url('"+this.project.getLogo()+"')"},addTo:function(a){return a.appendChild(this._container),this},addToBefore:function(a){var b=a.lastChild;a.insertBefore(this._container,b)},remove:function(){return Wu.DomUtil.remove(this._container),this},open:function(){this._parent&&(this._parent._container.style.overflow="visible")},close:function(){this._parent&&(this._parent._container.style.overflow="hidden")},select:function(){this.project!=app.activeProject&&(this.project.select(),Wu.app.SidePane.refreshProject(this.project))},_markActive:function(){var a=app.Projects;for(p in a){var b=a[p];b._menuItem._unmarkActive()}Wu.DomUtil.addClass(this._container,"active-project")},_unmarkActive:function(){Wu.DomUtil.removeClass(this._container,"active-project")},edit:function(a){if(!this.editing){this.editing=!0;var b=a.target,c=(b.type,b.innerHTML),d=ich.injectProjectEditInput({value:c});b.innerHTML=d;var e=b.firstChild;e.focus(),e.selectionStart=e.selectionEnd,Wu.DomEvent.on(e,"blur",this._editBlur,this),Wu.DomEvent.on(e,"keydown",this._editKey,this)}},_editBlur:function(a){var b=a.target.value,c=a.target.parentNode;c.innerHTML=b,this.project.setSlug(b),this.project.setName(b),this.project.setHeaderTitle(b),app.HeaderPane.setTitle(b),this.editing=!1},editDescription:function(a){if(!this.editing){this.editing=!0;var b=a.target,c=(b.type,b.innerHTML);b.innerHTML="";var d=Wu.DomUtil.create("textarea","project-edit-textarea",b);d.innerHTML=c;var e=d;e.focus(),e.selectionStart=e.selectionEnd,Wu.DomEvent.on(e,"blur",this._editDescriptionBlur,this),Wu.DomEvent.on(e,"keydown",this._editKey,this)}},_editDescriptionBlur:function(a){var b=a.target.value,c=a.target.parentNode;c.innerHTML=b,this.project.setDescription(b),this.project.setHeaderSubtitle(b),app.HeaderPane.setSubtitle(b),this.editing=!1},_editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},deleteProject:function(a){Wu.DomEvent.stop(a);var b=confirm("Are you sure you want to delete project "+this.project.store.name+"?");if(b){var c=confirm("Are you REALLY sure you want to delete project "+this.project.store.name+"? You cannot UNDO this action!");c&&this.confirmDelete()}},confirmDelete:function(){this.removeHooks(),this.project.selected&&this.project.unload(),this._parent.removeProject(this.project),Wu.DomUtil.remove(this._container),this.project._delete(),delete this}}),Wu.SidePane.Client=Wu.Class.extend({initialize:function(a){return this.client=app.Clients[a.uuid],this.editable=app.Account.canCreateClient(),this.initLayout(),this.update(),this},initLayout:function(){this._container=Wu.DomUtil.create("div","editor-clients-container ct0"),this.title=Wu.DomUtil.create("div","client-title",this._container),this.description=Wu.DomUtil.create("div","client-description",this._container),this.logo=Wu.DomUtil.create("img","client-logo",this._container),this._projectsContainer=Wu.DomUtil.create("div","projects-container",this._container)},addTo:function(a){return a.appendChild(this._container),this.addHooks(),this.editable&&this.addEditHooks(),this},remove:function(){return Wu.DomUtil.remove(this._container),this},update:function(){this.title.innerHTML=this.client.getName(),this.description.innerHTML=this.client.getDescription(),this.logo.setAttribute("src",this.client.getLogo()),this.insertProjects()},insertProjects:function(){var a=this.client;return this.projects=_.filter(Wu.app.Projects,function(b){return b.store.client==a.getUuid()}),this.projects?(this.projects=_.sortBy(this.projects,function(a){return a.store.lastUpdated}),this.projects.reverse(),this.projects.forEach(function(a){var b={parent:this},c=new Wu.SidePane.Project(a,b);c.addTo(this._projectsContainer)},this),this.editButtons(),void this.calculateHeight()):this.editButtons()},editButtons:function(){if(this._newProjectButton&&Wu.DomUtil.remove(this._newProjectButton),this._removeClientButton&&Wu.DomUtil.remove(this._removeClientButton),app.Account.canCreateProject()){var a="smap-button-white new-project-button ct11 ct16 ct18";this._newProjectButton=Wu.DomUtil.create("div",a,this._projectsContainer,"+"),Wu.DomEvent.on(this._newProjectButton,"mousedown",this.createNewProject,this),Wu.DomEvent.on(this._newProjectButton,"mousedown",Wu.DomEvent.stop,this),Wu.DomEvent.on(this._newProjectButton,"click",Wu.DomEvent.stop,this)}app.Account.canDeleteClient(this.client.uuid)&&(this._removeClientButton=Wu.DomUtil.create("div","client-kill",this._container,"Delete client"),Wu.DomEvent.on(this._removeClientButton,"mousedown",this.removeClient,this))},removeClient:function(){var a=this.projects.length;if(a>0)return alert("The client "+this.client.getName()+" has "+a+" projects. You must delete these individually first before deleting client.");var b=confirm("Are you sure you want to delete client "+this.client.getName()+"?");if(b){var c=confirm("Are you REALLY sure you want to delete client "+this.client.getName()+"? You cannot UNDO this action!");c&&this.confirmDeleteClient()}},confirmDeleteClient:function(){Wu.DomUtil.remove(this._container),this.client.destroy()},createNewProject:function(){var a={name:"Project title",description:"Project description",created:(new Date).toJSON(),lastUpdated:(new Date).toJSON(),createdByName:app.Account.getName(),keywords:"",client:this.client.uuid,position:{},bounds:{northEast:{lat:0,lng:0},southWest:{lat:0,lng:0},minZoom:1,maxZoom:22},header:{height:50},folders:[]},b=new Wu.Project(a);b.editMode=!0;var c={callback:this._projectCreated,context:this};b._saveNew(c)},_projectCreated:function(a,b){var c=JSON.parse(b),d=c.error,e=c.project;return d?void 0:(app.Projects[e.uuid]=a,a.setStore(e),a.addAccess(),void this._createNewProject(a))
},_createNewProject:function(a){this.projects.push(a);var b={parent:this},c=new Wu.SidePane.Project(a,b);c.addToBefore(this._projectsContainer),this.open(),c.project._menuItem.select()},addHooks:function(){Wu.DomEvent.on(this._container,"mousedown",this.toggle,this)},removeHooks:function(){Wu.DomEvent.off(this._container,"mousedown",this.toggle,this)},addEditHooks:function(){Wu.DomEvent.on(this.title,"dblclick",this.editName,this),Wu.DomEvent.on(this.description,"dblclick",this.editDescription,this),this.addLogoDZ()},removeEditHooks:function(){Wu.DomEvent.off(this.title,"dblclick",this.editName,this),Wu.DomEvent.off(this.description,"dblclick",this.editDescription,this),this.removeLogoDZ()},editName:function(){if(!this.editing){this.editing=!0;var a=this.title,b=a.innerHTML;a.innerHTML=ich.injectClientEditInput({value:b});var c=a.firstChild;c.focus(),c.selectionStart=c.selectionEnd,Wu.DomEvent.on(c,"blur",this.editedName,this),Wu.DomEvent.on(c,"keydown",this.editKeyed,this)}},editedName:function(a){var b=a.target,c=b.value,d=this.title;d.innerHTML=c,this.client.setName(c),Wu.DomEvent.off(b,"blur",this.editedName,this),Wu.DomEvent.off(b,"keydown",this.editKeyed,this),this.editing=!1},editKeyed:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},editDescription:function(){if(!this.editing){this.editing=!0;var a=this.description,b=a.innerHTML;a.innerHTML=ich.injectClientEditInput({value:b});var c=a.firstChild;c.focus(),c.selectionStart=c.selectionEnd,Wu.DomEvent.on(c,"blur",this.editedDescription,this),Wu.DomEvent.on(c,"keydown",this.editKeyed,this)}},editedDescription:function(a){var b=a.target,c=b.value,d=this.description;d.innerHTML=c,this.client.setDescription(c),Wu.DomEvent.off(b,"blur",this.editedDescription,this),Wu.DomEvent.off(b,"keydown",this.editKeyed,this),this.editing=!1},addLogoDZ:function(){this.logodz=new Dropzone(this.logo,{url:"/api/client/uploadlogo",createImageThumbnails:!1,autoDiscover:!1}),this.logodz.options.params.client=this.client.getUuid();var a=this;this.logodz.on("success",function(b,c){a.editedLogo(c)}),Wu.DomUtil.addClass(this.logo,"editable")},removeLogoDZ:function(){this.logodz&&this.logodz.disable(),delete this.logodz,Wu.DomUtil.removeClass(this.logo,"editable")},editedLogo:function(a){var b="/images/"+a;this.client.setLogo(b),this.logo.src=b},pendingOpen:function(){if(app._timerOpenClient&&clearTimeout(app._timerOpenClient),!this._isOpen){var a=this;app._timerOpenClient=setTimeout(function(){a.open(),app._pendingCloseClient&&app._pendingCloseClient.close(),app._pendingCloseClient=a},200)}},toggle:function(){this._isOpen?this.close():this.open()},open:function(){this.calculateHeight(),this._container.style.height=this.maxHeight+"px",this._isOpen=!0;var a=app.SidePane.Clients;a._lastOpened&&a._lastOpened!=this&&a._lastOpened.close(),a._lastOpened=this},close:function(){this.calculateHeight(),this._container.style.height=this.minHeight+"px",this._isOpen=!1},removeProject:function(a){_.remove(this.projects,function(b){return b.store.uuid==a.store.uuid}),this.calculateHeight(),this.open()},calculateHeight:function(){var a=150;this.maxHeight=a+116*_.size(this.projects),this.minHeight=80}}),Wu.SidePane.Users=Wu.SidePane.Item.extend({_:"sidepane.users",type:"users",title:"Users",initContent:function(){this._content=Wu.DomUtil.create("div","fullpage-users",Wu.app._appPane),this._usersControls=Wu.DomUtil.create("div","users-controls",this._content),this._usersControlsInner=Wu.DomUtil.create("div","users-controls-inner",this._usersControls),this._addUser=Wu.DomUtil.createId("div","users-add-user",this._usersControlsInner),this._addUser.innerHTML="Create user",Wu.DomUtil.addClass(this._addUser,"smap-button-gray users"),this._delUser=Wu.DomUtil.createId("div","users-delete-user",this._usersControlsInner),this._delUser.innerHTML="Delete user",Wu.DomUtil.addClass(this._delUser,"smap-button-gray users"),this._search=Wu.DomUtil.createId("input","users-search",this._usersControlsInner),this._search.setAttribute("type","text"),this._search.setAttribute("placeholder","Search users"),Wu.DomUtil.addClass(this._search,"search ct17"),this._container=Wu.DomUtil.create("div","editor-wrapper",this._content,ich.usersPane()),this._tableContainer=Wu.DomUtil.get("users-table-container"),this._tableContainer.innerHTML=ich.usersTableFrame(),this._table=Wu.DomUtil.get("users-insertrows"),this._addUser=Wu.DomUtil.get("users-add-user"),this._mainTitle=Wu.DomUtil.get("user-management-client"),this._deleteUser=Wu.DomUtil.get("users-delete-user"),this._checkall=Wu.DomUtil.get("users-checkbox-all"),this._checkallLabel=Wu.DomUtil.get("label-users-checkbox-all"),this.initList()},addHooks:function(){Wu.DomEvent.on(this._search,"keyup",this.searchList,this)},addEditHooks:function(){Wu.DomEvent.on(this._addUser,"mousedown",this.inputUser,this),Wu.DomEvent.on(this._deleteUser,"mousedown",this.deleteUser,this),Wu.DomEvent.on(this._checkallLabel,"mousedown",this.checkAll,this),Wu.DomUtil.removeClass(this._addUser,"displayNone"),Wu.DomUtil.removeClass(this._deleteUser,"displayNone"),Wu.DomUtil.removeClass(this._addUser,"displayNone")},removeEditHooks:function(){Wu.DomEvent.off(this._addUser,"mousedown",this.inputUser,this),Wu.DomEvent.off(this._deleteUser,"mousedown",this.deleteUser,this),Wu.DomEvent.off(this._checkallLabel,"mousedown",this.checkAll,this),Wu.DomUtil.addClass(this._addUser,"displayNone"),Wu.DomUtil.addClass(this._deleteUser,"displayNone"),Wu.DomUtil.addClass(this._addUser,"displayNone")},_deactivate:function(){},searchList:function(a){if(27==a.keyCode)return this.list.search(),void(this._search.value="");var b=this._search.value;this.list.search(b)},initList:function(){var a=Wu.DomUtil.createId("tr","dummy-table-entry");a.innerHTML=ich.usersTablerow({type:"dummy-table-entry"}),this._table.appendChild(a);var b={valueNames:["name","company","position","phone","email","access"]};this.list=new List("userslist",b),this.list.clear()},updateContent:function(){this.update()},update:function(){this.reset(),this.refreshTable(),this.addEditHooks()},inputUser:function(){Wu.DomUtil.addClass(this._content,"hide-top",this),this._inputUser={};var a="Create new user",b="Enter details for the new user:",c="Password is auto-generated. The user will receive login details on email.",d=this._inputUser._container=Wu.DomUtil.create("div","backpane-container",this._content),e=this._inputUser._wrapper=Wu.DomUtil.create("div","backpane-wrapper",d),f=(this._inputUser._title=Wu.DomUtil.create("div","backpane-title",e,a),this._inputUser._subtitle=Wu.DomUtil.create("div","backpane-subtitle",e,b),this._inputUser._firstName=Wu.DomUtil.create("input","backpane-input",e,"First Name"),this._inputUser._lastName=Wu.DomUtil.create("input","backpane-input",e,"Last Name"),this._inputUser._companyName=Wu.DomUtil.create("input","backpane-input",e,"Company Name"),this._inputUser._position=Wu.DomUtil.create("input","backpane-input",e,"Position"),this._inputUser._phoneNo=Wu.DomUtil.create("input","backpane-input",e,"Phone Number"),this._inputUser._email=Wu.DomUtil.create("input","backpane-input",e,"Email")),g=this._inputUser._email2=Wu.DomUtil.create("input","backpane-input",e,"Confirm Email"),h=(this._inputUser._message=Wu.DomUtil.create("div","backpane-message",e,c),this._inputUser._cancel=Wu.DomUtil.create("div","backpane-cancel smap-button-gray",e,"Cancel")),i=this._inputUser._confirm=Wu.DomUtil.create("div","backpane-confirm smap-button-gray",e,"Confirm");Wu.DomEvent.on(f,"keyup",this.checkUniqueEmail,this),Wu.DomEvent.on(g,"keyup",this.checkSameEmail,this),Wu.DomEvent.on(h,"mousedown",this.cancelInput,this),Wu.DomEvent.on(i,"mousedown",this.confirmInput,this),this._container.style.display="none"},checkUniqueEmail:function(){clearTimeout(this._checkUniqeEmailTimer);var a=this;this._checkUniqeEmailTimer=setTimeout(function(){var b=a._inputUser._email.value,c=JSON.stringify({email:b});Wu.Util.postcb("/api/user/unique",c,a.checkedUniqueEmail,a)},250)},checkedUniqueEmail:function(a,b){var c=JSON.parse(b),d=a._inputUser._email;c.unique?(Wu.DomUtil.addClass(d,"valid"),Wu.DomUtil.removeClass(d,"invalid"),a._inputUser.validEmail=!0):(Wu.DomUtil.addClass(d,"invalid"),Wu.DomUtil.removeClass(d,"valid"),a._inputUser.validEmail=!1)},checkSameEmail:function(){var a=this._inputUser._email,b=this._inputUser._email2;a.value==b.value?(Wu.DomUtil.addClass(b,"valid"),Wu.DomUtil.removeClass(b,"invalid"),this._inputUser.validEmail2=!0):(Wu.DomUtil.addClass(b,"invalid"),Wu.DomUtil.removeClass(b,"valid"),this._inputUser.validEmail2=!1)},cancelInput:function(){Wu.DomUtil.remove(this._inputUser._container),this._container.style.display="block",Wu.DomUtil.removeClass(this._content,"hide-top",this)},confirmInput:function(){var a=this._inputUser._firstName.value,b=this._inputUser._lastName.value,c=this._inputUser._email.value,d=this._inputUser._companyName.value,e=this._inputUser._position.value,f=this._inputUser._phoneNo.value;if(a&&b&&c&&this._inputUser.validEmail2&&this._inputUser.validEmail){var g={lastName:b,firstName:a,email:c,company:d,position:e,phone:f};this.createUser(g),this.cancelInput(),this._container.style.display="block",Wu.DomUtil.removeClass(this._content,"hide-top",this)}},createUser:function(a){var b=JSON.stringify(a);b&&Wu.post("/api/user/new",b,this.createdUser,this)},createdUser:function(a,b){var c=JSON.parse(b),d=new Wu.User(c);d.attachToApp(),a.addTableItem(d)},deleteUser:function(){var a=this.getSelected(),b=Wu.app.Account.store.uuid,c=!1;return a.forEach(function(a){a.uuid==b&&(c=!0)}),c?void 0:void a.forEach(function(a){var b=a.store.firstName+" "+a.store.lastName;confirm("Are you sure you want to delete user "+b+"?")&&confirm("Are you REALLY SURE you want to delete user "+b+"?")&&this.confirmDelete(a)},this)},confirmDelete:function(a){a.deleteUser(this,"deletedUser")},deletedUser:function(a){a.reset(),a.refreshTable()},checkAll:function(){},getSelected:function(){var a=[];for(u in this.users){var b=this.users[u],c=Wu.DomUtil.get("users-checkbox-"+b.store.uuid);if(c)var d=c.checked;d&&a.push(b)}return a},refreshTable:function(){this.users=app.Users;for(u in this.users){var a=this.users[u];this.addTableItem(a)}this.list.sort("name",{order:"asc"})},reset:function(){this.list.clear()},addTableItem:function(a){var b={};b.name=ich.usersTablerowName({firstName:a.getFirstName()||"First name",lastName:a.getLastName()||"Last name",lastNameUuid:"lastName-"+a.getUuid(),firstNameUuid:"firstName-"+a.getUuid()}),b.email=a.getEmail(),b.position=a.getPosition(),b.company=a.getCompany(),b.mobile=a.getMobile(),b.phone=a.getPhone(),b.access=this.getAccessTemplate(a);for(var c=this.list.add(b),d=c[0].elm.children,e=0;e<d.length;e++){var f=d[e];0==e&&(f.children[0].children[0].id="users-checkbox-"+a.getUuid(),f.children[0].children[1].setAttribute("for","users-checkbox-"+a.getUuid())),""==!f.id&&(f.id=f.id+a.getUuid(),f.setAttribute("uuid",a.getUuid()))}this.setEditHooks(a.getUuid())},getAccessTemplate:function(a){var b=a.getProjects();return b.length>1?b.length+" projects":b.length+" project"},getProjectsTemplate:function(a){var b="";if(a.isSuperuser()){for(p in app.Projects){var c=app.Projects[p];if(!c)return;content={name:c.store.name,description:c.store.description,uuid:c.store.uuid},b+=ich.usersTableProjectItem(content)}return b}var d=a.getProjects();return d&&0!=d.length?(d.forEach(function(a){var c=app.Projects[a];c&&(content={name:c.store.name,description:c.store.description,uuid:c.store.uuid},b+=ich.usersTableProjectItem(content))},this),b):b},checkEscape:function(a){27==a.keyCode&&this._popupCancel()},setEditHooks:function(a,b){var b=b||"on",c=Wu.DomUtil.get("lastName-"+a),d=Wu.DomUtil.get("firstName-"+a),e=Wu.DomUtil.get("company-"+a),f=Wu.DomUtil.get("position-"+a),g=Wu.DomUtil.get("phone-"+a),h=Wu.DomUtil.get("email-"+a),i=Wu.DomUtil.get("access-"+a);Wu.DomEvent[b](c,"mousedown mouseup click",this.stop,this)[b](c,"dblclick",this.rename,this)[b](d,"mousedown mouseup click",this.stop,this)[b](d,"dblclick",this.rename,this)[b](e,"mousedown mouseup click",this.stop,this)[b](e,"dblclick",this._rename,this)[b](f,"mousedown mouseup click",this.stop,this)[b](f,"dblclick",this._rename,this)[b](g,"mousedown mouseup click",this.stop,this)[b](g,"dblclick",this._rename,this)[b](h,"mousedown mouseup click",this.stop,this)[b](i,"click",function(){this.editAccess(a)},this)},editAccess:function(a){var b=app.Users[a];this.manageAccess(b),Wu.DomUtil.addClass(this._content,"hide-top",this)},manageAccess:function(a){var b="Manage access for "+a.getName(),c="Manage read, write and manage access for this user.",d="<h4>Guide:</h4>Managers can add READ access to projects they are managers for.";d+="<br>Admins can add READ, WRITE and MANAGE access to projects they have created themselves.";var e=a.isSuperadmin()?"green":"red",f=a.isAdmin()?"green":"red";this._inputAccess={};{var g=this._inputAccess._container=Wu.DomUtil.create("div","backpane-access-container",this._content),h=this._inputAccess._wrapper=Wu.DomUtil.create("div","backpane-access-wrapper",g),i=(this._inputAccess._title=Wu.DomUtil.create("div","backpane-title",h,b),this._inputAccess._subtitle=Wu.DomUtil.create("div","backpane-subtitle",h,c),this._inputAccess._superadmin=Wu.DomUtil.create("div","backpane-superadmin-box "+e,h,"Superadmin"),this._inputAccess._admin=Wu.DomUtil.create("div","backpane-admin-box "+f,h,"Admin"),this._inputAccess._projectTitle=Wu.DomUtil.create("div","backpane-projectTitle",h,"Projects:"),this._inputAccess._projectsWrap=this.insertProjectWrap(a),this._inputAccess._confirm=Wu.DomUtil.create("div","backpane-confirm smap-button-gray",h,"Done"));this._inputAccess._message=Wu.DomUtil.create("div","backpane-message",h,d)}Wu.DomEvent.on(i,"mousedown",this.closeManageAccess,this),this._container.style.display="none"},closeManageAccess:function(){Wu.DomUtil.remove(this._inputAccess._container),this._container.style.display="block",this.update(),Wu.DomUtil.removeClass(this._content,"hide-top",this)},insertProjectWrap:function(a){var b=Wu.DomUtil.create("div","backpane-projects-wrap",this._inputAccess._wrapper),c=this._getProjectAccessSchema();if(0!=c.length){var d=app.Account.isAdmin()||app.Account.isSuperadmin(),e=app.Account.isSuperadmin();return c.forEach(function(c){if(c){var f,g,h=a.canReadProject(c.getUuid())?"gotAccess":"",i=a.canUpdateProject(c.getUuid())?"gotAccess":"",j=a.canManageProject(c.getUuid())?"gotAccess":"",k=c.getName()+" ("+c.getClient().getName()+")",l=Wu.DomUtil.create("div","access-projects-wrap",b),m=Wu.DomUtil.create("div","access-projects-details-wrap",l),n=(Wu.DomUtil.create("div","access-projects-title",m,k),Wu.DomUtil.create("div","access-projects-description",m,c.getDescription()),Wu.DomUtil.create("div","access-projects-read "+h,l,"Read"));e&&(f=Wu.DomUtil.create("div","access-projects-write "+i,l,"Edit")),d&&(g=Wu.DomUtil.create("div","access-projects-manage "+j,l,"Manage"));var o={user:a,project:c,read:n,edit:f,manage:g};Wu.DomEvent.on(n,"mousedown",function(){this.toggleReadAccess(o)},this),e&&Wu.DomEvent.on(f,"mousedown",function(){this.toggleUpdateAccess(o)},this),d&&Wu.DomEvent.on(g,"mousedown",function(){this.toggleManageAccess(o)},this)}},this),b}},toggleReadAccess:function(a){var b=a.user,c=b.store.role.reader.projects.indexOf(a.project.getUuid())>=0?!0:!1;c?(b.removeReadProject(a.project),Wu.DomUtil.removeClass(a.read,"gotAccess")):(b.addReadProject(a.project),Wu.DomUtil.addClass(a.read,"gotAccess"))},toggleUpdateAccess:function(a){var b=a.user,c=b.store.role.editor.projects.indexOf(a.project.getUuid())>=0?!0:!1;c?(b.removeUpdateProject(a.project),Wu.DomUtil.removeClass(a.edit,"gotAccess")):(b.addUpdateProject(a.project),Wu.DomUtil.addClass(a.edit,"gotAccess"),b.canReadProject(a.project.getUuid())||(Wu.DomUtil.addClass(a.read,"gotAccess"),setTimeout(function(){b.addReadProject(a.project)},300)))},toggleManageAccess:function(a){var b=a.user,c=b.store.role.manager.projects.indexOf(a.project.getUuid())>=0?!0:!1;c?(b.removeManageProject(a.project),Wu.DomUtil.removeClass(a.manage,"gotAccess")):(b.addManageProject(a.project),Wu.DomUtil.addClass(a.manage,"gotAccess"),b.canReadProject(a.project.getUuid())||(Wu.DomUtil.addClass(a.read,"gotAccess"),setTimeout(function(){b.addReadProject(a.project)},300)))},_getProjectAccessSchema:function(){var a=[];return app.Account.store.role.manager.projects.forEach(function(b){a.push(app.Projects[b])},this),_.toArray(a)},stop:function(a){a.preventDefault(),a.stopPropagation()},rename:function(a){a.target.removeAttribute("readonly"),a.target.focus(),a.target.selectionStart=a.target.selectionEnd,a.target.fieldKey=a.target.id.split("-")[0],Wu.DomEvent.on(a.target,"blur",this.editBlur,this),Wu.DomEvent.on(a.target,"keydown",this.editKey,this)},editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},editBlur:function(a){var b=a.target.fieldKey;a.target.setAttribute("readonly","readonly");var c=a.target.id.replace(b+"-",""),d=a.target.value||a.target.innerHTML;this.save(b,d,c)},_rename:function(a){var b=a.target,c=a.target.innerHTML,d=a.target.getAttribute("key"),e=a.target.getAttribute("uuid"),f=ich.injectInput({value:c,key:d,uuid:e});b.innerHTML=f;var g=b.firstChild;g.focus(),g.selectionStart=g.selectionEnd,Wu.DomEvent.on(g,"blur",this._editBlur,this),Wu.DomEvent.on(g,"keydown",this._editKey,this)},_editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},_editBlur:function(a){var b=a.target.value,c=a.target.getAttribute("key"),d=a.target.getAttribute("uuid"),e=a.target.parentNode;e.innerHTML=b,this.list.update(),this.save(c,b,d)},save:function(a,b,c){var d=app.Users[c];d.setKey(a,b)}}),Wu.SidePane.Map=Wu.SidePane.Item.extend({_:"sidepane.map",type:"map",title:"Options",initContent:function(){this.app=Wu.app,this._container.innerHTML=ich.editorMapBaseLayer(),this._settingsContainer=Wu.DomUtil.get("mapsettings-container"),this._panes={},this.mapSettings={},this.mapSettings.baselayer=new Wu.SidePane.Map.BaseLayers,this.mapSettings.layermenu=new Wu.SidePane.Map.LayerMenu,this.mapSettings.bounds=new Wu.SidePane.Map.Bounds,this.mapSettings.position=new Wu.SidePane.Map.Position,this.mapSettings.controls=new Wu.SidePane.Map.Controls,this.mapSettings.connect=new Wu.SidePane.Map.Connect(this._settingsContainer),this.mapSettings.settings=new Wu.SidePane.Map.Settings(this._settingsContainer)},addHooks:function(){},_activate:function(){},_deactivate:function(){},updateContent:function(){this._update()},_resetView:function(){},update:function(){this._update()},_update:function(){this.project=app.activeProject;for(s in this.mapSettings){var a=this.mapSettings[s];a.update()}this.setContentHeight()},closeAll:function(){var a=app.SidePane.Map.mapSettings;for(o in a){var b=a[o];b._isOpen&&b.close()}}}),Wu.SidePane.Map.MapSetting=Wu.SidePane.Map.extend({_:"sidepane.map.mapsetting",type:"mapSetting",initialize:function(a){this.panes={},this.mapsettingsContainer=Wu.DomUtil.get("mapsettings-container"),this.getPanes(),this.initLayout(a),this.addHooks()},buttonDown:function(a){Wu.DomUtil.addClass(a.target,"btn-info")},buttonUp:function(a){Wu.DomUtil.removeClass(a.target,"btn-info")},update:function(){this.project=Wu.app.activeProject},addHooks:function(){Wu.DomEvent.on(this._container,"mousedown",this.toggleOpen,this)},removeHooks:function(){},calculateHeight:function(){this.maxHeight=this._inner.offsetHeight+15,this.minHeight=0},pendingOpen:function(){if(app._timerOpen&&clearTimeout(app._timerOpen),!this._isOpen){var a=this;app._timerOpen=setTimeout(function(){a.open(),app._pendingClose&&app._pendingClose.close(),app._pendingClose=a},200)}},toggleOpen:function(){this._isOpen?this.close():this.open()},open:function(){this.calculateHeight(),this._outer.style.height=this.maxHeight+20+"px",this._open(),this._isOpen=!0,app._pendingClose&&app._pendingClose!=this&&app._pendingClose.close(),app._pendingClose=this},close:function(){this.calculateHeight(),this._outer.style.height=this.minHeight+"px",this._close(),this._isOpen=!1,app._pendingClose=!1,app._timerOpen&&clearTimeout(app._timerOpen)},_open:function(){app.SidePane.Map.mapSettings.layermenu.disableEdit()},_close:function(){},initLayout:function(){},getPanes:function(){},sortLayers:function(a){var b=["geojson","mapbox"],c=[];return b.forEach(function(b){var d={key:b,layers:[]};for(l in a){var e=a[l];e.store.data.hasOwnProperty(b)&&d.layers.push(e)}c.push(d)},this),this.numberOfProviders=c.length,c},addProvider:function(a){var b="";"geojson"==a&&(b="Data Library"),"mapbox"==a&&(b="Mapbox");Wu.DomUtil.create("div","item-list-header",this._outer,b)},fillLayers:function(){if(this._layers={},!_.isEmpty(this.project.layers)){var a=this.sortLayers(this.project.layers);a.forEach(function(a){this.addProvider(a.key),a.layers.forEach(function(a){this.addLayer(a)},this)},this),this.calculateHeight()}}}),Wu.SidePane.Map.BaseLayers=Wu.SidePane.Map.MapSetting.extend({_:"sidepane.map.baselayers",type:"baseLayers",getPanes:function(){this._container=Wu.DomUtil.get("editor-map-baselayer-wrap")},initLayout:function(){this._container.innerHTML="<h4>Base Layers</h4>";var a=Wu.DomUtil.createId("div","select-baselayer-wrap",this._container);this._outer=Wu.DomUtil.create("div","select-elems",a),Wu.DomUtil.addClass(a,"select-wrap")},update:function(){Wu.SidePane.Map.MapSetting.prototype.update.call(this),this.editMode=!1,this.initLayout(),this.fillLayers(),this.markOccupied()},removeHooks:function(){},addLayer:function(a){var b=Wu.DomUtil.create("div","item-list select-elem ct0 baselayer",this._outer),c=Wu.DomUtil.create("div","item-list-inner-text",b);c.innerHTML=a.store.title,a.store.title&&a.store.title.length<32&&(c.style.maxHeight="12px");var d=Wu.DomUtil.create("input","baselayer-range-slider-opacity",b),e=Wu.DomUtil.create("input","baselayer-range-slider-zindex",b),f={layer:a,container:b,active:!1,rangeOpacity:d,rangeZindex:e};this.project.store.baseLayers.forEach(function(b){a.store.uuid==b.uuid&&this.on(f)},this),Wu.DomEvent.on(b,"mousedown",function(a){Wu.DomEvent.stop(a),this.toggle(f)},this),this._layers=this._layers||{},this._layers[f.layer.store.uuid]=f},toggleEdit:function(a){var b=a.layer.store.uuid;this.editMode[b]?this.editOff(a):this.editOn(a)},setOpacity:function(){if(this.context.rangeOpacity){var a=parseFloat(this.context.rangeOpacity.element.value/100);this.layer.setOpacity(a);{var b=this.layer.store.uuid,c=_.find(this.context.project.store.baseLayers,function(a){return a.uuid==b});this.context.project}c.opacity=a,this.context.save()}},setZIndex:function(){if(this.context.rangeZindex){var a=parseFloat(this.context.rangeZindex.element.value);this.layer.setZIndex(a);{var b=this.layer.store.uuid,c=_.find(this.context.project.store.baseLayers,function(a){return a.uuid==b});this.context.project}c.zIndex=a,this.context.save()}},save:function(){var a=this;this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(function(){a.project._update("baseLayers")},1e3)},editOn:function(a){var b=a.layer.store.uuid,c=_.find(this.project.store.baseLayers,function(a){return a.uuid==b});if(c)var d=parseInt(100*c.opacity);else var d=1;this.rangeOpacity=new Powerange(a.rangeOpacity,{callback:this.setOpacity,decimal:!1,disable:!1,disableOpacity:.5,hideRange:!1,klass:"powerange-opacity",min:0,max:100,start:d,step:null,vertical:!1,context:this,layer:a.layer}),this.rangeZindex=new Powerange(a.rangeZindex,{callback:this.setZIndex,decimal:!1,disable:!1,disableOpacity:.5,hideRange:!1,klass:"powerange-zindex",min:1,max:10,start:null,step:1,vertical:!1,context:this,layer:a.layer}),a.container.style.height="132px";var e=this.rangeZindex.handle,f=this.rangeZindex.slider;Wu.DomEvent.on(e,"mousedown",Wu.DomEvent.stop,this),Wu.DomEvent.on(f,"mousedown",Wu.DomEvent.stop,this);var e=this.rangeOpacity.handle,f=this.rangeOpacity.slider;Wu.DomEvent.on(e,"mousedown",Wu.DomEvent.stop,this),Wu.DomEvent.on(f,"mousedown",Wu.DomEvent.stop,this),this.calculateHeight(),this.open(),this.editMode=this.editMode||{},this._editsOff();var b=a.layer.store.uuid;this.editMode[b]=a},_editsOff:function(){var a=this.editMode;for(b in a){var c=a[b];this.editOff(c)}},editOff:function(a){a.layer.store.uuid;a.container.style.height="32px";var b=this.rangeZindex.handle,c=this.rangeZindex.slider;Wu.DomEvent.on(b,"mousedown",Wu.DomEvent.stop,this),Wu.DomEvent.on(c,"mousedown",Wu.DomEvent.stop,this),Wu.DomUtil.remove(this.rangeZindex.slider),Wu.DomUtil.remove(this.rangeOpacity.slider),Wu.DomUtil.remove(this.rangeZindex.handle),Wu.DomUtil.remove(this.rangeOpacity.handle),delete this.rangeZindex,delete this.rangeOpacity,this.calculateHeight(),this.open()},toggle:function(a){a.active?(this.off(a),this.disableLayer(a)):(this.on(a),this.enableLayer(a))},on:function(a){Wu.DomUtil.addClass(a.container,"active"),a.active=!0},off:function(a){Wu.DomUtil.removeClass(a.container,"active"),a.active=!1},enableLayer:function(a){a.layer.enable();var b=a.layer.getOpacity();this.project.store.baseLayers.push({uuid:a.layer.store.uuid,zIndex:1,opacity:b}),this.save(),this._refreshControls()},disableLayer:function(a){a&&a.layer&&a.layer.disable(),_.remove(this.project.store.baseLayers,function(b){return b.uuid==a.layer.store.uuid}),this.save(),this._refreshControls()},_refreshControls:function(){var a=app.MapPane.baselayerToggle;a&&a.update();var b=app.SidePane.Map.mapSettings.layermenu;b.markOccupied();var c=app.MapPane.cartoCss;c&&c.update()},calculateHeight:function(){var a=_.size(this.project.getLayermenuLayers()),b=35*this.numberOfProviders;this.maxHeight=33*(_.size(this.project.layers)-a)+b,this.minHeight=0,this.editMode&&(this.maxHeight+=100)},markOccupied:function(){var a=this.project.getLayermenuLayers(),b=this.project.getLayers();b.forEach(function(a){this.activate(a.store.uuid)},this),a.forEach(function(a){var c=_.find(b,function(b){return b.store.uuid==a.layer});c&&this.deactivate(c.store.uuid)},this)},activate:function(a){var b=this._layers[a];Wu.DomUtil.removeClass(b.container,"deactivated")},deactivate:function(a){var b=this._layers[a];Wu.DomUtil.addClass(b.container,"deactivated")}}),Wu.SidePane.Map.LayerMenu=Wu.SidePane.Map.MapSetting.extend({_:"sidepane.map.layermenu",type:"layerMenu",getPanes:function(){this._container=Wu.DomUtil.get("editor-map-layermenu-wrap")},initLayout:function(){this._container.innerHTML="<h4>Layer Menu</h4>",this._inner=Wu.DomUtil.create("div","map-layermenu-inner",this._container),this._outer=Wu.DomUtil.create("div","map-layermenu-outer",this._inner)},update:function(){Wu.SidePane.Map.MapSetting.prototype.update.call(this),this.layerMenu=Wu.app.MapPane.layerMenu,this.editMode=!1,this.initLayout(),this.fillLayers(),this.markOccupied()},addLayer:function(a){var b=Wu.DomUtil.create("div","item-list select-elem ct0",this._outer),c=Wu.DomUtil.create("div","item-list-inner-text",b);c.innerHTML=a.store.title,a.store.title&&a.store.title.length<32&&(c.style.maxHeight="12px");var d=Wu.DomUtil.create("div","edit-layermenu-layer",b),e=Wu.DomUtil.create("input","layermenu-range-slider-opacity",b),f=Wu.DomUtil.create("input","layermenu-range-slider-zindex",b),g={layer:a,container:b,active:!1,rangeOpacity:e,rangeZindex:f};this._layers[a.store.uuid]=g,this.project.store.layermenu.forEach(function(b){a.store.uuid==b.layer&&this.on(g)},this),Wu.DomEvent.on(b,"mousedown",function(a){Wu.DomEvent.stop(a),this.toggle(g)},this),Wu.DomEvent.on(d,"mousedown",function(a){Wu.DomEvent.stop(a)},this)},getLayerByUuid:function(a){var b=_.find(this._layers,function(b){return b.layer.store.uuid==a});return b},enableLayerByUuid:function(a){var b=this.getLayerByUuid(a);return b?(this.toggle(b),b):!1},calculateHeight:function(){var a=_.size(this.project.getBaselayers()),b=35*this.numberOfProviders;this.maxHeight=33*(_.size(this.project.layers)-a)+b,this.minHeight=0,this.editMode&&(this.maxHeight+=100)},enableLayermenu:function(){var a=app.MapPane.enableLayermenu();return app.SidePane.Map.mapSettings.controls.enableControl("layermenu"),this.project.store.controls.layermenu=!0,this.project._update("controls"),a},toggle:function(a){if(this.layerMenu=this.layerMenu||Wu.app.MapPane.layerMenu,this.layerMenu||(this.layerMenu=this.enableLayermenu()),a.active){var b=a.layer.store.uuid;this.layerMenu._remove(b),this.off(a)}else this.layerMenu.add(a.layer),this.on(a);var c=app.SidePane.Map.mapSettings.baselayer;c.markOccupied();var d=app.MapPane.cartoCss;d&&d.update()},toggleEdit:function(){},on:function(a){Wu.DomUtil.addClass(a.container,"active"),a.active=!0},off:function(a){Wu.DomUtil.removeClass(a.container,"active"),a.active=!1},_off:function(a){var b=a.store.uuid,c=this._layers[b];this.off(c)},_open:function(){this.enableEdit(),clearTimeout(this.closeEditTimer)},_close:function(){clearTimeout(this.closeEditTimer);var a=this;this.closeEditTimer=setTimeout(function(){a.disableEdit()},3e3)},enableEdit:function(){var a=Wu.app.MapPane.layerMenu;a&&a.enableEdit()},disableEdit:function(){var a=Wu.app.MapPane.layerMenu;a&&a.disableEdit()},markOccupied:function(){var a=this.project.getBaselayers(),b=this.project.getLayers();b.forEach(function(a){this.activate(a.store.uuid)},this),a.forEach(function(a){this.deactivate(a.uuid)},this)},activate:function(a){var b=this._layers[a];b&&Wu.DomUtil.removeClass(b.container,"deactivated")},deactivate:function(a){var b=this._layers[a];b&&Wu.DomUtil.addClass(b.container,"deactivated")}}),Wu.SidePane.Map.Position=Wu.SidePane.Map.MapSetting.extend({_:"sidepane.map.position",type:"position",getPanes:function(){this._container=Wu.DomUtil.get("editor-map-position-wrap"),this._outer=Wu.DomUtil.get("editor-map-initpos-coordinates"),this._inner=Wu.DomUtil.get("map-initpos-inner"),this.panes.initPos=Wu.DomUtil.get("editor-map-initpos-button"),this.panes.initPosLatValue=Wu.DomUtil.get("editor-map-initpos-lat-value"),this.panes.initPosLngValue=Wu.DomUtil.get("editor-map-initpos-lng-value"),this.panes.initPosZoomValue=Wu.DomUtil.get("editor-map-initpos-zoom-value"),this.toggled=!1},addHooks:function(){Wu.SidePane.Map.MapSetting.prototype.addHooks.call(this),Wu.DomEvent.on(this.panes.initPos,"click",this.setPosition,this),Wu.DomEvent.on(this.panes.initPos,"mousedown",this.buttonDown,this),Wu.DomEvent.on(this.panes.initPos,"mouseup",this.buttonUp,this),Wu.DomEvent.on(this.panes.initPos,"mouseleave",this.buttonUp,this),Wu.DomEvent.on(this.panes.initPos,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.initPosLatValue,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.initPosLngValue,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.initPosZoomValue,"mousedown",Wu.DomEvent.stopPropagation,this)},removeHooks:function(){},toggleDropdown:function(){this.toggled?(this.toggled=!1,this.close()):(this.toggled=!0,this.open())},setPosition:function(){var a=app.activeProject;if(a){var b=Wu.app._map.getCenter(),c=Wu.app._map.getZoom(),d={lat:b.lat,lng:b.lng,zoom:c};a.setPosition(d),this.update()}},update:function(){Wu.SidePane.Map.MapSetting.prototype.update.call(this);var a=this.project.getLatLngZoom();this.panes.initPosLatValue.value=a.lat,this.panes.initPosLngValue.value=a.lng,this.panes.initPosZoomValue.value=a.zoom},save:function(){var a=this;this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(function(){a.project._update("position")},1e3)}}),Wu.SidePane.Map.Bounds=Wu.SidePane.Map.MapSetting.extend({_:"sidepane.map.bounds",type:"bounds",getPanes:function(){this._container=Wu.DomUtil.get("editor-map-bounds-wrap"),this._outer=Wu.DomUtil.get("editor-map-bounds-coordinates"),this._inner=Wu.DomUtil.get("map-bounds-inner"),this.panes.clear=Wu.DomUtil.get("editor-map-bounds-clear"),this.panes.bounds=Wu.DomUtil.get("editor-map-bounds"),this.panes.boundsNELatValue=Wu.DomUtil.get("editor-map-bounds-NE-lat-value"),this.panes.boundsNELngValue=Wu.DomUtil.get("editor-map-bounds-NE-lng-value"),this.panes.boundsSWLatValue=Wu.DomUtil.get("editor-map-bounds-SW-lat-value"),this.panes.boundsSWLngValue=Wu.DomUtil.get("editor-map-bounds-SW-lng-value"),this.panes.boundsNE=Wu.DomUtil.get("editor-map-bounds-NE"),this.panes.boundsSW=Wu.DomUtil.get("editor-map-bounds-SW"),this.panes.minZoom=Wu.DomUtil.get("editor-map-bounds-min-zoom-value"),this.panes.maxZoom=Wu.DomUtil.get("editor-map-bounds-max-zoom-value"),this.panes.setMinZoom=Wu.DomUtil.get("editor-map-bounds-set-minZoom"),this.panes.setMaxZoom=Wu.DomUtil.get("editor-map-bounds-set-maxZoom"),this.toggled=!1
},addHooks:function(){Wu.SidePane.Map.MapSetting.prototype.addHooks.call(this),Wu.DomEvent.on(this.panes.bounds,"click",this.setBounds,this),Wu.DomEvent.on(this.panes.clear,"click",this.clearBounds,this),Wu.DomEvent.on(this.panes.boundsNE,"click",this.setBoundsNE,this),Wu.DomEvent.on(this.panes.boundsSW,"click",this.setBoundsSW,this),Wu.DomEvent.on(this.panes.setMinZoom,"click",this.setMinZoom,this),Wu.DomEvent.on(this.panes.setMaxZoom,"click",this.setMaxZoom,this),Wu.DomEvent.on(this.panes.bounds,"mousedown",this.buttonDown,this),Wu.DomEvent.on(this.panes.bounds,"mouseup",this.buttonUp,this),Wu.DomEvent.on(this.panes.bounds,"mouseleave",this.buttonUp,this),Wu.DomEvent.on(this.panes.clear,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.bounds,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.boundsNELatValue,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.boundsNELngValue,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.boundsSWLatValue,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.boundsSWLngValue,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.boundsNE,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.boundsSW,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.minZoom,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.maxZoom,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.setMinZoom,"mousedown",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this.panes.setMaxZoom,"mousedown",Wu.DomEvent.stopPropagation,this)},removeHooks:function(){},setBounds:function(){var a=app.activeProject;if(a){var b=Wu.app._map.getBounds(),c=Wu.app._map.getZoom();a.setBounds({northEast:{lat:b._northEast.lat,lng:b._northEast.lng},southWest:{lat:b._southWest.lat,lng:b._southWest.lng},minZoom:c,maxZoom:18}),this.update(),this.enforceBounds()}},setMinZoom:function(){var a=app._map,b=a.getZoom(),c=this.project.getBounds();c.minZoom=b,this.project.setBounds(c),this.update()},setMaxZoom:function(){var a=app._map,b=a.getZoom(),c=this.project.getBounds();c.maxZoom=parseInt(b),this.project.setBounds(c),this.update()},enforceBounds:function(){var a=app.activeProject,b=app._map,c=a.getBounds();if(c){var d=L.latLng(c.southWest.lat,c.southWest.lng),e=L.latLng(c.northEast.lat,c.northEast.lng),f=L.latLngBounds(d,e),g=c.minZoom,h=c.maxZoom;b.setMaxBounds(c==this._nullBounds?!1:f),b.options.minZoom=g,b.options.maxZoom=h}b.invalidateSize()},_nullBounds:{northEast:{lat:"90",lng:"180"},southWest:{lat:"-90",lng:"-180"},minZoom:"1",maxZoom:"20"},clearBounds:function(){var a=Wu.app.activeProject,b=Wu.app._map;a.setBounds(this._nullBounds),this.update(),this.enforceBounds(),b.setMaxBounds(!1)},setBoundsSW:function(){var a=Wu.app.activeProject,b=Wu.app._map;if(a){var c=b.getBounds(),d=b.getZoom();a.setBoundsSW({lat:c._southWest.lat,lng:c._southWest.lng}),a.setBoundsZoomMin(d),this.update(),b.setMaxBounds(c)}},setBoundsNE:function(){var a=app.activeProject;if(a){var b=app._map.getBounds();a.setBoundsNE({lat:b._northEast.lat,lng:b._northEast.lng}),this.update()}},toggleDropdown:function(){this.toggled?(this.toggled=!1,this.close()):(this.toggled=!0,this.open())},update:function(){Wu.SidePane.Map.MapSetting.prototype.update.call(this);var a=this.project.getBounds();a&&(this.panes.boundsNELatValue.value=a.northEast.lat,this.panes.boundsNELngValue.value=a.northEast.lng,this.panes.boundsSWLatValue.value=a.southWest.lat,this.panes.boundsSWLngValue.value=a.southWest.lng,this.panes.maxZoom.value=a.maxZoom,this.panes.minZoom.value=a.minZoom),this.enforceBounds()},save:function(){var a=this;this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(function(){a.project._update("bounds")},1e3)}}),Wu.SidePane.Map.Controls=Wu.SidePane.Map.MapSetting.extend({_:"sidepane.map.controls",type:"controls",getPanes:function(){this._container=Wu.DomUtil.get("editor-map-controls-wrap"),this._outer=Wu.DomUtil.get("editor-map-controls-inner-wrap"),this.panes.controlZoom=Wu.DomUtil.get("map-controls-zoom").parentNode.parentNode,this.panes.controlDraw=Wu.DomUtil.get("map-controls-draw").parentNode.parentNode,this.panes.controlInspect=Wu.DomUtil.get("map-controls-inspect").parentNode.parentNode,this.panes.controlDescription=Wu.DomUtil.get("map-controls-description").parentNode.parentNode,this.panes.controlLayermenu=Wu.DomUtil.get("map-controls-layermenu").parentNode.parentNode,this.panes.controlLegends=Wu.DomUtil.get("map-controls-legends").parentNode.parentNode,this.panes.controlMeasure=Wu.DomUtil.get("map-controls-measure").parentNode.parentNode,this.panes.controlGeolocation=Wu.DomUtil.get("map-controls-geolocation").parentNode.parentNode,this.panes.controlMouseposition=Wu.DomUtil.get("map-controls-mouseposition").parentNode.parentNode,this.panes.controlBaselayertoggle=Wu.DomUtil.get("map-controls-baselayertoggle").parentNode.parentNode,this.panes.controlCartocss=Wu.DomUtil.get("map-controls-cartocss").parentNode.parentNode},addHooks:function(){Wu.SidePane.Map.MapSetting.prototype.addHooks.call(this),Wu.DomEvent.on(this.panes.controlZoom,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlDraw,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlInspect,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlDescription,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlLayermenu,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlLegends,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlMeasure,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlGeolocation,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlMouseposition,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlBaselayertoggle,"mousedown click",this.toggleControl,this),Wu.DomEvent.on(this.panes.controlCartocss,"mousedown click",this.toggleControl,this)},removeHooks:function(){},calculateHeight:function(){var a=_.size(this.controls);this.maxHeight=30*a+30,this.minHeight=0},toggleControl:function(a){if("click"==a.type)return Wu.DomEvent.stop(a);Wu.DomEvent.stop(a);var b=a.target.getAttribute("which"),c=Wu.DomUtil.get("map-controls-"+b),d=!c.checked,e="enable"+b.camelize(),f="disable"+b.camelize(),g=app.MapPane;d?(g[e](),this.enableControl(b)):(g[f](),this.disableControl(b)),this.project.store.controls[b]=d,this.project._update("controls"),g.updateControlCss()},disableControl:function(a){{var b=Wu.DomUtil.get("map-controls-"+a),c=Wu.DomUtil.get("map-controls-title-"+a).parentNode;Wu.app._map}Wu.DomUtil.removeClass(c,"active"),b.checked=!1},enableControl:function(a){{var b=Wu.DomUtil.get("map-controls-"+a),c=Wu.DomUtil.get("map-controls-title-"+a).parentNode;Wu.app._map}Wu.DomUtil.addClass(c,"active"),b.checked=!0},update:function(){Wu.SidePane.Map.MapSetting.prototype.update.call(this),this.controls=this.project.getControls(),delete this.controls.vectorstyle;for(c in this.controls){var a=this.controls[c],b="enable"+c.camelize(),d="disable"+c.camelize();a?(Wu.app.MapPane[b](),this.enableControl(c)):(Wu.app.MapPane[d](),this.disableControl(c))}}}),Wu.SidePane.Map.Connect=Wu.SidePane.Map.MapSetting.extend({_:"sidepane.map.connect",type:"connect",initLayout:function(a){this._container=Wu.DomUtil.create("div","editor-inner-wrapper editor-map-item-wrap ct12 ct17 ct23",a);Wu.DomUtil.create("h4","",this._container,"Connected Accounts");this._outer=Wu.DomUtil.create("div","connect-outer",this._container);{var b=Wu.DomUtil.create("div","connect-mapbox",this._outer);Wu.DomUtil.create("div","connect-mapbox-title",b,"Mapbox")}this._mapboxWrap=Wu.DomUtil.create("div","mapbox-connect-wrap ct11",this._outer),this._mapboxInput=Wu.DomUtil.create("input","input-box search import-mapbox-layers",this._mapboxWrap),this._mapboxConnect=Wu.DomUtil.create("div","smap-button-gray ct0 ct11 import-mapbox-layers-button",this._mapboxWrap,"Add"),this._mapboxAccounts=Wu.DomUtil.create("div","mapbox-accounts",this._mapboxWrap),this.resetInput()},addHooks:function(){Wu.SidePane.Map.MapSetting.prototype.addHooks.call(this),Wu.DomEvent.on(this._mapboxConnect,"click",this.importMapbox,this),Wu.DomEvent.on(this._mapboxConnect,"mousedown",Wu.DomEvent.stop,this),Wu.DomEvent.on(this._mapboxInput,"mousedown",Wu.DomEvent.stopPropagation,this)},removeHooks:function(){},calculateHeight:function(){var a=this.project.getMapboxAccounts().length;this.maxHeight=100+30*a,this.minHeight=0},tokenMode:function(){this._username=this._mapboxInput.value,this._mapboxInput.value="",this._askedToken=!0,this._mapboxConnect.innerHTML="OK",this._mapboxInput.setAttribute("placeholder","Enter access token")},resetInput:function(){this._username=null,delete this._username,this._askedToken=!1,this._mapboxConnect.innerHTML="Add",this._mapboxInput.setAttribute("placeholder","Mapbox username"),this._mapboxInput.value=""},importMapbox:function(){if(!this._askedToken)return this.tokenMode();var a=this._username,b=this._mapboxInput.value;this.resetInput(),this._importMapbox(a,b)},_importMapbox:function(a,b){var c={username:a,accessToken:b,projectId:this.project.store.uuid};Wu.post("/api/util/getmapboxaccount",JSON.stringify(c),this.importedMapbox,this)},importedMapbox:function(a,b){var c=JSON.parse(b),d=c.error,e=c.project;d||a.project.setStore(e)},fillMapbox:function(){var a=this.project.getMapboxAccounts();a&&(this._mapboxAccounts.innerHTML="",a.forEach(function(a){{var b=Wu.DomUtil.create("div","mapbox-listed-account",this._mapboxAccounts);Wu.DomUtil.create("div","mapbox-listed-account-title",b,a.username.camelize())}},this))},removeAccount:function(a,b){Wu.DomUtil.remove(a),this.project.removeMapboxAccount(b)},update:function(){Wu.SidePane.Map.MapSetting.prototype.update.call(this),this.fillMapbox()}}),Wu.SidePane.Map.Settings=Wu.SidePane.Map.MapSetting.extend({_:"sidepane.map.settings",type:"settings",options:{screenshot:!0,socialSharing:!0,documentsPane:!0,dataLibrary:!0,mediaLibrary:!1,autoHelp:!0,autoAbout:!0,darkTheme:!0,tooltips:!0,mapboxGL:!1},initLayout:function(a){this._container=Wu.DomUtil.create("div","editor-inner-wrapper editor-map-item-wrap ct12 ct17 ct23",a);Wu.DomUtil.create("h4","",this._container,"Settings");this._outer=Wu.DomUtil.create("div","settings-outer",this._container)},addHooks:function(){Wu.SidePane.Map.MapSetting.prototype.addHooks.call(this),Wu.DomEvent.on(this._outer,"mousedown",Wu.DomEvent.stopPropagation,this)},removeHooks:function(){Wu.DomEvent.off(this._outer,"mousedown",Wu.DomEvent.stopPropagation,this)},calculateHeight:function(){var a=_.filter(this.options,function(a){return a}).length;this.maxHeight=30*a,this.minHeight=0},contentLayout:function(){var a=Wu.DomUtil.create("div","settings-wrapper");if(this.options.screenshot){var b=this._contentItem("screenshot","Screenshots");a.appendChild(b)}if(this.options.socialSharing){var c=this._contentItem("socialSharing","Social Sharing");a.appendChild(c)}if(this.options.documentsPane){var d=this._contentItem("documentsPane","Documents Pane");a.appendChild(d)}if(this.options.dataLibrary){var e=this._contentItem("dataLibrary","Data Library");a.appendChild(e)}if(this.options.mediaLibrary){var f=this._contentItem("mediaLibrary","Media Library");a.appendChild(f)}if(this.options.autoHelp){var g=this._contentItem("autoHelp","Add Help");a.appendChild(g)}if(this.options.autoAbout){var h=this._contentItem("autoAbout","Add About");a.appendChild(h)}if(this.options.darkTheme){var i=this._contentItem("darkTheme","Dark Theme");a.appendChild(i)}if(this.options.tooltips){var j=this._contentItem("tooltips","Tooltips");a.appendChild(j)}if(this.options.mapboxGL){var k=this._contentItem("mapboxGL","MapboxGL");a.appendChild(k)}return a},_contentItem:function(a,b){var c="settings-item settings-item-"+a,d=Wu.DomUtil.create("div",c),e=Wu.DomUtil.create("div","settings-item-title",d),f=Wu.DomUtil.create("div","switch",d),g=Wu.DomUtil.create("input","cmn-toggle cmn-toggle-round-flat",f),h=Wu.DomUtil.create("label","",f),i=Wu.Util.guid();return e.innerHTML=b,g.setAttribute("type","checkbox"),this._settings[a]&&g.setAttribute("checked","checked"),g.id=i,h.setAttribute("for",i),Wu.DomEvent.on(g,"click",function(b){Wu.DomEvent.stopPropagation(b),this.project.toggleSetting(a),this._settings=this.project.getSettings()},this),Wu.DomEvent.on(f,"mousedown",Wu.DomEvent.stopPropagation),d},save:function(){this.project.setSettings(this._settings)},update:function(){Wu.SidePane.Map.MapSetting.prototype.update.call(this),this._settings=this.project.getSettings();var a=this.contentLayout();this._outer.innerHTML="",this._outer.appendChild(a)}}),Wu.SidePane.Documents=Wu.SidePane.Item.extend({type:"documents",title:"Docs",initContent:function(){this._content=Wu.DomUtil.create("div","fullpage-documents ct1",Wu.app._appPane),this._container=Wu.DomUtil.create("div","editor-wrapper ct11",this._content),this._container.innerHTML=ich.documentsContainer(),this._leftpane=Wu.DomUtil.get("documents-container-leftpane"),this._folderpane=Wu.DomUtil.get("documents-folder-list"),this._rightpane=Wu.DomUtil.get("documents-container-rightpane"),this._textarea=Wu.DomUtil.get("documents-container-textarea"),this._newfolder=Wu.DomUtil.get("documents-new-folder")},initFolders:function(){this.folders={};var a=this.project.store.folders;a.forEach(function(a){this.folders[a.uuid]=a},this)},addHooks:function(){},addEditHooks:function(){Wu.DomEvent.on(this._newfolder,"mousedown",this.newFolder,this),this.addGrande(),Wu.DomUtil.removeClass(this._newfolder,"displayNone")},addGrande:function(){var a=this._textarea,b=this.project.getFiles(),c=this.project.getGrandeFiles(b),d=this.project.getGrandeImages(b),e={plugins:{attachments:new G.Attachments(c,{icon:[app.options.servers.portal+"images/image-c9471cb2-7e0e-417d-a048-2ac501e7e96f",app.options.servers.portal+"images/image-7b7cc7e4-404f-4e29-9d7d-11f0f24faf42"],className:"attachment"}),images:new G.Attachments(d,{icon:[app.options.servers.portal+"images/image-0359b349-6312-4fe5-b5d7-346a7a0d3c38",app.options.servers.portal+"images/image-087ef5f5-b838-48bb-901f-7e896de7c59e"],embedImage:!0,className:"image-attachment"})},events:{change:this.textChange}};this.grande=G.rande(a,e)},removeGrande:function(){this.grande&&(this.grande.destroy(),delete this.grande)},textChange:function(){},removeEditHooks:function(){Wu.DomEvent.off(this._newfolder,"mousedown",this.newFolder,this),this.removeGrande(),Wu.DomUtil.addClass(this._newfolder,"displayNone")},_activate:function(){this.adjustTop(),Wu.app.HeaderPane.disableResize();var a=this.project.store.folders;if(a.length>0){var b=a[0].uuid;this.selectFolder(b)}this.project.editMode&&(this.enableShift(),this.addEditHooks())},_deactivate:function(){Wu.app.HeaderPane.enableResize(),this.disableShift(),this.removeEditHooks()},enableShift:function(){Wu.DomEvent.on(window,"keydown",this.shiftMode,this),Wu.DomEvent.on(window,"keyup",this.unshiftMode,this)},disableShift:function(){Wu.DomEvent.off(window,"keydown",this.shiftMode,this),Wu.DomEvent.off(window,"keyup",this.unshiftMode,this)},shiftMode:function(a){var c=a||window.event;if(16==c.which)for(b in this._deleteButtons){var d=this._deleteButtons[b];d.style.visibility="visible"}},unshiftMode:function(a){var c=a||window.event;if(16==c.which)for(b in this._deleteButtons){var d=this._deleteButtons[b];d.style.visibility="hidden"}},adjustTop:function(){return},update:function(){this.project=app.activeProject,this.reset(),this.createFolders(),this.project.editMode?Wu.DomUtil.removeClass(this._newfolder,"displayNone"):Wu.DomUtil.addClass(this._newfolder,"displayNone")},updateContent:function(){this._textarea.innerHTML="",this.update()},newFolder:function(){var a={title:"Title",uuid:Wu.Util.guid("folder"),content:"Text content"};this.project.store.folders.push(a),this.update()},createFolders:function(){var a=this.project.store.folders;a&&(this._deleteButtons={},a.forEach(function(a){this._createFolder(a)},this))},_createFolder:function(a){if(this.project.editMode){var b=Wu.DomUtil.create("div","documents-folder-delete",this._folderpane,"x");Wu.DomEvent.on(b,"click",function(){this.deleteFolder(a.uuid)},this),this._deleteButtons[a.uuid]=b}var c=a;c.el=Wu.DomUtil.create("div","documents-folder-item ct23 ct28",this._folderpane),c.el.innerHTML=c.title,Wu.DomEvent.on(c.el,"mousedown",function(){this.selectFolder(c.uuid)},this),this.project.editMode&&Wu.DomEvent.on(c.el,"dblclick",function(a){this._renameFolder(a,c.uuid)},this),this.folders[c.uuid]=c},deleteFolder:function(a){confirm("Are you sure you want to delete folder "+this.folders[a].title+"?")&&(delete this.folders[a],this.save())},_renameFolder:function(a,b){this._editing=!0,this.disableShift();var c=a.target,d=a.target.innerHTML,e=ich.injectFolderTitleInput({value:d});c.innerHTML=e;var f=c.firstChild;f.focus(),f.selectionStart=f.selectionEnd,Wu.DomEvent.on(f,"blur",function(a){this._titleBlur(a,b)},this),Wu.DomEvent.on(f,"keydown",function(a){this._titleKey(a,b)},this)},_titleKey:function(a,b){(13==event.which||13==event.keyCode)&&this._titleBlur(a,b)},_titleBlur:function(a,b){if(this._editing){this._editing=!1;var c=a.target.value,d=a.target.parentNode;d.innerHTML=c,this.folders[b].title=c,this.save(),this.enableShift()}},selectFolder:function(a){var b=this.folders[a];Wu.DomEvent.off(this._textarea,"keydown mousedown",this.autosave,this),this._textarea.innerHTML="",this._textarea.innerHTML=b.content,this._textarea.fuuid=a,this._textarea.blur(),this.underline(a),Wu.DomEvent.on(this._textarea,"keydown mousedown",this.autosave,this)},underline:function(a){for(f in this.folders){var b=this.folders[f].el,c=this.folders[f].uuid;a==c?Wu.DomUtil.addClass(b,"underline"):Wu.DomUtil.removeClass(b,"underline")}},autosave:function(){var a=this;clearTimeout(this._saving),this._saving=setTimeout(function(){a.saveText()},500)},saveText:function(){var a=this.folders[this._textarea.fuuid].content,b=this._textarea.innerHTML;a!=b&&(this.folders[this._textarea.fuuid].content=b,this.save())},save:function(){var a=this.folders;this.project.store.folders=[];for(f in a){var b=Wu.extend({},a[f]);delete b.el,this.project.store.folders.push(b)}this.project._update("folders"),app.setSaveStatus(),this.update()},reset:function(){this._folderpane.innerHTML="",this.folders={}}}),Wu.SidePane.DataLibrary=Wu.SidePane.Item.extend({_:"sidepane.datalibrary",type:"dataLibrary",title:"Data <br> Library",initContent:function(){this._content=Wu.DomUtil.create("div","data-library ct1",Wu.app._appPane),this._controlContainer=Wu.DomUtil.create("div","datalibrary-controls",this._content),this._controlInner=Wu.DomUtil.create("div","datalibrary-controls-inner",this._controlContainer),this._uploadContainer=Wu.DomUtil.createId("div","upload-container",this._controlInner),this._uploadContainer.innerHTML="Upload",Wu.DomUtil.addClass(this._uploadContainer,"smap-button-gray ct17"),this._search=Wu.DomUtil.createId("input","datalibrary-search",this._controlInner),this._search.setAttribute("type","text"),this._search.setAttribute("placeholder","Search files"),Wu.DomUtil.addClass(this._search,"search ct17"),this._delete=Wu.DomUtil.createId("div","datalibrary-delete-file",this._controlInner),this._delete.innerHTML="Delete",Wu.DomUtil.addClass(this._delete,"smap-button-gray"),this._download=Wu.DomUtil.createId("div","datalibrary-download-files",this._controlInner),Wu.DomUtil.addClass(this._download,"smap-button-gray"),this._download.innerHTML="Download",this._errors=Wu.DomUtil.createId("div","datalibrary-errors",this._controlInner),Wu.DomUtil.addClass(this._download,"smap-button-gray"),this._container=Wu.DomUtil.create("div","editor-wrapper ct1",this._content),this._downloadList=Wu.DomUtil.createId("div","datalibrary-download-dialogue",this._content),this.progress=Wu.DomUtil.create("div","progress-bar",this._content),this._container.innerHTML=ich.datalibraryContainer(),this._tableContainer=Wu.DomUtil.get("datalibrary-table-container"),this.fulldrop=Wu.DomUtil.create("div","fullscreen-drop",this._content),this.filecount=0,this._tableContainer.innerHTML=ich.datalibraryTableframe(),this._table=Wu.DomUtil.get("datalibrary-insertrows"),this._errors=Wu.DomUtil.get("datalibrary-errors"),this._uploader=Wu.DomUtil.get("upload-container"),this._deleter=Wu.DomUtil.get("datalibrary-delete-file"),this._downloader=Wu.DomUtil.get("datalibrary-download-files"),this._checkall=Wu.DomUtil.get("checkbox-all"),this._checkallLabel=Wu.DomUtil.get("label-checkbox-all"),this.initList(),this.initDZ(),this.initDownloadTable()},addHooks:function(){Wu.DomEvent.on(this._downloader,"mousedown",this.downloadConfirm,this),Wu.DomEvent.on(this._checkallLabel,"mousedown",this.checkAll,this),Wu.DomEvent.on(this._search,"keyup",this.searchList,this)},addEditHooks:function(){Wu.DomEvent.on(this._deleter,"mousedown",this.deleteConfirm,this),Wu.DomUtil.removeClass(this._deleter,"displayNone")},removeEditHooks:function(){Wu.DomEvent.off(this._deleter,"mousedown",this.deleteConfirm,this),Wu.DomUtil.addClass(this._deleter,"displayNone")},searchList:function(a){if(27==a.keyCode)return this.list.search(),void(this._search.value="");var b=this._search.value;this.list.search(b)},_activate:function(){this.dz&&this.dz.enable()},_deactivate:function(){this.dz.disable(),this.disableFullscreenDZ()},initDownloadTable:function(){var a=ich.datalibraryTableDownload();this._downloadList.innerHTML=a,this._downloadOK=Wu.DomUtil.get("download-ok-button"),this._downloadCancel=Wu.DomUtil.get("download-cancel-button"),Wu.DomEvent.on(this._downloadOK,"mousedown",this.downloadFiles,this),Wu.DomEvent.on(this._downloadCancel,"mousedown",this.downloadCancel,this)},checkAll:function(){if(this._checkall.checked){var a=this.list.visibleItems;a.forEach(function(a){var b=a.elm.children[0].childNodes[1].children[0];b.checked&&(b.checked=!1)},this)}else{var a=this.list.visibleItems;a.forEach(function(a){var b=a.elm.children[0].childNodes[1].children[0];b.checked||(b.checked=!0)},this)}},downloadFiles:function(){var a=[];this._downloadFileList.forEach(function(b){a.push(b.uuid)},this);var b={files:this._downloadFileList,puuid:this.project.store.uuid,pslug:this.project.store.slug},b=JSON.stringify(b);Wu.post("/api/file/download",b,this.receivedDownload,this)},receivedDownload:function(a,b){var c="/api/file/download?file="+b+"&type=zip";a._downloadList.innerHTML=ich.datalibraryDownloadReady({url:c});var d=Wu.DomUtil.get("download-ready-button");Wu.DomEvent.on(d,"click",a.downloadDone,a),this._downloadList&&(this._downloadList.style.display="none"),this._container&&(this._container.style.display="block")},downloadCancel:function(){this._downloadFileList=[],this._downloadList&&(this._downloadList.style.display="none"),this._container&&(this._container.style.display="block"),Wu.DomUtil.removeClass(this._content,"hide-top",this)},downloadDone:function(){var a=this;setTimeout(function(){a.downloadCancel(),a.initDownloadTable()},1e3)},downloadConfirm:function(){var a=this.getSelected();if(this._downloadFileList=a,0!=a.length){var b="";a.forEach(function(a){var c=Wu.extend({},a);b+=ich.datalibraryDownloadRow(c)},this);var c=Wu.DomUtil.get("datalibrary-download-insertrows");c.innerHTML=b,this._downloadList.style.display="block",this._container.style.display="none",Wu.DomUtil.addClass(this._content,"hide-top",this)}},getSelected:function(){var a=[];return this.project.store.files.forEach(function(b){var c=Wu.DomUtil.get("checkbox-"+b.uuid);if(c)var d=c.checked;d&&a.push(b)},this),a},deleteConfirm:function(){var a=this.getSelected();0!=a.length&&confirm("Are you sure you want to delete these "+a.length+" files?")&&this.deleteFiles(a)},deleteFiles:function(a){app.setStatus("Deleting"),this.project.removeFiles(a),app.setStatus("Deleted!"),this.project.refreshSidepane()},initList:function(){var a=Wu.DomUtil.createId("tr","dummy-table-entry");a.innerHTML=ich.datalibraryTablerow({type:"dummy-table-entry"}),this._table.appendChild(a);var b={valueNames:["name","file","category","keywords","date","status","type"]};this.list=new List("filelist",b),this.list.clear()},initDZ:function(){this.dz=new Dropzone(this._uploader,{url:"/api/upload",createImageThumbnails:!1,autoDiscover:!1,uploadMultiple:!0,acceptedFiles:".zip,.gz,.png,.jpg,.jpeg,.geojson,.docx,.pdf,.doc,.txt",maxFiles:10,parallelUploads:10}),this.enableFullscreenDZ()},enableFullscreenDZ:function(){Wu.DomEvent.on(document,"dragenter",this.dropping,this),Wu.DomEvent.on(document,"dragleave",this.undropping,this),Wu.DomEvent.on(document,"dragover",this.dragover,this),Wu.DomEvent.on(document,"drop",this.dropped,this)},disableFullscreenDZ:function(){Wu.DomEvent.off(document,"dragenter",this.dropping,this),Wu.DomEvent.off(document,"dragleave",this.undropping,this),Wu.DomEvent.off(document,"dragover",this.dragover,this),Wu.DomEvent.off(document,"drop",this.dropped,this)},refreshDZ:function(){var a=this;this.dz.removeAllListeners(),this.dz.options.params.project=this.project.getUuid(),this.dz.on("drop",function(){}),this.dz.on("dragenter",function(){}),this.dz.on("addedfile",function(b){a.progress.style.opacity=1,a._fulldrop||(a.fullOn(b),a.fullUpOn(b)),app.setStatus("Uploading")}),this.dz.on("complete",function(b){a.dz.removeFile(b)}),this.dz.on("uploadprogress",function(b,c){a.progress.style.width=c+"%"}),this.dz.on("successmultiple",function(b,c){var d=Wu.parse(c);app.setStatus("Done!",2e3),d&&a.uploaded(d),a.resetProgressbar()})},resetProgressbar:function(){this.progress.style.opacity=0,this.progress.style.width="0%",this.fulldropOff(),this.fullUpOff(),this._fulldrop=!1},fullUpOn:function(a){var b=this._createFileMetaContent(a);this.fulldrop.appendChild(b),Wu.DomUtil.addClass(this.fulldrop,"fullscreen-dropped")},_createFileMetaContent:function(a){var b=Wu.DomUtil.create("div","drop-meta-wrapper"),c=Wu.DomUtil.create("div","drop-meta-name",b),d=Wu.DomUtil.create("div","drop-meta-size",b),e=Wu.DomUtil.create("div","drop-meta-type",b),f=Wu.DomUtil.create("div","drop-meta-type",b);return c.innerHTML="Name: "+a.name,d.innerHTML="Size: "+Wu.Util.bytesToSize(a.size),e.innerHTML="Type: "+a.type.split("/")[0].camelize(),f.innerHTML="Filetype: "+a.type.split("/")[1],b},fullUpOff:function(){Wu.DomUtil.removeClass(this.fulldrop,"fullscreen-dropped"),this.fulldrop.innerHTML=""},fulldropOn:function(a){this.fullOn(),this._fulldrop=a.target.className},fulldropOff:function(){this.fullOff()},fullOn:function(){this.fulldrop.style.opacity=.9,this.fulldrop.style.zIndex=1e3},fullOff:function(){var a=this;this.fulldrop.style.opacity=0,setTimeout(function(){a.fulldrop.style.zIndex=-10},200)},dropping:function(a){a.preventDefault(),this.fulldropOn(a)},undropping:function(a){a.preventDefault();var b=a.target.className;b==this._fulldrop&&this.fulldropOff(a)},dropped:function(a){a.preventDefault(),this.fullUpOn(),this.dz.drop(a)},dragover:function(a){a.preventDefault()},handleError:function(a){var b="";a.forEach(function(a){b+=a.error,b+="<br>"}),this._errors.innerHTML=b,this._errors.style.display="block"},uploaded:function(a,b){if(a.errors&&a.errors.length&&this.handleError(a.errors),a.files){a.files&&a.files.forEach(function(a){this.project.setFile(a)},this),a.layers&&a.layers.forEach(function(a){this.project.addLayer(a)},this),this.project.refreshSidepane();var c=app.MapPane.cartoCss;c&&c.update()}},addFile:function(a){var b=Wu.extend({},a);b.name=ich.datalibraryTablerowName({name:b.name||"Title",description:b.description||"Description",nameUuid:"name-"+b.uuid,descUuid:"description-"+b.uuid}),b.type=b.type.camelize(),b.files=this._createFilePopup(b.files),b.keywords=b.keywords.join(", "),b.createdDate=new Date(b.created).toDateString();var c=this.list.add(b);c[0].elm.id=b.uuid;var d=c[0].elm.children[0].children[0].children;d[0].id="checkbox-"+b.uuid,d[1].setAttribute("for","checkbox-"+b.uuid),this.project.editMode&&this._addFileEditHooks(b.uuid)},_createFilePopup:function(a){var b=a.length,c='<div class="dataLibrary-file-popup-wrap">';return c+='<div class="dataLibrary-file-popup-trigger">'+b+"</div>",c+='<div class="dataLibrary-file-popup-list">Files:<br>',a.forEach(function(a){c+='<div class="dataLibrary-file-popup-item">',c+="• "+a,c+="</div>"},this),c+="</div></div>"},_addFileEditHooks:function(a){var b=Wu.DomUtil.get("name-"+a),c=Wu.DomUtil.get("description-"+a);Wu.DomEvent.on(b,"mousedown mouseup click",this.stop,this),Wu.DomEvent.on(b,"dblclick",this.rename,this),Wu.DomEvent.on(c,"mousedown mouseup click",this.stop,this),Wu.DomEvent.on(c,"dblclick",this.rename,this)},stop:function(a){a.preventDefault(),a.stopPropagation()},rename:function(a){a.target.removeAttribute("readonly"),a.target.focus(),a.target.selectionStart=a.target.selectionEnd,a.target.fieldKey=a.target.id.split("-")[0],Wu.DomEvent.on(a.target,"blur",this.editBlur,this),Wu.DomEvent.on(a.target,"keydown",this.editKey,this)},editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},editBlur:function(a){var b=a.target.fieldKey;a.target.setAttribute("readonly","readonly");var c=a.target.id.replace(b+"-",""),d=a.target.value||a.target.innerHTML;this.project.store.files.forEach(function(a){a.uuid==c&&(a[b]=d)},this),this.list.update(),this._save(c,b),"name"==b&&this.updateLayerName(c,d)},updateLayerName:function(a,b){var c=this.project.getLayerFromFile(a);c&&c.setTitle(b)},_save:function(a,b){this.project.store.files.forEach(function(c){if(c.uuid==a){var d={};d[b]=c[b],d.uuid=c.uuid;var e=JSON.stringify(d);Wu.save("/api/file/update",e)}}),app.setSaveStatus()},updateContent:function(){this.update()},update:function(){this.project=Wu.app.activeProject,this.reset(),this.refreshDZ(),this.refreshTable(),this.project.editMode?this.addEditHooks():this.removeEditHooks();var a=app.MapPane.cartoCss;a&&a.update()},refreshTable:function(){this.project.store.files&&(this.project.store.files.forEach(function(a){this.addFile(a)},this),this.list.sort("name",{order:"asc"}))},reset:function(){this.list.clear(),this.fullOff(),this.fulldropOff()}}),Wu.SidePane.MediaLibrary=Wu.SidePane.Item.extend({type:"mediaLibrary",title:"Media",initContent:function(){this._content=Wu.DomUtil.create("div","fullpage-mediaLibrary",Wu.app._appPane),this._container=Wu.DomUtil.create("div","editor-wrapper",this._content,ich.mediaLibrary({media:"this is media!"})),this._innerContent=Wu.DomUtil.get("mediaLibrary-inner-content"),this._leftImage={},this._leftImage.innerSlider=Wu.DomUtil.get("mediaLibrary-inner-slider-left"),this._leftImage.grabGrid=Wu.DomUtil.get("mediaLibrary-grabgrid-left"),this._leftImage.Image=Wu.DomUtil.get("mediaLibrary-image-container-left"),this._leftImage.Image.img=this._leftImage.Image.getElementsByTagName("img")[0],this._leftImage.nativeResolution=Wu.DomUtil.get("mediaLibrary-data-resolution-l"),this._leftImage.filename=Wu.DomUtil.get("mediaLibrary-data-filename-l"),this._leftImage.fileCaptured=Wu.DomUtil.get("mediaLibrary-data-captured-l"),this._leftImage.fileUploaded=Wu.DomUtil.get("mediaLibrary-data-uploaded-l"),this._leftImage.fileUploadedBy=Wu.DomUtil.get("mediaLibrary-data-uploaded-by-l"),this._leftImage.percent=Wu.DomUtil.get("mediaLibrary-percent-left-side"),this._leftImage.zoomIn=Wu.DomUtil.get("mediaLibrary-zoom-in-left"),this._leftImage.zoomOut=Wu.DomUtil.get("mediaLibrary-zoom-out-left"),this._rightImage={},this._rightImage.innerSlider=Wu.DomUtil.get("mediaLibrary-inner-slider-right"),this._rightImage.grabGrid=Wu.DomUtil.get("mediaLibrary-grabgrid-right"),this._rightImage.Image=Wu.DomUtil.get("mediaLibrary-image-container-right"),this._rightImage.Image.img=this._rightImage.Image.getElementsByTagName("img")[0],this._rightImage.nativeResolution=Wu.DomUtil.get("mediaLibrary-data-resolution-r"),this._rightImage.filename=Wu.DomUtil.get("mediaLibrary-data-filename-r"),this._rightImage.fileCaptured=Wu.DomUtil.get("mediaLibrary-data-captured-r"),this._rightImage.fileUploaded=Wu.DomUtil.get("mediaLibrary-data-uploaded-r"),this._rightImage.fileUploadedBy=Wu.DomUtil.get("mediaLibrary-data-uploaded-by-r"),this._rightImage.percent=Wu.DomUtil.get("mediaLibrary-percent-right-side"),this._rightImage.zoomIn=Wu.DomUtil.get("mediaLibrary-zoom-in-right"),this._rightImage.zoomOut=Wu.DomUtil.get("mediaLibrary-zoom-out-right")
},_addHooks:function(){Wu.DomEvent.on(this._leftImage.zoomIn,"mousedown",function(){this.zoomImg("left","in")},this),Wu.DomEvent.on(this._leftImage.zoomIn,"mouseup",function(){this.zoomImg_stop("left")},this),Wu.DomEvent.on(this._leftImage.zoomOut,"mousedown",function(){this.zoomImg("left","out")},this),Wu.DomEvent.on(this._leftImage.zoomOut,"mouseup",function(){this.zoomImg_stop("left")},this),Wu.DomEvent.on(this._rightImage.zoomIn,"mousedown",function(){this.zoomImg("right","in")},this),Wu.DomEvent.on(this._rightImage.zoomIn,"mouseup",function(){this.zoomImg_stop("right")},this),Wu.DomEvent.on(this._rightImage.zoomOut,"mousedown",function(){this.zoomImg("right","out")},this),Wu.DomEvent.on(this._rightImage.zoomOut,"mouseup",function(){this.zoomImg_stop("right")},this)},zoomImg:function(a,b){var c;if("left"==a)var c=this._leftImage,d=this.images[this._currentActiveLeft].file.data.image.dimensions.width;if("right"==a)var c=this._rightImage,d=this.images[this._currentActiveRight].file.data.image.dimensions.width;var e=(c.Image.img,c.Image.img),f=e.offsetWidth,g=e.offsetHeight,h=e.offsetLeft,i=e.offsetTop,j=g/f,k=c.Image.offsetWidth,l=c.Image.offsetHeight;this.imgZooming=setInterval(function(){zoomIndex="in"==b?f/100:-f/100,f+=zoomIndex;var a=zoomIndex*j;g+=a,KOPercentLeft=(-h+k/2)/f,KOPercentTop=(-i+l/2)/g,leftZoomIndex=zoomIndex*KOPercentLeft,h-=leftZoomIndex,topZoomIndex=zoomIndex*j*KOPercentTop,i-=topZoomIndex;var m=Math.round(f/d*100);c.percent.innerHTML=m,e.style.width=f+"px",e.style.height=g+"px",e.style.left=h+"px",e.style.top=i+"px"},10)},zoomImg_stop:function(a){clearInterval(this.imgZooming),"left"==a&&this.__leftImageUpdate()},__leftImageUpdate:function(){var a=app.options.servers.portal+"pixels/",b=this.images[this._currentActiveLeft],c=(b.file.data.image.dimensions.width,b.file.data.image.dimensions.height,this._leftImage.Image.img.offsetWidth),d=this._leftImage.Image.img.offsetHeight,e=this._leftImage.Image.offsetWidth,f=this._leftImage.Image.offsetHeight,g=this._leftImage.Image.img.offsetLeft,h=this._leftImage.Image.img.offsetTop;g>0&&(g=0),h>0&&(h=0);var i=a;i+=b.file.uuid,i+="?width="+c,i+="&height="+d,i+="&cropw="+e,i+="&croph="+f,i+="&cropx="+Math.abs(g),i+="&cropy="+Math.abs(h);var j=new Image,k=this;j.onload=function(){k._rightImage.Image.img.style.top="0px",k._rightImage.Image.img.style.left="0px",k._rightImage.Image.img.src=j.src},j.src=i},removeHooks:function(){},addEditHooks:function(){},removeEditHooks:function(){},deactivate:function(){},updateContent:function(){this.update()},update:function(){this.project=app.activeProject,this.reset(),this.refresh(),this.addEditHooks()},thumbClick:function(a,b){var c=this.images[a];if("left"==b){var d=this._leftImage;this._currentActiveLeft=a}if("right"==b){var d=this._rightImage;this._currentActiveRight=a}d.Image.img.removeAttribute("style");var e=app.options.servers.portal+"pixels/",f=c.file.data.image.dimensions.width,g=c.file.data.image.dimensions.height;d.nativeResolution.innerHTML=f+" x "+g+" pixels",d.filename.innerHTML=c.file.name,d.fileCaptured.innerHTML=new Date(c.file.data.image.created).toDateString();var h=new Date(c.file.created).toDateString();d.fileUploaded.innerHTML=h,d.fileUploadedBy.innerHTML=c.file.createdByName;var i=d.Image.offsetWidth,j=Math.round(i/f*100);d.percent.innerHTML=j;var k=f/g;k>=1?(Wu.DomUtil.addClass(d.Image,"landscape",this),Wu.DomUtil.removeClass(d.Image,"portrait",this)):(Wu.DomUtil.removeClass(d.Image,"landscape",this),Wu.DomUtil.addClass(d.Image,"portrait",this));var l=900,m=l/f,n=g*m,o=d.Image.offsetWidth,p=d.Image.offsetHeight,q=o/l,r=n*q,s=p/2-r/2;d.Image.img.style.top=Math.round(s)+"px",d.Image.img.src=e+a+"?width="+l+"&height="+n},refresh:function(){var a=this.project.getFiles(),b="http://85.10.202.87:8080/pixels/",c=_.filter(a,function(a){return a.format.indexOf("jpg")>-1});this.images={},c.forEach(function(a){var c=this.images[a.uuid]={};c.file=a,c.left={},c.left.div=Wu.DomUtil.create("div","mediaLibrary-slider-thumb",this._leftImage.innerSlider),c.left.img=Wu.DomUtil.create("img","",c.left.div),c.left.img.src=b+a.uuid+"?width=145&height=500",c.right={},c.right.div=Wu.DomUtil.create("div","mediaLibrary-slider-thumb",this._rightImage.innerSlider),c.right.img=Wu.DomUtil.create("img","",c.right.div),c.right.img.src=b+a.uuid+"?width=145&height=500",Wu.DomEvent.on(c.left.div,"click",function(){this.thumbClick(a.uuid,"left")},this),Wu.DomEvent.on(c.right.div,"click",function(){this.thumbClick(a.uuid,"right")},this)},this),this._imgDraggable(),this._addHooks()},_imgDraggable:function(){var a=this._leftImage.grabGrid;Wu.DomEvent.on(a,"mousedown",function(){this._initDragging()},this),Wu.DomEvent.on(a,"mousemove",function(a){this._draggingImage(a)},this),this.__x_pos=0,this.__y_pos=0,this.__x_elem=0,this.__y_elem=0},_initDragging:function(){return this.__x_elem=this.__x_pos-this._leftImage.Image.img.offsetLeft,this.__y_elem=this.__y_pos-this._leftImage.Image.img.offsetTop,this._draggingLeftImage=!0,!1},_draggingImage:function(a){if(this.__x_pos=document.all?window.event.clientX:a.pageX,this.__y_pos=document.all?window.event.clientY:a.pageY,this._draggingLeftImage){var b=this.__x_pos-this.__x_elem,c=this.__y_pos-this.__y_elem,d=this._leftImage.Image.img.offsetLeft-b,e=this._rightImage.Image.img.offsetLeft,f=this._leftImage.Image.img.offsetTop-c,g=this._rightImage.Image.img.offsetTop;this._leftImage.Image.img.style.left=b+"px",this._leftImage.Image.img.style.top=c+"px",this._rightImage.Image.img.style.left=e-d+"px",this._rightImage.Image.img.style.top=g-f+"px"}},_stopDragging:function(){this._draggingLeftImage=!1,this.__leftImageUpdate()},reset:function(){this.removeHooks()}}),Wu.HeaderPane=Wu.Class.extend({_:"headerpane",initialize:function(){return this.options={},this.options.editMode=!1,this._initContainer(),this},_initContainer:function(){this._container=Wu.app._headerPane=Wu.DomUtil.createId("div","header",Wu.app._mapContainer),Wu.DomUtil.addClass(Wu.app._headerPane,"displayNone"),this._logoWrap=Wu.DomUtil.create("div","header-logo",this._container),this._titleWrap=Wu.DomUtil.create("div","header-title-wrap",this._container),this._title=Wu.DomUtil.create("div","header-title editable",this._titleWrap),this._subtitle=Wu.DomUtil.create("div","header-subtitle editable",this._titleWrap),this._title.whichTitle="title",this._subtitle.whichTitle="subtitle"},addHooks:function(){},addEditHooks:function(){this.logodz?this.logodz.enable():this.addDropzone(),Wu.DomUtil.addClass(this._logoWrap,"editable")},removeEditHooks:function(){this.logodz&&this.logodz.disable(),Wu.DomUtil.removeClass(this._logoWrap,"editable")},addDropzone:function(){this.logodz=new Dropzone(this._logoWrap,{url:"/api/upload/image",createImageThumbnails:!1,autoDiscover:!1})},refreshDropzone:function(){var a=this;this.logodz.options.params.project=this.project.store.uuid,this.logodz.on("success",function(b,c){a.addedLogo(c)})},addedLogo:function(a){var b="/images/"+a;this.project.setHeaderLogo(b),this._logoWrap.style.backgroundImage=this.project.getHeaderLogoBg()},disableResize:function(){},enableResize:function(){},_enableEdit:function(a,b){var c=a.target,d=a.target.innerHTML,b=a.target.whichTitle;if(b){if("title"==b)var e=ich.injectHeaderTitleInput({value:d});if("subtitle"==b)var e=ich.injectHeaderSubtitleInput({value:d});c.innerHTML=e;var f=c.firstChild;f.focus(),f.selectionStart=f.selectionEnd,Wu.DomEvent.on(f,"blur",this._editBlur,this),Wu.DomEvent.on(f,"keydown",this._editKey,this)}},_editBlur:function(a){var b=a.target.value,c=a.target.parentNode;c.innerHTML=b,this.save()},_editKey:function(a){(13==event.which||13==event.keyCode)&&a.target.blur()},setTitle:function(a){this._title.innerHTML=a},setSubtitle:function(a){this._subtitle.innerHTML=a},_setLeft:function(a){this._container.style.left=a+"px"},_update:function(a){this.update(a)},update:function(a){this.project=a,this._container.style.display="block",this._logoWrap.style.backgroundImage=a.getHeaderLogoBg(),this._title.innerHTML=a.getHeaderTitle(),this._subtitle.innerHTML=a.getHeaderSubtitle(),a.editMode?(this.addEditHooks(),this.refreshDropzone()):this.removeEditHooks()},getHeight:function(){return this._headerHeight},reset:function(){this._container.style.display="none"},_resetView:function(){},resize:function(){},_resize:function(a){return},_resized:function(){this._resizer.style.backgroundColor="",window.onmousemove=null,this.save(),setTimeout(function(){var a=Wu.app._map;a&&a.reframe()},300)},save:function(){this.project.store.header.height=this._headerHeight,this.project.store.header.title=this._title.innerHTML,this.project.store.header.subtitle=this._subtitle.innerHTML;var a=this._logoWrap.style.backgroundImage.slice(4).slice(0,-1);this.project.store.header.logo=a,this._save()},_save:function(){this.project._update("header")},setProject:function(a){this._update(a)}}),Wu.MapPane=Wu.Class.extend({initialize:function(){return this._initContainer(),this._initPanes(),this},_initContainer:function(){this._container=Wu.app._mapPane=Wu.DomUtil.createId("div","map",Wu.app._mapContainer),Wu.DomEvent.on(window,"resize",this._updateWidth,this),Wu.DomUtil.addClass(this._container,"click-to-start")},_initPanes:function(){},_updateWidth:function(){var a=this._map;a&&(a._container.style.width=parseInt(window.innerWidth)-parseInt(a._container.offsetLeft)+"px",setTimeout(function(){a&&a.reframe()},300))},setProject:function(a){this.project=a,this.reset(),this.update(a)},clearBaseLayers:function(){var a=this._map;this.baseLayers&&(this.baseLayers.forEach(function(b){a.removeLayer(b.layer)}),this.baseLayers={})},setBaseLayers:function(){this._map;this.clearBaseLayers();var a=this.project.getBaselayers();a&&a.forEach(function(a){this.addBaseLayer(a)},this)},addBaseLayer:function(a){var b=this.project.layers[a.uuid];b&&(b.add(),b.setOpacity(a.opacity))},removeBaseLayer:function(){map.removeLayer(base.layer)},_setLeft:function(a){this._container.style.left=a+"px",this._container.style.width=parseInt(window.innerWidth)-a+"px"},_update:function(a){this.update(a)},update:function(a){this.project=a,this.setBaseLayers(),this.setMaxBounds(),this.setPosition(),this.setHeaderPadding(),this.updateControlCss()},setHeaderPadding:function(){var a=this._map,b=a._controlContainer;b.style.paddingTop=this.project.getHeaderHeight()+"px"},setPosition:function(a){var b=this._map,c=a||this.project.getLatLngZoom(),d=c.lat,e=c.lng,f=c.zoom;void 0!=d&&void 0!=e&&void 0!=f&&b.setView([d,e],f)},getPosition:function(){var a=this._map.getCenter(),b={lat:a.lat,lng:a.lng,zoom:this._map.getZoom()};return b},getActiveLayers:function(){if(!this.layerMenu)return!1;var a=this.layerMenu.getLayers(),b=_.filter(a,function(a){return a.on});return b},setMaxBounds:function(){var a=app._map,b=this.project.getBounds();if(b){var c=L.latLng(b.southWest.lat,b.southWest.lng),d=L.latLng(b.northEast.lat,b.northEast.lng),e=L.latLngBounds(c,d);a.setMaxBounds(e),a.options.minZoom=b.minZoom,a.options.maxZoom=b.maxZoom}},_reset:function(){this.reset()},createNewMap:function(){var a={worldCopyJump:!0};this._map=Wu.app._map=L.map("map",a).setView([0,0],5),this.addEditableLayer(this._map),this._attributionControl=L.control.attribution({position:"bottomleft",prefix:'Powered by <a href="https://systemapic.com/" target="_blank">Systemapic</a>'}),this._map.addControl(this._attributionControl)},addEditableLayer:function(a){this.editableLayers=new L.FeatureGroup,a.addLayer(this.editableLayers)},reset:function(){var a=this._map;a&&(a.eachLayer(function(b){a.removeLayer(b)}),a.remove()),this.createNewMap(),this._updateWidth(),this.resetControls(),this.disableZoom()},updateControlCss:function(){var a=this;setTimeout(function(){var b=a.project.getControls();b.baselayertoggle;app.MapPane._map._controlContainer.childNodes[0];if(b.description,b.draw,b.geolocation,b.inspect,b.layermenu){var c=app.MapPane._map._controlContainer.childNodes[3];b.inspect?Wu.DomUtil.removeClass(c,"no-inspector"):Wu.DomUtil.addClass(c,"no-inspector")}if(b.legends){var d=a.legendsControl._legendsContainer;b.layermenu?Wu.DomUtil.removeClass(d,"legends-padding-right"):Wu.DomUtil.addClass(d,"legends-padding-right"),b.description}if(b.measure){var e=app.MapPane._map._controlContainer.childNodes[1];e.style.right=b.layermenu?"295px":"6px",b.legends}b.mouseposition,b.vectorstyle,b.zoom},50)},resetControls:function(){delete this._drawControl,delete this._drawControlLayer,delete this._scale,delete this.vectorStyle,delete this.layerMenu,delete this.legendsControl,delete this.descriptionControl,delete this.inspectControl,delete this.mousepositionControl,delete this.baselayerToggle,delete this.geolocationControl,this.cartoCss&&this.cartoCss.destroy(),delete this.cartoCss},refreshControls:function(){},hideControls:function(){Wu.DomUtil.addClass(app._map._controlContainer,"displayNone")},showControls:function(){Wu.DomUtil.removeClass(app._map._controlContainer,"displayNone")},addLayer:function(a){var b=L.mapbox.tileLayer(a);b.addTo(this._map)},_addLayer:function(a){a.addto(this._map)},disableInteraction:function(a){var b=this._map;a&&b.dragging.disable(),b.touchZoom.disable(),b.doubleClickZoom.disable(),b.scrollWheelZoom.disable(),b.boxZoom.disable(),b.keyboard.disable()},enableInteraction:function(a){var b=this._map;a&&b.dragging.enable(),b.touchZoom.enable(),b.doubleClickZoom.enable(),b.scrollWheelZoom.enable(),b.boxZoom.enable(),b.keyboard.enable()},disableZoom:function(){this._map.touchZoom.disable(),this._map.doubleClickZoom.disable(),this._map.scrollWheelZoom.disable(),this._map.boxZoom.disable(),this._map.keyboard.disable(),document.getElementsByClassName("leaflet-control-zoom")[0].style.display="none"},enableZoom:function(){this._map.touchZoom.enable(),this._map.doubleClickZoom.enable(),this._map.scrollWheelZoom.enable(),this._map.boxZoom.enable(),this._map.keyboard.enable(),document.getElementsByClassName("leaflet-control-zoom")[0].style.display="block"},enableLegends:function(){this.legendsControl||(this.legendsControl=L.control.legends({position:"bottomleft"}),this.legendsControl.addTo(this._map),this.legendsControl.update())},disableLegends:function(){this.legendsControl&&(this._map.removeControl(this.legendsControl),delete this.legendsControl)},enableMouseposition:function(){this.mousepositionControl||(this.mousepositionControl=L.control.mouseposition({position:"topright"}),this.mousepositionControl.addTo(this._map))},disableMouseposition:function(){this.mousepositionControl&&(this._map.removeControl(this.mousepositionControl),delete this.mousepositionControl)},enableGeolocation:function(){this.geolocationControl||(this.geolocationControl=new L.Control.Search({url:"http://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],boundingBox:"boundingbox",filterJSON:function(a){var b,c=[];for(b in a){var d=a[b];if(d.hasOwnProperty("type"))var e={address:d.display_name,boundingbox:d.boundingbox,latlng:L.latLng(d.lat,d.lon),type:d.type};c.push(e)}var f=_.unique(c,function(a){return a?a.address:void 0});return f}}),this.geolocationControl.addTo(this._map))},disableGeolocation:function(){this.geolocationControl&&(this._map.removeControl(this.geolocationControl),delete this.geolocationControl)},enableMeasure:function(){this._scale||(this._scale=L.control.scale({position:"topright"}),this._scale.addTo(this._map))},disableMeasure:function(){this._scale&&(this._map.removeControl(this._scale),delete this._scale)},enableDescription:function(){this.descriptionControl||(this.descriptionControl=L.control.description({position:"topleft"}),this.descriptionControl.addTo(this._map),this.descriptionControl.update())},disableDescription:function(){this.descriptionControl&&(this._map.removeControl(this.descriptionControl),delete this.descriptionControl)},enableInspect:function(){this.inspectControl||(this.inspectControl=L.control.inspect({position:"bottomright"}),this.inspectControl.addTo(this._map),this.inspectControl.update())},enableCartocss:function(){return this.cartoCss?void 0:(this.cartoCss=L.control.cartoCss({position:"topleft"}),this.cartoCss.addTo(this._map),this.cartoCss.update(),this.cartoCss)},disableCartocss:function(){this.cartoCss&&(this._map.removeControl(this.cartoCss),delete this.cartoCss)},disableInspect:function(){this.inspectControl&&(this._map.removeControl(this.inspectControl),delete this.inspectControl)},enableLayermenu:function(){return this.layerMenu?void 0:(this.layerMenu=L.control.layermenu({position:"bottomright"}),this.layerMenu.addTo(this._map),this.layerMenu.update(),this.layerMenu)},disableLayermenu:function(){this.layerMenu&&(this._map.removeControl(this.layerMenu),delete this.layerMenu)},enableBaselayertoggle:function(){return this.baselayerToggle?void 0:(this.baselayerToggle=L.control.baselayerToggle(),this.baselayerToggle.addTo(this._map),this.baselayerToggle.update(),this.baselayerToggle)},disableBaselayertoggle:function(){this.baselayerToggle&&(this._map.removeControl(this.baselayerToggle),delete this.baselayerToggle)},enableVectorstyle:function(a){this.vectorStyle||(this.vectorStyle=L.control.styleEditor({position:"topleft",container:a}),this._map.addControl(this.vectorStyle))},disableVectorstyle:function(){this.vectorStyle&&(this._map.removeControl(this.vectorStyle),delete this.vectorStyle)},enableDraw:function(){this._drawControl||this.addDrawControl()},disableDraw:function(){this._drawControl&&"undefined"!==this._drawControl&&this.removeDrawControl()},removeDrawControl:function(){this._drawControl&&"undefined"!==this._drawControl&&(this._map.removeControl(this._drawControl),this._drawControl=!1,this.disableVectorstyle())},addDrawControl:function(){var a=this,b=this._map,c=this.editableLayers;options={position:"topleft",edit:{featureGroup:c},draw:{circle:{shapeOptions:{fill:!0,color:"#FFF",fillOpacity:.3}},rectangle:{shapeOptions:{fill:!0,color:"#FFF",fillOpacity:.3,fillColor:"#FFF"}},polygon:{shapeOptions:{fill:!0,color:"#FFF",fillOpacity:.3,fillColor:"#FFF"}},polyline:{shapeOptions:{fill:!1,color:"#FFF"}}}};var d=this._drawControl=new L.Control.Draw(options);b.addControl(d);var e=d._container;L.DomUtil.addClass(e,"elizaveta"),Wu.DomEvent.on(d,"mousemove",L.DomEvent.stop,this),Wu.DomEvent.on(d,"mouseover",b.closePopup,this);var a=this;b.on("draw:created",function(b){if(b.layer.layerType=b.layerType,a.project.editMode){var d=b.layer.toGeoJSON();a.project.createLayerFromGeoJSON(d)}else c.addLayer(b.layer)}),b.on("draw:note:created",function(a){c.addLayer(a.noteLayer),c.addLayer(a.rectangleLayer),L.Draw._editshortcut.enable(),a.noteLayer._el.focus(),b.LeafletDrawEditEnabled=!0}),this.enableVectorstyle(d._wrapper)},getEditableLayerParent:function(a){var b=this.editableLayers._layers;for(l in b)for(m in b[l]._layers){if(m==a)return b[l];var c=b[l]._layers[m];for(n in c){var d=c[n];if(n==a)return c;for(o in d){{d[o]}if(o==a)return d}}}return!1}}),Wu.StatusPane=Wu.Class.extend({_:"statuspane",initialize:function(a){Wu.setOptions(this,a),this.initContainer(),this.addHooks()},initContainer:function(){{var a=this._container=Wu.DomUtil.create("div","home-container"),b=(this._logo=Wu.DomUtil.create("div","home-logo",a),this._statusWrap=Wu.DomUtil.create("div","home-status-wrap",a)),c=Wu.DomUtil.create("div","home-status",b);Wu.DomUtil.create("div","home-status-inner",c)}this.clearStatus(),this.options.addTo&&this.addTo(this.options.addTo)},addHooks:function(){Wu.DomEvent.on(this._container,"mousedown",this.toggle,this)},tab:function(a){9==a.keyCode&&this.toggle()},toggle:function(){this.isOpen?this.close():this.open(),this.cleaningJobs()},cleaningJobs:function(){var a=Wu.app.MapPane.layerMenu;a&&a.disableEdit(),app.SidePane.Map.closeAll()},open:function(){this.isOpen=!0;var a=app.SidePane;a.expand(),this.refresh(),this.checkMapBlur(),this.setContentHeights(),Wu.DomUtil.removeClass(app._mapPane,"click-to-start"),app.StartPane&&app.StartPane.deactivate(),app._activeMenu._activate()},close:function(){this.isOpen=!1;var a=app.SidePane;a.collapse(),this.refresh(),Wu.DomUtil.removeClass(app.MapPane._container,"map-blur")},setContentHeights:function(){var a=app.SidePane.Clients,b=app.SidePane.Map;a&&a.setContentHeight(),b&&b.setContentHeight()},checkMapBlur:function(){("documents"==app._activeMenuItem||"dataLibrary"==app._activeMenuItem||"users"==app._activeMenuItem)&&Wu.DomUtil.addClass(app.MapPane._container,"map-blur")},addTo:function(a,b){b?a.insertBefore(this._container,a.firstChild):a.appendChild(this._container)},setHeight:function(a){this._container.style.height=parseInt(a)+"px"},refresh:function(){if(this.project){var a=this.project.getHeaderHeight();this.setHeight(a)}},updateContent:function(a){this.project=a,this.refresh(),this.close()},setStatus:function(a,b){var c=this;this.clearTimer&&clearTimeout(this.clearTimer);var d=Wu.DomUtil.create("div","home-status"),e=Wu.DomUtil.create("div","home-status-inner",d);e.innerHTML=a,this.pushStatus(d),this.clearTimer=setTimeout(function(){c.clearStatus()},b||3e3)},setSaveStatus:function(){this.setStatus("Saved!")},pushStatus:function(a){var b=this._statusWrap.firstChild;this._statusWrap.insertBefore(a,b),setTimeout(function(){Wu.DomUtil.addClass(a,"status-in"),setTimeout(function(){Wu.DomUtil.remove(b)},250)},50)},clearStatus:function(){var a=app.getPortalName();a!=this.getStatus()&&this.setStatus(a)},getStatus:function(){return this._statusWrap.firstChild.firstChild.innerHTML}}),Wu.ProgressBar=Wu.Class.extend({initialize:function(a){Wu.setOptions(this,a),this.initContainer()},initContainer:function(){this._progressBar=Wu.DomUtil.create("div","status-progress-bar",this._container),this.options.addTo&&this.addTo(this.options.addTo)},addTo:function(){var a=this.options.addTo;a.appendChild(this._progressBar)},setProgress:function(a){if(!(a<this._current+9)){var b=this._progressBar;b.style.opacity=1,b.style.width=a+"%",this._current=a}},hideProgress:function(){var a=this._progressBar;a.style.opacity=0,this._current=0,a.style.width=0},timedProgress:function(a){var b=a||5e3,c=10,d=0,e=parseInt(b)/c;this._timedProgress(d,e,c)},_timedProgress:function(a,b,c){var d=this;a+=100/c,this.setProgress(a),setTimeout(function(){return 100>a?d._timedProgress(a,b,c):void d.hideProgress()},b)}}),L.Control.Layermenu=L.Control.extend({options:{position:"bottomright"},onAdd:function(){{var a="leaflet-control-layermenu",b=this._innerContainer=L.DomUtil.create("div",a);this.options}return b.innerHTML=ich.layerMenuFrame(),this.initContainer(),b},initContainer:function(){if(this._layerMenuHeader=Wu.DomUtil.createId("div","layer-menu-header"),Wu.DomUtil.addClass(this._layerMenuHeader,"menucollapser"),this._layerMenuHeaderTitle=Wu.DomUtil.create("div","layer-menu-header-title",this._layerMenuHeader,"Layers"),this._bhattan1=Wu.DomUtil.createId("div","bhattan1"),Wu.DomUtil.addClass(this._bhattan1,"dropdown-button rotate270"),this._layerMenuHeader.appendChild(this._bhattan1),this._innerContainer.insertBefore(this._layerMenuHeader,this._innerContainer.getElementsByTagName("div")[0]),this._openLayers=Wu.DomUtil.createId("div","open-layers"),this._openLayers.innerHTML="Open Layer Menu",Wu.DomUtil.addClass(this._openLayers,"leaflet-control open-open-layers"),this._legendsContainer=Wu.DomUtil.get("legends-control-inner-content"),this._legendsCollapser=Wu.DomUtil.get("legends-collapser"),Wu.DomEvent.on(this._bhattan1,"click",this.closeLayerPane,this),Wu.DomEvent.on(this._openLayers,"click",this.openLayerPane,this),Wu.DomEvent.on(this._openLayers,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this._bhattan1,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this._innerContainer,"mouseenter",this.cancelEditClose,this),Wu.DomEvent.on(this._innerContainer,"mouseleave",this.timedEditClose,this),!app.MapPane.inspectControl){var a=app._map._controlCorners.bottomright;a.style.paddingBottom="6px"}},cancelEditClose:function(){if(this.editMode){var a=app.SidePane.Map.mapSettings.layermenu.closeEditTimer;clearTimeout(a),setTimeout(function(){var a=app.SidePane.Map.mapSettings.layermenu.closeEditTimer;clearTimeout(a)},301)}},timedEditClose:function(){if(this.editMode){var a=this;app.SidePane.Map.mapSettings.layermenu.closeEditTimer=setTimeout(function(){a.disableEdit()},3e3)}},closeLayerPane:function(){this._container.parentNode.style.width="0px",this._container.parentNode.appendChild(this._openLayers),app.MapPane.inspectControl&&this._legendsContainer&&Wu.DomUtil.removeClass(this._legendsContainer,"legends-padding-right"),Wu.app.MapPane._container.children[1].children[1].style.right="140px";setTimeout(function(){},500)},openLayerPane:function(){this._container.parentNode.style.width="290px",this._openLayers.className="leaflet-control layer-opener-opened close-layer-opener",app.MapPane.inspectControl&&this._legendsContainer&&Wu.DomUtil.addClass(this._legendsContainer,"legends-padding-right"),Wu.app.MapPane._container.children[1].children[1].style.right="295px";var a=this;setTimeout(function(){a._container.parentNode.removeChild(a._openLayers),a._openLayers.className="leaflet-control open-open-layers"},500)},enableEdit:function(){this.editMode||(this.editMode=!0,Wu.app.MapPane.disableInteraction(!0),this.enableSortable(),this._layerMenuHeaderTitle.innerHTML="Edit Layer Menu",Wu.DomUtil.addClass(this._innerContainer,"edit-mode"),this._insertMenuFolder(),this.openAll())},disableEdit:function(){this.editMode&&(this.editMode=!1,Wu.app.MapPane.enableInteraction(!0),this.disableSortable(),this._layerMenuHeaderTitle.innerHTML="Layers",Wu.DomUtil.removeClass(this._innerContainer,"edit-mode"),this._removeMenuFolder())},_hideEditButtons:function(){},_showEditButtons:function(){},_insertMenuFolder:function(){this._menuFolder?Wu.DomUtil.removeClass(this._menuFolder,"displayNone"):(this._menuFolder=Wu.DomUtil.create("div","smap-button-white middle-item ct12 ct18",this._innerContainer,"Add folder"),this._layerMenuHeader.parentNode.insertBefore(this._menuFolder,this._layerMenuHeader.nextSibling),Wu.DomEvent.on(this._menuFolder,"click",this.addMenuFolder,this))},_removeMenuFolder:function(){this._menuFolder&&Wu.DomUtil.addClass(this._menuFolder,"displayNone")},enableSortable:function(){this.initSortable()},disableSortable:function(){this.resetSortable()},refreshSortable:function(){this.resetSortable(),this.initSortable()},initSortable:function(){for(var a=document.getElementsByClassName("layer-menu-item-wrap"),b=0;b<a.length;b++){var c=a[b];c.setAttribute("draggable","true"),Wu.DomEvent.on(c,"dragstart",this.drag.start,this)}var d=Wu.DomUtil.get("layer-menu-inner-content");d&&(Wu.DomEvent.on(d,"dragover",this.drag.over,this),Wu.DomEvent.on(d,"dragleave",this.drag.leave,this),Wu.DomEvent.on(d,"drop",this.drag.drop,this))},resetSortable:function(){var a=Wu.DomUtil.get("layer-menu-inner-content");a&&(Wu.DomEvent.off(a,"dragover",this.drag.over,this),Wu.DomEvent.off(a,"dragleave",this.drag.leave,this),Wu.DomEvent.off(a,"drop",this.drag.drop,this))},drag:{start:function(a){var b=a.target;Wu.DomUtil.addClass(b,"dragged-ghost");var c=b.id;return this.drag.currentDragElement=b,this.drag.currentDragUuid=c,this.drag.startDragLevel=this.layers[c].item.pos,a.dataTransfer.setData("uuid",c),!1},drop:function(a){var b=a.dataTransfer.getData("uuid"),c=document.getElementById(b);Wu.DomUtil.removeClass(c,"dragged-ghost");var d=Array.prototype.slice.call(this._content.childNodes),e=d.indexOf(c),f=_.findIndex(this.project.store.layermenu,{uuid:b});return this.project.store.layermenu.move(f,e),this.save(),this.drag.currentDragElement=null,this.drag.currentDragLevel=null,this.movingX=!1,!1},over:function(a){a.preventDefault&&a.preventDefault(),this.movingX||(this.movingX=a.layerX);a.layerX-this.movingX;return!1},leave:function(a){var b=a.clientX,c=a.clientY,d=document.elementFromPoint(b,c),e=this.drag.currentDragElement,f=d.getAttribute("type");return"layerItem"==f?(this.drag.moveElementNextTo(e,d),!1):void 0},moveElementNextTo:function(a,b){b=b.parentNode,this.isBelow(a,b)?b.parentNode.insertBefore(a,b):b.parentNode.insertBefore(a,b.nextSibling)},isBelow:function(a,b){var c=a.parentNode;if(b.parentNode!=c)return!1;for(var d=a.previousSibling;d&&9!==d.nodeType;){if(d===b)return!0;d=d.previousSibling}return!1}},_isFolder:function(a){var b=this.layers[a.uuid];return b.layer?!1:!0},updateLogic:function(){var a=this.project.store.layermenu;this._logic=this._logic||{},a.forEach(function(b){if(this._isFolder(b)){var c=b.pos,d=[],e=[],f=!1;if(_.each(a,function(a){if(b.uuid==a.uuid&&(f=!0),f){if(parseInt(a.pos)>parseInt(c)){var e=this.layers[a.uuid].el;d.push(e)}if(parseInt(a.pos)==parseInt(c)&&b.uuid!=a.uuid)return!1}},this),f=!1,_.each(a,function(a){if(f){if(parseInt(a.pos)==parseInt(c)+1){var d=this.layers[a.uuid].el;e.push(d)}if(parseInt(a.pos)==parseInt(c))return!1}b.uuid==a.uuid&&(f=!0)},this),this._logic[b.uuid])var g=this._logic[b.uuid].isOpen||!1;else var g=!0;this._logic[b.uuid]={toOpen:e,toClose:d,isOpen:g}}},this)},enforceLogic:function(a){var b=a.item.uuid,c=this._logic[b];if(c.isOpen){var d=c.toClose;d.forEach(function(a){Wu.DomUtil.addClass(a,"layeritem-closed"),Wu.DomUtil.removeClass(a,"layeritem-open")},this),this._logic[b].isOpen=!1}else{var d=c.toOpen;d.forEach(function(a){Wu.DomUtil.removeClass(a,"layeritem-closed"),Wu.DomUtil.addClass(a,"layeritem-open")},this),this._logic[b].isOpen=!0}},closeAll:function(){this.updateLogic();for(l in this._logic){var a=this.layers[l];this._logic[l].isOpen=!0,this.enforceLogic(a)}},openAll:function(){this.updateLogic();for(l in this._logic){var a=this.layers[l];this._logic[l].isOpen=!1,this.enforceLogic(a)}},toggleFolder:function(a){this.updateLogic(),this.enforceLogic(a)},toggleLayer:function(a){this.editMode||(a.on?this.disableLayer(a):this.enableLayer(a))},enableLayer:function(a){var b=a.layer;if(!b)return this.toggleFolder(a);b.add(),a.on=!0,Wu.DomUtil.addClass(a.el,"layer-active");var c=app.MapPane.inspectControl;c&&c.addLayer(b);var d=app.MapPane.descriptionControl;d&&(d.setLayer(b),d._container.style.display=b.store.description?"block":"none")},disableLayer:function(a){var b=a.layer;if(b){this._disableLayer(b);var c=app.MapPane.inspectControl;c&&c.removeLayer(b);var d=app.MapPane.legendsControl;d&&d.removeLegend(b);var e=app.MapPane.descriptionControl;e&&(e.removeLayer(b),e._container.style.display="none")}},_disableLayer:function(a){var b=this._getLayermenuItem(a.store.uuid);a.remove(),b.on=!1,Wu.DomUtil.removeClass(b.el,"layer-active")},_getLayermenuItem:function(a){var b=_.find(this.layers,function(b){return b.item.layer==a});return b},onDelete:function(a){if(!a)return void 0;var b=a.getUuid(),c=this._getLayermenuItem(b);if(c){var d=c.el;d&&d.parentNode.removeChild(d)}},remove:function(a){var b=this.layers[a],c=b.el;c&&c.parentNode.removeChild(c),b.layer&&app.SidePane.Map.mapSettings.layermenu._off(b.layer),delete this.layers[a],_.remove(this.project.store.layermenu,function(b){return b.uuid==a}),this.save();var d=app.SidePane.Map.mapSettings.baselayer,e=app.SidePane.Map.mapSettings.layermenu;d&&d.markOccupied(),e&&e.markOccupied()},removeLayermenuItem:function(){},removeLayer:function(){},_remove:function(a){var b=this._getLayermenuItem(a);this.remove(b.item.uuid)},add:function(a){var b={uuid:"layerMenuItem-"+Wu.Util.guid(),layer:a.store.uuid,caption:a.store.title,pos:0,zIndex:1,opacity:1},c={item:b,layer:a};this._add(c),this.project.store.layermenu.push(b),this.save()},_add:function(a){var b=a.item,c=a.layer,d="layer-menu-item-wrap";c||(d+=" menufolder");var e=Wu.DomUtil.create("div",d),f=b.uuid;e.innerHTML=ich.layerMenuItem(b),e.id=f,Wu.DomUtil.addClass(e,"level-"+b.pos),e.setAttribute("draggable",!0),this._content.appendChild(e);var g=e.children[0],h=e.children[1],i=e.children[2],j=e.children[3];Wu.DomEvent.on(g,"click",function(){this.upFolder(f)},this),Wu.DomEvent.on(h,"click",function(){this.downFolder(f)},this),Wu.DomEvent.on(i,"click",function(){this.deleteMenuFolder(f)},this),Wu.DomEvent.on(j,"dblclick",function(){this._editFolderTitle(f)
},this),Wu.DomEvent.on(g,"mousedown",Wu.DomEvent.stop,this),Wu.DomEvent.on(h,"mousedown",Wu.DomEvent.stop,this),Wu.DomEvent.on(i,"mousedown",Wu.DomEvent.stop,this),Wu.DomEvent.on(this._container,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this),a.el=e,Wu.DomEvent.on(e,"mousedown",function(){this.toggleLayer(a)},this),Wu.DomEvent.on(this._innerContainer,"dblclick",Wu.DomEvent.stop,this),this.refreshSortable(),this.editMode&&this._showEditButtons(),this.layers[b.uuid]=a},getLayers:function(){return this.layers},_fill:function(){this.project.store.layermenu&&this.project.store.layermenu.forEach(function(a){var b=_.find(this.project.layers,function(b){return b.store.uuid==a.layer}),c={item:a,layer:b};this._add(c)},this)},addMenuFolder:function(){this.addFolder()},_addMenuFolder:function(){this._addFolder()},addFolder:function(){var a={uuid:"layerMenuItem-"+Wu.Util.guid(),caption:"New folder",pos:0,folder:!0},b={item:a,layer:!1};this._add(b),this.project.store.layermenu.push(a),this.save()},_editFolderTitle:function(a){if(this.editMode&&!this.currentlyEditing){this.currentlyEditing=!0;var b=this.layers[a],c=b.el.children[3],d=c.innerHTML;c.innerHTML="";var e=Wu.DomUtil.create("input","layer-item-title-input");e.value=d,c.appendChild(e),e.focus(),Wu.DomEvent.on(e,"blur",function(){var b=e.value;Wu.DomUtil.remove(e),c.innerHTML=b;var d=_.findIndex(this.project.store.layermenu,{uuid:a});this.project.store.layermenu[d].caption=b,this.save(),this.currentlyEditing=!1},this),Wu.DomEvent.on(e,"keydown",function(){(13==event.which||13==event.keyCode)&&e.blur(),(27==event.which||27==event.keyCode)&&e.blur()},this)}},upFolder:function(a){var b=this.layers[a].el,c=_.findIndex(this.project.store.layermenu,{uuid:a}),d=parseInt(this.project.store.layermenu[c].pos),e=d+1;this.project.store.layermenu[c].pos=e,Wu.DomUtil.addClass(b,"level-"+e),Wu.DomUtil.removeClass(b,"level-"+d),this.save()},downFolder:function(a){var b=this.layers[a].el,c=_.findIndex(this.project.store.layermenu,{uuid:a}),d=parseInt(this.project.store.layermenu[c].pos),e=d-1;this.project.store.layermenu[c].pos=e,Wu.DomUtil.addClass(b,"level-"+e),Wu.DomUtil.removeClass(b,"level-"+d),this.save()},deleteMenuFolder:function(a){this.remove(a)},save:function(){var a=this;this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(function(){a.project._update("layermenu")},1e3)},update:function(a){this.project=a||Wu.app.activeProject,this._content=Wu.DomUtil.get("layer-menu-inner-content"),this.layers={},this._fill(),this.closeAll();var b=app._map;Wu.DomEvent.on(this._container,"mouseenter",function(){b.scrollWheelZoom.disable()},this),Wu.DomEvent.on(this._container,"mouseleave",function(){b.scrollWheelZoom.enable()},this)}}),L.control.layermenu=function(a){return new L.Control.Layermenu(a)},L.Control.Inspect=L.Control.extend({options:{position:"bottomright"},onAdd:function(){{var a="leaflet-control-inspect ct14",b=L.DomUtil.create("div",a);this.options}return b.innerHTML=ich.inspectControl(),b},addTo:function(a){this._map=a;var b=this._container=this.onAdd(a),c=this.getPosition(),d=a._controlCorners[c];return L.DomUtil.addClass(b,"leaflet-control"),d.appendChild(b),this},update:function(a){this.project=a||Wu.app.activeProject,this._content=Wu.DomUtil.get("inspect-control-inner-content"),this._list=Wu.DomUtil.get("inspector-list"),this.layers=[];var b=app._map;Wu.DomEvent.on(this._container,"mouseenter",function(){b.scrollWheelZoom.disable()},this),Wu.DomEvent.on(this._container,"mouseleave",function(){b.scrollWheelZoom.enable()},this)},addLayer:function(a){this._content.style.display="block";var b=Wu.DomUtil.create("div","inspect-layer"),c=Wu.DomUtil.create("div","inspect-arrows-wrap",b),d=Wu.DomUtil.create("div","inspect-arrow-up",c),e=Wu.DomUtil.create("div","inspect-arrow-down",c),f=Wu.DomUtil.create("div","inspect-text",b,a.store.title),g=Wu.DomUtil.create("div","inspect-eye",b),h=Wu.DomUtil.create("div","inspect-kill",b);if(this._list.firstChild){var i=this._list.firstChild;i.parentNode.insertBefore(b,i)}else this._list.appendChild(b);var j={wrapper:b,upArrow:d,downArrow:e,text:f,eye:g,kill:h,layer:a,uuid:a.store.uuid,isolated:!1};this.layers.unshift(j),Wu.DomEvent.on(d,"dblclick click",function(a){Wu.DomEvent.stop(a),this.moveUp(j)},this),Wu.DomEvent.on(e,"dblclick click",function(a){Wu.DomEvent.stop(a),this.moveDown(j)},this),Wu.DomEvent.on(g,"dblclick click",function(a){Wu.DomEvent.stop(a),this.isolateToggle(j)},this),Wu.DomEvent.on(h,"dblclick click",function(a){Wu.DomEvent.stop(a),this.killLayer(j)},this),Wu.DomEvent.on(f,"dblclick click",function(a){Wu.DomEvent.stop(a),this.select(j)},this),Wu.DomEvent.on(b,"mousedown dblclick click",Wu.DomEvent.stop,this),Wu.DomEvent.on(this._content,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this),this.updateZIndex()},removeLayer:function(a){var b=_.find(this.layers,function(b){return b.uuid==a.store.uuid});this._removeLayer(b),0==this.layers.length&&(this._content.style.display="none")},_removeLayer:function(a){Wu.DomUtil.remove(a.wrapper),_.remove(this.layers,function(b){return b.uuid==a.uuid}),0==this.layers.length&&(this._content.style.display="none")},moveUp:function(a){var b=_.findIndex(this.layers,{uuid:a.uuid});if(0!=b){var c=this.layers[b-1],d=a.wrapper,e=c.wrapper;d.parentNode.insertBefore(d,e),this.layers.moveUp(a),this.updateZIndex()}},moveDown:function(a){var b=_.findIndex(this.layers,{uuid:a.uuid});if(b!=this.layers.length-1){var c=this.layers[b+1],d=a.wrapper,e=c.wrapper;e.parentNode.insertBefore(e,d),this.layers.moveDown(a),this.updateZIndex()}},updateZIndex:function(){var a=this.layers.length;this.layers.forEach(function(b,c){var d=b.layer,e=a-c;d.setZIndex(e)},this)},isolateToggle:function(a){a.isolated?(a.isolated=!1,this.isolateLayers(),Wu.DomUtil.removeClass(a.eye,"inspecting")):(a.isolated=!0,this.isolateLayers(),Wu.DomUtil.addClass(a.eye,"inspecting"))},_noneAreIsolated:function(){var a=_.filter(this.layers,function(a){return 1==a.isolated});return 0==a.length?!0:!1},isolateLayers:function(){return this._noneAreIsolated()?void this.layers.forEach(function(a){a.layer.show()},this):void this.layers.forEach(function(a){a.isolated?a.layer.show():a.layer.hide()},this)},killLayer:function(a){this._removeLayer(a);var b=app.MapPane.layerMenu;b&&b._disableLayer(a.layer);var c=app.MapPane.legendsControl;c&&c.removeLegend(a.layer);var d=app.MapPane.descriptionControl;d&&d.removeLayer(a.layer),0==this.layers.length&&(this._content.style.display="none")},select:function(a){var b=app.MapPane.descriptionControl;b&&b.setLayer(a.layer),this.activeEntry=a}}),L.control.inspect=function(a){return new L.Control.Inspect(a)},L.Control.Description=L.Control.extend({options:{position:"bottomright"},onAdd:function(){{var a="leaflet-control-description",b=L.DomUtil.create("div",a);this.options}return b.innerHTML=ich.descriptionControl(),b},initContainer:function(){this._container.style.display="none",this._content=Wu.DomUtil.get("description-control-inner-content"),this._outer=Wu.DomUtil.get("description-control-inner-content-box"),this._button=Wu.DomUtil.get("description-toggle-button"),this._legendsContainer=Wu.DomUtil.get("legends-control-inner-content"),this._legendsCollapser=Wu.DomUtil.get("legends-collapser"),this._inner=document.createElement("div"),this._outer.appendChild(this._inner),Wu.DomUtil.addClass(this._inner,"description-scroller")},setDescription:function(a){this._inner.innerHTML=a.store.description},clear:function(){this.activeLayer=!1,this._inner.innerHTML=""},setActiveLayer:function(a){this.setLayer(a)},setLayer:function(a){this.activeLayer=a,this.setDescription(a),a.store.description||(this.closePane(),this.clear())},removeLayer:function(a){this.activeLayer==a&&this.clear()},update:function(a){this.project=a||Wu.app.activeProject,this.editMode=this.project.editMode,this.editing=!1,this.activeLayer=!1,this.initContainer(),this.addHooks(),this.clear()},addHooks:function(){Wu.DomEvent.on(this._button,"mousedown",this.closePane,this),this.editMode&&Wu.DomEvent.on(this._inner,"dblclick",this.toggleEdit,this),Wu.DomEvent.on(this._container,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this._button,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this)},removeHooks:function(){Wu.DomEvent.off(this._button,"mousedown",this.closePane,this),this.editMode&&Wu.DomEvent.off(this._inner,"dblclick",this.toggleEdit,this),Wu.DomEvent.off(this._container,"dblclick",Wu.DomEvent.stop,this),Wu.DomEvent.off(this._container,"dblclick",Wu.DomEvent.stop,this),Wu.DomEvent.off(this._container,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this)},toggleEdit:function(){this.editing||this.editOn()},editOn:function(){if(this.activeLayer){this.editing=!0,this.addGrande(),app._map.dragging.disable(),Wu.DomUtil.addClass(this._inner,"description-editing"),Wu.DomEvent.on(this._inner,"keydown",this.keyDown,this);var a=app._map;a.scrollWheelZoom.disable()}},keyDown:function(a){(27==a.keyCode||9==a.keyCode)&&this.editOff()},editOff:function(){this.editing=!1,this.removeGrande(),app._map.dragging.enable(),Wu.DomUtil.removeClass(this._inner,"description-editing"),this._inner.setAttribute("contenteditable","false");var a=app._map;if(a.scrollWheelZoom.enable(),this.activeLayer){var b=this._inner.innerHTML;this.activeLayer.store.description=b,this.activeLayer.save("description"),app.setSaveStatus()}},textChange:function(a){a||this.editOff()},removeGrande:function(){this.grande&&(this.grande.destroy(),delete this.grande)},addGrande:function(){var a=this._inner,b=(this.project.getFiles(),this.project.getGrandeFiles()),c=this.project.getGrandeImages(),d={plugins:{attachments:new G.Attachments(b,{icon:[app.options.servers.portal+"images/image-c9471cb2-7e0e-417d-a048-2ac501e7e96f",app.options.servers.portal+"images/image-7b7cc7e4-404f-4e29-9d7d-11f0f24faf42"],className:"attachment"}),images:new G.Attachments(c,{icon:[app.options.servers.portal+"images/image-0359b349-6312-4fe5-b5d7-346a7a0d3c38",app.options.servers.portal+"images/image-087ef5f5-b838-48bb-901f-7e896de7c59e"],embedImage:!0,className:"image-attachment"})},events:{change:this.textChange.bind(this)}};this.grande=G.rande(a,d)},closePane:function(){this._container.style.display="none"},openPane:function(){this._container.style.display="block"}}),L.control.description=function(a){return new L.Control.Description(a)},L.Control.Legends=L.Control.extend({options:{position:"bottomleft"},onAdd:function(){{var a="leaflet-control-legends",b=L.DomUtil.create("div",a);this.options}return b.innerHTML=ich.legendsControl(),this._legendsOpener=Wu.DomUtil.createId("div","legends-opener"),this._legendsOpener.innerHTML="Open Legends",Wu.DomUtil.addClass(this._legendsOpener,"opacitizer"),b},addHooks:function(){Wu.DomEvent.on(this._legendsCollapser,"click",this.closeLegends,this),Wu.DomEvent.on(this._container,"mousewheel",Wu.DomEvent.stop,this),Wu.DomEvent.on(this._legendsScrollLeft,"click",this.legendsScrollLeft,this),Wu.DomEvent.on(this._legendsScrollRight,"click",this.legendsScrollRight,this),Wu.DomEvent.on(this._container,"dblclick",Wu.DomEvent.stop,this),Wu.DomEvent.on(this._container,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this),Wu.DomEvent.on(this._legendsCollapser,"mousedown click dblclick",Wu.DomEvent.stopPropagation,this)},checkWidth:function(){var a=window.innerWidth;app.MapPane.layerMenu&&(a-=300),this.sliderWidth>a?(this._legendsScrollLeft.style.display="block",this._legendsScrollRight.style.display="block"):(this._legendsScrollLeft.style.display="none",this._legendsScrollRight.style.display="none"),app.MapPane.inspectControl?app.MapPane.inspectControl._container.offsetWidth>=100&&Wu.DomUtil.addClass(this._legendsContainer,"legends-padding-right"):Wu.DomUtil.removeClass(this._legendsContainer,"legends-padding-right")},closeLegends:function(){var a=this._legendsInner.getElementsByTagName("div")[0];this._legendsInner.insertBefore(this._legendsOpener,a),Wu.DomEvent.on(this._legendsOpener,"click",this.openLegends,this),this._legendsInner.style.width=this._legendsWidth+"px",this._legendsInner.style.height=this._legendsHeight+"px";var b=this;setTimeout(function(){b._legendsInner.style.width="150px",b._legendsInner.style.height="24px",b._legendsScrollLeft.style.display="none",b._legendsScrollRight.style.display="none"},10),setTimeout(function(){b._legendsCollapser.style.display="none",b._legendsCollapser.style.opacity="0",this._openWidth=0,this._openHeight=0,this._legendsWidth=0,this._legendsHeight=0},500)},openLegends:function(){this._legendsOpener.className="",this._legendsOpener.style.opacity="0",this._legendsInner.style.width=this.sliderWidth+"px",this.checkWidth(),this._legendsInner.style.height=this._openHeight-5+"px";var a=this;setTimeout(function(){a._legendsInner.removeAttribute("style"),a._legendsOpener.removeAttribute("style"),a._legendsInner.removeChild(a._legendsOpener),Wu.DomUtil.addClass(a._legendsCollapser,"opacitizer"),a._legendsCollapser.style.opacity="1",a._legendsCollapser.style.display="block"},500)},update:function(a){this.initContainer(),this.project=a||Wu.app._activeProject,this._content=Wu.DomUtil.get("legends-control-inner-content"),this.calculateHeight()},initContainer:function(){this._legendsCollapser=Wu.DomUtil.get("legends-collapser"),this._legendsInner=Wu.DomUtil.get("legends-inner"),this._legendsContainer=Wu.DomUtil.get("legends-control-inner-content"),this._legendsInnerSlider=Wu.DomUtil.get("legends-inner-slider"),this._legendsScrollLeft=Wu.DomUtil.get("legends-scroll-left"),this._legendsScrollRight=Wu.DomUtil.get("legends-scroll-right"),this.addHooks(),this.legends={},this.legendsCounter=[],this.sliderWidth=0,this.sliderOffset=0},addLegend:function(a){var b=a.store.uuid,c=a.getLegends();if(c){this._legendsContainer.style.display="block";var d=Wu.DomUtil.create("div","legends-item",this._legendsInnerSlider),e=150*Math.round(c.length/4);150>e&&(e=150),d.style.width=e+"px",this.sliderWidth+=e,this._legendsInnerSlider.style.width=this.sliderWidth+"px";var f=d.offsetWidth;this.legends[b]={layer:a,div:d,width:f};var g={id:b,width:f};this.legendsCounter.push(g);{Wu.DomUtil.create("div","legend-header",d)}this._legendsList=Wu.DomUtil.create("div","legend-list",d),c.forEach(function(a){{var b=Wu.DomUtil.create("div","legend-each",this._legendsList),c=Wu.DomUtil.create("div","legend-feature",b),d=Wu.DomUtil.create("img","legend-image1",c),e=Wu.DomUtil.create("img","legend-image2",c);Wu.DomUtil.create("div","legend-feature-name",b,a.value)}d.src=a.base64,e.src=a.base64},this),this.checkWidth(),this.calculateHeight()}},_addLegend:function(){},removeLegend:function(a){var b=a.store.uuid,c=this.legends[b];if(c){var d=c.div.getBoundingClientRect();d.left<0&&(Wu.DomUtil.removeClass(this._legendsInnerSlider,"legends-inner-slider-sliding"),this._legendsInnerSlider.style.left=this._legendsInnerSlider.offsetLeft+c.width+"px",this.sliderOffset--);var e=this;setTimeout(function(){Wu.DomUtil.addClass(e._legendsInnerSlider,"legends-inner-slider-sliding")},500),this.sliderWidth-=c.width;for(var f=0;f<this.legendsCounter.length;f++)this.legendsCounter[f].id==b&&this.legendsCounter.splice(f,1);this._legendsInnerSlider.style.width=this.sliderWidth+"px";var g=c.div;Wu.DomUtil.remove(g),delete this.legends[b],this.checkWidth(),this.calculateHeight(),0==this.legendsCounter.length&&(this._legendsContainer.style.display="none")}},legendsScrollLeft:function(){if(!this.scrolling&&this.sliderOffset>=1){this.sliderOffset--;var a=this.legendsCounter[this.sliderOffset].width,b=this._legendsInnerSlider.offsetLeft;this._legendsInnerSlider.style.left=b+a+"px",this.scrolling=!0;var c=this;setTimeout(function(){c.scrolling=!1},500)}},legendsScrollRight:function(){if(!this.scrolling&&this.sliderOffset<=this.legendsCounter.length-1){var a=this.legendsCounter[this.sliderOffset].width,b=this._legendsInnerSlider.offsetLeft,c=this._legendsInner.offsetWidth-(this._legendsInnerSlider.offsetWidth+b);if(0>=c){this._legendsInnerSlider.style.left=b-a+"px",this.sliderOffset++,this.scrolling=!0;var d=this;setTimeout(function(){d.scrolling=!1},500)}}},calculateHeight:function(){this._legendsHeight=this._legendsInner.offsetHeight,this._legendsWidth=this._legendsInner.offsetWidth,this._openHeight=this._legendsInner.offsetHeight,this._openWidth=this._legendsInner.offsetWidth,app.StatusPane.setContentHeights()}}),L.control.legends=function(a){return new L.Control.Legends(a)},L.Control.MousePosition=L.Control.extend({options:{position:"topright",separator:" : ",emptyString:"Lat/Lng",lngFirst:!1,numDigits:5,lngFormatter:void 0,latFormatter:void 0,prefix:""},onAdd:function(a){return this._container=L.DomUtil.create("div","leaflet-control-mouseposition"),this._container.innerHTML=this.options.emptyString,L.DomEvent.disableClickPropagation(this._container),a.on("mousemove",this._onMouseMove,this),this._container},onRemove:function(a){a.off("mousemove",this._onMouseMove,this)},_onMouseMove:function(a){var b=this.options.lngFormatter?this.options.lngFormatter(a.latlng.lng):L.Util.formatNum(a.latlng.lng,this.options.numDigits),c=this.options.latFormatter?this.options.latFormatter(a.latlng.lat):L.Util.formatNum(a.latlng.lat,this.options.numDigits),d=this.options.lngFirst?b+this.options.separator+c:c+this.options.separator+b,e=this.options.prefix+" "+d;this._container.innerHTML=e}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.mouseposition=function(a){return new L.Control.MousePosition(a)},L.Control.BaselayerToggle=L.Control.extend({options:{collapsed:!0,position:"topleft",autoZIndex:!0},onAdd:function(){return this._initLayout(),this.update(),this._container},addTo:function(a){this._map=a;var b=this._container=this.onAdd(a),c=this.getPosition(),d=a._controlCorners[c];return L.DomUtil.addClass(b,"leaflet-control"),d.appendChild(b),this},_initLayout:function(){var a="leaflet-control-baselayertoggle",b=this._container=L.DomUtil.create("div",a);Wu.DomEvent.on(b,"mousedown",this.toggle,this),Wu.DomEvent.on(b,"dblclick",Wu.DomEvent.stop,this)},update:function(){if(this._container){this.project=this.project||app.activeProject,this._list&&Wu.DomUtil.remove(this._list),this._layers={},this._list=L.DomUtil.create("div","baselayertoggle-list collapsed",this._container),Wu.DomEvent.on(this._list,"dblclick",Wu.DomEvent.stop,this);var a=this.project.getBaselayers();if(a)return a.forEach(function(a){var b={layer:this.project.getLayer(a.uuid),baseLayer:a};this.addLayer(b)},this),this}},addLayer:function(a){if(!a.layer)return void 0;var b=a.layer.getTitle(),c=Wu.DomUtil.create("div","baselayertoggle-item active",this._list,b);a.active=!0;var d=L.stamp(a);this._layers[d]=a,Wu.DomEvent.on(c,"mousedown",function(b){Wu.DomEvent.stop(b),this.toggleLayer(a,c)},this)},toggleLayer:function(a,b){var c=this._layers[L.stamp(a)].layer;a.active?(c.disable(),a.active=!1,Wu.DomUtil.removeClass(b,"active")):(c.enable(),a.active=!0,Wu.DomUtil.addClass(b,"active"))},toggle:function(){this._isOpen?this.collapse():this.expand()},collapse:function(){this._isOpen=!1,Wu.DomUtil.addClass(this._list,"collapsed")},expand:function(){this._isOpen=!0,Wu.DomUtil.removeClass(this._list,"collapsed")}}),L.control.baselayerToggle=function(a){return new L.Control.BaselayerToggle(a)},Wu.Project=Wu.Class.extend({initialize:function(a){this.store={},Wu.extend(this.store,a),this.setEditMode(),this.lastSaved={},this._client=Wu.app.Clients[this.store.client]},initLayers:function(){this.store.layers&&(this.layers={},this.addLayers(this.store.layers))},addLayers:function(a){a.forEach(function(a){this.addLayer(a)},this)},addLayer:function(a){this.store.layers.push(a),this.layers[a.uuid]=new Wu.createLayer(a)},createLayerFromGeoJSON:function(a){var b=JSON.stringify({project:this.getUuid(),geojson:a,layerType:"geojson"});Wu.Util.postcb("/api/layers/new",b,this._createdLayerFromGeoJSON,this)},_createdLayerFromGeoJSON:function(a,b){var c=JSON.parse(b);app.SidePane.DataLibrary.uploaded(c,{autoAdd:!0})},createLayer:function(){},setActive:function(){this.select()},setEditMode:function(){this.editMode=!1,app.Account.canUpdateProject(this.store.uuid)&&(this.editMode=!0)},refresh:function(){this._refresh(),this.refreshMappane(),this.refreshHeaderpane(),this.refreshSidepane(),this._menuItem&&this._menuItem._markActive()},addNewLayer:function(a){this.addLayer(a)},refreshSidepane:function(){Wu.Util.isObject(Wu.app.SidePane)&&Wu.app.SidePane.setProject(this)},refreshHeaderpane:function(){Wu.Util.isObject(Wu.app.HeaderPane)&&Wu.app.HeaderPane.setProject(this)},refreshMappane:function(){Wu.Util.isObject(Wu.app.MapPane)&&Wu.app.MapPane.setProject(this)},_refresh:function(){this.setEditMode(),this.initLayers(),this._setUrl(),this.setColorTheme(),this.refreshSettings()},select:function(){Wu.DomUtil.removeClass(Wu.app._headerPane,"displayNone"),app.activeProject=this,this.selected=!0,this.refresh()},_setUrl:function(){var a="/";a+=this._client.slug,a+="/",a+=this.store.slug,Wu.Util.setAddressBar(a)},setStore:function(a){this.store=a,this.refresh()},setMapboxAccount:function(a){this.store=a,this._refresh(),this.refreshSidepane()},_update:function(a){var b={};b[a]=this.store[a],b.uuid=this.store.uuid;var c=JSON.stringify(b);this._save(c)},save:function(){},_save:function(a){Wu.save("/api/project/update",a),app.setSaveStatus()},_saveNew:function(a){var b={name:this.store.name,description:this.store.description,keywords:this.store.keywords,client:this._client.uuid},c=JSON.stringify(b);Wu.Util.postcb("/api/project/new",c,a.callback.bind(a.context),this)},unload:function(){Wu.app.MapPane.reset(),Wu.app.HeaderPane.reset(),this.selected=!1},_delete:function(){var a=JSON.stringify({pid:this.store.uuid,projectUuid:this.store.uuid,clientUuid:this._client.uuid});Wu.Util.postcb("/api/project/delete",a,this._deleted,this)},_deleted:function(a){app.Account.removeProjectAccess(a),delete Wu.app.Projects[a.uuid]},saveColorTheme:function(){this.colorTheme=savedCSS,this._update("colorTheme")},setColorTheme:function(){this.colorTheme&&(savedCSS=this.colorTheme,Wu.Util.setColorTheme())},removeMapboxAccount:function(a){_.remove(this.store.connectedAccounts.mapbox,function(b){return b==a}),this._update("connectedAccounts")},getName:function(){return this.store.name},getDescription:function(){return this.store.description},getLogo:function(){return this.store.logo},getUuid:function(){return this.store.uuid},getLastUpdated:function(){return this.store.lastUpdated},getClient:function(){return app.Clients[this.store.client]},getClientUuid:function(){return this.store.client},getBaselayers:function(){return this.store.baseLayers},getLayermenuLayers:function(){return _.filter(this.store.layermenu,function(a){return!a.folder})},getLayers:function(){return _.toArray(this.layers)},getActiveLayers:function(){var a=this.getBaselayers(),b=this.getLayermenuLayers(),c=a.concat(b),d=[];return c.forEach(function(a){if(!a.folder){var b=a.layer||a.uuid,c=this.layers[b];d.push(c)}},this),d},getLayer:function(a){return this.layers[a]},getStylableLayers:function(){var a=this.getActiveLayers(),b=_.filter(a,function(a){return a?a.store.data.hasOwnProperty("geojson"):void 0});return b},getLayerFromFile:function(a){return _.find(this.layers,function(b){return b.store.file==a})},getFiles:function(){return this.store.files},getFile:function(a){var b=_.find(this.store.files,function(b){return b.uuid==a});return b},getBounds:function(){var a=this.store.bounds;return _.isEmpty(a)?!1:a},getLatLngZoom:function(){var a={lat:this.store.position.lat,lng:this.store.position.lng,zoom:this.store.position.zoom};return a},getPosition:function(){return this.getLatLngZoom()},getCollections:function(){},setCollection:function(){},getUsers:function(){var a=this.store.uuid,b=_.filter(app.Users,function(b){return b.store.role.reader.projects.indexOf(a)>-1});return b},getSlug:function(){return this.store.slug},getSlugs:function(){var a={project:this.store.slug,client:this.getClient().getSlug()};return a},getUsersHTML:function(){var a=this.getUsers(),b="",c=app.options.silentUsers;return a.forEach(function(a){var d=a.store.uuid.slice(0,13);-1==c.indexOf(d)&&(b+="<p>"+a.store.firstName+" "+a.store.lastName+"</p>")},this),b},addAccess:function(){var a=app.Users;for(u in a){var b=a[u];b.isSuperadmin()&&b.addProjectAccess(this)}app.Account.addProjectAccess(this)},getHeaderLogo:function(){var a=this.store.header.logo;return a||(a=this.store.logo),a},getHeaderLogoBg:function(){var a=this.store.header.logo;a||(a=this.store.logo);var b="url('"+a+"')";return b},getHeaderTitle:function(){return this.store.header.title},getHeaderSubtitle:function(){return this.store.header.subtitle},getHeaderHeight:function(){return parseInt(this.store.header.height)},getMapboxAccounts:function(){return this.store.connectedAccounts.mapbox},getControls:function(){return this.store.controls},getSettings:function(){return this.store.settings},setSettings:function(a){this.store.settings=a,this._update("settings")},setFile:function(a){this.store.files.push(a)},setLogo:function(a){this.store.logo=a,this._update("logo")},setHeaderLogo:function(a){this.store.header.logo=a,this._update("header")},setHeaderTitle:function(a){this.store.header.title=a,this._update("header")},setHeaderSubtitle:function(a){this.store.header.subtitle=a,this._update("header")},setName:function(a){this.store.name=a,this._update("name")},setDescription:function(a){this.store.description=a,this._update("description")},setSlug:function(a){var b=a.replace(/\s+/g,"").toLowerCase();b=Wu.Util.stripAccents(b),this.store.slug=b,this._update("slug"),this._setUrl()},setBounds:function(a){this.store.bounds=a,this._update("bounds")},setBoundsSW:function(a){this.store.bounds.southWest=a,this._update("bounds")},setBoundsNE:function(a){this.store.bounds.northEast=a,this._update("bounds")},setBoundsZoomMin:function(a){this.store.bounds.zoomMin=a,this._update("bounds")},setPosition:function(a){this.store.position=a,this._update("position")},setSidepane:function(a){this._menuItem=a},getSidepane:function(){return this._menuItem},removeFiles:function(a){var b=app.SidePane.DataLibrary.list,c=app.MapPane.layerMenu,d=[],e=[],f=this;a.forEach(function(a){b.remove("uuid",a.uuid),_.remove(this.store.files,function(b){return b.uuid==a.uuid});var f=_.find(this.layers,function(b){return b.store.file==a.uuid});if(f){_.remove(this.store.layermenu,function(a){return a.layer==f.store.uuid}),_.remove(this.store.baseLayers,function(a){return a.uuid==f.store.uuid}),c&&c.onDelete(f);{_.remove(this.store.layers,function(a){return a.uuid==f.store.uuid})}delete this.layers[f.store.uuid]}d.push(a._id),e.push(a.uuid)},this),this._update("layermenu"),setTimeout(function(){var a={_fids:d,puuid:f.store.uuid,uuids:e},b=JSON.stringify(a);Wu.save("/api/file/delete",b)},1e3)},getGrandeFiles:function(){var a=this.getFiles(),b=this._formatGrandeFiles(a);return b},getGrandeImages:function(){var a=this.getFiles(),b=this._formatGrandeImages(a);return b},_formatGrandeImages:function(a){var b=[];return a.forEach(function(a){if("image"==a.type){var c="/pixels/"+a.uuid+"?width=75&height=50",d="/pixels/"+a.uuid+"?width=200&height=200",e={title:a.name,thumbnail:c,uuid:a.uuid,type:a.type,url:d};b.push(e)}},this),b},_formatGrandeFiles:function(a){var b=[];return a.forEach(function(a){var c="image"==a.type?"/pixels/"+a.uuid+"?width=50&height=50":"",d="image"==a.type?"/images/":"/api/file/download/?file=",e=d+a.uuid,f={title:a.name,thumbnail:c,uuid:a.uuid,type:a.type,url:e};b.push(f)},this),b},refreshSettings:function(){for(setting in this.getSettings())this.getSettings()[setting]?this["enable"+setting.camelize()]():this["disable"+setting.camelize()]()},toggleSetting:function(a){this.getSettings()[a]?this["disable"+a.camelize()]():this["enable"+a.camelize()](),this.store.settings[a]=!this.store.settings[a],this._update("settings")},enableDarkTheme:function(){app.Style.setDarkTheme()},disableDarkTheme:function(){app.Style.setLightTheme()},enableTooltips:function(){},disableTooltips:function(){},enableScreenshot:function(){app.SidePane.Share.enableScreenshot()},disableScreenshot:function(){app.SidePane.Share.disableScreenshot()},enableDocumentsPane:function(){app.SidePane.addPane("Documents")},disableDocumentsPane:function(){app.SidePane.removePane("Documents")},enableDataLibrary:function(){app.SidePane.addPane("DataLibrary")},disableDataLibrary:function(){app.SidePane.removePane("DataLibrary")},enableMediaLibrary:function(){},disableMediaLibrary:function(){},enableSocialSharing:function(){app.SidePane.Share.enableSocial()},disableSocialSharing:function(){app.SidePane.Share.disableSocial()},enableAutoHelp:function(){},disableAutoHelp:function(){},enableAutoAbout:function(){},disableAutoAbout:function(){},enableMapboxGL:function(){},disableMapboxGL:function(){}}),Wu.Client=Wu.Class.extend({initialize:function(a){Wu.extend(this,a),this.options={},this.options.editMode=!1},setEditMode:function(){this.editMode=!1,app.Account.canUpdateClient(this.uuid)&&(this.editMode=!0)},setActive:function(){this.setEditMode(),this._setUrl(),this._isActive()||(Wu.app._activeClient=this)},_isActive:function(){return Wu.Util.isObject(Wu.app._activeClient)&&Wu.app._activeClient.uuid==this.uuid?!0:!1},_setUrl:function(){var a="/"+this.slug+"/";Wu.Util.setAddressBar(a)},update:function(a){var b={};b[a]=this[a],b.uuid=this.uuid;var c=JSON.stringify(b);this._save(c)},_save:function(a){Wu.save("/api/client/update",a)},saveNew:function(){var a={name:this.name,description:this.description,keywords:this.keywords},b=JSON.stringify(a),c=Wu.app.SidePane.Clients;Wu.Util.postcb("/api/client/new",b,c._created,this)},destroy:function(){this._delete()},_delete:function(){var a=this,b={cid:a.uuid};b=JSON.stringify(b),Wu.Util.postcb("/api/client/delete",b,a._deleted,a)},_deleted:function(a){delete Wu.app.Clients[a.uuid]},getName:function(){return this.name},getDescription:function(){return this.description},getLogo:function(){return this.logo},getUuid:function(){return this.uuid},getSlug:function(){return this.slug},setName:function(a){this.name=a,this.update("name")},setDescription:function(a){this.description=a,this.update("description")},setLogo:function(a){this.logo=a,this.update("logo")}}),Wu.User=Wu.Class.extend({initialize:function(a){this.store=a,this.lastSaved=_.cloneDeep(a)},setLastName:function(a){this.store.lastName=a,this.save()},setFirstName:function(a){this.store.firstName=a,this.save()},setCompany:function(a){this.store.company=a,this.save()},setPosition:function(a){this.store.position=a,this.save()},setPhone:function(a){this.store.phone=a,this.save()},setMobile:function(a){this.store.mobile=a,this.save()},setEmail:function(a){this.store.local.email=a,this.save()},setKey:function(a,b){return"lastName"==a?this.setLastName(b):"firstName"==a?this.setFirstName(b):"company"==a?this.setCompany(b):"position"==a?this.setPosition(b):"mobile"==a?this.setMobile(b):"phone"==a?this.setPhone(b):"email"==a?this.setEmail(b):void 0},setAccess:function(){},save:function(){this._saveTimer&&clearTimeout(this._saveTimer);var a=this;this._saveTimer=setTimeout(function(){var b=a._findChanges();b&&a._save(b)},1e3)},_save:function(a){Wu.save("/api/user/update",JSON.stringify(a))},isSuperuser:function(){return this.isSuperadmin()},isSuperadmin:function(){return this.store.role.superadmin?!0:!1},isAdmin:function(){return this.store.role.admin?!0:!1},isManager:function(){return _.size(this.store.role.manager.projects)>0||this.isAdmin()||this.isSuperadmin()?!0:!1},attachToApp:function(){app.Users[this.getUuid()]=this},deleteUser:function(a,b){delete app.Users[this.store.uuid];var c=this.store.uuid,d=JSON.stringify({uuid:c});Wu.Util.postcb("/api/user/delete",d,a[b],a)},delegateAccess:function(a,b,c){var d={userUuid:this.getUuid(),projectUuid:a.getUuid(),role:b,add:c};Wu.Util.postcb("/api/user/delegate",JSON.stringify(d),this.delegatedAccess,this),app.setSaveStatus()
},delegatedAccess:function(){},addReadProject:function(a){this.delegateAccess(a,"reader",!0),this.store.role.reader.projects.push(a.getUuid())},removeReadProject:function(a){this.delegateAccess(a,"reader",!1),_.remove(this.store.role.reader.projects,function(b){return b==a.getUuid()})},addUpdateProject:function(a){this.delegateAccess(a,"editor",!0),this.store.role.editor.projects.push(a.getUuid())},removeUpdateProject:function(a){this.delegateAccess(a,"editor",!1),_.remove(this.store.role.editor.projects,function(b){return b==a.getUuid()})},addManageProject:function(a){this.delegateAccess(a,"manager",!0),this.store.role.manager.projects.push(a.getUuid())},removeManageProject:function(a){this.delegateAccess(a,"manager",!1),_.remove(this.store.role.manager.projects,function(b){return b==a.getUuid()})},addProjectAccess:function(a){var b=a.getUuid();this.store.role.editor.projects.push(b),this.store.role.reader.projects.push(b),this.store.role.manager.projects.push(b)},removeProjectAccess:function(a){_.remove(this.store.role.manager.projects,function(b){return b==a.getUuid()}),_.remove(this.store.role.editor.projects,function(b){return b==a.getUuid()}),_.remove(this.store.role.reader.projects,function(b){return b==a.getUuid()})},getKey:function(a){return this.store[a]},getFirstName:function(){return this.store.firstName},getLastName:function(){return this.store.lastName},getFullName:function(){return this.store.firstName+" "+this.store.lastName},getName:function(){return this.getFullName()},getCompany:function(){return this.store.company},getPosition:function(){return this.store.position},getPhone:function(){return this.store.phone},getMobile:function(){return this.store.mobile},getEmail:function(){return this.store.local.email},getProjects:function(){var a=[];return a.push(this.store.role.reader.projects),a.push(this.store.role.editor.projects),a.push(this.store.role.manager.projects),a=_.flatten(a),a=_.unique(a)},getProjectsByRole:function(){var a={};return a.read=this.store.role.reader.projects,a.update=this.store.role.editor.projects,a.manage=this.store.role.manager.projects,a},getClients:function(){var a={};return a.read=this.store.role.reader.clients,a.update=this.store.role.editor.clients,a},getUuid:function(){return this.store.uuid},canCreateProject:function(){return this.store.role.superadmin?!0:this.store.role.admin?!0:!1},canReadProject:function(a){return this.store.role.reader.projects.indexOf(a)>=0?!0:!1},canUpdateProject:function(a){return this.store.role.editor.projects.indexOf(a)>=0?!0:!1},canDeleteProject:function(a){var b=this.store.role.editor.projects.indexOf(a)>=0?!0:!1;return this.store.role.superadmin&&b?!0:this.store.role.admin&&b?!0:!1},canManageProject:function(a){return this.store.role.manager.projects.indexOf(a)>=0?!0:!1},canCreateClient:function(){var a=this.store;return a.role.superadmin?!0:a.role.admin?!0:!1},canReadClient:function(a){return this.store.role.reader.clients.indexOf(a)>=0?!0:!1},canUpdateClient:function(a){return this.store.role.editor.clients.indexOf(a)>=0?!0:!1},canDeleteClient:function(a){var b=this.store.role.editor.clients.indexOf(a)>=0?!0:!1;return this.store.role.superadmin&&b?!0:this.store.role.admin&&b?!0:!1},canCreateSuperadmin:function(){return this.store.role.superadmin?!0:!1},canCreateAdmin:function(){return user.role.superadmin?!0:user.role.admin?!0:!1},canCreateUser:function(a){var b=this.store;return b.role.superadmin?!0:b.role.admin?!0:b.role.manager.projects.indexOf(a)>=0?!0:!1},canUpdateUser:function(){var a=this.store;return a.role.superadmin?!0:a.role.admin?!0:!1},canDeleteUser:function(){},_findChanges:function(){var a=_.cloneDeep(this.store),d=_.cloneDeep(this.lastSaved),e=[];for(c in a)if(_.isObject(a[c])){var f=a[c];for(b in f){{f[b]}if(h=_.isEqual(a[c][b],d[c][b]),!h){var g={};g[c]={},g[c][b]=a[c][b],e.push(g)}}}else{var h=_.isEqual(a[c],d[c]);if(!h){var g={};g[c]=a[c],e.push(g)}}if(0==e.length)return!1;var i={};return e.forEach(function(a){for(c in a)i[c]=a[c]},this),i.uuid=this.getUuid(),this.lastSaved=_.cloneDeep(this.store),i}}),Wu.Layer=Wu.Class.extend({type:"layer",initialize:function(a){this.store=a,this.loaded=!1,this.initLayer(),Wu.DomEvent.on(this.layer,"load",function(){app._loaded.push(this.getUuid())},this)},initLayer:function(){},add:function(a){this.addTo(a)},addTo:function(a){var a=a||Wu.app._map;this.layer.addTo(a),this.gridLayer&&a.addLayer(this.gridLayer);var b=app.MapPane.legendsControl;b&&b.addLegend(this)},remove:function(a){var a=a||Wu.app._map;a.removeLayer(this.layer),this.gridLayer&&a.removeLayer(this.gridLayer);var b=app.MapPane.legendsControl;b&&b.removeLegend(this)},enable:function(){this.addTo()},disable:function(){this.remove()},setOpacity:function(a){this.opacity=a||1,this.layer.setOpacity(this.opacity)},setZIndex:function(a){this.zIndex=a||1,this.layer.setZIndex(this.zIndex)},getOpacity:function(){return this.opacity||1},getContainer:function(){return this.layer.getContainer()},getTitle:function(){return this.store.title},setTitle:function(a){this.store.title=a,this.save("title")},getUuid:function(){return this.store.uuid},getFileUuid:function(){return this.store.file},getProjectUuid:function(){return app.activeProject.store.uuid},setCartoid:function(a){this.store.data.cartoid=a,this.save("data")},getCartoid:function(){return this.store.data?this.store.data.cartoid:!1},setCartoCSS:function(a,b){Wu.post("/api/layers/cartocss/set",JSON.stringify(a),b,this),this.setCartoid(a.cartoid)},getCartoCSS:function(a,b){var c={cartoid:a};Wu.post("/api/layers/cartocss/get",JSON.stringify(c),b,this)},getMeta:function(){var a=this.store.metadata;return a?JSON.parse(a):!1},getMetaFields:function(){var a=this.getMeta();return a&&a.json&&a.json.vector_layers&&a.json.vector_layers[0]&&a.json.vector_layers[0].fields?a.json.vector_layers[0].fields:!1},reloadMeta:function(a){var b=JSON.stringify({fileUuid:this.getFileUuid(),layerUuid:this.getUuid()});Wu.post("/api/layer/reloadmeta",b,a||function(a,b){},this)},getTooltip:function(){var a=this.store.tooltip;if(!a)return!1;var b=JSON.parse(a);return b},setTooltip:function(a){this.store.tooltip=JSON.stringify(a),this.save("tooltip")},getLegends:function(){var a=this.store.legends;return a?JSON.parse(a):!1},setLegends:function(a){a&&(this.store.legends=JSON.stringify(a),this.save("legends"))},createLegends:function(a){var b=JSON.stringify({fileUuid:this.getFileUuid(),cartoid:this.getCartoid()});Wu.post("/api/layer/createlegends",b,a,this)},getFeaturesValues:function(a,b){if(!a||!b)return void 0;var c=JSON.stringify({fileUuid:this.getFileUuid(),cartoid:this.getCartoid()});Wu.post("/api/util/getfeaturesvalues",c,a.bind(b),this)},hide:function(){var a=this.getContainer();a.style.visibility="hidden"},show:function(){var a=this.getContainer();a.style.visibility="visible"},save:function(a){var b={};b[a]=this.store[a],b.layer=this.store.uuid,b.uuid=app.activeProject.getUuid(),this._save(b)},_save:function(a){var b=JSON.stringify(a);Wu.save("/api/layer/update",b)}}),Wu.RasterLayer=Wu.Layer.extend({type:"rasterLayer"}),Wu.CartoCSSLayer=Wu.Layer.extend({initLayer:function(){this.update()},update:function(){var a=app._map;this.layer&&a.removeLayer(this.layer),this._prepareRaster(),this._prepareGrid()},_prepareRaster:function(){var a=this.store.file,b=this.store.data.cartoid||"cartoid",c=app.options.servers.tiles,d=app.accessToken,e=c+"{fileUuid}/{cartoid}/{z}/{x}/{y}.png"+d;this.layer=L.tileLayer(e,{fileUuid:a,cartoid:b,subdomains:"abcd"})},_prepareGrid:function(){var a=this.store.file,b=(this.store.data.cartoid||"cartoid",app.options.servers.utfgrid),c=app.accessToken,d=b+a+"/{z}/{x}/{y}.grid.json"+c;this.gridLayer=new L.UtfGrid(d,{useJsonP:!1,subdomains:"ghi"}),this.gridLayer.on("click",function(a){a.data&&this.openPopup(a.data,a.latlng)},this)},updateStyle:function(){this.update();var a=app._map;this.addTo(a)},openPopup:function(a,b){var c=app._map,d=this._popupContent(a);this.popup=L.popup({offset:[18,0],closeButton:!0,zoomAnimation:!1,maxWidth:400,minWidth:200,maxHeight:350}),this.popup.setContent(d),this.popup.setLatLng(b),this.popup.openOn(c)},_popupContent:function(a){var b=this.getTooltip(),c="";if(b){b.title&&(c+='<div class="tooltip-title">'+b.title+"</div>");for(var d in b.fields){var e=b.fields[d];if(e.on){var f=e.title||e.key,g=a[e.key];c+=f+": "+g+"<br>"}}return c}var c="";for(var h in a){var g=a[h];"NULL"!=g&&"null"!=g&&null!=g&&""!=g&&"undefined"!=g&&"__sid"!=h&&(c+=h+": "+g+"<br>")}return c}}),Wu.MapboxLayer=Wu.Layer.extend({type:"mapboxLayer",initLayer:function(){this.layer=L.mapbox.tileLayer(this.store.data.mapbox,{accessToken:this.store.accessToken}),"grids"in this.store&&(this.gridLayer=L.mapbox.gridLayer(this.store.data.mapbox)),this.loaded=!0}}),Wu.CartodbLayer=Wu.Layer.extend({}),Wu.createLayer=function(a){return a.data.mapbox?new Wu.MapboxLayer(a):a.data.geojson?new Wu.CartoCSSLayer(a):a.data.topojson?new Wu.TopojsonLayer(a):void a.data.raster},Wu.GeojsonLayer=Wu.Layer.extend({type:"geojsonLayer",initLayer:function(){this.layer=L.geoJson(!1,{onEachFeature:this.createPopup})},add:function(a){this.addTo(a)},addTo:function(a){var a=a||Wu.app._map,b=this.layer;this.loaded||this.loadData(),this.bindHoverPopup();var c=app.MapPane.editableLayers;c.addLayer(b)},remove:function(a){var a=a||Wu.app._map,b=this.layer,c=app.MapPane.editableLayers;c.removeLayer(b),this.removeLayerHooks()},addLayerHooks:function(){this.layer.eachLayer(function(a){var b=a.feature.geometry.type;"Polygon"==b&&Wu.DomEvent.on(a,"styleeditor:changed",this.styleChanged,this),"MultiPolygon"==b&&a.eachLayer(function(b){Wu.DomEvent.on(b,"styleeditor:changed",function(c){this.multiStyleChanged(c,b,a)},this)},this)},this)},removeLayerHooks:function(){for(l in this.layer._layers){var a=this.layer._layers[l];Wu.DomEvent.off(a,"styleeditor:changed",this.styleChanged,this)}},getGeojsonUuid:function(){return this.store.data.geojson},loadData:function(){var a=this;if(!this.loaded){app.setStatus("Loading...");var b={uuid:this.getGeojsonUuid(),projectUuid:app.activeProject.getUuid()},c=JSON.stringify(b),d="/api/geojson",e=new XMLHttpRequest,f=window.location.origin;f+=d;var g=this.getDataSize();if(g){var a=this;e.addEventListener("progress",function(b){var c=Math.round(b.loaded/g*100);a.setProgress(c)},!1)}e.open("POST",f,!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&a.dataLoaded(a,e.responseText)},e.send(c)}},dataLoaded:function(a,b){a.setProgress(100);try{a.data=JSON.parse(b)}catch(c){return void 0}return a.data?a.data.error?void 0:(a.layer.addData(a.data),a.loaded=!0,a.setOpacity(),a.renderStyle(),app.setStatus("Loaded!"),this.hideProgress(),this.addLayerHooks(),void app._loaded.push(this.getUuid())):void 0},getDataSize:function(){var a=this.getFileUuid();if(!a)return!1;var b=this.getFile(a);return parseInt(b.dataSize)},getFileUuid:function(){return this.store.file},getFile:function(a){var b=app.activeProject.getFiles(),c=_.find(b,function(b){return b.uuid==a});return c},progress:function(a){this.setProgress(a)},setProgress:function(a){app.ProgressBar.setProgress(a)},hideProgress:function(){app.ProgressBar.hideProgress()},setZIndex:function(a){this.zIndex=a||1,!this.loaded},getContainer:function(){},show:function(){for(l in this.layer._layers){var a=this.layer._layers[l];a._container.style.visibility="visible"}},hide:function(){for(l in this.layer._layers){var a=this.layer._layers[l];a._container.style.visibility="hidden"}},multiStyleChanged:function(a,b,c){var d=c,e=a.style,f=d.feature.properties.__sid;d.setStyle(e),this.saveStyle(e,f)},styleChanged:function(a){var b=a.style,c=a.target,d=c._leaflet_id,e=(this.getPathParentLayer(d),c.feature.properties.__sid);this.saveStyle(b,e)},getPathParentLayer:function(a){return app.MapPane.getEditableLayerParent(a)},saveStyle:function(a,b){var c=this.layer.toGeoJSON(),c={};c.layer=this.getUuid(),c.uuid=this.getProjectUuid(),c.style={__sid:b,style:a},this._save(c),app.setSaveStatus()},renderStyle:function(){var a=this.store.style,b=this.layer._layers;for(l in b){var c=b[l],d=c.feature.properties.__sid,e=_.find(a,function(a){return a.__sid==d});if(e){var f=JSON.parse(e.style);c.setStyle(f)}}},setOpacity:function(a){this.opacity=a||this.opacity||.2,this.loaded&&this.layer.setStyle({opacity:this.opacity,fillOpacity:this.opacity})},getOpacity:function(){return this.opacity||.2},createPopup:function(a,b){if(a.properties){var c=L.popup({offset:[0,-5],closeButton:!1,zoomAnimation:!1,maxWidth:1e3,minWidth:200,maxHeight:150}),d="";for(key in a.properties){var e=a.properties[key];"NULL"!=e&&"null"!=e&&null!=e&&""!=e&&"undefined"!=e&&"__sid"!=key&&(d+=key+": "+e+"<br>")}0!=d.length&&(c.setContent(d),b.bindPopup(c))}},setPopupPosition:function(a){var b=a.layer._popup,c=app._map.mouseEventToLatLng(a.originalEvent);b.setLatLng(c)},bindHoverPopup:function(){}}),Wu.TopojsonLayer=Wu.Layer.extend({type:"topojsonLayer",initLayer:function(){this.layer=L.topoJson(!1,{onEachFeature:this.createPopup})}}),L.TopoJSON=L.GeoJSON.extend({addData:function(a){if("Topology"===a.type)for(key in a.objects)geojson=topojson.feature(a,a.objects[key]),L.GeoJSON.prototype.addData.call(this,geojson);else L.GeoJSON.prototype.addData.call(this,a)}}),L.topoJson=function(a,b){return new L.TopoJSON(a,b)};var colorTheme={},savedCSS,_CTheader=document.getElementsByTagName("head")[0],jcss;jcss=document.createElement("style"),jcss.setAttribute("type","text/css"),jcss.setAttribute("rel","stylesheet"),_CTheader.appendChild(jcss);var menuList=[];Wu.version="0.3-dev",Wu.App=Wu.Class.extend({_:"app",options:{id:"app",portalName:"systemapic",portalLogo:!1,panes:{clients:!0,mapOptions:!0,documents:!0,dataLibrary:!0,users:!0,share:!0,mediaLibrary:!1},settings:{chat:!0,colorTheme:!0,screenshot:!0,socialSharing:!0,print:!0},providers:{mapbox:[{username:"systemapic",accessToken:"pk.eyJ1Ijoic3lzdGVtYXBpYyIsImEiOiJQMWFRWUZnIn0.yrBvMg13AZC9lyOAAf9rGg"}]},servers:{portal:"https://projects.ruppellsgriffon.com/",tiles:"https://{s}.systemapic.com/tiles/",utfgrid:"https://{s}.systemapic.com/utfgrid/"},silentUsers:["user-9fed4b5f","user-e6e5d7d9"]},initialize:function(a){Wu.app=this,Wu.setOptions(this,a),L.mapbox.config.FORCE_HTTPS=!0,L.mapbox.accessToken=this.options.providers.mapbox[0].accessToken,this.initServer()},initServer:function(){var a=(this.options.servers.portal,JSON.stringify(this.options));Wu.post("/api/portal",a,this.initServerResponse,this)},initServerResponse:function(a,b){var c=JSON.parse(b);a.initApp(c)},initApp:function(a){this.options.json=a,this._initContainer(),this._initDependencies(),this._initObjects(),this._initPanes(),this._initView()},_initContainer:function(){var a=this.options.id;this._appPane=Wu.DomUtil.get(a)||Wu.DomUtil.createId("div",a||"app",document.body),this._mapContainer=Wu.DomUtil.createId("div","map-container",this._appPane)},_initDependencies:function(){ich.grabTemplates()},_initObjects:function(){this.Account=new Wu.User(this.options.json.account),this.setToken(),this.Users={},this.options.json.users.forEach(function(a){this.Users[a.uuid]=new Wu.User(a)},this),this.Clients={},this.options.json.clients.forEach(function(a){this.Clients[a.uuid]=new Wu.Client(a,this)},this),this.Projects={},this.options.json.projects.forEach(function(a){this.Projects[a.uuid]=new Wu.Project(a,this)},this)},setToken:function(){this.accessToken="?token=",this.accessToken+=Wu.app.Account.store.token,this.accessToken+=".",this.accessToken+=Wu.app.Account.store._id},_initPanes:function(){this.Style=new Wu.Style,this.StatusPane=new Wu.StatusPane({addTo:this._appPane}),this.ProgressBar=new Wu.ProgressBar({color:"white",addTo:this._appPane}),this.SidePane=new Wu.SidePane,this.HeaderPane=new Wu.HeaderPane,this.MapPane=new Wu.MapPane},_initView:function(){if(!this._initLocation()&&!this._initHotlink()&&!this._lonelyProject()){var a=app.Account;(a.isAdmin()||a.isSuperadmin()||a.isManager())&&this.SidePane.refresh(["Clients","Users"]),this.StartPane=new Wu.StartPane({projects:this.Projects})}},_lonelyProject:function(){if(1==_.size(app.Projects))for(p in app.Projects){var a=app.Projects[p];return this._setProject(a),!0}return!1},_initLocation:function(){{var a=window.location.pathname,b=a.split("/")[1],c=a.split("/")[2],d=a.split("/")[3];window.location.search.split("?"),Wu.Util.parseUrl()}if(!b||!c)return!1;var c=this._projectExists(c,b);return c?(this._setProject(c),d&&6==d.length?this._initHash(c,d):!0):!1},_setProject:function(a){a.select(),app.SidePane.refreshProject(a),Wu.DomUtil.removeClass(app._mapPane,"click-to-start")},_initHotlink:function(){try{this.hotlink=JSON.parse(window.hotlink)}catch(a){this.hotlink=!1}if(!this.hotlink)return!1;var b=this._projectExists(this.hotlink.project,this.hotlink.client);return b?(this._setProject(b),!0):!1},_projectExists:function(a,b){var a=a||window.hotlink.project;for(p in Wu.app.Projects){var c=Wu.app.Projects[p];if(a==c.store.slug&&c._client.slug==b)return c}return!1},getPortalName:function(){return this.options.portalName},setStatus:function(a,b){app.StatusPane.setStatus(a,b)},setSaveStatus:function(){app.StatusPane.setSaveStatus()},_initHash:function(a,b){return this.getHash(b,a,this._renderHash),!0},getHash:function(a,b,c){var d={projectUuid:b.getUuid(),id:a};Wu.post("/api/project/hash/get",JSON.stringify(d),c,this)},_renderHash:function(a,b){var c=JSON.parse(b);c.error;var d=c.hash,e=d.project||c.project;app.MapPane.setPosition(d.position),d.layers.forEach(function(a){var b=app.Projects[e].layers[a];app.MapPane.layerMenu,b.add()},this)},setHash:function(a){var b=app.MapPane.getActiveLayers(),c=_.map(b,function(a){return a.item.layer}),d=this.activeProject.getUuid(),e={projectUuid:d,hash:{id:Wu.Util.createRandom(6),position:app.MapPane.getPosition(),layers:c}};return Wu.post("/api/project/hash/set",JSON.stringify(e),a,this),e.hash},phantomJS:function(a){var b=a.projectUuid,c=a.hash;if(!b)return!1;var d=app.Projects[b];if(!d)return!1;if(this._setProject(d),app._map._controlContainer.style.display="none",app.HeaderPane._container.style.width="auto",c){var e=JSON.stringify({hash:c,project:b});this._renderHash(this,e)}app.setStatus("systemapic")},_phantomJSLoaded:function(){},_loaded:[],_loadLayers:function(){},_allLoaded:function(){}});